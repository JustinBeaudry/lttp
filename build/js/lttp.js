/**
 * @license
 * GrapeFruit Game Engine - v0.1.0
 * Copyright (c) 2012, Chad Engler
 * https://github.com/grapefruitjs/grapefruit
 *
 * Compiled: 2013-11-19
 *
 * GrapeFruit Game Engine is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license.php
 */

/**
 * almond 0.2.6 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

(function(){(function(e){var t=typeof define=="function"&&define.amd,n=typeof exports=="object",i=!n,s=e,o=n?require:void 0,u=function(){var e,t,n;return function(r){function d(e,t){return h.call(e,t)}function v(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function m(e,t){return function(){return s.apply(r,p.call(arguments,0).concat([e,t]))}}function g(e){return function(t){return v(t,e)}}function y(e){return function(t){a[e]=t}}function b(e){if(d(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!d(a,e)&&!d(c,e))throw new Error("No "+e);return a[e]}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice;o=function(e,t){var n,r=w(e),i=r[0];return e=r[1],i&&(i=v(i,t),n=b(i)),i?n&&n.normalize?e=n.normalize(e,g(t)):e=v(e,t):(e=v(e,t),r=w(e),i=r[0],e=r[1],i&&(n=b(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return m(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:E(e)}}},i=function(e,t,n,i){var s,l,h,p,v,g=[],w;i=i||e;if(typeof n=="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(v=0;v<t.length;v+=1){p=o(t[v],i),l=p.f;if(l==="require")g[v]=u.require(e);else if(l==="exports")g[v]=u.exports(e),w=!0;else if(l==="module")s=g[v]=u.module(e);else if(d(a,l)||d(f,l)||d(c,l))g[v]=b(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,m(i,!0),y(l),{}),g[v]=a[l]}}h=n.apply(a[e],g);if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!w)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){return typeof e=="string"?u[e]?u[e](t):b(o(e,t).f):(e.splice||(l=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s)},s.config=function(e){return l=e,l.deps&&s(l.deps,l.callback),s},e._defined=a,n=function(e,t,n){t.splice||(n=t,t=[]),!d(a,e)&&!d(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("almond",[],function(){}),n("constants",["require","exports","module"],function(e,t,n){var r={RENDERER:{AUTO:"auto",CANVAS:"canvas",WEBGL:"webgl"},FILE_FORMAT:{JSON:"json",XML:"xml",CSV:"csv"},ATLAS_FORMAT:{JSON_ARRAY:"json_array",JSON_HASH:"json_hash",XML_STARLING:"xml_starling"},CAMERA_FOLLOW:{PLATFORMER:0,TOPDOWN:1,TOPDOWN_TIGHT:2,LOCKON:3},AXIS:{NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},DIRECTION:{NONE:0,LEFT:1,RIGHT:2,TOP:4,BOTTOM:8,ALL:15},SHAPE:{CIRCLE:1,POLYGON:2,RECTANGLE:3}};return n.exports=r,r.pkg={name:"gf",version:"0.1.0",longName:"GrapeFruit Game Engine",description:"A fun and easy WebGL-enabled JavaScript Game Engine",author:"Chad Engler <chad@pantherdev.com>",contributors:[],homepage:"https://github.com/grapefruitjs/grapefruit",bugs:"https://github.com/grapefruitjs/grapefruit/issues",license:"MIT",licenseUrl:"http://www.opensource.org/licenses/mit-license.php",repository:{type:"git",url:"https://github.com/grapefruitjs/grapefruit.git"},main:"build/gf.js",dependencies:{},devDependencies:{grunt:"~0.4.1","grunt-contrib-jshint":"git+https://github.com/englercj/grunt-contrib-jshint","grunt-contrib-connect":"~0.5","grunt-contrib-yuidoc":"~0.5","grunt-contrib-watch":"~0.5","grunt-contrib-concat":"~0.3","grunt-mocha":"git+https://github.com/englercj/grunt-mocha.git","grunt-urequire":"~0.6",glob:"~3.2",should:"~2.1"},scripts:{build:"grunt build",test:"grunt test"},"private":!0},n.exports}),n("vendor/hand-1.1.2.js",["require","exports","module"],function(e,t,n){Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>0&&(r=Number(arguments[1]),r!=r?r=0:r!=0&&r!=Infinity&&r!=-Infinity&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1});var r=["PointerDown","PointerUp","PointerMove","PointerOver","PointerOut","PointerCancel","PointerEnter","PointerLeave","pointerdown","pointerup","pointermove","pointerover","pointerout","pointercancel","pointerenter","pointerleave"],i="touch",o="pen",u="mouse",a={},f=function(e){while(e&&e.handjs_forcePreventDefault!==!0)e=e.parentElement;return e!=null},l=function(e,t){var n;document.createEvent?(n=document.createEvent("MouseEvents"),n.initMouseEvent(t,!0,!0,s,1,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,null)):(n=document.createEventObject(),n.screenX=e.screenX,n.screenY=e.screenY,n.clientX=e.clientX,n.clientY=e.clientY,n.ctrlKey=e.ctrlKey,n.altKey=e.altKey,n.shiftKey=e.shiftKey,n.metaKey=e.metaKey,n.button=e.button),n.offsetX===undefined&&(e.offsetX!==undefined?(Object&&Object.defineProperty!==undefined&&(Object.defineProperty(n,"offsetX",{writable:!0}),Object.defineProperty(n,"offsetY",{writable:!0})),n.offsetX=e.offsetX,n.offsetY=e.offsetY):e.layerX!==undefined&&(n.offsetX=e.layerX-e.currentTarget.offsetLeft,n.offsetY=e.layerY-e.currentTarget.offsetTop)),e.isPrimary!==undefined?n.isPrimary=e.isPrimary:n.isPrimary=!0;if(e.pressure)n.pressure=e.pressure;else{var r=0;e.which!==undefined?r=e.which:e.button!==undefined&&(r=e.button),n.pressure=r==0?0:.5}e.rotation?n.rotation=e.rotation:n.rotation=0,e.hwTimestamp?n.hwTimestamp=e.hwTimestamp:n.hwTimestamp=0,e.tiltX?n.tiltX=e.tiltX:n.tiltX=0,e.tiltY?n.tiltY=e.tiltY:n.tiltY=0,e.height?n.height=e.height:n.height=0,e.width?n.width=e.width:n.width=0,n.preventDefault=function(){e.preventDefault!==undefined&&e.preventDefault()};if(n.stopPropagation!==undefined){var a=n.stopPropagation;n.stopPropagation=function(){e.stopPropagation!==undefined&&e.stopPropagation(),a.call(this)}}n.POINTER_TYPE_TOUCH=i,n.POINTER_TYPE_PEN=o,n.POINTER_TYPE_MOUSE=u,n.pointerId=e.pointerId,n.pointerType=e.pointerType;switch(n.pointerType){case 2:n.pointerType=n.POINTER_TYPE_TOUCH;break;case 3:n.pointerType=n.POINTER_TYPE_PEN;break;case 4:n.pointerType=n.POINTER_TYPE_MOUSE}e.currentTarget&&f(e.currentTarget)===!0&&n.preventDefault(),e.target?e.target.dispatchEvent(n):e.srcElement.fireEvent("on"+m(t),n)},c=function(e,t){e.pointerId=1,e.pointerType=u,l(e,t)},h=function(e,t,n,r){var s=t.identifier+2;t.pointerId=s,t.pointerType=i,t.currentTarget=n,t.target=n,r.preventDefault!==undefined&&(t.preventDefault=function(){r.preventDefault()}),l(t,e)},p=function(e,t){while(e&&(!e.__handjsGlobalRegisteredEvents||!e.__handjsGlobalRegisteredEvents[t]))e=e.parentElement;return e!=null},d=function(e,t,n,r){p(n,e)&&h(e,t,n,r)},v=function(e,t,n,r){e.preventManipulation&&e.preventManipulation();for(var i=0;i<e.changedTouches.length;++i){var s=e.changedTouches[i];n&&(a[s.identifier]=s.target),r?d(t,s,a[s.identifier],e):h(t,s,a[s.identifier],e)}},m=function(e){return e.toLowerCase().replace("pointer","mouse")},g=function(e,t,n){var i;if(n==n.toLowerCase()){var s=r.indexOf(n)-r.length/2;i=t+r[s]}else i=t+n;return i===t+"PointerEnter"&&e["on"+t.toLowerCase()+"pointerenter"]===undefined&&(i=t+"PointerOver"),i===t+"PointerLeave"&&e["on"+t.toLowerCase()+"pointerleave"]===undefined&&(i=t+"PointerOut"),i},y=function(e,t,n,r){e.__handjsRegisteredEvents===undefined&&(e.__handjsRegisteredEvents=[]);if(r){if(e.__handjsRegisteredEvents[t]!==undefined){e.__handjsRegisteredEvents[t]++;return}e.__handjsRegisteredEvents[t]=1,e.addEventListener(t,n,!1)}else{if(e.__handjsRegisteredEvents.indexOf(t)!==-1){e.__handjsRegisteredEvents[t]--;if(e.__handjsRegisteredEvents[t]!=0)return}e.removeEventListener(t,n),e.__handjsRegisteredEvents[t]=0}},b=function(e,t,n){if(e.onpointerdown!==undefined)return;if(e.onmspointerdown!==undefined){var r=g(e,"MS",t);y(e,r,function(e){l(e,t)},n);return}if(e.ontouchstart!==undefined)switch(t){case"pointermove":y(e,"touchmove",function(e){v(e,t)},n);break;case"pointercancel":y(e,"touchcancel",function(e){v(e,t)},n);break;case"pointerdown":case"pointerup":case"pointerout":case"pointerover":case"pointerleave":case"pointerenter":e.__handjsGlobalRegisteredEvents||(e.__handjsGlobalRegisteredEvents=[]);if(n){if(e.__handjsGlobalRegisteredEvents[t]!==undefined){e.__handjsGlobalRegisteredEvents[t]++;return}e.__handjsGlobalRegisteredEvents[t]=1}else e.__handjsGlobalRegisteredEvents[t]!==undefined&&(e.__handjsGlobalRegisteredEvents[t]--,e.__handjsGlobalRegisteredEvents[t]<0&&(e.__handjsGlobalRegisteredEvents[t]=0))}switch(t){case"pointerdown":y(e,"mousedown",function(e){c(e,t)},n);break;case"pointermove":y(e,"mousemove",function(e){c(e,t)},n);break;case"pointerup":y(e,"mouseup",function(e){c(e,t)},n);break;case"pointerover":y(e,"mouseover",function(e){c(e,t)},n);break;case"pointerout":y(e,"mouseout",function(e){c(e,t)},n);break;case"pointerenter":e.onmouseenter===undefined?y(e,"mouseover",function(e){c(e,t)},n):y(e,"mouseenter",function(e){c(e,t)},n);break;case"pointerleave":e.onmouseleave===undefined?y(e,"mouseout",function(e){c(e,t)},n):y(e,"mouseleave",function(e){c(e,t)},n)}},w=function(e){var t=e.prototype?e.prototype.addEventListener:e.addEventListener,n=function(e,n,i){r.indexOf(e)!=-1&&b(this,e,!0),t===undefined?this.attachEvent("on"+m(e),n):t.call(this,e,n,i)};e.prototype?e.prototype.addEventListener=n:e.addEventListener=n},E=function(e){var t=e.prototype?e.prototype.removeEventListener:e.removeEventListener,n=function(e,n,i){r.indexOf(e)!=-1&&b(this,e,!1),t===undefined?this.detachEvent(m(e),n):t.call(this,e,n,i)};e.prototype?e.prototype.removeEventListener=n:e.removeEventListener=n};return w(HTMLElement),w(document),w(HTMLBodyElement),w(HTMLDivElement),w(HTMLImageElement),w(HTMLUListElement),w(HTMLAnchorElement),w(HTMLLIElement),w(HTMLTableElement),s.HTMLSpanElement&&w(HTMLSpanElement),s.HTMLCanvasElement&&w(HTMLCanvasElement),s.SVGElement&&w(SVGElement),E(HTMLElement),E(document),E(HTMLBodyElement),E(HTMLDivElement),E(HTMLImageElement),E(HTMLUListElement),E(HTMLAnchorElement),E(HTMLLIElement),E(HTMLTableElement),s.HTMLSpanElement&&E(HTMLSpanElement),s.HTMLCanvasElement&&E(HTMLCanvasElement),s.SVGElement&&E(SVGElement),s.ontouchstart!==undefined&&(s.addEventListener("touchstart",function(e){for(var t=0;t<e.changedTouches.length;++t){var n=e.changedTouches[t];a[n.identifier]=n.target,d("pointerenter",n,n.target,e),d("pointerover",n,n.target,e),d("pointerdown",n,n.target,e)}}),s.addEventListener("touchend",function(e){for(var t=0;t<e.changedTouches.length;++t){var n=e.changedTouches[t],r=a[n.identifier];d("pointerup",n,r,e),d("pointerout",n,r,e),d("pointerleave",n,r,e)}}),s.addEventListener("touchmove",function(e){for(var t=0;t<e.changedTouches.length;++t){var n=e.changedTouches[t],r=document.elementFromPoint(n.clientX,n.clientY),i=a[n.identifier];if(i===r)continue;i&&(d("pointerout",n,i,e),i.contains(r)||d("pointerleave",n,i,e)),r&&(d("pointerover",n,r,e),r.contains(i)||d("pointerenter",n,r,e)),a[n.identifier]=r}})),navigator.pointerEnabled===undefined&&(navigator.pointerEnabled=!0,navigator.msPointerEnabled&&(navigator.maxTouchPoints=navigator.msMaxTouchPoints)),document.styleSheets&&document.addEventListener&&document.addEventListener("DOMContentLoaded",function(){var e=function(e){return e.replace(/^\s+|\s+$/,"")},t=function(t){var n=new RegExp(".+?{.*?}","m"),r=new RegExp(".+?{","m");while(t!=""){var i=n.exec(t);if(!i)break;var s=i[0];t=e(t.replace(s,""));var o=e(r.exec(s)[0].replace("{",""));if(s.replace(/\s/g,"").indexOf("touch-action:none")!=-1){var u=document.querySelectorAll(o);for(var a=0;a<u.length;a++){var f=u[a];f.style.msTouchAction!==undefined?f.style.msTouchAction="none":f.handjs_forcePreventDefault=!0}}}};try{for(var n=0;n<document.styleSheets.length;n++){var r=document.styleSheets[n];if(r.href==undefined)continue;var i=new XMLHttpRequest;i.open("get",r.href,!1),i.send();var s=i.responseText.replace(/(\n|\r)/g,"");t(s)}}catch(o){}var u=document.getElementsByTagName("style");for(var n=0;n<u.length;n++){var a=u[n],f=e(a.innerHTML.replace(/(\n|\r)/g,""));t(f)}},!1),n.exports}),n("utils/EventEmitter",["require","exports","module"],function(e,t,n){var r=function(){this._events=this._events||{},this.addEventListener=this.on=function(e,t){if(typeof t!="function")throw new TypeError("listener must be a function");return this._events||(this._events={}),this._events[e]?typeof this._events[e]=="object"?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,this},this.dispatchEvent=this.emit=function(e){var t,n,r,i,s;this._events||(this._events={}),t=this._events[e];if(typeof t=="undefined")return!1;if(typeof t=="function")switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:n=arguments.length,r=new Array(n-1);for(i=1;i<n;i++)r[i-1]=arguments[i];t.apply(this,r)}else if(typeof t=="object"){n=arguments.length,r=new Array(n-1);for(i=1;i<n;i++)r[i-1]=arguments[i];s=t.slice(),n=s.length;for(i=0;i<n;i++)s[i].apply(this,r)}return this},this.removeEventListener=this.off=function(e,t){var n,r,i,s;if(typeof t!="function")throw new TypeError("listener must be a function");if(!this._events[e])return this;n=this._events[e],i=n.length,r=-1;if(n===t||typeof n.listener=="function"&&n.listener===t)this._events[e]=undefined;else if(typeof n=="object"){for(s=i;s-->0;)if(n[s]===t||n[s].listener&&n[s].listener===t){r=s;break}if(r<0)return this;n.length===1?(n.length=0,this._events[e]=undefined):n.splice(r,1)}return this},this.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}if(typeof t!="function")throw new TypeError("listener must be a function");return n.listener=t,this.on(e,n),this}};return n.exports=r,n.exports}),n("utils/inherit",["require","exports","module"],function(e,t,n){var r=function(e,t,n){n=n||{};var r={};[e.prototype,n].forEach(function(e){Object.getOwnPropertyNames(e).forEach(function(t){r[t]=Object.getOwnPropertyDescriptor(e,t)})}),r.constructor={value:e,enumerable:!1,writable:!0,configurable:!0},e.prototype=Object.create(t.prototype,r)};return n.exports=r,n.exports}),n("math/Vector",["require","exports","module","../utils/inherit"],function(e,t,n){var r=e("../utils/inherit"),i=function(e,t){this.x=e||0,this.y=t||0};return r(i,Object,{set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new RangeError("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new RangeError("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},add:function(e){return this.x+=e.x,this.y+=e.y,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e){return this.x-=e.x,this.y-=e.y,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return e!==0?(this.x/=e,this.y/=e):this.set(0,0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},negate:function(){return this.multiplyScalar(-1)},project:function(e){var t=this.dot(e)/e.lengthSq();return this.x=t*e.x,this.y=t*e.y,this},projectN:function(e){var t=this.dot(e);return this.x=t*e.x,this.y=t*e.y,this},reflect:function(e){var t=this.x,n=this.y;return this.project(e).multiplyScalar(2),this.x-=t,this.y-=n,this},reflectN:function(e){var t=this.x,n=this.y;return this.projectN(e).multiplyScalar(2),this.x-=t,this.y-=n,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},setLength:function(e){var t=this.length();return t!==0&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},perp:function(){var e=this.x;return this.x=this.y,this.y=-e,this},rotate:function(e,t){var n=t.distanceTo(this);return this.set(t.x+n*Math.cos(e),t.y+n*Math.sin(e))},equals:function(e){return e.x===this.x&&e.y===this.y},toArray:function(){return[this.x,this.y]},clone:function(){return new i(this.x,this.y)}}),i.ZERO=new i,n.exports=i,n.exports}),n("geom/Circle",["require","exports","module","../utils/inherit","../math/Vector","../constants"],function(e,t,n){var r=e("../utils/inherit"),i=e("../math/Vector"),s=e("../constants"),o=function(e,t,n,r){this.position=new i,this._radius=n||0,this.radius=n||0,this.scale=r||new i(1,1),this.x=e||0,this.y=t||0,this._shapetype=s.SHAPE.CIRCLE,this.recalc()};return r(o,Object,{clone:function(){return new o(this.x,this.y,this.radius)},copy:function(e){return this.x=e.x,this.y=e.y,this.radius=e.radius,this},contains:function(e,t){if(this.radius<=0)return!1;var n=e-this.x,r=t-this.y,i=this.radius*this.radius;return n*=n,r*=r,n+r<=i},overlaps:function(e){var t=this.position.clone().sub(e.position),n=this.radius+e.radius,r=n*n,i=t.lengthSq();return!(i>r)},equals:function(e){return this.position.equals(e.position)&&this.radius===e.radius},recalc:function(){return this.radius=this._radius*this.scale.x,this}}),Object.defineProperty(o.prototype,"x",{get:function(){return this.position.x},set:function(e){this.position.x=e}}),Object.defineProperty(o.prototype,"y",{get:function(){return this.position.y},set:function(e){this.position.y=e}}),Object.defineProperty(o.prototype,"radius",{get:function(){return this._radius*this.scale.x},set:function(e){this._radius=e}}),Object.defineProperty(o.prototype,"circumference",{get:function(){return 2*Math.PI*this.radius}}),Object.defineProperty(o.prototype,"area",{get:function(){return Math.PI*this.radius*this.radius}}),n.exports=o,n.exports}),n("geom/Polygon",["require","exports","module","../utils/inherit","../math/Vector","../constants"],function(e,t,n){var r=e("../utils/inherit"),i=e("../math/Vector"),s=e("../constants"),o=function(e,t,n,r){this.position=new i,this._points=null,this.scale=r||new i(1,1),this.points=[],this.edges=[],this.normals=[];if(typeof n[0]=="number"){var o=[];for(var u=0,a=n.length;u<a;u+=2)o.push(new i(n[u],n[u+1]));n=o}this._points=n,this.x=e||0,this.y=t||0,this.recalc(),this._shapetype=s.SHAPE.POLYGON};return r(o,Object,{clone:function(){var e=[];for(var t=0;t<this._points.length;t++)e.push(this._points[t].clone());return new o(e,this.scale)},copy:function(e){this.position.copy(e.position),this._points.length=this.points.length=0;for(var t=0;t<e._points.length;++t)this._points.push(e._points[t].clone());return this.scale.copy(e.scale),this.recalc(),this},contains:function(e,t){var n=!1;for(var r=0,i=this.points.length-1;r<this.points.length;i=r++){var s=this.points[r].x,o=this.points[r].y,u=this.points[i].x,a=this.points[i].y,f=o>t!=a>t&&e<(u-s)*(t-o)/(a-o)+s;f&&(n=!n)}return n},equals:function(e){if(!this.position.equals(e.position)||this.points.length!==e.points.length)return!1;for(var t=0;t<e.points.length;++t)if(!this.points[t].equals(e.points[t]))return!1;return!0},recalc:function(){var e=this._points,t=e.length,n,r,s,o,u=0;for(u=0;u<t;u++)this.points[u]||(this.points[u]=new i),this.points[u].set(this._points[u].x*this.scale.x,this._points[u].y*this.scale.y);this.edges.length=this.normals.length=0;for(u=0;u<t;++u)n=e[u],r=u<t-1?e[u+1]:e[0],s=r.clone().sub(n),o=s.clone().perp().normalize(),this.edges.push(s),this.normals.push(o);return this}}),Object.defineProperty(o.prototype,"x",{get:function(){return this.position.x},set:function(e){this.position.x=e}}),Object.defineProperty(o.prototype,"y",{get:function(){return this.position.y},set:function(e){this.position.y=e}}),n.exports=o,n.exports}),n("utils/support",["require","exports","module"],function(e,t,n){var r={ua:s.navigator?s.navigator.userAgent.toLowerCase():"nodejs",canvas:function(){try{return!!s.CanvasRenderingContext2D&&!!document.createElement("canvas").getContext("2d")}catch(e){return!1}}(),webgl:function(){try{var e=document.createElement("canvas");return!!s.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(t){return!1}}(),crypto:!!s.crypto&&!!s.crypto.getRandomValues,workers:!!s.Worker,blobUrls:!!s.Blob&&!!s.URL&&!!s.URL.createObjectURL,typedArrays:!!s.ArrayBuffer,fileapi:!!s.File&&!!s.FileReader&&!!s.FileList&&!!s.Blob,webAudio:!!s.AudioContext||!!s.webkitAudioContext||!!s.mozAudioContext,htmlAudio:!!document.createElement("audio").canPlayType&&!!s.Audio,localStorage:!!s.localStorage,touch:"createTouch"in document||"ontouchstart"in s||navigator.isCocoonJS,gamepad:!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||navigator.userAgent.indexOf("Firefox/")!==-1};if(r.htmlAudio){var i=new Audio;r.codec={mp3:!!i.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!i.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!i.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),m4a:!!(i.canPlayType("audio/x-m4a;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),webm:!!i.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")}}return n.exports=r,n.exports}),n("vendor/pixi",["require","exports","module"],function(e,t,n){function u(){return o.Matrix=typeof Float32Array!="undefined"?Float32Array:Array,o.Matrix}function h(e){return[(e>>16&255)/255,(e>>8&255)/255,(e&255)/255]}function h(e){return[(e>>16&255)/255,(e>>8&255)/255,(e&255)/255]}var i=this,o=o||{};o.Point=function(e,t){this.x=e||0,this.y=t||0},o.Point.prototype.clone=function(){return new o.Point(this.x,this.y)},o.Point.prototype.constructor=o.Point,o.Rectangle=function(e,t,n,r){this.x=e||0,this.y=t||0,this.width=n||0,this.height=r||0},o.Rectangle.prototype.clone=function(){return new o.Rectangle(this.x,this.y,this.width,this.height)},o.Rectangle.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var n=this.x;if(e>=n&&e<=n+this.width){var r=this.y;if(t>=r&&t<=r+this.height)return!0}return!1},o.Rectangle.prototype.constructor=o.Rectangle,o.Polygon=function(e){e instanceof Array||(e=Array.prototype.slice.call(arguments));if(typeof e[0]=="number"){var t=[];for(var n=0,r=e.length;n<r;n+=2)t.push(new o.Point(e[n],e[n+1]));e=t}this.points=e},o.Polygon.prototype.clone=function(){var e=[];for(var t=0;t<this.points.length;t++)e.push(this.points[t].clone());return new o.Polygon(e)},o.Polygon.prototype.contains=function(e,t){var n=!1;for(var r=0,i=this.points.length-1;r<this.points.length;i=r++){var s=this.points[r].x,o=this.points[r].y,u=this.points[i].x,a=this.points[i].y,f=o>t!=a>t&&e<(u-s)*(t-o)/(a-o)+s;f&&(n=!n)}return n},o.Polygon.prototype.constructor=o.Polygon,o.Circle=function(e,t,n){this.x=e||0,this.y=t||0,this.radius=n||0},o.Circle.prototype.clone=function(){return new o.Circle(this.x,this.y,this.radius)},o.Circle.prototype.contains=function(e,t){if(this.radius<=0)return!1;var n=this.x-e,r=this.y-t,i=this.radius*this.radius;return n*=n,r*=r,n+r<=i},o.Circle.prototype.constructor=o.Circle,o.Ellipse=function(e,t,n,r){this.x=e||0,this.y=t||0,this.width=n||0,this.height=r||0},o.Ellipse.prototype.clone=function(){return new o.Ellipse(this.x,this.y,this.width,this.height)},o.Ellipse.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var n=(e-this.x)/this.width-.5,r=(t-this.y)/this.height-.5;return n*=n,r*=r,n+r<.25},o.Ellipse.getBounds=function(){return new o.Rectangle(this.x,this.y,this.width,this.height)},o.Ellipse.prototype.constructor=o.Ellipse,u(),o.mat3={},o.mat3.create=function(){var e=new o.Matrix(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},o.mat3.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},o.mat4={},o.mat4.create=function(){var e=new o.Matrix(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},o.mat3.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],o=e[3],u=e[4],a=e[5],f=e[6],l=e[7],c=e[8],h=t[0],p=t[1],d=t[2],v=t[3],m=t[4],g=t[5],y=t[6],b=t[7],w=t[8];return n[0]=h*r+p*o+d*f,n[1]=h*i+p*u+d*l,n[2]=h*s+p*a+d*c,n[3]=v*r+m*o+g*f,n[4]=v*i+m*u+g*l,n[5]=v*s+m*a+g*c,n[6]=y*r+b*o+w*f,n[7]=y*i+b*u+w*l,n[8]=y*s+b*a+w*c,n},o.mat3.clone=function(e){var t=new o.Matrix(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},o.mat3.transpose=function(e,t){if(!t||e===t){var n=e[1],r=e[2],i=e[5];return e[1]=e[3],e[2]=e[6],e[3]=n,e[5]=e[7],e[6]=r,e[7]=i,e}return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t},o.mat3.toMat4=function(e,t){return t||(t=o.mat4.create()),t[15]=1,t[14]=0,t[13]=0,t[12]=0,t[11]=0,t[10]=e[8],t[9]=e[7],t[8]=e[6],t[7]=0,t[6]=e[5],t[5]=e[4],t[4]=e[3],t[3]=0,t[2]=e[2],t[1]=e[1],t[0]=e[0],t},o.mat4.create=function(){var e=new o.Matrix(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},o.mat4.transpose=function(e,t){if(!t||e===t){var n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],u=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=n,e[6]=e[9],e[7]=e[13],e[8]=r,e[9]=s,e[11]=e[14],e[12]=i,e[13]=o,e[14]=u,e}return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},o.mat4.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],o=e[3],u=e[4],a=e[5],f=e[6],l=e[7],c=e[8],h=e[9],p=e[10],d=e[11],v=e[12],m=e[13],g=e[14],y=e[15],b=t[0],w=t[1],E=t[2],S=t[3];return n[0]=b*r+w*u+E*c+S*v,n[1]=b*i+w*a+E*h+S*m,n[2]=b*s+w*f+E*p+S*g,n[3]=b*o+w*l+E*d+S*y,b=t[4],w=t[5],E=t[6],S=t[7],n[4]=b*r+w*u+E*c+S*v,n[5]=b*i+w*a+E*h+S*m,n[6]=b*s+w*f+E*p+S*g,n[7]=b*o+w*l+E*d+S*y,b=t[8],w=t[9],E=t[10],S=t[11],n[8]=b*r+w*u+E*c+S*v,n[9]=b*i+w*a+E*h+S*m,n[10]=b*s+w*f+E*p+S*g,n[11]=b*o+w*l+E*d+S*y,b=t[12],w=t[13],E=t[14],S=t[15],n[12]=b*r+w*u+E*c+S*v,n[13]=b*i+w*a+E*h+S*m,n[14]=b*s+w*f+E*p+S*g,n[15]=b*o+w*l+E*d+S*y,n},o.DisplayObject=function(){this.last=this,this.first=this,this.position=new o.Point,this.scale=new o.Point(1,1),this.pivot=new o.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.worldTransform=o.mat3.create(),this.localTransform=o.mat3.create(),this.color=[],this.dynamic=!0,this._sr=0,this._cr=1},o.DisplayObject.prototype.constructor=o.DisplayObject,o.DisplayObject.prototype.setInteractive=function(e){this.interactive=e},Object.defineProperty(o.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(e){this._interactive=e,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(o.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(e){e?this._mask?(e.start=this._mask.start,e.end=this._mask.end):(this.addFilter(e),e.renderable=!1):(this.removeFilter(this._mask),this._mask.renderable=!0),this._mask=e}}),Object.defineProperty(o.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(e){e?(this._filters&&this.removeFilter(this._filters),this.addFilter(e)):this._filters&&this.removeFilter(this._filters),this._filters=e}}),o.DisplayObject.prototype.addFilter=function(e){var t=new o.FilterBlock,n=new o.FilterBlock;e.start=t,e.end=n,t.data=e,n.data=e,t.first=t.last=this,n.first=n.last=this,t.open=!0;var r=t,i=t,s,u;u=this.first._iPrev,u?(s=u._iNext,r._iPrev=u,u._iNext=r):s=this,s&&(s._iPrev=i,i._iNext=s);var r=n,i=n,s=null,u=null;u=this.last,s=u._iNext,s&&(s._iPrev=i,i._iNext=s),r._iPrev=u,u._iNext=r;var a=this,f=this.last;while(a)a.last==f&&(a.last=n),a=a.parent;this.first=t,this.__renderGroup&&this.__renderGroup.addFilterBlocks(t,n)},o.DisplayObject.prototype.removeFilter=function(e){console.log("YUOIO");var t=e.start,n=t._iNext,r=t._iPrev;n&&(n._iPrev=r),r&&(r._iNext=n),this.first=t._iNext;var i=e.end,n=i._iNext,r=i._iPrev;n&&(n._iPrev=r),r._iNext=n;var s=i._iPrev,o=this;while(o.last==i){o.last=s,o=o.parent;if(!o)break}this.__renderGroup&&this.__renderGroup.removeFilterBlocks(t,i)},o.DisplayObject.prototype.updateTransform=function(){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var e=this.localTransform,t=this.parent.worldTransform,n=this.worldTransform;e[0]=this._cr*this.scale.x,e[1]=-this._sr*this.scale.y,e[3]=this._sr*this.scale.x,e[4]=this._cr*this.scale.y;var r=this.pivot.x,i=this.pivot.y,s=e[0],u=e[1],a=this.position.x-e[0]*r-i*e[1],f=e[3],l=e[4],c=this.position.y-e[4]*i-r*e[3],h=t[0],p=t[1],d=t[2],v=t[3],m=t[4],g=t[5];e[2]=a,e[5]=c,n[0]=h*s+p*f,n[1]=h*u+p*l,n[2]=h*a+p*c+d,n[3]=v*s+m*f,n[4]=v*u+m*l,n[5]=v*a+m*c+g,this.worldAlpha=this.alpha*this.parent.worldAlpha,this.vcount=o.visibleCount},o.visibleCount=0,o.DisplayObjectContainer=function(){o.DisplayObject.call(this),this.children=[]},o.DisplayObjectContainer.prototype=Object.create(o.DisplayObject.prototype),o.DisplayObjectContainer.prototype.constructor=o.DisplayObjectContainer,o.DisplayObjectContainer.prototype.addChild=function(e){e.parent!=undefined&&e.parent.removeChild(e),e.parent=this,this.children.push(e);if(this.stage){var t=e;do t.interactive&&(this.stage.dirty=!0),t.stage=this.stage,t=t._iNext;while(t)}var n=e.first,r=e.last,i,s;this._filters||this._mask?s=this.last._iPrev:s=this.last,i=s._iNext;var o=this,u=s;while(o)o.last==u&&(o.last=e.last),o=o.parent;i&&(i._iPrev=r,r._iNext=i),n._iPrev=s,s._iNext=n,this.__renderGroup&&(e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e),this.__renderGroup.addDisplayObjectAndChildren(e))},o.DisplayObjectContainer.prototype.addChildAt=function(e,t){if(!(t>=0&&t<=this.children.length))throw new Error(e+" The index "+t+" supplied is out of bounds "+this.children.length);e.parent!=undefined&&e.parent.removeChild(e),e.parent=this;if(this.stage){var n=e;do n.interactive&&(this.stage.dirty=!0),n.stage=this.stage,n=n._iNext;while(n)}var r=e.first,i=e.last,s,o;if(t==this.children.length){o=this.last;var u=this,a=this.last;while(u)u.last==a&&(u.last=e.last),u=u.parent}else t==0?o=this:o=this.children[t-1].last;s=o._iNext,s&&(s._iPrev=i,i._iNext=s),r._iPrev=o,o._iNext=r,this.children.splice(t,0,e),this.__renderGroup&&(e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e),this.__renderGroup.addDisplayObjectAndChildren(e))},o.DisplayObjectContainer.prototype.swapChildren=function(e,t){return},o.DisplayObjectContainer.prototype.getChildAt=function(e){if(e>=0&&e<this.children.length)return this.children[e];throw new Error(child+" Both the supplied DisplayObjects must be a child of the caller "+this)},o.DisplayObjectContainer.prototype.removeChild=function(e){var t=this.children.indexOf(e);if(t===-1)throw new Error(e+" The supplied DisplayObject must be a child of the caller "+this);var n=e.first,r=e.last,i=r._iNext,s=n._iPrev;i&&(i._iPrev=s),s._iNext=i;if(this.last==r){var o=n._iPrev,u=this;while(u.last==r.last){u.last=o,u=u.parent;if(!u)break}}r._iNext=null,n._iPrev=null;if(this.stage){var a=e;do a.interactive&&(this.stage.dirty=!0),a.stage=null,a=a._iNext;while(a)}e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e),e.parent=undefined,this.children.splice(t,1)},o.DisplayObjectContainer.prototype.updateTransform=function(){if(!this.visible)return;o.DisplayObject.prototype.updateTransform.call(this);for(var e=0,t=this.children.length;e<t;e++)this.children[e].updateTransform()},o.blendModes={},o.blendModes.NORMAL=0,o.blendModes.SCREEN=1,o.Sprite=function(e){o.DisplayObjectContainer.call(this),this.anchor=new o.Point,this.texture=e,this.blendMode=o.blendModes.NORMAL,this._width=0,this._height=0,e.baseTexture.hasLoaded?this.updateFrame=!0:(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},o.Sprite.prototype=Object.create(o.DisplayObjectContainer.prototype),o.Sprite.prototype.constructor=o.Sprite,Object.defineProperty(o.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(e){this.scale.x=e/this.texture.frame.width,this._width=e}}),Object.defineProperty(o.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(e){this.scale.y=e/this.texture.frame.height,this._height=e}}),o.Sprite.prototype.setTexture=function(e){this.texture.baseTexture!=e.baseTexture?(this.textureChange=!0,this.texture=e,this.__renderGroup&&this.__renderGroup.updateTexture(this)):this.texture=e,this.updateFrame=!0},o.Sprite.prototype.onTextureUpdate=function(e){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height),this.updateFrame=!0},o.Sprite.fromFrame=function(e){var t=o.TextureCache[e];if(!t)throw new Error("The frameId '"+e+"' does not exist in the texture cache"+this);return new o.Sprite(t)},o.Sprite.fromImage=function(e){var t=o.Texture.fromImage(e);return new o.Sprite(t)},o.MovieClip=function(e){o.Sprite.call(this,e[0]),this.textures=e,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},o.MovieClip.prototype=Object.create(o.Sprite.prototype),o.MovieClip.prototype.constructor=o.MovieClip,Object.defineProperty(o.MovieClip.prototype,"totalFrames",{get:function(){return this.textures.length}}),o.MovieClip.prototype.stop=function(){this.playing=!1},o.MovieClip.prototype.play=function(){this.playing=!0},o.MovieClip.prototype.gotoAndStop=function(e){this.playing=!1,this.currentFrame=e;var t=this.currentFrame+.5|0;this.setTexture(this.textures[t%this.textures.length])},o.MovieClip.prototype.gotoAndPlay=function(e){this.currentFrame=e,this.playing=!0},o.MovieClip.prototype.updateTransform=function(){o.Sprite.prototype.updateTransform.call(this);if(!this.playing)return;this.currentFrame+=this.animationSpeed;var e=this.currentFrame+.5|0;this.loop||e<this.textures.length?this.setTexture(this.textures[e%this.textures.length]):e>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())},o.FilterBlock=function(){this.visible=!0,this.renderable=!0},o.ColorMatrixFilter=function(){this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","gl_FragColor = gl_FragColor * vColor;","}"]},Object.defineProperty(o.ColorMatrixFilter.prototype,"matrix",{get:function(){return this.uniforms.matrix.value},set:function(e){this.uniforms.matrix.value=e}}),o.GreyFilter=function(){this.uniforms={grey:{type:"f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","uniform float grey;","void main(void) {","gl_FragColor = texture2D(uSampler, vTextureCoord);","gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), grey);","gl_FragColor = gl_FragColor * vColor;","}"],this.primitiveFragmentSrc=["precision mediump float;","varying vec4 vColor;","uniform float grey;","void main(void) {","gl_FragColor = vColor;","gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), grey);","gl_FragColor = gl_FragColor * vColor;","}"]},Object.defineProperty(o.GreyFilter.prototype,"grey",{get:function(){return this.uniforms.grey.value},set:function(e){this.uniforms.grey.value=e}}),o.DisplacementFilter=function(e){this.uniforms={displacementMap:{type:"sampler2D",value:e},scale:{type:"f2",value:{x:30,y:30}},mapDimensions:{type:"f2",value:{x:e.width,y:e.height}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 mapDimensions;","const vec2 textureDimensions = vec2(245.0, 263.0);","void main(void) {","vec2 matSample = texture2D(displacementMap, vTextureCoord * (textureDimensions/mapDimensions)).xy;","matSample -= 0.5;","matSample *= scale;","matSample /= textureDimensions;","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);","gl_FragColor = gl_FragColor * vColor;","}"]},Object.defineProperty(o.DisplacementFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(e){this.uniforms.displacementMap.value=e}}),Object.defineProperty(o.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(e){this.uniforms.scale.value=e}}),o.Text=function(e,t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),o.Sprite.call(this,o.Texture.fromCanvas(this.canvas)),this.setText(e),this.setStyle(t),this.updateText(),this.dirty=!1},o.Text.prototype=Object.create(o.Sprite.prototype),o.Text.prototype.constructor=o.Text,o.Text.prototype.setStyle=function(e){e=e||{},e.font=e.font||"bold 20pt Arial",e.fill=e.fill||"black",e.align=e.align||"left",e.stroke=e.stroke||"black",e.strokeThickness=e.strokeThickness||0,e.wordWrap=e.wordWrap||!1,e.wordWrapWidth=e.wordWrapWidth||100,this.style=e,this.dirty=!0},o.Text.prototype.setText=function(e){this.text=e.toString()||" ",this.dirty=!0},o.Text.prototype.updateText=function(){this.context.font=this.style.font;var e=this.text;this.style.wordWrap&&(e=this.wordWrap(this.text));var t=e.split(/(?:\r\n|\r|\n)/),n=[],r=0;for(var i=0;i<t.length;i++){var s=this.context.measureText(t[i]).width;n[i]=s,r=Math.max(r,s)}this.canvas.width=r+this.style.strokeThickness;var u=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness;this.canvas.height=u*t.length,this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="top";for(i=0;i<t.length;i++){var a=new o.Point(this.style.strokeThickness/2,this.style.strokeThickness/2+i*u);this.style.align=="right"?a.x+=r-n[i]:this.style.align=="center"&&(a.x+=(r-n[i])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(t[i],a.x,a.y),this.style.fill&&this.context.fillText(t[i],a.x,a.y)}this.updateTexture()},o.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.frame.width=this.canvas.width,this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,o.texturesToUpdate.push(this.texture.baseTexture)},o.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),o.Sprite.prototype.updateTransform.call(this)},o.Text.prototype.determineFontHeight=function(e){var t=o.Text.heightCache[e];if(!t){var n=document.getElementsByTagName("body")[0],r=document.createElement("div"),i=document.createTextNode("M");r.appendChild(i),r.setAttribute("style",e+";position:absolute;top:0;left:0"),n.appendChild(r),t=r.offsetHeight,o.Text.heightCache[e]=t,n.removeChild(r)}return t},o.Text.prototype.wordWrap=function(e){var t=function(e,t,n,r,i){var s=Math.floor((r-n)/2)+n;return s==n?1:e.measureText(t.substring(0,s)).width<=i?e.measureText(t.substring(0,s+1)).width>i?s:arguments.callee(e,t,s,r,i):arguments.callee(e,t,n,s,i)},n=function(e,n,r){if(e.measureText(n).width<=r||n.length<1)return n;var i=t(e,n,0,n.length,r);return n.substring(0,i)+"\n"+arguments.callee(e,n.substring(i),r)},r="",i=e.split("\n");for(var s=0;s<i.length;s++)r+=n(this.context,i[s],this.style.wordWrapWidth)+"\n";return r},o.Text.prototype.destroy=function(e){e&&this.texture.destroy()},o.Text.heightCache={},o.BitmapText=function(e,t){o.DisplayObjectContainer.call(this),this.setText(e),this.setStyle(t),this.updateText(),this.dirty=!1},o.BitmapText.prototype=Object.create(o.DisplayObjectContainer.prototype),o.BitmapText.prototype.constructor=o.BitmapText,o.BitmapText.prototype.setText=function(e){this.text=e||" ",this.dirty=!0},o.BitmapText.prototype.setStyle=function(e){e=e||{},e.align=e.align||"left",this.style=e;var t=e.font.split(" ");this.fontName=t[t.length-1],this.fontSize=t.length>=2?parseInt(t[t.length-2],10):o.BitmapText.fonts[this.fontName].size,this.dirty=!0},o.BitmapText.prototype.updateText=function(){var e=o.BitmapText.fonts[this.fontName],t=new o.Point,n=null,r=[],i=0,s=[],u=0,a=this.fontSize/e.size;for(var f=0;f<this.text.length;f++){var l=this.text.charCodeAt(f);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(f))){s.push(t.x),i=Math.max(i,t.x),u++,t.x=0,t.y+=e.lineHeight,n=null;continue}var c=e.chars[l];if(!c)continue;n&&c[n]&&(t.x+=c.kerning[n]),r.push({texture:c.texture,line:u,charCode:l,position:new o.Point(t.x+c.xOffset,t.y+c.yOffset)}),t.x+=c.xAdvance,n=l}s.push(t.x),i=Math.max(i,t.x);var h=[];for(f=0;f<=u;f++){var p=0;this.style.align=="right"?p=i-s[f]:this.style.align=="center"&&(p=(i-s[f])/2),h.push(p)}for(f=0;f<r.length;f++){var d=new o.Sprite(r[f].texture);d.position.x=(r[f].position.x+h[r[f].line])*a,d.position.y=r[f].position.y*a,d.scale.x=d.scale.y=a,this.addChild(d)}this.width=t.x*a,this.height=(t.y+e.lineHeight)*a},o.BitmapText.prototype.updateTransform=function(){if(this.dirty){while(this.children.length>0)this.removeChild(this.getChildAt(0));this.updateText(),this.dirty=!1}o.DisplayObjectContainer.prototype.updateTransform.call(this)},o.BitmapText.fonts={},o.InteractionManager=function(e){this.stage=e,this.mouse=new o.InteractionData,this.touchs={},this.tempPoint=new o.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.interactionDOMElement=null,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.last=0},o.InteractionManager.prototype.constructor=o.InteractionManager,o.InteractionManager.prototype.collectInteractiveSprite=function(e,t){var n=e.children,r=n.length;for(var i=r-1;i>=0;i--){var s=n[i];s.interactive?(t.interactiveChildren=!0,this.interactiveItems.push(s),s.children.length>0&&this.collectInteractiveSprite(s,s)):(s.__iParent=null,s.children.length>0&&this.collectInteractiveSprite(s,t))}},o.InteractionManager.prototype.setTarget=function(e){this.target=e,this.interactionDOMElement===null&&this.setTargetDomElement(e.view),document.body.addEventListener("mouseup",this.onMouseUp,!0)},o.InteractionManager.prototype.setTargetDomElement=function(e){this.interactionDOMElement!==null&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]="",this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0)),s.navigator.msPointerEnabled&&(e.style["-ms-content-zooming"]="none",e.style["-ms-touch-action"]="none"),this.interactionDOMElement=e,e.addEventListener("mousemove",this.onMouseMove,!0),e.addEventListener("mousedown",this.onMouseDown,!0),e.addEventListener("mouseout",this.onMouseOut,!0),e.addEventListener("touchstart",this.onTouchStart,!0),e.addEventListener("touchend",this.onTouchEnd,!0),e.addEventListener("touchmove",this.onTouchMove,!0)},o.InteractionManager.prototype.update=function(){if(!this.target)return;var e=Date.now(),t=e-this.last;t=t*30/1e3;if(t<1)return;this.last=e;if(this.dirty){this.dirty=!1;var n=this.interactiveItems.length;for(var r=0;r<n;r++)this.interactiveItems[r].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)}var i=this.interactiveItems.length;this.interactionDOMElement.style.cursor="default";for(var r=0;r<i;r++){var s=this.interactiveItems[r];if(s.mouseover||s.mouseout||s.buttonMode)s.__hit=this.hitTest(s,this.mouse),this.mouse.target=s,s.__hit?(s.buttonMode&&(this.interactionDOMElement.style.cursor="pointer"),s.__isOver||(s.mouseover&&s.mouseover(this.mouse),s.__isOver=!0)):s.__isOver&&(s.mouseout&&s.mouseout(this.mouse),s.__isOver=!1)}},o.InteractionManager.prototype.onMouseMove=function(e){this.mouse.originalEvent=e||s.event;var t=this.interactionDOMElement.getBoundingClientRect();this.mouse.global.x=(e.clientX-t.left)*(this.target.width/t.width),this.mouse.global.y=(e.clientY-t.top)*(this.target.height/t.height);var n=this.interactiveItems.length,r=this.mouse.global;for(var i=0;i<n;i++){var o=this.interactiveItems[i];o.mousemove&&o.mousemove(this.mouse)}},o.InteractionManager.prototype.onMouseDown=function(e){this.mouse.originalEvent=e||s.event;var t=this.interactiveItems.length,n=this.mouse.global,r=0,i=this.stage;for(var o=0;o<t;o++){var u=this.interactiveItems[o];if(u.mousedown||u.click){u.__mouseIsDown=!0,u.__hit=this.hitTest(u,this.mouse);if(u.__hit){u.mousedown&&u.mousedown(this.mouse),u.__isDown=!0;if(!u.interactiveChildren)break}}}},o.InteractionManager.prototype.onMouseOut=function(e){var t=this.interactiveItems.length;this.interactionDOMElement.style.cursor="default";for(var n=0;n<t;n++){var r=this.interactiveItems[n];r.__isOver&&(this.mouse.target=r,r.mouseout&&r.mouseout(this.mouse),r.__isOver=!1)}},o.InteractionManager.prototype.onMouseUp=function(e){this.mouse.originalEvent=e||s.event;var t=this.mouse.global,n=this.interactiveItems.length,r=!1;for(var i=0;i<n;i++){var o=this.interactiveItems[i];if(o.mouseup||o.mouseupoutside||o.click)o.__hit=this.hitTest(o,this.mouse),o.__hit&&!r?(o.mouseup&&o.mouseup(this.mouse),o.__isDown&&o.click&&o.click(this.mouse),o.interactiveChildren||(r=!0)):o.__isDown&&o.mouseupoutside&&o.mouseupoutside(this.mouse),o.__isDown=!1}},o.InteractionManager.prototype.hitTest=function(e,t){var n=t.global;if(e.vcount!==o.visibleCount)return!1;var r=e instanceof o.Sprite,i=e.worldTransform,s=i[0],u=i[1],a=i[2],f=i[3],l=i[4],c=i[5],h=1/(s*l+u*-f),p=l*h*n.x+ -u*h*n.y+(c*u-a*l)*h,d=s*h*n.y+ -f*h*n.x+(-c*s+a*f)*h;t.target=e;if(e.hitArea&&e.hitArea.contains)return e.hitArea.contains(p,d)?(t.target=e,!0):!1;if(r){var v=e.texture.frame.width,m=e.texture.frame.height,g=-v*e.anchor.x,y;if(p>g&&p<g+v){y=-m*e.anchor.y;if(d>y&&d<y+m)return t.target=e,!0}}var b=e.children.length;for(var w=0;w<b;w++){var E=e.children[w],S=this.hitTest(E,t);if(S)return t.target=e,!0}return!1},o.InteractionManager.prototype.onTouchMove=function(e){var t=this.interactionDOMElement.getBoundingClientRect(),n=e.changedTouches;for(var r=0;r<n.length;r++){var i=n[r],o=this.touchs[i.identifier];o.originalEvent=e||s.event,o.global.x=(i.clientX-t.left)*(this.target.width/t.width),o.global.y=(i.clientY-t.top)*(this.target.height/t.height)}var u=this.interactiveItems.length;for(var r=0;r<u;r++){var a=this.interactiveItems[r];a.touchmove&&a.touchmove(o)}},o.InteractionManager.prototype.onTouchStart=function(e){var t=this.interactionDOMElement.getBoundingClientRect(),n=e.changedTouches;for(var r=0;r<n.length;r++){var i=n[r],u=this.pool.pop();u||(u=new o.InteractionData),u.originalEvent=e||s.event,this.touchs[i.identifier]=u,u.global.x=(i.clientX-t.left)*(this.target.width/t.width),u.global.y=(i.clientY-t.top)*(this.target.height/t.height);var a=this.interactiveItems.length;for(var f=0;f<a;f++){var l=this.interactiveItems[f];if(l.touchstart||l.tap){l.__hit=this.hitTest(l,u);if(l.__hit){l.touchstart&&l.touchstart(u),l.__isDown=!0,l.__touchData=u;if(!l.interactiveChildren)break}}}}},o.InteractionManager.prototype.onTouchEnd=function(e){var t=this.interactionDOMElement.getBoundingClientRect(),n=e.changedTouches;for(var r=0;r<n.length;r++){var i=n[r],o=this.touchs[i.identifier],u=!1;o.global.x=(i.clientX-t.left)*(this.target.width/t.width),o.global.y=(i.clientY-t.top)*(this.target.height/t.height);var a=this.interactiveItems.length;for(var f=0;f<a;f++){var l=this.interactiveItems[f],c=l.__touchData;l.__hit=this.hitTest(l,o);if(c==o){o.originalEvent=e||s.event;if(l.touchend||l.tap)l.__hit&&!u?(l.touchend&&l.touchend(o),l.__isDown&&l.tap&&l.tap(o),l.interactiveChildren||(u=!0)):l.__isDown&&l.touchendoutside&&l.touchendoutside(o),l.__isDown=!1;l.__touchData=null}}this.pool.push(o),this.touchs[i.identifier]=null}},o.InteractionData=function(){this.global=new o.Point,this.local=new o.Point,this.target,this.originalEvent},o.InteractionData.prototype.getLocalPosition=function(e){var t=e.worldTransform,n=this.global,r=t[0],i=t[1],s=t[2],u=t[3],a=t[4],f=t[5],l=1/(r*a+i*-u);return new o.Point(a*l*n.x+ -i*l*n.y+(f*i-s*a)*l,r*l*n.y+ -u*l*n.x+(-f*r+s*u)*l)},o.InteractionData.prototype.constructor=o.InteractionData,o.Stage=function(e){o.DisplayObjectContainer.call(this),this.worldTransform=o.mat3.create(),this.interactive=!0,this.interactionManager=new o.InteractionManager(this),this.dirty=!0,this.__childrenAdded=[],this.__childrenRemoved=[],this.stage=this,this.stage.hitArea=new o.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(e),this.worldVisible=!0},o.Stage.prototype=Object.create(o.DisplayObjectContainer.prototype),o.Stage.prototype.constructor=o.Stage,o.Stage.prototype.setInteractionDelegate=function(e){this.interactionManager.setTargetDomElement(e)},o.Stage.prototype.updateTransform=function(){this.worldAlpha=1,this.vcount=o.visibleCount;for(var e=0,t=this.children.length;e<t;e++)this.children[e].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},o.Stage.prototype.setBackgroundColor=function(e){this.backgroundColor=e||0,this.backgroundColorSplit=h(this.backgroundColor);var t=this.backgroundColor.toString(16);t="000000".substr(0,6-t.length)+t,this.backgroundColorString="#"+t},o.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global};var f=0,l=["ms","moz","webkit","o"];for(var c=0;c<l.length&&!s.requestAnimationFrame;++c)s.requestAnimationFrame=s[l[c]+"RequestAnimationFrame"],s.cancelAnimationFrame=s[l[c]+"CancelAnimationFrame"]||s[l[c]+"CancelRequestAnimationFrame"];s.requestAnimationFrame||(s.requestAnimationFrame=function(e,t){var n=(new Date).getTime(),r=Math.max(0,16-(n-f)),i=s.setTimeout(function(){e(n+r)},r);return f=n+r,i}),s.cancelAnimationFrame||(s.cancelAnimationFrame=function(e){clearTimeout(e)}),s.requestAnimFrame=s.requestAnimationFrame,typeof Function.prototype.bind!="function"&&(Function.prototype.bind=function(){var e=Array.prototype.slice;return function(t){function i(){var s=r.concat(e.call(arguments));n.apply(this instanceof i?this:t,s)}var n=this,r=e.call(arguments,1);if(typeof n!="function")throw new TypeError;return i.prototype=function s(e){e&&(s.prototype=e);if(!(this instanceof s))return new s}(n.prototype),i}}());var p=o.AjaxRequest=function(){var e=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!s.ActiveXObject)return s.XMLHttpRequest?new XMLHttpRequest:!1;for(var t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(n){}};o.runList=function(e){console.log(">>>>>>>>>"),console.log("_");var t=0,n=e.first;console.log(n);while(n._iNext){t++,n=n._iNext,console.log(n);if(t>100){console.log("BREAK");break}}},o.EventTarget=function(){var e={};this.addEventListener=this.on=function(t,n){e[t]===undefined&&(e[t]=[]),e[t].indexOf(n)===-1&&e[t].push(n)},this.dispatchEvent=this.emit=function(t){if(!e[t.type]||!e[t.type].length)return;for(var n=0,r=e[t.type].length;n<r;n++)e[t.type][n](t)},this.removeEventListener=this.off=function(t,n){var r=e[t].indexOf(n);r!==-1&&e[t].splice(r,1)}},o.autoDetectRenderer=function(e,t,n,r,i){e||(e=800),t||(t=600);var u=function(){try{var e=document.createElement("canvas");return!!s.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(t){return!1}}();if(u){var a=navigator.userAgent.toLowerCase().indexOf("msie")!=-1;u=!a}return u?new o.WebGLRenderer(e,t,n,r,i):new o.CanvasRenderer(e,t,n,r)},o.PolyK={},o.PolyK.Triangulate=function(e){var t=!0,n=e.length>>1;if(n<3)return[];var r=[],i=[];for(var s=0;s<n;s++)i.push(s);var s=0,u=n;while(u>3){var a=i[(s+0)%u],f=i[(s+1)%u],l=i[(s+2)%u],c=e[2*a],h=e[2*a+1],p=e[2*f],d=e[2*f+1],v=e[2*l],m=e[2*l+1],g=!1;if(o.PolyK._convex(c,h,p,d,v,m,t)){g=!0;for(var y=0;y<u;y++){var b=i[y];if(b==a||b==f||b==l)continue;if(o.PolyK._PointInTriangle(e[2*b],e[2*b+1],c,h,p,d,v,m)){g=!1;break}}}if(g)r.push(a,f,l),i.splice((s+1)%u,1),u--,s=0;else if(s++>3*u){if(!t)return console.log("PIXI Warning: shape too complex to fill"),[];var r=[];i=[];for(var s=0;s<n;s++)i.push(s);s=0,u=n,t=!1}}return r.push(i[0],i[1],i[2]),r},o.PolyK._PointInTriangle=function(e,t,n,r,i,s,o,u){var a=o-n,f=u-r,l=i-n,c=s-r,h=e-n,p=t-r,d=a*a+f*f,v=a*l+f*c,m=a*h+f*p,g=l*l+c*c,y=l*h+c*p,b=1/(d*g-v*v),w=(g*m-v*y)*b,E=(d*y-v*m)*b;return w>=0&&E>=0&&w+E<1},o.PolyK._convex=function(e,t,n,r,i,s,o){return(t-r)*(i-n)+(n-e)*(s-r)>=0==o},o.shaderFragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor = gl_FragColor * vColor;","}"],o.shaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","varying float vColor;","void main(void) {","gl_Position = vec4( aVertexPosition.x / projectionVector.x -1.0, aVertexPosition.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vTextureCoord = aTextureCoord;","vColor = aColor;","}"],o.stripShaderFragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor = gl_FragColor * alpha;","}"],o.stripShaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","varying float vColor;","void main(void) {","vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vTextureCoord = aTextureCoord;","vColor = aColor;","}"],o.primitiveShaderFragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","gl_FragColor = vColor;","}"],o.primitiveShaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform float alpha;","varying vec4 vColor;","void main(void) {","vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vColor = aColor  * alpha;","}"],o.shaderStack=[],o.initPrimitiveShader=function(){var e=o.gl,t=o.compileProgram(o.primitiveShaderVertexSrc,o.primitiveShaderFragmentSrc);e.useProgram(t),t.vertexPositionAttribute=e.getAttribLocation(t,"aVertexPosition"),t.colorAttribute=e.getAttribLocation(t,"aColor"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.translationMatrix=e.getUniformLocation(t,"translationMatrix"),t.alpha=e.getUniformLocation(t,"alpha"),o.primitiveProgram=t},o.initDefaultShader=function(){o.defaultShader=new o.PixiShader,o.defaultShader.init(),o.pushShader(o.defaultShader)},o.initDefaultStripShader=function(){var e=this.gl,t=o.compileProgram(o.stripShaderVertexSrc,o.stripShaderFragmentSrc);e.useProgram(t),t.vertexPositionAttribute=e.getAttribLocation(t,"aVertexPosition"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.textureCoordAttribute=e.getAttribLocation(t,"aTextureCoord"),t.translationMatrix=e.getUniformLocation(t,"translationMatrix"),t.alpha=e.getUniformLocation(t,"alpha"),t.colorAttribute=e.getAttribLocation(t,"aColor"),t.projectionVector=e.getUniformLocation(t,"projectionVector"),t.samplerUniform=e.getUniformLocation(t,"uSampler"),o.stripShaderProgram=t},o.CompileVertexShader=function(e,t){return o._CompileShader(e,t,e.VERTEX_SHADER)},o.CompileFragmentShader=function(e,t){return o._CompileShader(e,t,e.FRAGMENT_SHADER)},o._CompileShader=function(e,t,n){var r=t.join("\n"),i=e.createShader(n);return e.shaderSource(i,r),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(alert(e.getShaderInfoLog(i)),null)},o.compileProgram=function(e,t){var n=o.gl,r=o.CompileFragmentShader(n,t),i=o.CompileVertexShader(n,e),s=n.createProgram();return n.attachShader(s,i),n.attachShader(s,r),n.linkProgram(s),n.getProgramParameter(s,n.LINK_STATUS)||alert("Could not initialise shaders"),s},o.pushShader=function(e){o.shaderStack.push(e);var t=o.gl,n=e.program;t.useProgram(n),t.enableVertexAttribArray(n.vertexPositionAttribute),t.enableVertexAttribArray(n.colorAttribute),t.enableVertexAttribArray(n.textureCoordAttribute),e.syncUniforms(),o.currentShader=n},o.popShader=function(){var e=o.gl,t=o.shaderStack.pop(),n=o.shaderStack[o.shaderStack.length-1].program;e.useProgram(n),o.currentShader=n},o.activatePrimitiveShader=function(){var e=o.gl;e.useProgram(o.primitiveProgram),e.disableVertexAttribArray(o.currentShader.textureCoordAttribute)},o.deactivatePrimitiveShader=function(){var e=o.gl;e.useProgram(o.currentShader),e.enableVertexAttribArray(o.currentShader.textureCoordAttribute)},o.PixiShader=function(){this.program,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;","}"]},o.PixiShader.prototype.init=function(){var e=o.compileProgram(this.vertexSrc||o.shaderVertexSrc,this.fragmentSrc),t=o.gl;t.useProgram(e),e.vertexPositionAttribute=t.getAttribLocation(e,"aVertexPosition"),e.colorAttribute=t.getAttribLocation(e,"aColor"),e.textureCoordAttribute=t.getAttribLocation(e,"aTextureCoord"),e.projectionVector=t.getUniformLocation(e,"projectionVector"),e.samplerUniform=t.getUniformLocation(e,"uSampler");for(var n in this.uniforms)e[n]=t.getUniformLocation(e,n);this.program=e},o.PixiShader.prototype.syncUniforms=function(){var e=o.gl;for(var t in this.uniforms){var n=this.uniforms[t].type;n=="f"&&e.uniform1f(this.program[t],this.uniforms[t].value);if(n=="f2")e.uniform2f(this.program[t],this.uniforms[t].value.x,this.uniforms[t].value.y);else if(n=="mat4")e.uniformMatrix4fv(this.program[t],!1,this.uniforms[t].value);else if(n=="sampler2D"){var r=this.uniforms[t].value;e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,r.baseTexture._glTexture),e.uniform1i(this.program[t],1)}}},o.WebGLGraphics=function(){},o.WebGLGraphics.renderGraphics=function(e,t){var n=o.gl;e._webGL||(e._webGL={points:[],indices:[],lastIndex:0,buffer:n.createBuffer(),indexBuffer:n.createBuffer()}),e.dirty&&(e.dirty=!1,e.clearDirty&&(e.clearDirty=!1,e._webGL.lastIndex=0,e._webGL.points=[],e._webGL.indices=[]),o.WebGLGraphics.updateGraphics(e)),o.activatePrimitiveShader();var r=o.mat3.clone(e.worldTransform);o.mat3.transpose(r),n.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA),n.uniformMatrix3fv(o.primitiveProgram.translationMatrix,!1,r),n.uniform2f(o.primitiveProgram.projectionVector,t.x,t.y),n.uniform1f(o.primitiveProgram.alpha,e.worldAlpha),n.bindBuffer(n.ARRAY_BUFFER,e._webGL.buffer),n.vertexAttribPointer(o.primitiveProgram.vertexPositionAttribute,2,n.FLOAT,!1,24,0),n.vertexAttribPointer(o.primitiveProgram.colorAttribute,4,n.FLOAT,!1,24,8),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e._webGL.indexBuffer),n.drawElements(n.TRIANGLE_STRIP,e._webGL.indices.length,n.UNSIGNED_SHORT,0),o.deactivatePrimitiveShader()},o.WebGLGraphics.updateGraphics=function(e){for(var t=e._webGL.lastIndex;t<e.graphicsData.length;t++){var n=e.graphicsData[t];n.type==o.Graphics.POLY?(n.fill&&n.points.length>3&&o.WebGLGraphics.buildPoly(n,e._webGL),n.lineWidth>0&&o.WebGLGraphics.buildLine(n,e._webGL)):n.type==o.Graphics.RECT?o.WebGLGraphics.buildRectangle(n,e._webGL):(n.type==o.Graphics.CIRC||n.type==o.Graphics.ELIP)&&o.WebGLGraphics.buildCircle(n,e._webGL)}e._webGL.lastIndex=e.graphicsData.length;var r=o.gl;e._webGL.glPoints=new Float32Array(e._webGL.points),r.bindBuffer(r.ARRAY_BUFFER,e._webGL.buffer),r.bufferData(r.ARRAY_BUFFER,e._webGL.glPoints,r.STATIC_DRAW),e._webGL.glIndicies=new Uint16Array(e._webGL.indices),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e._webGL.indexBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e._webGL.glIndicies,r.STATIC_DRAW)},o.WebGLGraphics.buildRectangle=function(e,t){var n=e.points,r=n[0],i=n[1],s=n[2],u=n[3];if(e.fill){var a=h(e.fillColor),f=e.fillAlpha,l=a[0]*f,c=a[1]*f,p=a[2]*f,d=t.points,v=t.indices,m=d.length/6;d.push(r,i),d.push(l,c,p,f),d.push(r+s,i),d.push(l,c,p,f),d.push(r,i+u),d.push(l,c,p,f),d.push(r+s,i+u),d.push(l,c,p,f),v.push(m,m,m+1,m+2,m+3,m+3)}e.lineWidth&&(e.points=[r,i,r+s,i,r+s,i+u,r,i+u,r,i],o.WebGLGraphics.buildLine(e,t))},o.WebGLGraphics.buildCircle=function(e,t){var n=e.points,r=n[0],i=n[1],s=n[2],u=n[3],a=40,f=Math.PI*2/a;if(e.fill){var l=h(e.fillColor),c=e.fillAlpha,p=l[0]*c,d=l[1]*c,v=l[2]*c,m=t.points,g=t.indices,y=m.length/6;g.push(y);for(var b=0;b<a+1;b++)m.push(r,i,p,d,v,c),m.push(r+Math.sin(f*b)*s,i+Math.cos(f*b)*u,p,d,v,c),g.push(y++,y++);g.push(y-1)}if(e.lineWidth){e.points=[];for(var b=0;b<a+1;b++)e.points.push(r+Math.sin(f*b)*s,i+Math.cos(f*b)*u);o.WebGLGraphics.buildLine(e,t)}},o.WebGLGraphics.buildLine=function(e,t){var n=!0,r=e.points;if(r.length==0)return;var i=new o.Point(r[0],r[1]),s=new o.Point(r[r.length-2],r[r.length-1]);if(i.x==s.x&&i.y==s.y){r.pop(),r.pop(),s=new o.Point(r[r.length-2],r[r.length-1]);var u=s.x+(i.x-s.x)*.5,a=s.y+(i.y-s.y)*.5;r.unshift(u,a),r.push(u,a)}var f=t.points,l=t.indices,c=r.length/2,p=r.length,d=f.length/6,v=e.lineWidth/2,m=h(e.lineColor),g=e.lineAlpha,y=m[0]*g,b=m[1]*g,w=m[2]*g,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z;E=r[0],S=r[1],x=r[2],T=r[3],k=-(S-T),L=E-x,z=Math.sqrt(k*k+L*L),k/=z,L/=z,k*=v,L*=v,f.push(E-k,S-L,y,b,w,g),f.push(E+k,S+L,y,b,w,g);for(var W=1;W<c-1;W++)E=r[(W-1)*2],S=r[(W-1)*2+1],x=r[W*2],T=r[W*2+1],N=r[(W+1)*2],C=r[(W+1)*2+1],k=-(S-T),L=E-x,z=Math.sqrt(k*k+L*L),k/=z,L/=z,k*=v,L*=v,A=-(T-C),O=x-N,z=Math.sqrt(A*A+O*O),A/=z,O/=z,A*=v,O*=v,H=-L+S-(-L+T),B=-k+x-(-k+E),j=(-k+E)*(-L+T)-(-k+x)*(-L+S),F=-O+C-(-O+T),I=-A+x-(-A+N),q=(-A+N)*(-O+T)-(-A+x)*(-O+C),R=H*I-F*B,R==0&&(R+=1),px=(B*q-I*j)/R,py=(F*j-H*q)/R,U=(px-x)*(px-x)+(py-T)+(py-T),U>19600?(M=k-A,_=L-O,z=Math.sqrt(M*M+_*_),M/=z,_/=z,M*=v,_*=v,f.push(x-M,T-_),f.push(y,b,w,g),f.push(x+M,T+_),f.push(y,b,w,g),f.push(x-M,T-_),f.push(y,b,w,g),p++):(f.push(px,py),f.push(y,b,w,g),f.push(x-(px-x),T-(py-T)),f.push(y,b,w,g));E=r[(c-2)*2],S=r[(c-2)*2+1],x=r[(c-1)*2],T=r[(c-1)*2+1],k=-(S-T),L=E-x,z=Math.sqrt(k*k+L*L),k/=z,L/=z,k*=v,L*=v,f.push(x-k,T-L),f.push(y,b,w,g),f.push(x+k,T+L),f.push(y,b,w,g),l.push(d);for(var W=0;W<p;W++)l.push(d++);l.push(d-1)},o.WebGLGraphics.buildPoly=function(e,t){var n=e.points;if(n.length<6)return;var r=t.points,i=t.indices,s=n.length/2,u=h(e.fillColor),a=e.fillAlpha,f=u[0]*a,l=u[1]*a,c=u[2]*a,p=o.PolyK.Triangulate(n),d=r.length/6;for(var v=0;v<p.length;v+=3)i.push(p[v]+d),i.push(p[v]+d),i.push(p[v+1]+d),i.push(p[v+2]+d),i.push(p[v+2]+d);for(var v=0;v<s;v++)r.push(n[v*2],n[v*2+1],f,l,c,a)},o._defaultFrame=new o.Rectangle(0,0,1,1),o.gl,o.WebGLRenderer=function(e,t,n,r,i){this.transparent=!!r,this.width=e||800,this.height=t||600,this.view=n||document.createElement("canvas"),this.view.width=this.width,this.view.height=this.height;var s=this;this.view.addEventListener("webglcontextlost",function(e){s.handleContextLost(e)},!1),this.view.addEventListener("webglcontextrestored",function(e){s.handleContextRestored(e)},!1),this.batchs=[];var u={alpha:this.transparent,antialias:!!i,premultipliedAlpha:!1,stencil:!0};try{o.gl=this.gl=this.view.getContext("experimental-webgl",u)}catch(a){try{o.gl=this.gl=this.view.getContext("webgl",u)}catch(a){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}}o.initDefaultShader(),o.initPrimitiveShader(),o.initDefaultStripShader();var f=this.gl;o.WebGLRenderer.gl=f,this.batch=new o.WebGLBatch(f),f.disable(f.DEPTH_TEST),f.disable(f.CULL_FACE),f.enable(f.BLEND),f.colorMask(!0,!0,!0,this.transparent),o.projection=new o.Point(400,300),this.resize(this.width,this.height),this.contextLost=!1,o.pushShader(o.defaultShader),this.stageRenderGroup=new o.WebGLRenderGroup(this.gl)},o.WebGLRenderer.prototype.constructor=o.WebGLRenderer,o.WebGLRenderer.getBatch=function(){return o._batchs.length==0?new o.WebGLBatch(o.WebGLRenderer.gl):o._batchs.pop()},o.WebGLRenderer.returnBatch=function(e){e.clean(),o._batchs.push(e)},o.WebGLRenderer.prototype.render=function(e){if(this.contextLost)return;this.__stage!==e&&(this.__stage=e,this.stageRenderGroup.setRenderable(e)),o.WebGLRenderer.updateTextures(),o.visibleCount++,e.updateTransform();var t=this.gl;t.colorMask(!0,!0,!0,this.transparent),t.viewport(0,0,this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,null),t.clearColor(e.backgroundColorSplit[0],e.backgroundColorSplit[1],e.backgroundColorSplit[2],!this.transparent),t.clear(t.COLOR_BUFFER_BIT),this.stageRenderGroup.backgroundColor=e.backgroundColorSplit,this.stageRenderGroup.render(o.projection),e.interactive&&(e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this)));if(o.Texture.frameUpdates.length>0){for(var n=0;n<o.Texture.frameUpdates.length;n++)o.Texture.frameUpdates[n].updateFrame=!1;o.Texture.frameUpdates=[]}},o.WebGLRenderer.updateTextures=function(){for(var e=0;e<o.texturesToUpdate.length;e++)o.WebGLRenderer.updateTexture(o.texturesToUpdate[e]);for(var e=0;e<o.texturesToDestroy.length;e++)o.WebGLRenderer.destroyTexture(o.texturesToDestroy[e]);o.texturesToUpdate=[],o.texturesToDestroy=[]},o.WebGLRenderer.updateTexture=function(e){var t=o.gl;e._glTexture||(e._glTexture=t.createTexture()),e.hasLoaded&&(t.bindTexture(t.TEXTURE_2D,e._glTexture),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e.source),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e.scaleMode===o.BaseTexture.SCALE_MODE.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e.scaleMode===o.BaseTexture.SCALE_MODE.LINEAR?t.LINEAR:t.NEAREST),e._powerOf2?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),t.bindTexture(t.TEXTURE_2D,null))},o.WebGLRenderer.destroyTexture=function(e){var t=o.gl;e._glTexture&&(e._glTexture=t.createTexture(),t.deleteTexture(t.TEXTURE_2D,e._glTexture))},o.WebGLRenderer.prototype.resize=function(e,t){this.width=e,this.height=t,this.view.width=e,this.view.height=t,this.gl.viewport(0,0,this.width,this.height),o.projection.x=this.width/2,o.projection.y=this.height/2},o.WebGLRenderer.prototype.handleContextLost=function(e){e.preventDefault(),this.contextLost=!0},o.WebGLRenderer.prototype.handleContextRestored=function(e){this.gl=this.view.getContext("experimental-webgl",{alpha:!0}),this.initShaders();for(var t in o.TextureCache){var n=o.TextureCache[t].baseTexture;n._glTexture=null,o.WebGLRenderer.updateTexture(n)}for(var r=0;r<this.batchs.length;r++)this.batchs[r].restoreLostContext(this.gl),this.batchs[r].dirty=!0;o._restoreBatchs(this.gl),this.contextLost=!1},o._batchs=[],o._getBatch=function(e){return o._batchs.length==0?new o.WebGLBatch(e):o._batchs.pop()},o._returnBatch=function(e){e.clean(),o._batchs.push(e)},o._restoreBatchs=function(e){for(var t=0;t<o._batchs.length;t++)o._batchs[t].restoreLostContext(e)},o.WebGLBatch=function(e){this.gl=e,this.size=0,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.uvBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer(),this.blendMode=o.blendModes.NORMAL,this.dynamicSize=1},o.WebGLBatch.prototype.constructor=o.WebGLBatch,o.WebGLBatch.prototype.clean=function(){this.verticies=[],this.uvs=[],this.indices=[],this.colors=[],this.dynamicSize=1,this.texture=null,this.last=null,this.size=0,this.head,this.tail},o.WebGLBatch.prototype.restoreLostContext=function(e){this.gl=e,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.uvBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer()},o.WebGLBatch.prototype.init=function(e){e.batch=this,this.dirty=!0,this.blendMode=e.blendMode,this.texture=e.texture.baseTexture,this.head=e,this.tail=e,this.size=1,this.growBatch()},o.WebGLBatch.prototype.insertBefore=function(e,t){this.size++,e.batch=this,this.dirty=!0;var n=t.__prev;t.__prev=e,e.__next=t,n?(e.__prev=n,n.__next=e):this.head=e},o.WebGLBatch.prototype.insertAfter=function(e,t){this.size++,e.batch=this,this.dirty=!0;var n=t.__next;t.__next=e,e.__prev=t,n?(e.__next=n,n.__prev=e):this.tail=e},o.WebGLBatch.prototype.remove=function(e){this.size--;if(this.size==0){e.batch=null,e.__prev=null,e.__next=null;return}e.__prev?e.__prev.__next=e.__next:(this.head=e.__next,this.head.__prev=null),e.__next?e.__next.__prev=e.__prev:(this.tail=e.__prev,this.tail.__next=null),e.batch=null,e.__next=null,e.__prev=null,this.dirty=!0},o.WebGLBatch.prototype.split=function(e){this.dirty=!0;var t=new o.WebGLBatch(this.gl);t.init(e),t.texture=this.texture,t.tail=this.tail,this.tail=e.__prev,this.tail.__next=null,e.__prev=null;var n=0;while(e)n++,e.batch=t,e=e.__next;return t.size=n,this.size-=n,t},o.WebGLBatch.prototype.merge=function(e){this.dirty=!0,this.tail.__next=e.head,e.head.__prev=this.tail,this.size+=e.size,this.tail=e.tail;var t=e.head;while(t)t.batch=this,t=t.__next},o.WebGLBatch.prototype.growBatch=function(){var e=this.gl;this.size==1?this.dynamicSize=1:this.dynamicSize=this.size*1.5,this.verticies=new Float32Array(this.dynamicSize*8),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.verticies,e.DYNAMIC_DRAW),this.uvs=new Float32Array(this.dynamicSize*8),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvs,e.DYNAMIC_DRAW),this.dirtyUVS=!0,this.colors=new Float32Array(this.dynamicSize*4),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colors,e.DYNAMIC_DRAW),this.dirtyColors=!0,this.indices=new Uint16Array(this.dynamicSize*6);var t=this.indices.length/6;for(var n=0;n<t;n++){var r=n*6,i=n*4;this.indices[r+0]=i+0,this.indices[r+1]=i+1,this.indices[r+2]=i+2,this.indices[r+3]=i+0,this.indices[r+4]=i+2,this.indices[r+5]=i+3}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)},o.WebGLBatch.prototype.refresh=function(){var e=this.gl;this.dynamicSize<this.size&&this.growBatch();var t=0,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y=this.head;while(y){c=t*8;var b=y.texture,w=b.frame,E=b.baseTexture.width,S=b.baseTexture.height;this.uvs[c+0]=w.x/E,this.uvs[c+1]=w.y/S,this.uvs[c+2]=(w.x+w.width)/E,this.uvs[c+3]=w.y/S,this.uvs[c+4]=(w.x+w.width)/E,this.uvs[c+5]=(w.y+w.height)/S,this.uvs[c+6]=w.x/E,this.uvs[c+7]=(w.y+w.height)/S,y.updateFrame=!1,colorIndex=t*4,this.colors[colorIndex]=this.colors[colorIndex+1]=this.colors[colorIndex+2]=this.colors[colorIndex+3]=y.worldAlpha,y=y.__next,t++}this.dirtyUVS=!0,this.dirtyColors=!0},o.WebGLBatch.prototype.update=function(){var e=this.gl,t,n,r,i,s,u,a,f,l,c,h,p,d,v,m,g,y,b,w=0,E=this.head,S=this.verticies,x=this.uvs,T=this.colors;while(E){if(E.vcount===o.visibleCount){n=E.texture.frame.width,r=E.texture.frame.height,i=E.anchor.x,s=E.anchor.y,u=n*(1-i),a=n*-i,f=r*(1-s),l=r*-s,c=w*8,t=E.worldTransform,d=t[0],v=t[3],m=t[1],g=t[4],y=t[2],b=t[5],S[c+0]=d*a+m*l+y,S[c+1]=g*l+v*a+b,S[c+2]=d*u+m*l+y,S[c+3]=g*l+v*u+b,S[c+4]=d*u+m*f+y,S[c+5]=g*f+v*u+b,S[c+6]=d*a+m*f+y,S[c+7]=g*f+v*a+b;if(E.updateFrame||E.texture.updateFrame){this.dirtyUVS=!0;var N=E.texture,C=N.frame,k=N.baseTexture.width,L=N.baseTexture.height;x[c+0]=C.x/k,x[c+1]=C.y/L,x[c+2]=(C.x+C.width)/k,x[c+3]=C.y/L,x[c+4]=(C.x+C.width)/k,x[c+5]=(C.y+C.height)/L,x[c+6]=C.x/k,x[c+7]=(C.y+C.height)/L,E.updateFrame=!1}if(E.cacheAlpha!=E.worldAlpha){E.cacheAlpha=E.worldAlpha;var A=w*4;T[A]=T[A+1]=T[A+2]=T[A+3]=E.worldAlpha,this.dirtyColors=!0}}else c=w*8,S[c+0]=S[c+1]=S[c+2]=S[c+3]=S[c+4]=S[c+5]=S[c+6]=S[c+7]=0;w++,E=E.__next}},o.WebGLBatch.prototype.render=function(e,t){e=e||0,t==undefined&&(t=this.size),this.dirty&&(this.refresh(),this.dirty=!1);if(this.size==0)return;this.update();var n=this.gl,r=o.currentShader;n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,this.verticies),n.vertexAttribPointer(r.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer),this.dirtyUVS&&(this.dirtyUVS=!1,n.bufferSubData(n.ARRAY_BUFFER,0,this.uvs)),n.vertexAttribPointer(r.textureCoordAttribute,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this.texture._glTexture),n.bindBuffer(n.ARRAY_BUFFER,this.colorBuffer),this.dirtyColors&&(this.dirtyColors=!1,n.bufferSubData(n.ARRAY_BUFFER,0,this.colors)),n.vertexAttribPointer(r.colorAttribute,1,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var i=t-e;n.drawElements(n.TRIANGLES,i*6,n.UNSIGNED_SHORT,e*2*6)},o.WebGLRenderGroup=function(e){this.gl=e,this.root,this.backgroundColor,this.batchs=[],this.toRemove=[]},o.WebGLRenderGroup.prototype.constructor=o.WebGLRenderGroup,o.WebGLRenderGroup.prototype.setRenderable=function(e){this.root&&this.removeDisplayObjectAndChildren(this.root),e.worldVisible=e.visible,this.root=e,this.addDisplayObjectAndChildren(e)},o.WebGLRenderGroup.prototype.render=function(e){o.WebGLRenderer.updateTextures();var t=this.gl;t.uniform2f(o.currentShader.projectionVector,e.x,e.y),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA);var n;for(var r=0;r<this.batchs.length;r++){n=this.batchs[r];if(n instanceof o.WebGLBatch){this.batchs[r].render();continue}var i=n.vcount===o.visibleCount;n instanceof o.TilingSprite?i&&this.renderTilingSprite(n,e):n instanceof o.Strip?i&&this.renderStrip(n,e):n instanceof o.Graphics?i&&n.renderable&&o.WebGLGraphics.renderGraphics(n,e):n instanceof o.FilterBlock&&this.handleFilterBlock(n,e)}},o.WebGLRenderGroup.prototype.renderSpecific=function(e,t){o.WebGLRenderer.updateTextures();var n=this.gl;n.uniform2f(o.currentShader.projectionVector,t.x,t.y);var r,i,s,u,a=e.first;while(a._iNext){a=a._iNext;if(a.renderable&&a.__renderGroup)break}var f=a.batch;if(a instanceof o.Sprite){f=a.batch;var l=f.head,c=l;if(l==a)r=0;else{r=1;while(l.__next!=a)r++,l=l.__next}}else f=a;var h=e,p,d=e;while(d.children.length>0)d=d.children[d.children.length-1],d.renderable&&(h=d.last);if(h instanceof o.Sprite){p=h.batch;var l=p.head;if(l==h)s=0;else{s=1;while(l.__next!=h)s++,l=l.__next}}else p=h;if(f==p){f instanceof o.WebGLBatch?f.render(r,s+1):this.renderSpecial(f,t);return}i=this.batchs.indexOf(f),u=this.batchs.indexOf(p),f instanceof o.WebGLBatch?f.render(r):this.renderSpecial(f,t);for(var v=i+1;v<u;v++)renderable=this.batchs[v],renderable instanceof o.WebGLBatch?this.batchs[v].render():this.renderSpecial(renderable,t);p instanceof o.WebGLBatch?p.render(0,s+1):this.renderSpecial(p,t)},o.WebGLRenderGroup.prototype.renderSpecial=function(e,t){var n=o.shaderStack.length,r=e.vcount===o.visibleCount;e instanceof o.TilingSprite?r&&this.renderTilingSprite(e,t):e instanceof o.Strip?r&&this.renderStrip(e,t):e instanceof o.CustomRenderable?r&&e.renderWebGL(this,t):e instanceof o.Graphics?r&&e.renderable&&o.WebGLGraphics.renderGraphics(e,t):e instanceof o.FilterBlock&&this.handleFilterBlock(e,t)},o.WebGLRenderGroup.prototype.handleFilterBlock=function(e,t){var n=o.gl;if(e.open)if(e.data instanceof Array){var r=e.data[0];if(!r.shader){var i=new o.PixiShader;i.fragmentSrc=r.fragmentSrc,i.uniforms=r.uniforms,i.init(),r.shader=i}o.pushShader(r.shader),n.uniform2f(o.currentShader.projectionVector,t.x,t.y)}else n.enable(n.STENCIL_TEST),n.colorMask(!1,!1,!1,!1),n.stencilFunc(n.ALWAYS,1,255),n.stencilOp(n.KEEP,n.KEEP,n.REPLACE),o.WebGLGraphics.renderGraphics(e.data,t),n.colorMask(!0,!0,!0,!0),n.stencilFunc(n.NOTEQUAL,0,255),n.stencilOp(n.KEEP,n.KEEP,n.KEEP);else e.data instanceof Array?(o.popShader(),n.uniform2f(o.currentShader.projectionVector,t.x,t.y)):n.disable(n.STENCIL_TEST)},o.WebGLRenderGroup.prototype.updateTexture=function(e){this.removeObject(e);var t=e.first;while(t!=this.root){t=t._iPrev;if(t.renderable&&t.__renderGroup)break}var n=e.last;while(n._iNext){n=n._iNext;if(n.renderable&&n.__renderGroup)break}this.insertObject(e,t,n)},o.WebGLRenderGroup.prototype.addFilterBlocks=function(e,t){e.__renderGroup=this,t.__renderGroup=this;var n=e;while(n!=this.root.first){n=n._iPrev;if(n.renderable&&n.__renderGroup)break}this.insertAfter(e,n);var r=t;while(r!=this.root.first){r=r._iPrev;if(r.renderable&&r.__renderGroup)break}this.insertAfter(t,r)},o.WebGLRenderGroup.prototype.removeFilterBlocks=function(e,t){this.removeObject(e),this.removeObject(t)},o.WebGLRenderGroup.prototype.addDisplayObjectAndChildren=function(e){e.__renderGroup&&e.__renderGroup.removeDisplayObjectAndChildren(e);var t=e.first;while(t!=this.root.first){t=t._iPrev;if(t.renderable&&t.__renderGroup)break}var n=e.last;while(n._iNext){n=n._iNext;if(n.renderable&&n.__renderGroup)break}var r=e.first,i=e.last._iNext;do r.__renderGroup=this,r.renderable&&(this.insertObject(r,t,n),t=r),r=r._iNext;while(r!=i)},o.WebGLRenderGroup.prototype.removeDisplayObjectAndChildren=function(e){if(e.__renderGroup!=this)return;var t=e.last;do e.__renderGroup=null,e.renderable&&this.removeObject(e),e=e._iNext;while(e)},o.WebGLRenderGroup.prototype.insertObject=function(e,t,n){var r=t,i=n;if(e instanceof o.Sprite){var s,u;if(r instanceof o.Sprite){s=r.batch;if(s&&s.texture==e.texture.baseTexture&&s.blendMode==e.blendMode){s.insertAfter(e,r);return}}else s=r;if(i)if(i instanceof o.Sprite){u=i.batch;if(u){if(u.texture==e.texture.baseTexture&&u.blendMode==e.blendMode){u.insertBefore(e,i);return}if(u==s){var a=s.split(i),f=o.WebGLRenderer.getBatch(),l=this.batchs.indexOf(s);f.init(e),this.batchs.splice(l+1,0,f,a);return}}}else u=i;var f=o.WebGLRenderer.getBatch();f.init(e);if(s){var l=this.batchs.indexOf(s);this.batchs.splice(l+1,0,f)}else this.batchs.push(f);return}e instanceof o.TilingSprite?this.initTilingSprite(e):e instanceof o.Strip?this.initStrip(e):e,this.insertAfter(e,r)},o.WebGLRenderGroup.prototype.insertAfter=function(e,t){if(t instanceof o.Sprite){var n=t.batch;if(n)if(n.tail==t){var r=this.batchs.indexOf(n);this.batchs.splice(r+1,0,e)}else{var i=n.split(t.__next),r=this.batchs.indexOf(n);this.batchs.splice(r+1,0,e,i)}else this.batchs.push(e)}else{var r=this.batchs.indexOf(t);this.batchs.splice(r+1,0,e)}},o.WebGLRenderGroup.prototype.removeObject=function(e){var t;if(e instanceof o.Sprite){var n=e.batch;if(!n)return;n.remove(e),n.size==0&&(t=n)}else t=e;if(t){var r=this.batchs.indexOf(t);if(r==-1)return;if(r==0||r==this.batchs.length-1){this.batchs.splice(r,1),t instanceof o.WebGLBatch&&o.WebGLRenderer.returnBatch(t);return}if(this.batchs[r-1]instanceof o.WebGLBatch&&this.batchs[r+1]instanceof o.WebGLBatch&&this.batchs[r-1].texture==this.batchs[r+1].texture&&this.batchs[r-1].blendMode==this.batchs[r+1].blendMode){this.batchs[r-1].merge(this.batchs[r+1]),t instanceof o.WebGLBatch&&o.WebGLRenderer.returnBatch(t),o.WebGLRenderer.returnBatch(this.batchs[r+1]),this.batchs.splice(r,2);return}this.batchs.splice(r,1),t instanceof o.WebGLBatch&&o.WebGLRenderer.returnBatch(t)}},o.WebGLRenderGroup.prototype.initTilingSprite=function(e){var t=this.gl;e.verticies=new Float32Array([0,0,e.width,0,e.width,e.height,0,e.height]),e.uvs=new Float32Array([0,0,1,0,1,1,0,1]),e.colors=new Float32Array([1,1,1,1]),e.indices=new Uint16Array([0,1,3,2]),e._vertexBuffer=t.createBuffer(),e._indexBuffer=t.createBuffer(),e._uvBuffer=t.createBuffer(),e._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,e.verticies,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._uvBuffer),t.bufferData(t.ARRAY_BUFFER,e.uvs,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._colorBuffer),t.bufferData(t.ARRAY_BUFFER,e.colors,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e.indices,t.STATIC_DRAW),e.texture.baseTexture._glTexture?(t.bindTexture(t.TEXTURE_2D,e.texture.baseTexture._glTexture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),e.texture.baseTexture._powerOf2=!0):e.texture.baseTexture._powerOf2=!0},o.WebGLRenderGroup.prototype.renderStrip=function(e,t){var n=this.gl,r=o.stripShaderProgram;n.useProgram(r);var i=o.mat3.clone(e.worldTransform);o.mat3.transpose(i),n.uniformMatrix3fv(r.translationMatrix,!1,i),n.uniform2f(r.projectionVector,t.x,t.y),n.uniform1f(r.alpha,e.worldAlpha),e.dirty?(e.dirty=!1,n.bindBuffer(n.ARRAY_BUFFER,e._vertexBuffer),n.bufferData(n.ARRAY_BUFFER,e.verticies,n.STATIC_DRAW),n.vertexAttribPointer(r.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,e._uvBuffer),n.bufferData(n.ARRAY_BUFFER,e.uvs,n.STATIC_DRAW),n.vertexAttribPointer(r.textureCoordAttribute,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,e.texture.baseTexture._glTexture),n.bindBuffer(n.ARRAY_BUFFER,e._colorBuffer),n.bufferData(n.ARRAY_BUFFER,e.colors,n.STATIC_DRAW),n.vertexAttribPointer(r.colorAttribute,1,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e._indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.indices,n.STATIC_DRAW)):(n.bindBuffer(n.ARRAY_BUFFER,e._vertexBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,e.verticies),n.vertexAttribPointer(r.vertexPositionAttribute,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,e._uvBuffer),n.vertexAttribPointer(r.textureCoordAttribute,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,e.texture.baseTexture._glTexture),n.bindBuffer(n.ARRAY_BUFFER,e._colorBuffer),n.vertexAttribPointer(r.colorAttribute,1,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e._indexBuffer)),n.drawElements(n.TRIANGLE_STRIP,e.indices.length,n.UNSIGNED_SHORT,0),n.useProgram(o.currentProgram)},o.WebGLRenderGroup.prototype.renderTilingSprite=function(e,t){var n=this.gl,r=o.shaderProgram,i=e.tilePosition,s=e.tileScale,u=i.x/e.texture.baseTexture.width,a=i.y/e.texture.baseTexture.height,f=e.width/e.texture.baseTexture.width/s.x,l=e.height/e.texture.baseTexture.height/s.y;e.uvs[0]=0-u,e.uvs[1]=0-a,e.uvs[2]=1*f-u,e.uvs[3]=0-a,e.uvs[4]=1*f-u,e.uvs[5]=1*l-a,e.uvs[6]=0-u,e.uvs[7]=1*l-a,n.bindBuffer(n.ARRAY_BUFFER,e._uvBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,e.uvs),this.renderStrip(e,t)},o.WebGLRenderGroup.prototype.initStrip=function(e){var t=this.gl,n=this.shaderProgram;e._vertexBuffer=t.createBuffer(),e._indexBuffer=t.createBuffer(),e._uvBuffer=t.createBuffer(),e._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,e.verticies,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._uvBuffer),t.bufferData(t.ARRAY_BUFFER,e.uvs,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._colorBuffer),t.bufferData(t.ARRAY_BUFFER,e.colors,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e.indices,t.STATIC_DRAW)},o.CanvasRenderer=function(e,t,n,r){this.transparent=r,this.width=e||800,this.height=t||600,this.view=n||document.createElement("canvas"),this.context=this.view.getContext("2d"),this.smoothProperty=null,"imageSmoothingEnabled"in this.context?this.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context&&(this.smoothProperty="oImageSmoothingEnabled"),this.scaleMode=null,this.refresh=!0,this.view.width=this.width,this.view.height=this.height,this.count=0},o.CanvasRenderer.prototype.constructor=o.CanvasRenderer,o.CanvasRenderer.prototype.render=function(e){o.texturesToUpdate=[],o.texturesToDestroy=[],o.visibleCount++,e.updateTransform(),this.view.style.backgroundColor!=e.backgroundColorString&&!this.transparent&&(this.view.style.backgroundColor=e.backgroundColorString),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height),this.renderDisplayObject(e),e.interactive&&(e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this))),o.Texture.frameUpdates.length>0&&(o.Texture.frameUpdates=[])},o.CanvasRenderer.prototype.resize=function(e,t){this.width=e,this.height=t,this.view.width=e,this.view.height=t},o.CanvasRenderer.prototype.renderDisplayObject=function(e){var t,n=this.context;n.globalCompositeOperation="source-over";var r=e.last._iNext;e=e.first;do{t=e.worldTransform;if(!e.visible){e=e.last._iNext;continue}if(!e.renderable){e=e._iNext;continue}if(e instanceof o.Sprite){var i=e.texture.frame;i&&i.width&&i.height&&(n.globalAlpha=e.worldAlpha,n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),this.smoothProperty&&this.scaleMode!==e.texture.baseTexture.scaleMode&&(this.scaleMode=e.texture.baseTexture.scaleMode,n[this.smoothProperty]=this.scaleMode===o.BaseTexture.SCALE_MODE.LINEAR),n.drawImage(e.texture.baseTexture.source,i.x,i.y,i.width,i.height,e.anchor.x*-i.width,e.anchor.y*-i.height,i.width,i.height))}else if(e instanceof o.Strip)n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),this.renderStrip(e);else if(e instanceof o.TilingSprite)n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),this.renderTilingSprite(e);else if(e instanceof o.CustomRenderable)n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),e.renderCanvas(this);else if(e instanceof o.Graphics)n.setTransform(t[0],t[3],t[1],t[4],t[2],t[5]),o.CanvasGraphics.renderGraphics(e,n);else if(e instanceof o.FilterBlock&&e.data instanceof o.Graphics){var s=e.data;if(e.open){n.save();var u=s.alpha,a=s.worldTransform;n.setTransform(a[0],a[3],a[1],a[4],a[2],a[5]),s.worldAlpha=.5,n.worldAlpha=0,o.CanvasGraphics.renderGraphicsMask(s,n),n.clip(),s.worldAlpha=u}else n.restore()}e=e._iNext}while(e!=r)},o.CanvasRenderer.prototype.renderStripFlat=function(e){var t=this.context,n=e.verticies,r=e.uvs,i=n.length/2;this.count++,t.beginPath();for(var s=1;s<i-2;s++){var o=s*2,u=n[o],a=n[o+2],f=n[o+4],l=n[o+1],c=n[o+3],h=n[o+5];t.moveTo(u,l),t.lineTo(a,c),t.lineTo(f,h)}t.fillStyle="#FF0000",t.fill(),t.closePath()},o.CanvasRenderer.prototype.renderTilingSprite=function(e){var t=this.context;t.globalAlpha=e.worldAlpha,e.__tilePattern||(e.__tilePattern=t.createPattern(e.texture.baseTexture.source,"repeat")),t.beginPath();var n=e.tilePosition,r=e.tileScale;t.scale(r.x,r.y),t.translate(n.x,n.y),t.fillStyle=e.__tilePattern,t.fillRect(-n.x,-n.y,e.width/r.x,e.height/r.y),t.scale(1/r.x,1/r.y),t.translate(-n.x,-n.y),t.closePath()},o.CanvasRenderer.prototype.renderStrip=function(e){var t=this.context,n=e.verticies,r=e.uvs,i=n.length/2;this.count++;for(var s=1;s<i-2;s++){var o=s*2,u=n[o],a=n[o+2],f=n[o+4],l=n[o+1],c=n[o+3],h=n[o+5],p=r[o]*e.texture.width,d=r[o+2]*e.texture.width,v=r[o+4]*e.texture.width,m=r[o+1]*e.texture.height,g=r[o+3]*e.texture.height,y=r[o+5]*e.texture.height;t.save(),t.beginPath(),t.moveTo(u,l),t.lineTo(a,c),t.lineTo(f,h),t.closePath(),t.clip();var b=p*g+m*v+d*y-g*v-m*d-p*y,w=u*g+m*f+a*y-g*f-m*a-u*y,E=p*a+u*v+d*f-a*v-u*d-p*f,S=p*g*f+m*a*v+u*d*y-u*g*v-m*d*f-p*a*y,x=l*g+m*h+c*y-g*h-m*c-l*y,T=p*c+l*v+d*h-c*v-l*d-p*h,N=p*g*h+m*c*v+l*d*y-l*g*v-m*d*h-p*c*y;t.transform(w/b,x/b,E/b,T/b,S/b,N/b),t.drawImage(e.texture.baseTexture.source,0,0),t.restore()}},o.CanvasGraphics=function(){},o.CanvasGraphics.renderGraphics=function(e,t){var n=e.worldAlpha;for(var r=0;r<e.graphicsData.length;r++){var i=e.graphicsData[r],s=i.points;t.strokeStyle=color="#"+("00000"+(i.lineColor|0).toString(16)).substr(-6),t.lineWidth=i.lineWidth;if(i.type==o.Graphics.POLY){t.beginPath(),t.moveTo(s[0],s[1]);for(var u=1;u<s.length/2;u++)t.lineTo(s[u*2],s[u*2+1]);s[0]==s[s.length-2]&&s[1]==s[s.length-1]&&t.closePath(),i.fill&&(t.globalAlpha=i.fillAlpha*n,t.fillStyle=color="#"+("00000"+(i.fillColor|0).toString(16)).substr(-6),t.fill()),i.lineWidth&&(t.globalAlpha=i.lineAlpha*n,t.stroke())}else if(i.type==o.Graphics.RECT){if(i.fillColor||i.fillColor===0)t.globalAlpha=i.fillAlpha*n,t.fillStyle=color="#"+("00000"+(i.fillColor|0).toString(16)).substr(-6),t.fillRect(s[0],s[1],s[2],s[3]);i.lineWidth&&(t.globalAlpha=i.lineAlpha*n,t.strokeRect(s[0],s[1],s[2],s[3]))}else if(i.type==o.Graphics.CIRC)t.beginPath(),t.arc(s[0],s[1],s[2],0,2*Math.PI),t.closePath(),i.fill&&(t.globalAlpha=i.fillAlpha*n,t.fillStyle=color="#"+("00000"+(i.fillColor|0).toString(16)).substr(-6),t.fill()),i.lineWidth&&(t.globalAlpha=i.lineAlpha*n,t.stroke());else if(i.type==o.Graphics.ELIP){var a=i.points,f=a[2]*2,l=a[3]*2,c=a[0]-f/2,h=a[1]-l/2;t.beginPath();var p=.5522848,d=f/2*p,v=l/2*p,m=c+f,g=h+l,y=c+f/2,b=h+l/2;t.moveTo(c,b),t.bezierCurveTo(c,b-v,y-d,h,y,h),t.bezierCurveTo(y+d,h,m,b-v,m,b),t.bezierCurveTo(m,b+v,y+d,g,y,g),t.bezierCurveTo(y-d,g,c,b+v,c,b),t.closePath(),i.fill&&(t.globalAlpha=i.fillAlpha*n,t.fillStyle=color="#"+("00000"+(i.fillColor|0).toString(16)).substr(-6),t.fill()),i.lineWidth&&(t.globalAlpha=i.lineAlpha*n,t.stroke())}}},o.CanvasGraphics.renderGraphicsMask=function(e,t){var n=e.worldAlpha,r=e.graphicsData.length;r>1&&(r=1,console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var i=0;i<1;i++){var s=e.graphicsData[i],u=s.points;if(s.type==o.Graphics.POLY){t.beginPath(),t.moveTo(u[0],u[1]);for(var a=1;a<u.length/2;a++)t.lineTo(u[a*2],u[a*2+1]);u[0]==u[u.length-2]&&u[1]==u[u.length-1]&&t.closePath()}else if(s.type==o.Graphics.RECT)t.beginPath(),t.rect(u[0],u[1],u[2],u[3]),t.closePath();else if(s.type==o.Graphics.CIRC)t.beginPath(),t.arc(u[0],u[1],u[2],0,2*Math.PI),t.closePath();else if(s.type==o.Graphics.ELIP){var f=s.points,l=f[2]*2,c=f[3]*2,h=f[0]-l/2,p=f[1]-c/2;t.beginPath();var d=.5522848,v=l/2*d,m=c/2*d,g=h+l,y=p+c,b=h+l/2,w=p+c/2;t.moveTo(h,w),t.bezierCurveTo(h,w-m,b-v,p,b,p),t.bezierCurveTo(b+v,p,g,w-m,g,w),t.bezierCurveTo(g,w+m,b+v,y,b,y),t.bezierCurveTo(b-v,y,h,w+m,h,w),t.closePath()}}},o.Graphics=function(){o.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor="black",this.graphicsData=[],this.currentPath={points:[]}},o.Graphics.prototype=Object.create(o.DisplayObjectContainer.prototype),o.Graphics.prototype.constructor=o.Graphics,o.Graphics.prototype.lineStyle=function(e,t,n){this.currentPath.points.length==0&&this.graphicsData.pop(),this.lineWidth=e||0,this.lineColor=t||0,this.lineAlpha=n==undefined?1:n,this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:o.Graphics.POLY},this.graphicsData.push(this.currentPath)},o.Graphics.prototype.moveTo=function(e,t){this.currentPath.points.length==0&&this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:o.Graphics.POLY},this.currentPath.points.push(e,t),this.graphicsData.push(this.currentPath)},o.Graphics.prototype.lineTo=function(e,t){this.currentPath.points.push(e,t),this.dirty=!0},o.Graphics.prototype.beginFill=function(e,t){this.filling=!0,this.fillColor=e||0,this.fillAlpha=t==undefined?1:t},o.Graphics.prototype.endFill=function(){this.filling=!1,this.fillColor=null,this.fillAlpha=1},o.Graphics.prototype.drawRect=function(e,t,n,r){this.currentPath.points.length==0&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,t,n,r],type:o.Graphics.RECT},this.graphicsData.push(this.currentPath),this.dirty=!0},o.Graphics.prototype.drawCircle=function(e,t,n){this.currentPath.points.length==0&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,t,n,n],type:o.Graphics.CIRC},this.graphicsData.push(this.currentPath),this.dirty=!0},o.Graphics.prototype.drawElipse=function(e,t,n,r){this.currentPath.points.length==0&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,t,n,r],type:o.Graphics.ELIP},this.graphicsData.push(this.currentPath),this.dirty=!0},o.Graphics.prototype.clear=function(){this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[]},o.Graphics.POLY=0,o.Graphics.RECT=1,o.Graphics.CIRC=2,o.Graphics.ELIP=3,o.Strip=function(e,t,n){o.DisplayObjectContainer.call(this),this.texture=e,this.blendMode=o.blendModes.NORMAL;try{this.uvs=new Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new Float32Array([0,0,0,0,0,0,0,0,0]),this.colors=new Float32Array([1,1,1,1]),this.indices=new Uint16Array([0,1,2,3])}catch(r){this.uvs=[0,1,1,1,1,0,0,1],this.verticies=[0,0,0,0,0,0,0,0,0],this.colors=[1,1,1,1],this.indices=[0,1,2,3]}this.width=t,this.height=n,e.baseTexture.hasLoaded?(this.width=this.texture.frame.width,this.height=this.texture.frame.height,this.updateFrame=!0):(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},o.Strip.prototype=Object.create(o.DisplayObjectContainer.prototype),o.Strip.prototype.constructor=o.Strip,o.Strip.prototype.setTexture=function(e){this.texture=e,this.width=e.frame.width,this.height=e.frame.height,this.updateFrame=!0},o.Strip.prototype.onTextureUpdate=function(e){this.updateFrame=!0},o.Rope=function(e,t){o.Strip.call(this,e),this.points=t;try{this.verticies=new Float32Array(t.length*4),this.uvs=new Float32Array(t.length*4),this.colors=new Float32Array(t.length*2),this.indices=new Uint16Array(t.length*2)}catch(n){this.verticies=verticies,this.uvs=uvs,this.colors=colors,this.indices=indices}this.refresh()},o.Rope.prototype=Object.create(o.Strip.prototype),o.Rope.prototype.constructor=o.Rope,o.Rope.prototype.refresh=function(){var e=this.points;if(e.length<1)return;var t=this.uvs,n=this.indices,r=this.colors,i=e[0],s,o={x:0,y:0},u=e[0];this.count-=.2,t[0]=0,t[1]=1,t[2]=0,t[3]=1,r[0]=1,r[1]=1,n[0]=0,n[1]=1;var a=e.length;for(var f=1;f<a;f++){var u=e[f],l=f*4,c=f/(a-1);f%2?(t[l]=c,t[l+1]=0,t[l+2]=c,t[l+3]=1):(t[l]=c,t[l+1]=0,t[l+2]=c,t[l+3]=1),l=f*2,r[l]=1,r[l+1]=1,l=f*2,n[l]=l,n[l+1]=l+1,i=u}},o.Rope.prototype.updateTransform=function(){var e=this.points;if(e.length<1)return;var t=this.verticies,n=e[0],r,i={x:0,y:0},s=e[0];this.count-=.2,t[0]=s.x+i.x,t[1]=s.y+i.y,t[2]=s.x-i.x,t[3]=s.y-i.y;var u=e.length;for(var a=1;a<u;a++){var s=e[a],f=a*4;a<e.length-1?r=e[a+1]:r=s,i.y=-(r.x-n.x),i.x=r.y-n.y;var l=(1-a/(u-1))*10;l>1&&(l=1);var c=Math.sqrt(i.x*i.x+i.y*i.y),h=this.texture.height/2;i.x/=c,i.y/=c,i.x*=h,i.y*=h,t[f]=s.x+i.x,t[f+1]=s.y+i.y,t[f+2]=s.x-i.x,t[f+3]=s.y-i.y,n=s}o.DisplayObjectContainer.prototype.updateTransform.call(this)},o.Rope.prototype.setTexture=function(e){this.texture=e,this.updateFrame=!0},o.TilingSprite=function(e,t,n){o.DisplayObjectContainer.call(this),this.texture=e,this.width=t,this.height=n,this.tileScale=new o.Point(1,1),this.tilePosition=new o.Point(0,0),this.renderable=!0,this.blendMode=o.blendModes.NORMAL},o.TilingSprite.prototype=Object.create(o.DisplayObjectContainer.prototype),o.TilingSprite.prototype.constructor=o.TilingSprite,o.TilingSprite.prototype.setTexture=function(e){this.texture=e,this.updateFrame=!0},o.TilingSprite.prototype.onTextureUpdate=function(e){this.updateFrame=!0},o.Spine=function(e){o.DisplayObjectContainer.call(this),this.spineData=o.AnimCache[e];if(!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+e);this.skeleton=new d.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new d.AnimationStateData(this.spineData),this.state=new d.AnimationState(this.stateData),this.slotContainers=[];for(var t=0,n=this.skeleton.drawOrder.length;t<n;t++){var r=this.skeleton.drawOrder[t],i=r.attachment,s=new o.DisplayObjectContainer;this.slotContainers.push(s),this.addChild(s);if(!(i instanceof d.RegionAttachment))continue;var u=i.rendererObject.name,a=this.createSprite(r,i.rendererObject);r.currentSprite=a,r.currentSpriteName=u,s.addChild(a)}},o.Spine.prototype=Object.create(o.DisplayObjectContainer.prototype),o.Spine.prototype.constructor=o.Spine,o.Spine.prototype.updateTransform=function(){this.lastTime=this.lastTime||Date.now();var e=(Date.now()-this.lastTime)*.001;this.lastTime=Date.now(),this.state.update(e),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();var t=this.skeleton.drawOrder;for(var n=0,r=t.length;n<r;n++){var i=t[n],s=i.attachment,u=this.slotContainers[n];if(!(s instanceof d.RegionAttachment)){u.visible=!1;continue}if(s.rendererObject)if(!i.currentSpriteName||i.currentSpriteName!=s.name){var a=s.rendererObject.name;i.currentSprite!==undefined&&(i.currentSprite.visible=!1),i.sprites=i.sprites||{};if(i.sprites[a]!==undefined)i.sprites[a].visible=!0;else{var f=this.createSprite(i,s.rendererObject);u.addChild(f)}i.currentSprite=i.sprites[a],i.currentSpriteName=a}u.visible=!0;var l=i.bone;u.position.x=l.worldX+s.x*l.m00+s.y*l.m01,u.position.y=l.worldY+s.x*l.m10+s.y*l.m11,u.scale.x=l.worldScaleX,u.scale.y=l.worldScaleY,u.rotation=-(i.bone.worldRotation*Math.PI/180)}o.DisplayObjectContainer.prototype.updateTransform.call(this)},o.Spine.prototype.createSprite=function(e,t){var n=o.TextureCache[t.name]?t.name:t.name+".png",r=new o.Sprite(o.Texture.fromFrame(n));return r.scale=t.scale,r.rotation=t.rotation,r.anchor.x=r.anchor.y=.5,e.sprites=e.sprites||{},e.sprites[t.name]=r,r};var d={};return d.BoneData=function(e,t){this.name=e,this.parent=t},d.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1},d.SlotData=function(e,t){this.name=e,this.boneData=t},d.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null},d.Bone=function(e,t){this.data=e,this.parent=t,this.setToSetupPose()},d.Bone.yDown=!1,d.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(e,t){var n=this.parent;n!=null?(this.worldX=this.x*n.m00+this.y*n.m01+n.worldX,this.worldY=this.x*n.m10+this.y*n.m11+n.worldY,this.worldScaleX=n.worldScaleX*this.scaleX,this.worldScaleY=n.worldScaleY*this.scaleY,this.worldRotation=n.worldRotation+this.rotation):(this.worldX=this.x,this.worldY=this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var r=this.worldRotation*Math.PI/180,i=Math.cos(r),s=Math.sin(r);this.m00=i*this.worldScaleX,this.m10=s*this.worldScaleX,this.m01=-s*this.worldScaleY,this.m11=i*this.worldScaleY,e&&(this.m00=-this.m00,this.m01=-this.m01),t&&(this.m10=-this.m10,this.m11=-this.m11),d.Bone.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},setToSetupPose:function(){var e=this.data;this.x=e.x,this.y=e.y,this.rotation=e.rotation,this.scaleX=e.scaleX,this.scaleY=e.scaleY}},d.Slot=function(e,t,n){this.data=e,this.skeleton=t,this.bone=n,this.setToSetupPose()},d.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(e){this.attachment=e,this._attachmentTime=this.skeleton.time},setAttachmentTime:function(e){this._attachmentTime=this.skeleton.time-e},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var e=this.data;this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a;var t=this.skeleton.data.slots;for(var n=0,r=t.length;n<r;n++)if(t[n]==e){this.setAttachment(e.attachmentName?this.skeleton.getAttachmentBySlotIndex(n,e.attachmentName):null);break}}},d.Skin=function(e){this.name=e,this.attachments={}},d.Skin.prototype={addAttachment:function(e,t,n){this.attachments[e+":"+t]=n},getAttachment:function(e,t){return this.attachments[e+":"+t]},_attachAll:function(e,t){for(var n in t.attachments){var r=n.indexOf(":"),i=parseInt(n.substring(0,r)),s=n.substring(r+1),o=e.slots[i];if(o.attachment&&o.attachment.name==s){var u=this.getAttachment(i,s);u&&o.setAttachment(u)}}}},d.Animation=function(e,t,n){this.name=e,this.timelines=t,this.duration=n},d.Animation.prototype={apply:function(e,t,n){n&&this.duration!=0&&(t%=this.duration);var r=this.timelines;for(var i=0,s=r.length;i<s;i++)r[i].apply(e,t,1)},mix:function(e,t,n,r){n&&this.duration!=0&&(t%=this.duration);var i=this.timelines;for(var s=0,o=i.length;s<o;s++)i[s].apply(e,t,r)}},d.binarySearch=function(e,t,n){var r=0,i=Math.floor(e.length/n)-2;if(i==0)return n;var s=i>>>1;for(;;){e[(s+1)*n]<=t?r=s+1:i=s;if(r==i)return(r+1)*n;s=r+i>>>1}},d.linearSearch=function(e,t,n){for(var r=0,i=e.length-n;r<=i;r+=n)if(e[r]>t)return r;return-1},d.Curves=function(e){this.curves=[],this.curves.length=(e-1)*6},d.Curves.prototype={setLinear:function(e){this.curves[e*6]=0},setStepped:function(e){this.curves[e*6]=-1},setCurve:function(e,t,n,r,i){var s=.1,o=s*s,u=o*s,a=3*s,f=3*o,l=6*o,c=6*u,h=-t*2+r,p=-n*2+i,d=(t-r)*3+1,v=(n-i)*3+1,m=e*6,g=this.curves;g[m]=t*a+h*f+d*u,g[m+1]=n*a+p*f+v*u,g[m+2]=h*l+d*c,g[m+3]=p*l+v*c,g[m+4]=d*c,g[m+5]=v*c},getCurvePercent:function(e,t){t=t<0?0:t>1?1:t;var n=e*6,r=this.curves,i=r[n];if(!i)return t;if(i==-1)return 0;var s=r[n+1],o=r[n+2],u=r[n+3],a=r[n+4],f=r[n+5],l=i,c=s,h=8;for(;;){if(l>=t){var p=l-i,d=c-s;return d+(c-d)*(t-p)/(l-p)}if(h==0)break;h--,i+=o,s+=u,o+=a,u+=f,l+=i,c+=s}return c+(1-c)*(t-l)/(1-l)}},d.RotateTimeline=function(e){this.curves=new d.Curves(e),this.frames=[],this.frames.length=e*2},d.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(e,t,n){e*=2,this.frames[e]=t,this.frames[e+1]=n},apply:function(e,t,n){var r=this.frames;if(t<r[0])return;var i=e.bones[this.boneIndex];if(t>=r[r.length-2]){var s=i.data.rotation+r[r.length-1]-i.rotation;while(s>180)s-=360;while(s<-180)s+=360;i.rotation+=s*n;return}var o=d.binarySearch(r,t,2),u=r[o-1],a=r[o],f=1-(t-a)/(r[o-2]-a);f=this.curves.getCurvePercent(o/2-1,f);var s=r[o+1]-u;while(s>180)s-=360;while(s<-180)s+=360;s=i.data.rotation+(u+s*f)-i.rotation;while(s>180)s-=360;while(s<-180)s+=360;i.rotation+=s*n}},d.TranslateTimeline=function(e){this.curves=new d.Curves(e),this.frames=[],this.frames.length=e*3},d.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(e,t,n,r){e*=3,this.frames[e]=t,this.frames[e+1]=n,this.frames[e+2]=r},apply:function(e,t,n){var r=this.frames;if(t<r[0])return;var i=e.bones[this.boneIndex];if(t>=r[r.length-3]){i.x+=(i.data.x+r[r.length-2]-i.x)*n,i.y+=(i.data.y+r[r.length-1]-i.y)*n;return}var s=d.binarySearch(r,t,3),o=r[s-2],u=r[s-1],a=r[s],f=1-(t-a)/(r[s+ -3]-a);f=this.curves.getCurvePercent(s/3-1,f),i.x+=(i.data.x+o+(r[s+1]-o)*f-i.x)*n,i.y+=(i.data.y+u+(r[s+2]-u)*f-i.y)*n}},d.ScaleTimeline=function(e){this.curves=new d.Curves(e),this.frames=[],this.frames.length=e*3},d.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(e,t,n,r){e*=3,this.frames[e]=t,this.frames[e+1]=n,this.frames[e+2]=r},apply:function(e,t,n){var r=this.frames;if(t<r[0])return;var i=e.bones[this.boneIndex];if(t>=r[r.length-3]){i.scaleX+=(i.data.scaleX-1+r[r.length-2]-i.scaleX)*n,i.scaleY+=(i.data.scaleY-1+r[r.length-1]-i.scaleY)*n;return}var s=d.binarySearch(r,t,3),o=r[s-2],u=r[s-1],a=r[s],f=1-(t-a)/(r[s+ -3]-a);f=this.curves.getCurvePercent(s/3-1,f),i.scaleX+=(i.data.scaleX-1+o+(r[s+1]-o)*f-i.scaleX)*n,i.scaleY+=(i.data.scaleY-1+u+(r[s+2]-u)*f-i.scaleY)*n}},d.ColorTimeline=function(e){this.curves=new d.Curves(e),this.frames=[],this.frames.length=e*5},d.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(e,t,n,i){e*=5,this.frames[e]=t,this.frames[e+1]=r,this.frames[e+2]=g,this.frames[e+3]=b,this.frames[e+4]=a},apply:function(e,t,n){var r=this.frames;if(t<r[0])return;var i=e.slots[this.slotIndex];if(t>=r[r.length-5]){var s=r.length-1;i.r=r[s-3],i.g=r[s-2],i.b=r[s-1],i.a=r[s];return}var o=d.binarySearch(r,t,5),u=r[o-4],a=r[o-3],f=r[o-2],l=r[o-1],c=r[o],h=1-(t-c)/(r[o-5]-c);h=this.curves.getCurvePercent(o/5-1,h);var p=u+(r[o+1]-u)*h,v=a+(r[o+2]-a)*h,m=f+(r[o+3]-f)*h,g=l+(r[o+4]-l)*h;n<1?(i.r+=(p-i.r)*n,i.g+=(v-i.g)*n,i.b+=(m-i.b)*n,i.a+=(g-i.a)*n):(i.r=p,i.g=v,i.b=m,i.a=g)}},d.AttachmentTimeline=function(e){this.curves=new d.Curves(e),this.frames=[],this.frames.length=e,this.attachmentNames=[],this.attachmentNames.length=e},d.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(e,t,n){this.frames[e]=t,this.attachmentNames[e]=n},apply:function(e,t,n){var r=this.frames;if(t<r[0])return;var i;t>=r[r.length-1]?i=r.length-1:i=d.binarySearch(r,t,1)-1;var s=this.attachmentNames[i];e.slots[this.slotIndex].setAttachment(s?e.getAttachmentBySlotIndex(this.slotIndex,s):null)}},d.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.animations=[]},d.SkeletonData.prototype={defaultSkin:null,findBone:function(e){var t=this.bones;for(var n=0,r=t.length;n<r;n++)if(t[n].name==e)return t[n];return null},findBoneIndex:function(e){var t=this.bones;for(var n=0,r=t.length;n<r;n++)if(t[n].name==e)return n;return-1},findSlot:function(e){var t=this.slots;for(var n=0,r=t.length;n<r;n++)if(t[n].name==e)return slot[n];return null},findSlotIndex:function(e){var t=this.slots;for(var n=0,r=t.length;n<r;n++)if(t[n].name==e)return n;return-1},findSkin:function(e){var t=this.skins;for(var n=0,r=t.length;n<r;n++)if(t[n].name==e)return t[n];return null},findAnimation:function(e){var t=this.animations;for(var n=0,r=t.length;n<r;n++)if(t[n].name==e)return t[n];return null}},d.Skeleton=function(e){this.data=e,this.bones=[];for(var t=0,n=e.bones.length;t<n;t++){var r=e.bones[t],i=r.parent?this.bones[e.bones.indexOf(r.parent)]:null;this.bones.push(new d.Bone(r,i))}this.slots=[],this.drawOrder=[];for(var t=0,n=e.slots.length;t<n;t++){var s=e.slots[t],o=this.bones[e.bones.indexOf(s.boneData)],u=new d.Slot(s,this,o);this.slots.push(u),this.drawOrder.push(u)}},d.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateWorldTransform:function(){var e=this.flipX,t=this.flipY,n=this.bones;for(var r=0,i=n.length;r<i;r++)n[r].updateWorldTransform(e,t)},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){var e=this.bones;for(var t=0,n=e.length;t<n;t++)e[t].setToSetupPose()},setSlotsToSetupPose:function(){var e=this.slots;for(var t=0,n=e.length;t<n;t++)e[t].setToSetupPose(t)},getRootBone:function(){return this.bones.length==0?null:this.bones[0]},findBone:function(e){var t=this.bones;for(var n=0,r=t.length;n<r;n++)if(t[n].data.name==e)return t[n];return null},findBoneIndex:function(e){var t=this.bones;for(var n=0,r=t.length;n<r;n++)if(t[n].data.name==e)return n;return-1},findSlot:function(e){var t=this.slots;for(var n=0,r=t.length;n<r;n++)if(t[n].data.name==e)return t[n];return null},findSlotIndex:function(e){var t=this.slots;for(var n=0,r=t.length;n<r;n++)if(t[n].data.name==e)return n;return-1},setSkinByName:function(e){var t=this.data.findSkin(e);if(!t)throw"Skin not found: "+e;this.setSkin(t)},setSkin:function(e){this.skin&&e&&e._attachAll(this,this.skin),this.skin=e},getAttachmentBySlotName:function(e,t){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(e),t)},getAttachmentBySlotIndex:function(e,t){if(this.skin){var n=this.skin.getAttachment(e,t);if(n)return n}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(e,t):null},setAttachment:function(e,t){var n=this.slots;for(var r=0,i=n.size;r<i;r++){var s=n[r];if(s.data.name==e){var o=null;if(t){o=this.getAttachment(r,t);if(o==null)throw"Attachment not found: "+t+", for slot: "+e}s.setAttachment(o);return}}throw"Slot not found: "+e},update:function(e){time+=e}},d.AttachmentType={region:0},d.RegionAttachment=function(){this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},d.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(e,t,n,r,i){var s=this.uvs;i?(s[2]=e,s[3]=r,s[4]=e,s[5]=t,s[6]=n,s[7]=t,s[0]=n,s[1]=r):(s[0]=e,s[1]=r,s[2]=e,s[3]=t,s[4]=n,s[5]=t,s[6]=n,s[7]=r)},updateOffset:function(){var e=this.width/this.regionOriginalWidth*this.scaleX,t=this.height/this.regionOriginalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.regionOffsetX*e,r=-this.height/2*this.scaleY+this.regionOffsetY*t,i=n+this.regionWidth*e,s=r+this.regionHeight*t,o=this.rotation*Math.PI/180,u=Math.cos(o),a=Math.sin(o),f=n*u+this.x,l=n*a,c=r*u+this.y,h=r*a,p=i*u+this.x,d=i*a,v=s*u+this.y,m=s*a,g=this.offset;g[0]=f-h,g[1]=c+l,g[2]=f-m,g[3]=v+l,g[4]=p-m,g[5]=v+d,g[6]=p-h,g[7]=c+d},computeVertices:function(e,t,n,r){e+=n.worldX,t+=n.worldY;var i=n.m00,s=n.m01,o=n.m10,u=n.m11,a=this.offset;r[0]=a[0]*i+a[1]*s+e,r[1]=a[0]*o+a[1]*u+t,r[2]=a[2]*i+a[3]*s+e,r[3]=a[2]*o+a[3]*u+t,r[4]=a[4]*i+a[5]*s+e,r[5]=a[4]*o+a[5]*u+t,r[6]=a[6]*i+a[7]*s+e,r[7]=a[6]*o+a[7]*u+t}},d.AnimationStateData=function(e){this.skeletonData=e,this.animationToMixTime={}},d.AnimationStateData.prototype={defaultMix:0,setMixByName:function(e,t,n){var r=this.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;var i=this.skeletonData.findAnimation(t);if(!i)throw"Animation not found: "+t;this.setMix(r,i,n)},setMix:function(e,t,n){this.animationToMixTime[e.name+":"+t.name]=n},getMix:function(e,t){var n=this.animationToMixTime[e.name+":"+t.name];return n?n:this.defaultMix}},d.AnimationState=function(e){this.data=e,this.queue=[]},d.AnimationState.prototype={current:null,previous:null,currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,mixTime:0,mixDuration:0,update:function(e){this.currentTime+=e,this.previousTime+=e,this.mixTime+=e;if(this.queue.length>0){var t=this.queue[0];this.currentTime>=t.delay&&(this._setAnimation(t.animation,t.loop),this.queue.shift())}},apply:function(e){if(!this.current)return;if(this.previous){this.previous.apply(e,this.previousTime,this.previousLoop);var t=this.mixTime/this.mixDuration;t>=1&&(t=1,this.previous=null),this.current.mix(e,this.currentTime,this.currentLoop,t)}else this.current.apply(e,this.currentTime,this.currentLoop)},clearAnimation:function(){this.previous=null,this.current=null,this.queue.length=0},_setAnimation:function(e,t){this.previous=null,e&&this.current&&(this.mixDuration=this.data.getMix(this.current,e),this.mixDuration>0&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop)),this.current=e,this.currentLoop=t,this.currentTime=0},setAnimationByName:function(e,t){var n=this.data.skeletonData.findAnimation(e);if(!n)throw"Animation not found: "+e;this.setAnimation(n,t)},setAnimation:function(e,t){this.queue.length=0,this._setAnimation(e,t)},addAnimationByName:function(e,t,n){var r=this.data.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;this.addAnimation(r,t,n)},addAnimation:function(e,t,n){var r={};r.animation=e,r.loop=t;if(!n||n<=0){var i=this.queue.length==0?this.current:this.queue[this.queue.length-1].animation;i!=null?n=i.duration-this.data.getMix(i,e)+(n||0):n=0}r.delay=n,this.queue.push(r)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}},d.SkeletonJson=function(e){this.attachmentLoader=e},d.SkeletonJson.prototype={scale:1,readSkeletonData:function(e){var t=new d.SkeletonData,n=e.bones;for(var r=0,i=n.length;r<i;r++){var s=n[r],o=null;if(s.parent){o=t.findBone(s.parent);if(!o)throw"Parent bone not found: "+s.parent}var u=new d.BoneData(s.name,o);u.length=(s.length||0)*this.scale,u.x=(s.x||0)*this.scale,u.y=(s.y||0)*this.scale,u.rotation=s.rotation||0,u.scaleX=s.scaleX||1,u.scaleY=s.scaleY||1,t.bones.push(u)}var a=e.slots;for(var r=0,i=a.length;r<i;r++){var f=a[r],u=t.findBone(f.bone);if(!u)throw"Slot bone not found: "+f.bone;var l=new d.SlotData(f.name,u),c=f.color;c&&(l.r=d.SkeletonJson.toColor(c,0),l.g=d.SkeletonJson.toColor(c,1),l.b=d.SkeletonJson.toColor(c,2),l.a=d.SkeletonJson.toColor(c,3)),l.attachmentName=f.attachment,t.slots.push(l)}var h=e.skins;for(var p in h){if(!h.hasOwnProperty(p))continue;var v=h[p],m=new d.Skin(p);for(var g in v){if(!v.hasOwnProperty(g))continue;var y=t.findSlotIndex(g),b=v[g];for(var w in b){if(!b.hasOwnProperty(w))continue;var E=this.readAttachment(m,w,b[w]);E!=null&&m.addAttachment(y,w,E)}}t.skins.push(m),m.name=="default"&&(t.defaultSkin=m)}var S=e.animations;for(var x in S){if(!S.hasOwnProperty(x))continue;this.readAnimation(x,S[x],t)}return t},readAttachment:function(e,t,n){t=n.name||t;var r=d.AttachmentType[n.type||"region"];if(r==d.AttachmentType.region){var i=new d.RegionAttachment;return i.x=(n.x||0)*this.scale,i.y=(n.y||0)*this.scale,i.scaleX=n.scaleX||1,i.scaleY=n.scaleY||1,i.rotation=n.rotation||0,i.width=(n.width||32)*this.scale,i.height=(n.height||32)*this.scale,i.updateOffset(),i.rendererObject={},i.rendererObject.name=t,i.rendererObject.scale={},i.rendererObject.scale.x=i.scaleX,i.rendererObject.scale.y=i.scaleY,i.rendererObject.rotation=-i.rotation*Math.PI/180,i}throw"Unknown attachment type: "+r},readAnimation:function(e,t,n){var r=[],i=0,s=t.bones;for(var o in s){if(!s.hasOwnProperty(o))continue;var u=n.findBoneIndex(o);if(u==-1)throw"Bone not found: "+o;var a=s[o];for(var f in a){if(!a.hasOwnProperty(f))continue;var l=a[f];if(f=="rotate"){var c=new d.RotateTimeline(l.length);c.boneIndex=u;var h=0;for(var p=0,v=l.length;p<v;p++){var m=l[p];c.setFrame(h,m.time,m.angle),d.SkeletonJson.readCurve(c,h,m),h++}r.push(c),i=Math.max(i,c.frames[c.getFrameCount()*2-2])}else{if(f!="translate"&&f!="scale")throw"Invalid timeline type for a bone: "+f+" ("+o+")";var c,g=1;f=="scale"?c=new d.ScaleTimeline(l.length):(c=new d.TranslateTimeline(l.length),g=this.scale),c.boneIndex=u;var h=0;for(var p=0,v=l.length;p<v;p++){var m=l[p],y=(m.x||0)*g,b=(m.y||0)*g;c.setFrame(h,m.time,y,b),d.SkeletonJson.readCurve(c,h,m),h++}r.push(c),i=Math.max(i,c.frames[c.getFrameCount()*3-3])}}}var w=t.slots;for(var E in w){if(!w.hasOwnProperty(E))continue;var S=w[E],x=n.findSlotIndex(E);for(var f in S){if(!S.hasOwnProperty(f))continue;var l=S[f];if(f=="color"){var c=new d.ColorTimeline(l.length);c.slotIndex=x;var h=0;for(var p=0,v=l.length;p<v;p++){var m=l[p],T=m.color,N=d.SkeletonJson.toColor(T,0),C=d.SkeletonJson.toColor(T,1),k=d.SkeletonJson.toColor(T,2),L=d.SkeletonJson.toColor(T,3);c.setFrame(h,m.time,N,C,k,L),d.SkeletonJson.readCurve(c,h,m),h++}r.push(c),i=Math.max(i,c.frames[c.getFrameCount()*5-5])}else{if(f!="attachment")throw"Invalid timeline type for a slot: "+f+" ("+E+")";var c=new d.AttachmentTimeline(l.length);c.slotIndex=x;var h=0;for(var p=0,v=l.length;p<v;p++){var m=l[p];c.setFrame(h++,m.time,m.name)}r.push(c),i=Math.max(i,c.frames[c.getFrameCount()-1])}}}n.animations.push(new d.Animation(e,r,i))}},d.SkeletonJson.readCurve=function(e,t,n){var r=n.curve;if(!r)return;r=="stepped"?e.curves.setStepped(t):r instanceof Array&&e.curves.setCurve(t,r[0],r[1],r[2],r[3])},d.SkeletonJson.toColor=function(e,t){if(e.length!=8)throw"Color hexidecimal length must be 8, recieved: "+e;return parseInt(e.substring(t*2,2),16)/255},d.Atlas=function(e,t){this.textureLoader=t,this.pages=[],this.regions=[];var n=new d.AtlasReader(e),r=[];r.length=4;var i=null;for(;;){var s=n.readLine();if(s==null)break;s=n.trim(s);if(s.length==0)i=null;else if(!i){i=new d.AtlasPage,i.name=s,i.format=d.Atlas.Format[n.readValue()],n.readTuple(r),i.minFilter=d.Atlas.TextureFilter[r[0]],i.magFilter=d.Atlas.TextureFilter[r[1]];var o=n.readValue();i.uWrap=d.Atlas.TextureWrap.clampToEdge,i.vWrap=d.Atlas.TextureWrap.clampToEdge,o=="x"?i.uWrap=d.Atlas.TextureWrap.repeat:o=="y"?i.vWrap=d.Atlas.TextureWrap.repeat:o=="xy"&&(i.uWrap=i.vWrap=d.Atlas.TextureWrap.repeat),t.load(i,s),this.pages.push(i)}else{var u=new d.AtlasRegion;u.name=s,u.page=i,u.rotate=n.readValue()=="true",n.readTuple(r);var a=parseInt(r[0]),f=parseInt(r[1]);n.readTuple(r);var l=parseInt(r[0]),c=parseInt(r[1]);u.u=a/i.width,u.v=f/i.height,u.rotate?(u.u2=(a+c)/i.width,u.v2=(f+l)/i.height):(u.u2=(a+l)/i.width,u.v2=(f+c)/i.height),u.x=a,u.y=f,u.width=Math.abs(l),u.height=Math.abs(c),n.readTuple(r)==4&&(u.splits=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],n.readTuple(r)==4&&(u.pads=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],n.readTuple(r))),u.originalWidth=parseInt(r[0]),u.originalHeight=parseInt(r[1]),n.readTuple(r),u.offsetX=parseInt(r[0]),u.offsetY=parseInt(r[1]),u.index=parseInt(n.readValue()),this.regions.push(u)}}},d.Atlas.prototype={findRegion:function(e){var t=this.regions;for(var n=0,r=t.length;n<r;n++)if(t[n].name==e)return t[n];return null},dispose:function(){var e=this.pages;for(var t=0,n=e.length;t<n;t++)this.textureLoader.unload(e[t].rendererObject)},updateUVs:function(e){var t=this.regions;for(var n=0,r=t.length;n<r;n++){var i=t[n];if(i.page!=e)continue;i.u=i.x/e.width,i.v=i.y/e.height,i.rotate?(i.u2=(i.x+i.height)/e.width,i.v2=(i.y+i.width)/e.height):(i.u2=(i.x+i.width)/e.width,i.v2=(i.y+i.height)/e.height)}}},d.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},d.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},d.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},d.AtlasPage=function(){},d.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},d.AtlasRegion=function(){},d.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},d.AtlasReader=function(e){this.lines=e.split(/\r\n|\r|\n/)},d.AtlasReader.prototype={index:0,trim:function(e){return e.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var e=this.readLine(),t=e.indexOf(":");if(t==-1)throw"Invalid line: "+e;return this.trim(e.substring(t+1))},readTuple:function(e){var t=this.readLine(),n=t.indexOf(":");if(n==-1)throw"Invalid line: "+t;var r=0,i=n+1;for(;r<3;r++){var s=t.indexOf(",",i);if(s==-1){if(r==0)throw"Invalid line: "+t;break}e[r]=this.trim(t.substr(i,s-i)),i=s+1}return e[r]=this.trim(t.substring(i)),r+1}},d.AtlasAttachmentLoader=function(e){this.atlas=e},d.AtlasAttachmentLoader.prototype={newAttachment:function(e,t,n){switch(t){case d.AttachmentType.region:var r=this.atlas.findRegion(n);if(!r)throw"Region not found in atlas: "+n+" ("+t+")";var i=new d.RegionAttachment(n);return i.rendererObject=r,i.setUVs(r.u,r.v,r.u2,r.v2,r.rotate),i.regionOffsetX=r.offsetX,i.regionOffsetY=r.offsetY,i.regionWidth=r.width,i.regionHeight=r.height,i.regionOriginalWidth=r.originalWidth,i.regionOriginalHeight=r.originalHeight,i}throw"Unknown attachment type: "+t}},o.AnimCache={},d.Bone.yDown=!0,o.CustomRenderable=function(){o.DisplayObject.call(this),this.renderable=!0},o.CustomRenderable.prototype=Object.create(o.DisplayObject.prototype),o.CustomRenderable.prototype.constructor=o.CustomRenderable,o.CustomRenderable.prototype.renderCanvas=function(e){},o.CustomRenderable.prototype.initWebGL=function(e){},o.CustomRenderable.prototype.renderWebGL=function(e,t){},o.BaseTextureCache={},o.texturesToUpdate=[],o.texturesToDestroy=[],o.BaseTexture=function(e,t){o.EventTarget.call(this),this.width=100,this.height=100,this.scaleMode=t||o.BaseTexture.SCALE_MODE.DEFAULT,this.hasLoaded=!1,this.source=e;if(!e)return;if(this.source instanceof Image||this.source instanceof HTMLImageElement)if(this.source.complete)this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,o.texturesToUpdate.push(this);else{var n=this;this.source.onload=function(){n.hasLoaded=!0,n.width=n.source.width,n.height=n.source.height,o.texturesToUpdate.push(n),n.dispatchEvent({type:"loaded",content:n})}}else this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,o.texturesToUpdate.push(this);this._powerOf2=!1},o.BaseTexture.prototype.constructor=o.BaseTexture,o.BaseTexture.prototype.destroy=function(){this.source instanceof Image&&(this.source.src=null),this.source=null,o.texturesToDestroy.push(this)},o.BaseTexture.fromImage=function(e,t,n){var r=o.BaseTextureCache[e];if(!r){var i=new Image;t&&(i.crossOrigin=""),i.src=e,r=new o.BaseTexture(i,n),o.BaseTextureCache[e]=r}return r},o.BaseTexture.SCALE_MODE={DEFAULT:0,LINEAR:0,NEAREST:1},o.TextureCache={},o.FrameCache={},o.Texture=function(e,t){o.EventTarget.call(this),t||(this.noFrame=!0,t=new o.Rectangle(0,0,1,1)),e instanceof o.Texture&&(e=e.baseTexture),this.baseTexture=e,this.frame=t,this.trim=new o.Point,this.scope=this;if(e.hasLoaded)this.noFrame&&(t=new o.Rectangle(0,0,e.width,e.height)),this.setFrame(t);else{var n=this;e.addEventListener("loaded",function(){n.onBaseTextureLoaded()})}},o.Texture.prototype.constructor=o.Texture,o.Texture.prototype.onBaseTextureLoaded=function(e){var t=this.baseTexture;t.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new o.Rectangle(0,0,t.width,t.height)),this.noFrame=!1,this.width=this.frame.width,this.height=this.frame.height,this.scope.dispatchEvent({type:"update",content:this})},o.Texture.prototype.destroy=function(e){e&&this.baseTexture.destroy()},o.Texture.prototype.setFrame=function(e){this.frame=e,this.width=e.width,this.height=e.height;if(e.x+e.width>this.baseTexture.width||e.y+e.height>this.baseTexture.height)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.updateFrame=!0,o.Texture.frameUpdates.push(this)},o.Texture.fromImage=function(e,t,n){var r=o.TextureCache[e];return r||(r=new o.Texture(o.BaseTexture.fromImage(e,t,n)),o.TextureCache[e]=r),r},o.Texture.fromFrame=function(e){var t=o.TextureCache[e];if(!t)throw new Error("The frameId '"+e+"' does not exist in the texture cache "+this);return t},o.Texture.fromCanvas=function(e,t){var n=new o.BaseTexture(e,t);return new o.Texture(n)},o.Texture.addTextureToCache=function(e,t){o.TextureCache[t]=e},o.Texture.removeTextureFromCache=function(e){var t=o.TextureCache[e];return o.TextureCache[e]=null,t},o.Texture.frameUpdates=[],o.Texture.SCALE_MODE=o.BaseTexture.SCALE_MODE,o.RenderTexture=function(e,t){o.EventTarget.call(this),this.width=e||100,this.height=t||100,this.indetityMatrix=o.mat3.create(),this.frame=new o.Rectangle(0,0,this.width,this.height),o.gl?this.initWebGL():this.initCanvas()},o.RenderTexture.prototype=Object.create(o.Texture.prototype),o.RenderTexture.prototype.constructor=o.RenderTexture,o.RenderTexture.prototype.initWebGL=function(){var e=o.gl;this.glFramebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.glFramebuffer),this.glFramebuffer.width=this.width,this.glFramebuffer.height=this.height,this.baseTexture=new o.BaseTexture,this.baseTexture.width=this.width,this.baseTexture.height=this.height,this.baseTexture._glTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.baseTexture._glTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.baseTexture.isRender=!0,e.bindFramebuffer(e.FRAMEBUFFER,this.glFramebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.baseTexture._glTexture,0),this.projection=new o.Point(this.width/2,this.height/2),this.render=this.renderWebGL},o.RenderTexture.prototype.resize=function(e,t){this.width=e,this.height=t;if(o.gl){this.projection.x=this.width/2,this.projection.y=this.height/2;var n=o.gl;n.bindTexture(n.TEXTURE_2D,this.baseTexture._glTexture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.width,this.height,0,n.RGBA,n.UNSIGNED_BYTE,null)}else this.frame.width=this.width,this.frame.height=this.height,this.renderer.resize(this.width,this.height)},o.RenderTexture.prototype.initCanvas=function(){this.renderer=new o.CanvasRenderer(this.width,this.height,null,0),this.baseTexture=new o.BaseTexture(this.renderer.view),this.frame=new o.Rectangle(0,0,this.width,this.height),this.render=this.renderCanvas},o.RenderTexture.prototype.renderWebGL=function(e,t,n){var r=o.gl;r.colorMask(!0,!0,!0,!0),r.viewport(0,0,this.width,this.height),r.bindFramebuffer(r.FRAMEBUFFER,this.glFramebuffer),n&&(r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT));var i=e.children,s=e.worldTransform;e.worldTransform=o.mat3.create(),e.worldTransform[4]=-1,e.worldTransform[5]=this.projection.y*2,t&&(e.worldTransform[2]=t.x,e.worldTransform[5]-=t.y),o.visibleCount++,e.vcount=o.visibleCount;for(var u=0,a=i.length;u<a;u++)i[u].updateTransform();var f=e.__renderGroup;f?e==f.root?f.render(this.projection):f.renderSpecific(e,this.projection):(this.renderGroup||(this.renderGroup=new o.WebGLRenderGroup(r)),this.renderGroup.setRenderable(e),this.renderGroup.render(this.projection)),e.worldTransform=s},o.RenderTexture.prototype.renderCanvas=function(e,t,n){var r=e.children;e.worldTransform=o.mat3.create(),t&&(e.worldTransform[2]=t.x,e.worldTransform[5]=t.y);for(var i=0,s=r.length;i<s;i++)r[i].updateTransform();n&&this.renderer.context.clearRect(0,0,this.width,this.height),this.renderer.renderDisplayObject(e),this.renderer.context.setTransform(1,0,0,1,0,0)},o.AssetLoader=function(e,t){o.EventTarget.call(this),this.assetURLs=e,this.crossorigin=t,this.loadersByType={jpg:o.ImageLoader,jpeg:o.ImageLoader,png:o.ImageLoader,gif:o.ImageLoader,json:o.JsonLoader,anim:o.SpineLoader,xml:o.BitmapFontLoader,fnt:o.BitmapFontLoader}},o.AssetLoader.prototype.constructor=o.AssetLoader,o.AssetLoader.prototype.load=function(){var e=this;this.loadCount=this.assetURLs.length;for(var t=0;t<this.assetURLs.length;t++){var n=this.assetURLs[t],r=n.split(".").pop().toLowerCase(),i=this.loadersByType[r];if(!i)throw new Error(r+" is an unsupported file type");var s=new i(n,this.crossorigin);s.addEventListener("loaded",function(){e.onAssetLoaded()}),s.load()}},o.AssetLoader.prototype.onAssetLoaded=function(){this.loadCount--,this.dispatchEvent({type:"onProgress",content:this}),this.onProgress&&this.onProgress(),this.loadCount==0&&(this.dispatchEvent({type:"onComplete",content:this}),this.onComplete&&this.onComplete())},o.JsonLoader=function(e,t){o.EventTarget.call(this),this.url=e,this.crossorigin=t,this.baseUrl=e.replace(/[^\/]*$/,""),this.loaded=!1},o.JsonLoader.prototype.constructor=o.JsonLoader,o.JsonLoader.prototype.load=function(){this.ajaxRequest=new p;var e=this;this.ajaxRequest.onreadystatechange=function(){e.onJSONLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},o.JsonLoader.prototype.onJSONLoaded=function(){if(this.ajaxRequest.readyState==4)if(this.ajaxRequest.status==200||s.location.href.indexOf("http")==-1){this.json=JSON.parse(this.ajaxRequest.responseText);if(this.json.frames){var e=this,t=this.baseUrl+this.json.meta.image,n=new o.ImageLoader(t,this.crossorigin),r=this.json.frames;this.texture=n.texture.baseTexture,n.addEventListener("loaded",function(t){e.onLoaded()});for(var i in r){var u=r[i].frame;u&&(o.TextureCache[i]=new o.Texture(this.texture,{x:u.x,y:u.y,width:u.w,height:u.h}),r[i].trimmed&&(o.TextureCache[i].realSize=r[i].spriteSourceSize,o.TextureCache[i].trim.x=0))}n.load()}else if(this.json.bones){var a=new d.SkeletonJson,f=a.readSkeletonData(this.json);o.AnimCache[this.url]=f,this.onLoaded()}else this.onLoaded()}else this.onError()},o.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},o.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},o.SpriteSheetLoader=function(e,t){o.EventTarget.call(this),this.url=e,this.crossorigin=t,this.baseUrl=e.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},o.SpriteSheetLoader.prototype.constructor=o.SpriteSheetLoader,o.SpriteSheetLoader.prototype.load=function(){var e=this,t=new o.JsonLoader(this.url,this.crossorigin);t.addEventListener("loaded",function(t){e.json=t.content.json,e.onJSONLoaded()}),t.load()},o.SpriteSheetLoader.prototype.onJSONLoaded=function(){var e=this,t=this.baseUrl+this.json.meta.image,n=new o.ImageLoader(t,this.crossorigin),r=this.json.frames;this.texture=n.texture.baseTexture,n.addEventListener("loaded",function(t){e.onLoaded()});for(var i in r){var s=r[i].frame;s&&(o.TextureCache[i]=new o.Texture(this.texture,{x:s.x,y:s.y,width:s.w,height:s.h}),r[i].trimmed&&(o.TextureCache[i].realSize=r[i].spriteSourceSize,o.TextureCache[i].trim.x=0))}n.load()},o.SpriteSheetLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},o.ImageLoader=function(e,t){o.EventTarget.call(this),this.texture=o.Texture.fromImage(e,t),this.frames=[]},o.ImageLoader.prototype.constructor=o.ImageLoader,o.ImageLoader.prototype.load=function(){if(!this.texture.baseTexture.hasLoaded){var e=this;this.texture.baseTexture.addEventListener("loaded",function(){e.onLoaded()})}else this.onLoaded()},o.ImageLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},o.ImageLoader.prototype.loadFramedSpriteSheet=function(e,t,n){this.frames=[];var r=Math.floor(this.texture.width/e),i=Math.floor(this.texture.height/t),s=0;for(var u=0;u<i;u++)for(var a=0;a<r;a++,s++){var f=new o.Texture(this.texture,{x:a*e,y:u*t,width:e,height:t});this.frames.push(f),n&&(o.TextureCache[n+"-"+s]=f)}if(!this.texture.baseTexture.hasLoaded){var l=this;this.texture.baseTexture.addEventListener("loaded",function(){l.onLoaded()})}else this.onLoaded()},o.BitmapFontLoader=function(e,t){o.EventTarget.call(this),this.url=e,this.crossorigin=t,this.baseUrl=e.replace(/[^\/]*$/,""),this.texture=null},o.BitmapFontLoader.prototype.constructor=o.BitmapFontLoader,o.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new XMLHttpRequest;var e=this;this.ajaxRequest.onreadystatechange=function(){e.onXMLLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},o.BitmapFontLoader.prototype.onXMLLoaded=function(){if(this.ajaxRequest.readyState==4)if(this.ajaxRequest.status==200||s.location.href.indexOf("http")==-1){var e=this.baseUrl+this.ajaxRequest.responseXML.getElementsByTagName("page")[0].attributes.getNamedItem("file").nodeValue,t=new o.ImageLoader(e,this.crossorigin);this.texture=t.texture.baseTexture;var n={},r=this.ajaxRequest.responseXML.getElementsByTagName("info")[0],i=this.ajaxRequest.responseXML.getElementsByTagName("common")[0];n.font=r.attributes.getNamedItem("face").nodeValue,n.size=parseInt(r.attributes.getNamedItem("size").nodeValue,10),n.lineHeight=parseInt(i.attributes.getNamedItem("lineHeight").nodeValue,10),n.chars={};var u=this.ajaxRequest.responseXML.getElementsByTagName("char");for(var a=0;a<u.length;a++){var f=parseInt(u[a].attributes.getNamedItem("id").nodeValue,10),l=new o.Rectangle(parseInt(u[a].attributes.getNamedItem("x").nodeValue,10),parseInt(u[a].attributes.getNamedItem("y").nodeValue,10),parseInt(u[a].attributes.getNamedItem("width").nodeValue,10),parseInt(u[a].attributes.getNamedItem("height").nodeValue,10));n.chars[f]={xOffset:parseInt(u[a].attributes.getNamedItem("xoffset").nodeValue,10),yOffset:parseInt(u[a].attributes.getNamedItem("yoffset").nodeValue,10),xAdvance:parseInt(u[a].attributes.getNamedItem("xadvance").nodeValue,10),kerning:{},texture:o.TextureCache[f]=new o.Texture(this.texture,l)}}var c=this.ajaxRequest.responseXML.getElementsByTagName("kerning");for(a=0;a<c.length;a++){var h=parseInt(c[a].attributes.getNamedItem("first").nodeValue,10),p=parseInt(c[a].attributes.getNamedItem("second").nodeValue,10),d=parseInt(c[a].attributes.getNamedItem("amount").nodeValue,10);n.chars[p].kerning[h]=d}o.BitmapText.fonts[n.font]=n;var v=this;t.addEventListener("loaded",function(){v.onLoaded()}),t.load()}},o.BitmapFontLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},o.SpineLoader=function(e,t){o.EventTarget.call(this),this.url=e,this.crossorigin=t,this.loaded=!1},o.SpineLoader.prototype.constructor=o.SpineLoader,o.SpineLoader.prototype.load=function(){var e=this,t=new o.JsonLoader(this.url,this.crossorigin);t.addEventListener("loaded",function(t){e.json=t.content.json,e.onJSONLoaded()}),t.load()},o.SpineLoader.prototype.onJSONLoaded=function(e){var t=new d.SkeletonJson,n=t.readSkeletonData(this.json);o.AnimCache[this.url]=n,this.onLoaded()},o.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},typeof t!="undefined"?(typeof n!="undefined"&&n.exports&&(t=n.exports=o),t.PIXI=o):i.PIXI=o,n.exports}),n("math/math",["require","exports","module","../utils/support","../vendor/pixi"],function(e,t,n){var r=e("../utils/support"),i=e("../vendor/pixi"),o={DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,SEED:Math.random(),Matrix:i.Matrix,mat3:i.mat3,mat4:i.mat4,floor:Math.floor,ceil:Math.ceil,random:Math.random,abs:Math.abs,sqrt:Math.sqrt,min:Math.min,max:Math.max,round:function(e){return~~(e+(e>0?.5:-0.5))},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},truncate:function(e){return e>0?Math.floor(e):Math.ceil(e)},snap:function(e,t,n){return t===0?e:(n=n||0,e-=n,e=t*Math.round(e/t),n+e)},snapFloor:function(e,t,n){return t===0?e:(n=n||0,e-=n,e=t*Math.floor(e/t),n+e)},snapCeil:function(e,t,n){return t===0?e:(n=n||0,e-=n,e=t*Math.ceil(e/t),n+e)},radiansToDegrees:function(e){return e*o.RAD_TO_DEG},degreesToRadians:function(e){return e*o.DEG_TO_RAD},angleBetween:function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},randomBool:function(e){return e===undefined&&(e=50),e<=0?!1:e>=100?!0:Math.random()*100<e},randomInt:function(e,t){return e!==undefined&&e===t?e:(e=e||0,t=t||100,Math.floor(Math.random()*(t-e+1)+e))},randomReal:function(e,t){return e!==undefined&&e===t?e:(e=e||0,t=t||1,o.random()*(t-e)+e)},randomSign:function(e){return o.randomBool(e)?1:-1},randomString:function(){return Math.floor(Date.now()*Math.random()).toString()},randomUuid:function(){var e=o.randomBytes(o.__uuidBytes);e[6]=e[6]&15|64,e[8]=e[8]&63|128;var t=0,n=o.__byteToHex;return n[e[t++]]+n[e[t++]]+n[e[t++]]+n[e[t++]]+"-"+n[e[t++]]+n[e[t++]]+"-"+n[e[t++]]+n[e[t++]]+"-"+n[e[t++]]+n[e[t++]]+"-"+n[e[t++]]+n[e[t++]]+n[e[t++]]+n[e[t++]]+n[e[t++]]+n[e[t++]]},__uuidBytes:new Uint8Array(16),__byteToHex:function(){var e=[],t={};for(var n=0;n<256;n++)e[n]=(n+256).toString(16).substr(1),t[e[n]]=n;return e}(),randomBytes:function(e){return e=e||new Uint8Array(16),s.crypto.getRandomValues(e),e},randomElement:function(e,t,n){if(!e||!e.length)return null;if(e.length===1)return e[0];if(!t||t<0)t=t||0;if(!n||n<0)n=e.length-1;return e[o.randomInt(t,n)]}};return o._getRandomValuesTyped=function(e){var t=e.buffer,n=t.byteLength,r=new Uint8Array(t);for(var i=0,s;i<n;++i)(i&3)===0&&(s=o.random()*4294967296),r[i]=s>>>((i&3)<<3)&255;return e},o._getRandomValuesArray=function(e){for(var t=0;t<e.length;++t)e[t]=o.random()*4294967296;return e},r.crypto||(s.crypto=s.crypto||{},r.typedArrays?s.crypto.getRandomValues=o._getRandomValuesTyped:s.crypto.getRandomValues=o._getRandomValuesArray),n.exports=o,n.exports}),n("geom/Rectangle",["require","exports","module","../utils/inherit","./Polygon","../math/Vector","../math/math","../constants"],function(e,t,n){var r=e("../utils/inherit"),i=e("./Polygon"),s=e("../math/Vector"),o=e("../math/math"),u=e("../constants"),a=function(e,t,n,r){this.position=new s,this.x=e||0,this.y=t||0,this._width=n||0,this._height=r||0,this.halfWidth=this._width/2,this.halfHeight=this._height/2,this._shapetype=u.SHAPE.RECTANGLE};return r(a,Object,{clone:function(){return new a(this.x,this.y,this._width,this._height)},copy:function(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this},contains:function(e,t){if(this._width<=0||this._height<=0)return!1;var n=this.x;if(e>=n&&e<=n+this._width){var r=this.y;if(t>=r&&t<=r+this._height)return!0}return!1},overlaps:function(e){return this.right>e.x&&this.x<e.right&&this.bottom>e.y&&this.y<e.bottom},toPolygon:function(e){return e=e||this.position,new i(this.x-e.x,this.y-e.y,[new s(e.x,e.y),new s(this.width,e.y),new s(this.width,this.height),new s(e.x,this.height)])},equals:function(e){return this.position.equals(e.position)&&this._width===e._width&&this._height===e._height},union:function(e,t){return t=t||new a,t.x=o.min(this.x,e.x),t.y=o.min(this.y,e.y),t.width=o.max(this.right,e.right),t.height=o.max(this.bottom,e.bottom),t}}),Object.defineProperty(a.prototype,"x",{get:function(){return this.position.x},set:function(e){this.position.x=e}}),Object.defineProperty(a.prototype,"y",{get:function(){return this.position.y},set:function(e){this.position.y=e}}),Object.defineProperty(a.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e||0,this.halfWidth=this._width/2}}),Object.defineProperty(a.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e||0,this.halfHeight=this._height/2}}),Object.defineProperty(a.prototype,"right",{get:function(){return this.x+this._width}}),Object.defineProperty(a.prototype,"left",{get:function(){return this.x}}),Object.defineProperty(a.prototype,"top",{get:function(){return this.y}}),Object.defineProperty(a.prototype,"bottom",{get:function(){return this.y+this._height}}),Object.defineProperty(a.prototype,"perimeter",{get:function(){return 2*(this._width+this._height)}}),Object.defineProperty(a.prototype,"area",{get:function(){return this._width*this._height}}),n.exports=a,n.exports}),n("utils/utils",["require","exports","module","../math/Vector","../geom/Circle","../geom/Rectangle","../geom/Polygon"],function(e,t,n){var r=e("../math/Vector"),i=e("../geom/Circle"),o=e("../geom/Rectangle"),u=e("../geom/Polygon"),a={_arrayDelim:/[|,]/,noop:function(){},getAbsoluteUrl:function(e){var t=document.createElement("a");return t.href=e,t.href},ajax:function(e){e=e||{},e.method=e.method||"GET",e.dataType=e.dataType||"text";if(!e.url)throw new TypeError("Undefined URL passed to ajax");e.progress=e.progress||a.noop,e.load=e.load||a.noop,e.error=e.error||a.noop,e.abort=e.abort||a.noop,e.complete=e.complete||a.noop;var t=a.createAjaxRequest(),n=a.getAbsoluteUrl(e.url).split("/")[0];return t.onreadystatechange=function(){if(t.readyState===4){var r=t.response||t.responseText,i=null;n!=="file:"&&t.status!==200&&(i="Non-200 status code returned: "+t.status);if(!i&&typeof r=="string")if(e.dataType==="json")try{r=JSON.parse(r)}catch(s){i=s}else if(e.dataType==="xml")try{r=a.parseXML(r)}catch(s){i=s}i?e.error&&e.error.call(t,i):e.load&&e.load.call(t,r)}},e.dataType!=="json"&&e.dataType!=="xml"?t.responseType=e.dataType:t.responseType="text",t.open(e.method,e.url,!0),t.send(),t},createAjaxRequest:function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];if(!s.ActiveXObject)return s.XMLHttpRequest?new XMLHttpRequest:!1;for(var t=0;t<e.length;t++)try{return new s.ActiveXObject(e[t])}catch(n){}},setValues:function(e,t){if(!t)return;for(var n in t){var i=t[n];if(i===undefined)continue;if(n in e){var s=e[n];if(typeof s=="number"&&typeof i=="string"){var o;i.indexOf("0x")===0?o=parseInt(i,16):o=parseInt(i,10),isNaN(o)||(e[n]=o)}else if(s instanceof r&&i instanceof Array)s.set(parseFloat(i[0],10)||0,parseFloat(i[1],10)||parseFloat(i[0],10)||0);else if(s instanceof r&&typeof i=="string"){var u=i.split(a._arrayDelim,2);s.set(parseFloat(u[0],10)||0,parseFloat(u[1],10)||parseFloat(u[0],10)||0)}else if(s instanceof r&&typeof i=="number")s.set(i,i);else if(s instanceof Array&&typeof i=="string"){e[n]=i.split(a._arrayDelim);for(var f=0,l=e[n].length;f<l;++f){var c=e[n][f];isNaN(c)||(e[n][f]=parseFloat(c,10))}}else e[n]=i}}return e},extend:function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,f=arguments.length,l=!1;typeof o=="boolean"&&(l=o,o=arguments[1]||{},u=2),typeof o!="object"&&typeof o!="function"&&(o={});for(;u<f;u++){i=arguments[u];if(i!==null&&i!==undefined)for(r in i){e=o[r],n=i[r];if(o===n)continue;l&&n&&(a.isPlainObject(n)||(t=Array.isArray(n)))?(t?(t=!1,s=e&&Array.isArray(e)?e:[]):s=e&&a.isPlainObject(e)?e:{},o[r]=a.extend(l,s,n)):n!==undefined&&(o[r]=n)}}return o},isPlainObject:function(e){if(typeof e!="object"||e.nodeType||e===e.window)return!1;try{if(e.constructor&&!Object.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},getOffset:function(e){var t=e.getBoundingClientRect(),n=e.clientTop||document.body.clientTop||0,i=e.clientLeft||document.body.clientLeft||0,o=s.pageYOffset||e.scrollTop||document.body.scrollTop,u=s.pageXOffset||e.scrollLeft||document.body.scrollLeft;return new r(t.left+u-i,t.top+o-n)},parseHitArea:function(e){var t;if(e.length%2!==0&&e.length!==3)throw new RangeError("Strange number of values for hitArea! Should be a flat array of values, like: [x,y,r] for a circle, [x,y,w,h] for a rectangle, or [x,y,x,y,...] for other polygons.");return e.length===3?t=new i(e[0],e[1],e[2]):e.length===4?t=new o(e[0],e[1],e[2],e[3]):t=new u(0,0,e),t},parseTiledProperties:function(e){if(!e||e.__tiledparsed)return e;for(var t in e){var n=e[t],r=parseFloat(n,10);if(r===0||r)e[t]=r;else if(n==="true")e[t]=!0;else if(n==="false")e[t]=!1;else try{n=JSON.parse(n),e[t]=n}catch(i){}}e.hitArea&&(e.hitArea=a.parseHitArea(e.hitArea));if(e.body==="static"||e.sensor)e.mass=Infinity,e.inertia=Infinity;return e.__tiledparsed=!0,e},_logger:s.console||{},log:function(){a._logger.log&&a._logger.log.apply(a._logger,arguments)},warn:function(){a._logger.warn&&a._logger.warn.apply(a._logger,arguments)},error:function(){a._logger.error&&a._logger.error.apply(a._logger,arguments)}};return typeof s.DOMParser!="undefined"?a.parseXML=function(e){return(new s.DOMParser).parseFromString(e,"text/xml")}:typeof s.ActiveXObject!="undefined"&&new s.ActiveXObject("Microsoft.XMLDOM")?a.parseXML=function(e){var t=new s.ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}:(a.warn("XML parser not available, trying to parse any XML will result in an error."),a.parseXML=function(){throw new Error("Trying to parse XML, but not XML parser is available in this environment")}),n.exports=a,n.exports}),n("audio/AudioPlayer",["require","exports","module","./AudioPlayer","../utils/EventEmitter","../utils/utils","../utils/inherit","../utils/support"],function(e,t,n){var r=e("./AudioPlayer"),i=e("../utils/EventEmitter"),s=e("../utils/utils"),o=e("../utils/inherit"),u=e("../utils/support"),r=function(e,t,n){i.call(this),this.src="",this.game=e.game,this.key=t.key,this.autoplay=!1,this.format=null,this.loop=!1,this.pos3d=[0,0,-0.5],this.sprite={},Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)}),this._file=t,this._volume=1,this._duration=0,this._loaded=!1,this._manager=e,this._webAudio=u.webAudio,this._nodes=[],this._onendTimer=[],s.setValues(this,n),this._webAudio&&this._setupAudioNode(),this._load()};return o(r,Object,{_load:function(){var e=this,t=this._file;if(t.webAudio)t.decoded?this._loadSoundBuffer(t.data):this._manager.ctx.decodeAudioData(t.data,function(n){n&&(t.data=n,t.decoded=!0,e._loadSoundBuffer(n))});else{var n=t.data.cloneNode();this._nodes.push(n),n._pos=0,n.volume=this._manager.muted?0:this._volume*this._manager.volume,this._duration=n.duration,this.sprite._default=[0,n.duration*1e3],this._loaded||(this._loaded=!0,this.emit("ready",this.src)),this.autoplay&&this.play()}return this},play:function(e,t){var n=this;return typeof e=="function"&&(t=e,e=null),e||(e="_default"),this._loaded?this.sprite[e]?(this._inactiveNode(function(r){var i=r._pos>0?r._pos:n.sprite[e][0]/1e3,s=n.sprite[e][1]/1e3-r._pos,o=n.loop||n.sprite[e][2],u=typeof t=="string"?t:Math.round(Date.now()*Math.random())+"",a;r._sprite=e,function(e){a=setTimeout(function(){!n._webAudio&&e.loop&&n.stop(e.id,e.timer).play(e.sprite,e.id),n._webAudio&&!e.loop&&(n._nodeById(e.id).paused=!0),!n._webAudio&&!e.loop&&n.stop(e.id,e.timer),n.emit("end",e.id)},s*1e3),n._onendTimer.push(a),e.timer=a}({id:u,sprite:e,loop:o});if(n._webAudio)r.id=u,r.paused=!1,n._refreshBuffer([o,i,s],u),n._playStart=n._manager.ctx.currentTime,r.gain.value=n._volume,typeof r.bufferSource.start=="undefined"?r.bufferSource.noteGrainOn(0,i,s):r.bufferSource.start(0,i,s);else{if(r.readyState!==4)return n._clearEndTimer(a),function(){var i=n,s=e,o=t,u=r,a=function(){i.play(s,o),u.removeEventListener("canplaythrough",a,!1)};u.addEventListener("canplaythrough",a,!1)}(),n;r.id=u,r.currentTime=i,r.muted=n._manager.muted,r.volume=n._volume*n._manager.volume,r.play()}n.emit("play",u),typeof t=="function"&&t(u)}),this):(typeof t=="function"&&t(),this):(this.on("ready",function(){n.play(e,t)}),this)},pause:function(e,t){var n=this;if(!this._loaded)return this.on("play",function(){n.play(e,t)}),this;this._clearEndTimer(t||0);var r=e?this._nodeById(e):this._activeNode();if(r)if(this._webAudio){if(!r.bufferSource)return this;r.paused=!0,r._pos+=this._manager.ctx.currentTime-this._playStart,typeof r.bufferSource.stop=="undefined"?r.bufferSource.noteOff(0):r.bufferSource.stop(0)}else r._pos=r.currentTime,r.pause();return this.emit("pause",r?r.id:e),this},stop:function(e,t){var n=this;if(!this._loaded)return this.on("play",function(){n.stop(e,t)}),this;this._clearEndTimer(t||0);var r=e?this._nodeById(e):this._activeNode();if(r){r._pos=0;if(this._webAudio){if(!r.bufferSource)return this;r.paused=!0,typeof r.bufferSource.stop=="undefined"?r.bufferSource.noteOff(0):r.bufferSource.stop(0)}else r.pause(),r.currentTime=0}return this},mute:function(e){return this.setMuted(!0,e)},unmute:function(e){return this.setMuted(!1,e)},setMuted:function(e,t){var n=this;if(!this._loaded)return this.on("play",function(){n.setMuted(e,t)}),this;var r=t?this._nodeById(t):this._activeNode();return r&&(this._webAudio?r.gain.value=e?0:this._volume:r.volume=e?0:this._volume),this},seek:function(e,t){var n=this;if(!this._loaded)return this.on("ready",function(){n.seek(e,t)}),this;if(!e||e<0)e=0;var r=t?this._nodeById(t):this._activeNode();return r&&(this._webAudio?(r._pos=e,this.pause(r.id).play(r._sprite,t)):r.currentTime=e),this},getPosition:function(e){var t=this;if(!this._loaded)return this.on("ready",function(){t.getPosition(e)}),this;var n=e?this._nodeById(e):this._activeNode();return n?this._webAudio?n._pos+(this._manager.ctx.currentTime-this._playStart):n.currentTime:0},fade:function(e,t,n,r,i){var s=this,o=Math.abs(e-t),u=e>t?"dowm":"up",a=o/.01,f=n/a;typeof r=="function"&&(i=r,r=null);if(!this._loaded)return this.on("ready",function(){s.fade(e,t,n,r,i)}),this;this.setVolume(e,r);for(var l=1;l<=a;++l){var c=this._volume+(u==="up"?.01:-0.01)*l,h=Math.round(1e3*c)/1e3,p=f*l;this._doFadeStep(h,p,t,r,i)}},getVolume:function(){return this._volume},setVolume:function(e,t){var n=this;e=parseFloat(e);if(!this._loaded)return this.on("play",function(){n.setVolume(e,t)}),this;if(e>=0&&e<=1){this._volume=e;var r=t?this._nodeById(t):this._activeNode();r&&(this._webAudio?r.gain.volume=e:r.volume=e*this._manager.volume)}return this},setPosition:function(e,t,n,r){var i=this;e=e?e:0,t=t?t:0,n=!n&&n!==0?-0.5:n;if(!this._loaded)return this.on("play",function(){i.setPosition(e,t,n,r)}),this;if(this._webAudio){var s=r?this._nodeById(r):this._activeNode();s&&(this.pos3d[0]=e,this.pos3d[1]=t,this.pos3d[2]=n,s.panner.setPosition(e,t,n))}return this},_doFadeStep:function(e,t,n,r,i){var s=this;setTimeout(function(){s.setVolume(e,r),e===n&&typeof i=="function"&&i()},t)},_nodeById:function(e){var t=this._nodes[0];for(var n=0,r=this._nodes.length;n<r;++n)if(this._nodes[n].id===e){t=this._nodes[n];break}return t},_activeNode:function(){var e;for(var t=0,n=this._nodes.length;t<n;++t)if(!this._nodes[t].paused){e=this._nodes[t];break}return this._drainPool(),e},_inactiveNode:function(e){var t;for(var n=0,r=this._nodes.length;n<r;++n)if(this._nodes[n].paused&&this._nodes[n].readyState===4){e(t=this._nodes[n]);break}this._drainPool();if(t)return;this._webAudio?(t=this._setupAudioNode(),e(t)):(this._load(),t=this._nodes[this.nodes.length-1],t.addEventListener("loadedmetadata",function(){e(t)}))},_drainPool:function(){var e=0,t=0,n=0;for(t=0,n=this._nodes.length;t<n;++t)this._nodes[t].paused&&e++;for(t=this._nodes.length-1;t>=0;--t){if(e<=5)break;this._nodes[t].paused&&(e--,this._nodes.splice(t,1))}},_clearEndTimer:function(e){var t=this._onendTimer.indexOf(e);t=t>=0?t:0,this._onendTimer[t]&&(clearTimeout(this._onendTimer[t]),this._onendTimer.splice(t,1))},_setupAudioNode:function(){var e=this._manager.ctx.createGain?this._manager.ctx.createGain():this._manager.ctx.createGainNode();return this._nodes.push(e),e.gain.value=this._volume,e.paused=!0,e._pos=0,e.readyState=4,e.connect(this._manager.masterGain),e.panner=this._manager.ctx.createPanner(),e.panner.setPosition(this.pos3d[0],this.pos3d[1],this.pos3d[2]),e.panner.connect(e),e},_loadSoundBuffer:function(e){this._duration=e?e.duration:this._duration,this.sprite._default=[0,this._duration*1e3],this._loaded||(this._loaded=!0,this.emit("ready",this.src)),this.autoplay&&this.play()},_refreshBuffer:function(e,t){var n=this._nodeById(t);n.bufferSource=this._manager.ctx.createBufferSource(),n.bufferSource.buffer=this._file.data,n.bufferSource.connect(n.panner),n.bufferSource.loop=e[0],e[0]&&(n.bufferSource.loopStart=e[1],n.bufferSource.loopEnd=e[1]+e[2])}}),n.exports=r,n.exports}),n("audio/AudioManager",["require","exports","module","./AudioPlayer","../utils/inherit","../utils/support"],function(e,t,n){var r=e("./AudioPlayer"),i=e("../utils/inherit"),o=e("../utils/support"),u=s.AudioContext||s.webkitAudioContext||s.mozAudioContext,a=o.webAudio?new u:null,f=function(e,t){this.game=e,this.parent=t,this._muted=!1,this._volume=1,Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)}),this.ctx=a,this.canPlay=o.webAudio||o.htmlAudio,o.webAudio&&(this.masterGain=this.ctx.createGain?this.ctx.createGain():this.ctx.createGainNode(),this.masterGain.gain.value=1,this.setParent(t)),this.sounds={}};return i(f,Object,{getVolume:function(){return this._volume},setVolume:function(e){e=parseFloat(e,10);if(!isNaN(e)&&e>=0&&e<=1){this._volume=e,o.webAudio&&(this.masterGain.gain.value=e);for(var t in this.sounds)if(this.sounds.hasOwnProperty(t)&&this.sounds[t]._webAudio===!1){var n=this.sounds[t];for(var r=0,i=n._nodes.length;r<i;++r)n._nodes[r].volume=n._volume*this._volume}}},mute:function(){return this.setMuted(!0)},unmute:function(){return this.setMuted(!1)},setMuted:function(e){this._muted=e=!!e,o.webAudio&&(this.masterGain.gain.value=e?0:this._volume);for(var t in this.sounds)if(this.sounds.hasOwnProperty(t)&&this.sounds[t]._webAudio===!1){var n=this.sounds[t];for(var r=0,i=n._nodes.length;r<i;++r)n._nodes[r].mute()}return this},setParent:function(e){return this.parent=e,o.webAudio&&(e&&e.masterGain?this.masterGain.connect(e.masterGain):this.masterGain.connect(this.ctx.destination)),this},attach:function(e){if(e._manager!==this){e._manager&&e._manager.detach(e),this.sounds[e.key]=e,e._manager=this;if(o.webAudio)for(var t=0;t<e._nodes.length;++t)e._nodes[t].connect(this.masterGain)}return e},detach:function(e){if(e._manager!==this){delete this.sounds[e.key],e._manager=null;if(o.webAudio)for(var t=0;t<e._nodes.length;++t)e._nodes[t].disconnect()}return e},add:function(e,t){if(!this.canPlay)return!1;var n=this.game.cache.getAudio(e);return n.player||(n.player=new r(this,n,t)),this.sounds[e]=n.player},remove:function(e){var t=this.sounds[e];return t&&t.stop(),delete this.sounds[e],t?t:!1}}),n.exports=f,n.exports}),n("physics/PhysicsTarget",["require","exports","module"],function(e,t,n){return n.exports=function(){this._phys={},this.mass=0,this.inertia=0,this.enablePhysics=function(e,t){var n=this;return typeof e=="function"&&(t=e,e=null),e?(this._phys.active?this._phys.system.remove(this,function(){e.add(n,t)}):e.add(this,t),this._phys.system=e):this._phys.system.add(this,t),this},this.disablePhysics=function(e){return this._phys.system&&this._phys.system.remove(this,e),this},this.reindex=function(e){return this._phys.system&&this._phys.system.reindex(this,e),this},this.setMass=function(e){return this._phys.system&&this._phys.system.setMass(this,e),this},this.setVelocity=function(e){return this._phys.system&&this._phys.system.setVelocity(this,e),this},this.setRotation=function(e){return this.rotation=e,this._phys.system&&this._phys.system.setRotation(this,e),this},this.setPosition=function(e,t){return this.position.x=e,this.position.y=t,this._phys.system&&this._phys.system.setPosition(this,this.position),this},this.onCollision=function(e,t,n,r){this.emit("collision",e,t,n,r)},this.onSeparate=function(e,t,n){this.emit("separate",e,t,n)}},n.exports}),n("display/Container",["require","exports","module","../utils/EventEmitter","../physics/PhysicsTarget","../utils/utils","../utils/inherit","../vendor/pixi"],function(e,t,n){var r=e("../utils/EventEmitter"),i=e("../physics/PhysicsTarget"),s=e("../utils/utils"),o=e("../utils/inherit"),u=e("../vendor/pixi"),a=function(e){u.DisplayObjectContainer.call(this),r.call(this),i.call(this),s.setValues(this,e)};return o(a,u.DisplayObjectContainer,{show:function(){return this.visible=!0,this},hide:function(){return this.visible=!1,this},addChild:function(e){return u.DisplayObjectContainer.prototype.addChild.apply(this,arguments),e},addChildAt:function(e){return u.DisplayObjectContainer.prototype.addChildAt.apply(this,arguments),e},removeChild:function(e){return u.DisplayObjectContainer.prototype.removeChild.apply(this,arguments),e},removeAllChildren:function(){while(this.children.length)this.removeChild(this.children[0]);return this},bringChildToTop:function(e){return e.parent===this&&this.addChild(this.removeChild(e)),e},destroy:function(){this.disablePhysics(),this.destroyAllChildren(),this.parent&&this.parent.removeChild(this)},destroyAllChildren:function(){while(this.children.length)this.children[0].destroy?this.children[0].destroy():this.removeChild(this.children[0]);return this},onCollide:function(){}}),n.exports=a,n.exports}),n("display/Texture",["require","exports","module","../vendor/pixi","../utils/utils","../vendor/pixi"],function(e,t,n){var r=e("../vendor/pixi").Texture,i=e("../utils/utils"),s=e("../vendor/pixi");return r.fromJSON=function(e,t,n){if(!t.frames){i.warn('Invalid Texture Atlas JSON for fromJSON, missing "frames" array, full json:',t);return}var s=t.frames,o={},u;if(s.length)for(var a=0,f=s.length;a<f;++a)u=e+"_"+s[a].filename,o[s[a].filename]=r._createFrame(u,s[a],n);else for(var l in s)u=e+"_"+l,o[l]=r._createFrame(u,s[l],n);return o},r._createFrame=function(e,t,n){var i=t.frame;if(i){var o=s.TextureCache[e]=new r(n,{x:i.x,y:i.y,width:i.w,height:i.h});return o.trimmed=t.trimmed,o.rotated=t.rotated,o.sourceSize=t.sourceSize,o.realSize=t.spriteSourceSize,o}},r.fromXML=function(e,t,n){if(!t.getElementsByTagName("TextureAtlas")){i.warn("Invalid Texture Atlas XML given, missing <TextureAtlas> tag, full xml:",t);return}var o=t.getElementsByTagName("SubTexture")||t.getElementsByTagName("sprite"),u={};for(var a=0;a<o.length;a++){var f=o[a],l=f.attributes,c=l.getNamedItem("name")||l.getNamedItem("n"),h=l.getNamedItem("x"),p=l.getNamedItem("y"),d=l.getNamedItem("width")||l.getNamedItem("w"),v=l.getNamedItem("height")||l.getNamedItem("h"),m=l.getNamedItem("frameX")||l.getNamedItem("oX"),g=l.getNamedItem("frameY")||l.getNamedItem("oY"),y=l.getNamedItem("frameWidth")||l.getNamedItem("oW"),b=l.getNamedItem("frameHeight")||l.getNamedItem("oH"),w=!!l.getNamedItem("r"),E=u[c]=s.TextureCache[e+"_"+c]=new r(n,{x:parseInt(h.nodeValue,10),y:parseInt(p.nodeValue,10),width:parseInt(d.nodeValue,10),height:parseInt(v.nodeValue,10)});E.trimmed=m&&g,E.rotated=w,E.trimmed&&(E.sourceSize={w:parseInt(y.nodeValue,10),h:parseInt(b.nodeValue,10)},E.realSize={x:Math.abs(parseInt(m.nodeValue,10)),y:Math.abs(parseInt(g.nodeValue,10)),w:parseInt(y.nodeValue,10),h:parseInt(b.nodeValue,10)})}return u},r.fromSpritesheet=function(e){return e},n.exports=r,n.exports}),n("display/Sprite",["require","exports","module","../utils/EventEmitter","../geom/Rectangle","../physics/PhysicsTarget","../utils/inherit","./Texture","../math/math","../utils/utils","../vendor/pixi"],function(e,t,n){var r=e("../utils/EventEmitter"),i=e("../geom/Rectangle"),s=e("../physics/PhysicsTarget"),o=e("../utils/inherit"),u=e("./Texture"),a=e("../math/math"),f=e("../utils/utils"),l=e("../vendor/pixi"),c=function(e,t,n){r.call(this),s.call(this),e||(e=u.__default);if(e instanceof u)e={_default:{frames:[e]}},n="_default";else if(e instanceof Array)e={_default:{frames:e}},n="_default";else for(var o in e){n===undefined&&(n=o);var a=e[o];a instanceof Array?e[o]={name:o,frames:a}:a instanceof u?e[o]={name:o,frames:[a]}:e[o].name=o}l.Sprite.call(this,e[n].frames[0]),this.name="",this.lifespan=Infinity,this.speed=t||1,this.loop=!1,this.animations=e,this.currentAnimation=n,this.currentFrame=0,this.playing=!1,this.hitArea=this.hitArea||new i(0,0,this.width,this.height),this.goto(0,this.currentAnimation)};return o(c,l.Sprite,{show:function(){return this.visible=!0,this},hide:function(){return this.visible=!1,this},clone:function(){var e=f.extend(!0,{},this.animations),t=new c(e,this.speed,this.currentAnimation);return t.name=this.name,t.loop=this.loop,t.currentFrame=this.currentFrame,t.playing=this.playing,t.hitArea=this.hitArea.clone(),t.body=this.body.clone(),t.blendMode=this.blendMode,t.anchor.x=this.anchor.x,t.anchor.y=this.anchor.y,t.position.x=this.position.x,t.position.y=this.position.y,t.scale.x=this.scale.x,t.scale.y=this.scale.y,t.pivot.x=this.pivot.x,t.pivot.y=this.pivot.y,t.rotation=this.rotation,t.alpha=this.alpha,t.visible=this.visible,t.buttonMode=this.buttonMode,t.renderable=this.renderable,t},addAnimation:function(e,t,n,r){return typeof e=="object"?this.animations[e.name]=e:this.animations[e]={name:e,frames:t,speed:n,loop:r},this},"goto":function(e,t){return typeof e=="string"&&(t=e,e=0),this.currentFrame=e||0,this.lastRound=a.round(e||0),t&&(this.currentAnimation=t),this.setTexture(this.animations[this.currentAnimation].frames[this.currentFrame]),this.emit("frame",this.currentAnimation,this.lastRound),this},play:function(){return this.playing=!0,this},stop:function(){return this.playing=!1,this},destroy:function(){this.stop(),this.disablePhysics(),this.parent&&this.parent.removeChild(this),this.name=null,this.lifetime=null,this.speed=null,this.loop=null,this.animations=null,this.currentAnimation=null,this.currentFrame=null,this.playing=null,this.hitArea=null},updateTransform:function(){l.Sprite.prototype.updateTransform.call(this);if(!this.playing)return;var e=this.animations[this.currentAnimation],t,n=e.loop!==undefined?e.loop:this.loop;this.currentFrame+=e.speed||this.speed,t=a.round(this.currentFrame),t<e.frames.length?t!==this.lastRound&&(this.lastRound=t,this.setTexture(e.frames[t]),this.emit("frame",this.currentAnimation,t)):n?this.goto(0):(this.stop(),this.emit("complete",this.currentAnimation))}}),n.exports=c,n.exports}),n("utils/ObjectPool",["require","exports","module","./inherit"],function(e,t,n){var r=e("./inherit"),i=function(e,t){this.type=e,this.pool=[],this.parent=t};return r(i,Object,{create:function(){var e=this.pool.pop();return e||(e=this._construct(this.type,arguments),this.parent&&this.parent.addChild(e)),e.__allocated=!0,e},free:function(e){e.__allocated&&(e.__allocated=!1,this.pool.push(e))},_construct:function(e,t){function n(){return e.apply(this,t)}return n.prototype=e.prototype,new n}}),n.exports=i,n.exports}),n("gui/GuiItem",["require","exports","module","../utils/inherit","../display/Sprite"],function(e,t,n){var r=e("../utils/inherit"),i=e("../display/Sprite"),s=function(e,t){this.draggable=!1,this.dragging=!1,i.call(this,e),this.interactive=t};return r(s,i,{mousedown:function(e){i.prototype.mousedown.call(this,e);if(!this.draggable)return;this.dragging=e.data.getLocalPosition(e.object.parent)},mouseup:function(e){i.prototype.mouseup.call(this,e),this.dragging=!1},mousemove:function(e){i.prototype.mousemove.call(this,e);if(!this.draggable||!this.dragging)return;var t=e.data.getLocalPosition(this.parent);this.position.x+=t.x-this.dragging.x,this.position.y+=t.y-this.dragging.y,this.dragging=t}}),n.exports=s,n.exports}),n("geom/Ellipse",["require","exports","module","../vendor/pixi"],function(e,t,n){var r=e("../vendor/pixi").Ellipse;return n.exports=r,n.exports}),n("tilemap/ObjectGroup",["require","exports","module","../display/Container","../math/Vector","../geom/Polygon","../geom/Ellipse","../geom/Rectangle","../utils/utils","../utils/inherit","../math/math"],function(e,t,n){var r=e("../display/Container"),i=e("../math/Vector"),s=e("../geom/Polygon"),o=e("../geom/Ellipse"),u=e("../geom/Rectangle"),a=e("../utils/utils"),f=e("../utils/inherit"),l=e("../math/math"),c=function(e,t){r.call(this,t),this.map=e,this.game=e.game,this.state=e.state,this.name=t.name||"",this.color=t.color,this.properties=t.properties||{},this.objects=t.objects,this.type=t.type||"objectgroup",this.position.x=t.x||0,this.position.y=t.y||0,this.alpha=t.opacity!==undefined?t.opacity:1,this.visible=t.visible!==undefined?t.visible:!0};return f(c,r,{spawn:function(){var e=this.game;for(var t=this.objects.length-1;t>=0;--t){var n=this.objects[t],i=a.parseTiledProperties(n.properties)||{},s,o,u;i.tileprops={},n.gid?(s=this.parent.getTileset(n.gid),s&&(i.texture=s.getTileTexture(n.gid),i.tileprops=s.getTileProperties(n.gid),i.hitArea||(i.tileprops.hitArea?i.hitArea=i.tileprops.hitArea:i.hitArea=s.properties.hitArea))):i.hitArea||(n.polyline?i.hitArea=this._getPolyline(n):n.polygon?i.hitArea=this._getPolygon(n):n.ellipse?i.hitArea=this._getEllipse(n):i.hitArea=this._getRectangle(n)),n.name=n.name||i.name||i.tileprops.name,n.type=n.type||i.type||i.tileprops.type,typeof i.texture=="string"&&(i.texture=e.cache.getTexture(i.texture));if(!i.texture)u=new r,u.width=n.width,u.height=n.height,u.name=n.name,u.type=n.type,u.rotation=n.rotation,u.position.x=n.x,u.position.y=n.y,u.sensor=!0,u.hitArea=i.hitArea,u.enablePhysics(e.physics);else{i.width=n.width,i.height=n.height,i.zIndex=this.zIndex,u=e.spritepool.create(n.name,i.texture,i),u.name=n.name,u.type=n.type,u.position.x=n.x,u.position.y=n.y,u.mass=i.mass||i.tileprops.mass,u.inertia=i.inertia||i.tileprops.inertia,u.friction=i.friction||i.tileprops.friction,u.sensor=i.sensor||i.tileprops.sensor,u.hitArea=i.hitArea;var f=i.anchor||i.tileprops.anchor;u.anchor.y=f?f[1]:1,u.anchor.x=f?f[0]:this.parent.orientation==="isometric"?.5:0,u.mass&&u.enablePhysics(e.physics),i.tileprops&&(i.tileprops.flippedX&&(u.scale.x=-1,u.anchor.x=f?f[0]:1),i.tileprops.flippedY&&(u.scale.y=-1,u.anchor.y=f?f[1]:0),i.tileprops.rotatedCW&&(u.rotation=l.degreesToRadians(45))),(i.animation||i.tileprops.animation)&&u.goto&&u.goto(0,i.animation||i.tileprops.animation).play(),typeof n.rotation=="number"&&u.setRotation(n.rotation)}u.visible=n.visible!==undefined?!!n.visible:!0;if(this.parent.orientation==="isometric"){var c=n.x/this.parent.tileSize.x,h=n.y/this.parent.tileSize.y;n.x=c*this.parent.tileSize.x-(h-1)*(this.parent.tileSize.x/2),n.y=h*this.parent.tileSize.y/2+c*this.parent.tileSize.y}o=this._getInteractive(s,i),o&&(u.interactive=o,u.click=this.onObjectEvent.bind(this,"click",u),u.mousedown=this.onObjectEvent.bind(this,"mousedown",u),u.mouseup=this.onObjectEvent.bind(this,"mouseup",u),u.mousemove=this.onObjectEvent.bind(this,"mousemove",u),u.mouseout=this.onObjectEvent.bind(this,"mouseout",u),u.mouseover=this.onObjectEvent.bind(this,"mouseover",u),u.mouseupoutside=this.onObjectEvent.bind(this,"mouseupoutside",u)),u.properties={};for(var p in i.tileprops)u.properties[p]=i.tileprops[p];for(var d in i)d!=="tileprops"&&(u.properties[d]=i[d]);u._objIndex=t,this.addChild(u)}return this},onObjectEvent:function(e,t,n){this.parent.onObjectEvent(e,t,n)},_getPolygon:function(e){var t=[];for(var n=0,r=e.polygon.length;n<r;++n)t.push(new i(e.polygon[n].x,e.polygon[n].y));return new s(t)},_getPolyline:function(e){var t=[];for(var n=0,r=e.polyline.length;n<r;++n)t.push(new i(e.polyline[n].x,e.polyline[n].y));return new s(t)},_getEllipse:function(e){return new o(0,0,e.width,e.height)},_getRectangle:function(e){return new u(0,0,e.width,e.height)},_getInteractive:function(e,t){return t.interactive||t.tileprops.interactive||e&&e.properties.interactive||this.properties.interactive||this.parent.properties.interactive},despawn:function(){return r.prototype.destroyAllChildren.call(this)},destroy:function(){this.despawn(),r.prototype.destroy.call(this),this.map=null,this.game=null,this.state=null,this.name=null,this.color=null,this.properties=null,this.objects=null,this.type=null}}),n.exports=c,n.exports}),n("tilemap/Tile",["require","exports","module","../display/Sprite","../utils/inherit"],function(e,t,n){var r=e("../display/Sprite"),i=e("../utils/inherit"),s=function(e){r.call(this,e)};return i(s,r,{}),n.exports=s,n.exports}),n("tilemap/Tilelayer",["require","exports","module","../display/Container","../geom/Rectangle","../math/Vector","../display/Texture","./Tile","../math/math","../utils/utils","../utils/inherit","../utils/support"],function(e,t,n){var r=e("../display/Container"),i=e("../geom/Rectangle"),s=e("../math/Vector"),o=e("../display/Texture"),u=e("./Tile"),a=e("../math/math"),f=e("../utils/utils"),l=e("../utils/inherit"),c=e("../utils/support"),h=function(e,t){r.call(this,t),this.map=e,this.state=e.state,this.state=e.state,this.tiles=[],this.name=t.name||"",this.size=new s(t.width||0,t.height||0),this.tileIds=c.typedArrays?new Uint32Array(t.data):t.data,this.properties=f.parseTiledProperties(t.properties)||{},this.type=t.type||"tilelayer",this.preRender=t.preRender||this.properties.preRender||!1,this.chunkSize=new s(t.chunkSizeX||t.chunkSize||this.properties.chunkSizeX||this.properties.chunkSize||512,t.chunkSizeY||t.chunkSize||this.properties.chunkSizeY||this.properties.chunkSize||512),this.position.x=t.x||0,this.position.y=t.y||0,this.alpha=t.opacity!==undefined?t.opacity:1,this.visible=t.visible!==undefined?t.visible:!0,this._preRendered=!1,this._tilePool=[],this._buffered={left:!1,right:!1,top:!1,bottom:!1},this._panDelta=new s,this._rendered=new i};return l(h,r,{render:function(e,t,n,r){if(this.preRender){if(!this._preRendered)this._preRender();else for(var i=this.children.length-1;i>-1;--i)this.children[i].visible=!0;return}return this.tileSize||(this.tileSize=this.map.tileSize),this.clearTiles(),this._renderTiles(e,t,n,r),this},_preRender:function(){if(!this.visible)return;this._preRendered=!0,this.tileSize=this.chunkSize.clone();var e=this.map,t=e.size.x*e.tileSize.x,n=e.size.y*e.tileSize.y,r=a.ceil(t/this.chunkSize.x),i=a.ceil(n/this.chunkSize.y);for(var s=0;s<r;++s)for(var o=0;o<i;++o){var u=s===r-1?t-s*this.chunkSize.x:this.chunkSize.x,f=o===i-1?n-o*this.chunkSize.y:this.chunkSize.y;this._preRenderChunk(s,o,u,f)}},_preRenderChunk:function(e,t,n,r){var i=this.map,s=i.tileSize.x,f=i.tileSize.y,l=n/s,c=r/f,h=e*this.chunkSize.x%s,p=t*this.chunkSize.y%f,d=a.floor(e*this.chunkSize.x/s),v=a.floor(t*this.chunkSize.y/f),m=i.size.x,g=i.size.y,y=document.createElement("canvas"),b=y.getContext("2d");y.width=n,y.height=r;for(var w=0;w<l;++w)for(var E=0;E<c;++E)if(w+d<m&&E+v<g){var S=w+d+(E+v)*m,x=this.tileIds[S],T=i.getTileset(x),N,C;T&&(N=T.getTileTexture(x),C=N.frame,b.drawImage(N.baseTexture.source,C.x,C.y,C.width,C.height,w*s-h+T.tileoffset.x,E*f-p+T.tileoffset.y,C.width,C.height))}var k=new u(o.fromCanvas(y));k.setPosition(e*this.chunkSize.x,t*this.chunkSize.y),this.tiles[e]||(this.tiles[e]={}),this.addChild(k),this.tiles[e][t]=k},_renderTiles:function(e,t,n,r){e=a.floor(e/this.map.scaledTileSize.x),t=a.floor(t/this.map.scaledTileSize.y),e=e<0?0:e,t=t<0?0:t,n=a.ceil(n/this.map.scaledTileSize.x)+1,r=a.ceil(r/this.map.scaledTileSize.y)+1,n=e+n>this.map.size.x?this.map.size.x-e:n,r=t+r>this.map.size.y?this.map.size.y-t:r;var i=e+n,s=t+r;for(var o=e;o<i;++o)for(var u=t;u<s;++u)this.moveTileSprite(-1,-1,o,u);this._rendered.x=e,this._rendered.y=t,this._rendered.width=n,this._rendered.height=r,this._buffered.left=this._buffered.right=this._buffered.top=this._buffered.bottom=!1,this._panDelta.x=this.state.world.position.x%this.map.scaledTileSize.x,this._panDelta.y=this.state.world.position.y%this.map.scaledTileSize.y},_freeTile:function(e,t){this.tiles[e]&&this.tiles[e][t]&&(this.clearTile(this.tiles[e][t]),this.tiles[e][t]=null)},clearTiles:function(e){var t;if(this.preRender&&!e){for(t=this.children.length-1;t>-1;--t)this.children[t].visible=!1;return}this._preRendered=!1;for(t=this.children.length-1;t>-1;--t)this.clearTile(this.children[t],e);return this.tiles.length=0,this},clearTile:function(e,t){return e.visible=!1,e.disablePhysics(),t?this.removeChild(e):this._tilePool.push(e),this},moveTileSprite:function(e,t,n,r){if(n<0||r<0||n>=this.map.size.x||r>=this.map.size.y){this.tiles[e]&&this.tiles[e][t]&&this.tiles[e][t].disablePhysics();return}var i,s=n+r*this.size.x,o=this.tileIds[s],a=this.map.getTileset(o),f,l,c,h,p;if(!a){this._freeTile(e,t);return}return f=a.getTileTexture(o),l=a.getTileProperties(o),h=l.hitArea||a.properties.hitArea,p=this._getInteractive(a,l),c=[n*this.map.tileSize.x+a.tileoffset.x,r*this.map.tileSize.y+a.tileoffset.y],c[1]+=this.map.tileSize.y,this.tiles[e]&&this.tiles[e][t]?(i=this.tiles[e][t],this.tiles[e][t]=null,i.disablePhysics()):i=this._tilePool.pop(),i||(i=new u(f),i.anchor.y=1,this.addChild(i)),i.collisionType=l.type,i.interactive=p,i.hitArea=h,i.mass=l.mass||0,i.setTexture(f),i.setPosition(c[0],c[1]),i.show(),i.mass&&i.enablePhysics(this.state.physics),p&&(i.click=this.onTileEvent.bind(this,"click",i),i.mousedown=this.onTileEvent.bind(this,"mousedown",i),i.mouseup=this.onTileEvent.bind(this,"mouseup",i),i.mousemove=this.onTileEvent.bind(this,"mousemove",i),i.mouseout=this.onTileEvent.bind(this,"mouseout",i),i.mouseover=this.onTileEvent.bind(this,"mouseover",i),i.mouseupoutside=this.onTileEvent.bind(this,"mouseupoutside",i)),this.tiles[n]||(this.tiles[n]=[]),this.tiles[n][r]=i,i},onTileEvent:function(e,t,n){this.map.onTileEvent(e,t,n)},_getInteractive:function(e,t){return t.interactive||e&&e.properties.interactive||this.properties.interactive||this.map.properties.interactive},pan:function(e,t){if(this.preRender)return;this._panDelta.x+=e,this._panDelta.y+=t;var n=this.map.scaledTileSize.x,r=this.map.scaledTileSize.y;e>0&&!this._buffered.left?this._renderLeft(this._buffered.left=!0):e<0&&!this._buffered.right&&this._renderRight(this._buffered.right=!0),t>0&&!this._buffered.top?this._renderUp(this._buffered.top=!0):t<0&&!this._buffered.bottom&&this._renderDown(this._buffered.bottom=!0);while(this._panDelta.x>=n)this._renderLeft(),this._panDelta.x-=n;while(this._panDelta.x<=-n)this._renderRight(),this._panDelta.x+=n;while(this._panDelta.y>=r)this._renderUp(),this._panDelta.y-=r;while(this._panDelta.y<=-r)this._renderDown(),this._panDelta.y+=r},_renderLeft:function(e){for(var t=0;t<this._rendered.height+1;++t)this.moveTileSprite(e?-1:this._rendered.right,e?-1:this._rendered.top+t,this._rendered.left-1,this._rendered.top+t);this._rendered.x--,e&&this._rendered.width++},_renderRight:function(e){for(var t=0;t<this._rendered.height+1;++t)this.moveTileSprite(e?-1:this._rendered.left,e?-1:this._rendered.top+t,this._rendered.right+1,this._rendered.top+t);e||this._rendered.x++,e&&this._rendered.width++},_renderUp:function(e){for(var t=0;t<this._rendered.width+1;++t)this.moveTileSprite(e?-1:this._rendered.left+t,e?-1:this._rendered.bottom,this._rendered.left+t,this._rendered.top-1);this._rendered.y--,e&&this._rendered.height++},_renderDown:function(e){for(var t=0;t<this._rendered.width+1;++t)this.moveTileSprite(e?-1:this._rendered.left+t,e?-1:this._rendered.top,this._rendered.left+t,this._rendered.bottom+1);e||this._rendered.y++,e&&this._rendered.height++},destroy:function(){r.prototype.destroy.call(this),this.clearTiles(!0),this.state=null,this.name=null,this.size=null,this.tileIds=null,this.properties=null,this.type=null,this.position.x=null,this.position.y=null,this.alpha=null,this.visible=null,this.preRender=null,this.chunkSize=null,this._preRendered=null,this._tilePool=null,this._buffered=null,this._panDelta=null,this._rendered=null}}),n.exports=h,n.exports}),n("tilemap/Tileset",["require","exports","module","../utils/utils","../utils/inherit","../math/math","../display/Texture","../math/Vector","../vendor/pixi"],function(e,t,n){var r=e("../utils/utils"),i=e("../utils/inherit"),s=e("../math/math"),o=e("../display/Texture"),u=e("../math/Vector"),a=e("../vendor/pixi"),f=function(e,t){o.call(this,e.baseTexture||e),this.firstgid=t.firstgid||1,this.name=t.name,this.tileSize=new u(t.tilewidth,t.tileheight),this.spacing=t.spacing||0,this.margin=t.margin||0,this.tileoffset=new u(t.tileoffset?t.tileoffset.x:0,t.tileoffset?t.tileoffset.y:0),this.numTiles=new u(s.floor((this.baseTexture.source.width-this.margin)/(this.tileSize.x-this.spacing)),s.floor((this.baseTexture.source.height-this.margin)/(this.tileSize.y-this.spacing))),this.lastgid=this.firstgid+(this.numTiles.x*this.numTiles.y-1||0),this.properties=t.properties||{},this.tileproperties=t.tileproperties||{},this.size=new u(t.imagewidth||this.baseTexture.source.width,t.imageheight||this.baseTexture.source.height),this.textures=[],this.properties=r.parseTiledProperties(this.properties);for(var n in this.tileproperties)this.tileproperties[n]=r.parseTiledProperties(this.tileproperties[n]);for(var i=0,f=this.lastgid-this.firstgid+1;i<f;++i){var l=s.floor(i/this.numTiles.x),c=i-l*this.numTiles.x;c=c*this.tileSize.x+c*this.spacing+this.margin,l=l*this.tileSize.y+l*this.spacing+this.margin,this.textures.push(new o(this.baseTexture,new a.Rectangle(c,l,this.tileSize.x,this.tileSize.y)))}};i(f,o,{getTileProperties:function(e){if(!e)return null;var t=f.FLAGS,n=e&t.FlippedX,r=e&t.FlippedY,i=e&t.RotatedCW;e=(e&~f.FLAGS.ALL)-this.firstgid;if(e<0)return null;var s=this.tileproperties[e]?this.tileproperties[e]:this.tileproperties[e]={collidable:!1,breakable:!1};return s.flippedX=n,s.flippedY=r,s.rotatedCW=i,s},getTileTexture:function(e){return e?(e=(e&~f.FLAGS.ALL)-this.firstgid,e<0?null:this.textures[e]):null},contains:function(e){return e?(e&=~f.FLAGS.ALL,e>=this.firstgid&&e<=this.lastgid):!1}}),f.FLAGS={FlippedX:2147483648,FlippedY:1073741824,RotatedCW:536870912};var l=0;for(var c in f.FLAGS)l|=f.FLAGS[c];return f.FLAGS.ALL=l,n.exports=f,n.exports}),n("tilemap/Tilemap",["require","exports","module","../display/Container","./ObjectGroup","../display/Sprite","../math/Vector","./Tilelayer","./Tileset","../utils/utils","../utils/inherit"],function(e,t,n){var r=e("../display/Container"),i=e("./ObjectGroup"),s=e("../display/Sprite"),o=e("../math/Vector"),u=e("./Tilelayer"),a=e("./Tileset"),f=e("../utils/utils"),l=e("../utils/inherit"),c=function(e,t,n){r.call(this,t),this.state=e,this.game=e.game,this.properties=f.parseTiledProperties(t.properties)||{},this.scale.x=this.properties.scale||1,this.scale.y=this.properties.scale||1,this.tileSize=new o(t.tilewidth,t.tileheight),this.size=new o(t.width,t.height),this.orientation=t.orientation,this.version=t.version,this.backgroundColor=t.backgroundColor,this.tilesets=[],this.scaledTileSize=new o(t.tilewidth*this.scale.x,t.tileheight*this.scale.y),this.realSize=new o(this.size.x*this.scaledTileSize.x,this.size.y*this.scaledTileSize.y);for(var l=0,c=t.tilesets.length;l<c;++l){var h=t.tilesets[l];this.tilesets.push(new a(n[h.name],h))}for(var p=0,d=t.layers.length;p<d;++p){var v;switch(t.layers[p].type){case"tilelayer":v=new u(this,t.layers[p]);break;case"objectgroup":v=new i(this,t.layers[p]);break;case"imagelayer":v=new s(t.layers[p])}this.addChild(v)}var m=this.game.state.active.world;m.bounds.width=Math.max(m.bounds.width,this.realSize.x),m.bounds.height=Math.max(m.bounds.height,this.realSize.y)};return l(c,r,{getTileset:function(e){for(var t=0,n=this.tilesets.length;t<n;++t)if(this.tilesets[t].contains(e))return this.tilesets[t]},destroy:function(){r.prototype.destroy.call(this),this.game=null,this.properties=null,this.tileSize=null,this.size=null,this.orientation=null,this.version=null,this.backgroundColor=null,this.tilesets=null,this.scaledTileSize=null,this.realSize=null},spawnObjects:function(){for(var e=0,t=this.children.length;e<t;++e){var n=this.children[e];n.type==="objectgroup"&&n.spawn()}return this},despawnObjects:function(){for(var e=0,t=this.children.length;e<t;++e){var n=this.children[e];n.type==="objectgroup"&&n.despawn()}return this},clearTiles:function(){for(var e=0,t=this.children.length;e<t;++e){var n=this.children[e];n.type==="tilelayer"&&n.clearTiles()}return this},onTileEvent:function(e,t,n){this.emit("tile."+e,{tile:t,data:n})},onObjectEvent:function(e,t,n){this.emit("object."+e,{object:t,data:n})},findLayer:function(e){for(var t=0,n=this.children.length;t<n;++t){var r=this.children[t];if(r.name===e)return r}},pan:function(e,t){for(var n=0,r=this.children.length;n<r;++n){var i=this.children[n];i.pan&&i.pan(e,t)}return this},render:function(e,t,n,r){e=e||-this.state.world.position.x,t=t||-this.state.world.position.y,n=n||this.game.width,r=r||this.game.height;for(var i=0,s=this.children.length;i<s;++i){var o=this.children[i];o.render&&o.render(e,t,n,r)}return this}}),n.exports=c,n.exports}),n("text/BitmapText",["require","exports","module","../display/Container","../utils/ObjectPool","../display/Texture","../display/Sprite","../math/Vector","../geom/Rectangle","../utils/utils","../utils/inherit","../vendor/pixi"],function(e,t,n){var r=e("../display/Container"),i=e("../utils/ObjectPool"),s=e("../display/Texture"),o=e("../display/Sprite"),u=e("../math/Vector"),a=e("../geom/Rectangle"),f=e("../utils/utils"),l=e("../utils/inherit"),c=e("../vendor/pixi"),h=function(e,t,n){r.call(this),this.dirty=!1,this.font=t,this.monospace=0,this._text=e,this.sprites=new i(o,this),this.text=e,this.setStyle(n)};return l(h,r,{setStyle:function(e){e=e||{},this.align=e.align,this.size=e.size||this.font.size,this.dirty=!0},renderText:function(){var e=this.font,t=new u,n=null,r=[],i=0,s=[],o=0,a=this.size/e.size;for(var f=0;f<this.text.length;++f){var l=this.text.charCodeAt(f),c=this.text.charAt(f);if(/(?:\r\n|\r|\n)/.test(c)){s.push(t.x),i=Math.max(i,t.x),o++,t.x=0,t.y+=e.lineHeight,n=null;continue}var h=e.chars[l];if(!h)continue;n&&h[n]&&(t.x+=h.kerning[n]||0),r.push({texture:h.texture,line:o,code:l,x:t.x+h.xOffset,y:t.y+h.yOffset}),t.x+=this.monospace||h.xAdvance,n=l}s.push(t.x),i=Math.max(i,t.x);var p=[],d=this.align,v=0;for(f=0;f<=o;++f)v=0,d==="right"?v=i-s[f]:d==="center"&&(v=(i-s[f])/2),p.push(v);for(f=0;f<r.length;++f){var m=this.sprites.create(r[f].texture);m.setTexture(r[f].texture),m.visible=!0,m.position.x=(r[f].x+p[r[f].line])*a,m.position.y=r[f].y*a,m.scale.x=m.scale.y=a,this.addChild(m)}this.width=t.x*a,this.height=(t.y+e.lineHeight)*a},clone:function(){return new h(this._text,this.font,{align:this.align,size:this.size})},updateTransform:function(){if(this.dirty){for(var e=0,t=this.children.length;e<t;++e){var n=this.children[e];n.visible=!1,this.sprites.free(n)}this.renderText(),this.dirty=!1}r.prototype.updateTransform.call(this)}}),Object.defineProperty(h.prototype,"text",{get:function(){return this._text},set:function(e){this._text=e,this.dirty=!0}}),h.parseXML=function(e,t,n){var r=n.baseTexture;t.getElementsByTagName("font")||f.warn("Invalid XML for BitmapText.parseXML(), missing <font> tag. Full XML:",t);var i={},o=t.getElementsByTagName("info")[0],u=t.getElementsByTagName("common")[0];i.name=o.attributes.getNamedItem("face").nodeValue,i.size=parseInt(o.attributes.getNamedItem("size").nodeValue,10),i.lineHeight=parseInt(u.attributes.getNamedItem("lineHeight").nodeValue,10),i.chars={};var l=t.getElementsByTagName("char");for(var h=0,p=l.length;h<p;++h){var d=l[h],v=d.attributes,m=parseInt(v.getNamedItem("id").nodeValue,10),g=new a(parseInt(v.getNamedItem("x").nodeValue,10),parseInt(v.getNamedItem("y").nodeValue,10),parseInt(v.getNamedItem("width").nodeValue,10),parseInt(v.getNamedItem("height").nodeValue,10)),y=c.TextureCache[e+"_"+m]=new s(r,g);i.chars[m]={xOffset:parseInt(v.getNamedItem("xoffset").nodeValue,10),yOffset:parseInt(v.getNamedItem("yoffset").nodeValue,10),xAdvance:parseInt(v.getNamedItem("xadvance").nodeValue,10),kerning:{},texture:y}}var b=t.getElementsByTagName("kerning");for(h=0,p=b.length;h<p;++h){var w=b[h],E=w.attributes,S=parseInt(E.getNamedItem("first").nodeValue,10),x=parseInt(E.getNamedItem("second").nodeValue,10),T=parseInt(E.getNamedItem("amount").nodeValue,10);i.chars[x].kerning[S]=T}return c.BitmapText.fonts[i.name]=i,i},n.exports=h,n.exports}),n("utils/ObjectFactory",["require","exports","module","./inherit","../gui/GuiItem","../display/Sprite","../tilemap/Tilemap","../geom/Rectangle","../text/BitmapText","../constants"],function(e,t,n){var r=e("./inherit"),i=e("../gui/GuiItem"),s=e("../display/Sprite"),o=e("../tilemap/Tilemap"),u=e("../geom/Rectangle"),a=e("../text/BitmapText"),f=e("../constants"),l=function(e,t){this.state=e,this.game=e.game,this.parent=t};return r(l,Object,{obj:function(e){return this.parent.addChild(e)},sprite:function(e,t,n){var r,i=this.game;return typeof e=="string"&&(t||t===0?e=i.cache.getTextures(e)[t]:e=i.cache.getTexture(e)),e||(e=i.cache.getTexture("__default")),r=new s(e),(n||n===undefined)&&r.enablePhysics(this.state.physics),this.parent.addChild(r)},audio:function(e,t){return this.state.audio.add(e,t)},tilemap:function(e,t){var n=this.game.cache.getTilemap(e)||{},r=n.format,i=n.data,s=n.textures,a;return r===f.FILE_FORMAT.JSON?a=new o(this.state,i,s):r===f.FILE_FORMAT.XML?a=o.fromXML(this.state,i,s):r===f.FILE_FORMAT.CSV&&(a=o.fromCSV(this.state,i,s)),t&&this.state.camera.constrain(new u(0,0,a.realSize.x,a.realSize.y)),a.render(-this.state.world.position.x,-this.state.world.position.x,this.game.width,this.game.height),a._cachekey=e,this.parent.addChild(a)},gui:function(e,t){return typeof e=="string"&&(e=this.game.cache.getTexture(e)),this.parent.addChild(new i(e,t))},bitmaptext:function(e,t,n){return typeof t=="string"&&(t=this.game.cache.getBitmapFont(t)),this.parent.addChild(new a(e,t,n))}}),n.exports=l,n.exports}),n("display/Graphics",["require","exports","module","../vendor/pixi"],function(e,t,n){var r=e("../vendor/pixi").Graphics;return n.exports=r,n.exports}),n("fx/camera/Effect",["require","exports","module","../../display/Container","../../utils/inherit","../../display/Graphics"],function(e,t,n){var r=e("../../display/Container"),i=e("../../utils/inherit"),s=e("../../display/Graphics"),o=function(){r.call(this),this.gfx=this.addChild(new s),this.gfx.visible=!1,this.done=!0};return i(o,r,{start:function(e){return this.done=!1,this.cb=e,this},stop:function(){return this.done=!0,this},update:function(){return this},_complete:function(){this.done=!0;if(typeof this.cb=="function"){var e=this.cb();e!==!1&&this.stop()}else this.stop()}}),n.exports=o,n.exports}),n("fx/camera/Close",["require","exports","module","./Effect","../../utils/inherit"],function(e,t,n){var r=e("./Effect"),i=e("../../utils/inherit"),s=function(){r.call(this)};return i(s,r,{start:function(e,t,n,i){return typeof n=="function"&&(i=n,n=null),typeof t=="function"&&(i=t,n=null,t=null),typeof e=="function"&&(i=e,n=null,t=null,e=null),r.prototype.start.call(this,i),this.shape=e||"circle",this.duration=t&&t>0?t:1e3,this.cx=n?n.x:this.parent.size.x/2,this.cy=n?n.y:this.parent.size.y/2,this.w=this.mx=this.parent.size.x,this.h=this.my=this.parent.size.y,this.radius=this.maxRadius=Math.max(this.w/2,this.h/2),this.gfx.visible=!0,this.gfx.position.x=this.cx,this.gfx.position.y=this.cy,this.parent.state.mask=this.gfx,e==="ellipse"?this.gfx.scale.y=.5:this.gfx.scale.y=1,this},stop:function(){return r.prototype.stop.call(this),this.radius=this.sx=this.sy=0,this.gfx.visible=!1,this.parent.state.mask===this.gfx&&(this.parent.state.mask=null),this},update:function(e){if(this.done)return;var t=e*1e3/this.duration;this.gfx.clear(),this.gfx.beginFill(16711935);switch(this.shape){case"ellipse":case"circle":this.radius-=t*this.maxRadius,this.radius<=0?this._complete():this.gfx.drawCircle(0,0,this.radius);break;case"rect":case"rectangle":this.w-=t*this.mx,this.h-=t*this.my,this.w<=0?this._complete():this.gfx.drawRect(-(this.w/2),-(this.h/2),this.w,this.h)}return this.gfx.endFill(),this}}),n.exports=s,n.exports}),n("fx/camera/Fade",["require","exports","module","./Effect","../../utils/inherit"],function(e,t,n){var r=e("./Effect"),i=e("../../utils/inherit"),s=function(){r.call(this)};return i(s,r,{start:function(e,t,n,i){return typeof n=="function"&&(i=t,n=null),typeof t=="function"&&(i=t,n=null,t=null),typeof e=="function"&&(i=e,n=null,t=null,e=null),r.prototype.start.call(this,i),e=typeof e=="number"?e:16777215,this.goal=n||1,this.duration=t&&t>0?t:1e3,this.gfx.visible=!0,this.gfx.alpha=0,this.gfx.clear(),this.gfx.beginFill(e),this.gfx.drawRect(0,0,this.parent.size.x,this.parent.size.y),this},stop:function(){return r.prototype.stop.call(this),this.gfx.alpha=0,this.gfx.visible=!1,this},update:function(e){if(this.done)return;return this.gfx.alpha<this.goal&&(this.gfx.alpha+=e*1e3/this.duration,this.gfx.alpha>=this.goal&&this._complete()),this}}),n.exports=s,n.exports}),n("fx/camera/Flash",["require","exports","module","./Effect","../../utils/inherit"],function(e,t,n){var r=e("./Effect"),i=e("../../utils/inherit"),s=function(){r.call(this)};return i(s,r,{start:function(e,t,n,i){return typeof n=="function"&&(i=t,n=null),typeof t=="function"&&(i=t,n=null,t=null),typeof e=="function"&&(i=e,n=null,t=null,e=null),r.prototype.start.call(this,i),n=n||1,e=typeof e=="number"?e:16777215,this.duration=t&&t>0?t:1e3,this.gfx.visible=!0,this.gfx.alpha=n,this.gfx.clear(),this.gfx.beginFill(e),this.gfx.drawRect(0,0,this.parent.size.x,this.parent.size.y),this},stop:function(){return r.prototype.stop.call(this),this.gfx.alpha=0,this.gfx.visible=!1,this},update:function(e){if(this.done)return;return this.gfx.alpha>0&&(this.gfx.alpha-=e*1e3/this.duration,this.gfx.alpha<=0&&this._complete()),this}}),n.exports=s,n.exports}),n("fx/camera/Scanlines",["require","exports","module","./Effect","../../utils/inherit","../../constants"],function(e,t,n){var r=e("./Effect"),i=e("../../utils/inherit"),s=e("../../constants"),o=function(){r.call(this)};return i(o,r,{start:function(e,t,n,i,o,u){typeof o=="function"&&(u=o,o=null),typeof i=="function"&&(u=i,o=null,i=null),typeof n=="function"&&(u=n,o=null,i=null,n=null),typeof t=="function"&&(u=n,o=null,i=null,n=null,t=null),typeof e=="function"&&(u=n,o=null,i=null,n=null,t=null,e=null),r.prototype.start.call(this,u),e=e||0,t=t||s.AXIS.HORIZONTAL,n=n||4,i=i||1,o=o||.3;var a=this.parent.size.x,f=this.parent.size.y;this.gfx.clear(),this.gfx.visible=!0,this.gfx.beginFill(e,o);if(t&s.AXIS.VERTICAL)for(var l=0;l<a;l+=n)this.gfx.drawRect(l,0,i,f);if(t&s.AXIS.HORIZONTAL)for(var c=0;c<f;c+=n)this.gfx.drawRect(0,c,a,i);return this.gfx.endFill(),this},stop:function(){return r.prototype.stop.call(this),this.gfx.visible=!1,this}}),n.exports=o,n.exports}),n("fx/camera/Shake",["require","exports","module","./Effect","../../math/Vector","../../utils/inherit","../../math/math","../../constants"],function(e,t,n){var r=e("./Effect"),i=e("../../math/Vector"),s=e("../../utils/inherit"),o=e("../../math/math"),u=e("../../constants"),a=function(){r.call(this),this.offset=new i};return s(a,r,{start:function(e,t,n,i){return typeof n=="function"&&(i=n,n=null),typeof t=="function"&&(i=t,n=null,t=null),typeof e=="function"&&(i=e,n=null,t=null,e=null),r.prototype.start.call(this,i),this.intensity=e||.01,this.duration=t||1e3,this.direction=n||u.AXIS.BOTH,this.offset.x=this.offset.y=0,this},stop:function(){return r.prototype.stop.call(this),this.duration=this.offset.x=this.offset.y=0,this},update:function(e){if(this.done)return;this.duration-=e*1e3,this.offset.x=-this.offset.x,this.offset.y=-this.offset.y,this.parent.pan(this.offset.x,this.offset.y),this.duration<=0?this._complete():(this.direction&u.AXIS.HORIZONTAL&&(this.offset.x=o.round(Math.random()*this.intensity*this.parent.size.x*2-this.intensity*this.parent.size.x)),this.direction&u.AXIS.VERTICAL&&(this.offset.y=o.round(Math.random()*this.intensity*this.parent.size.y*2-this.intensity*this.parent.size.y)),this.parent.pan(this.offset.x,this.offset.y))}}),n.exports=a,n.exports}),n("camera/Camera",["require","exports","module","../display/Container","../display/Sprite","../geom/Rectangle","../math/Vector","../utils/ObjectPool","../utils/ObjectFactory","../fx/camera/Close","../fx/camera/Fade","../fx/camera/Flash","../fx/camera/Scanlines","../fx/camera/Shake","../utils/inherit","../math/math","../constants"],function(e,t,n){var r=e("../display/Container"),i=e("../display/Sprite"),s=e("../geom/Rectangle"),o=e("../math/Vector"),u=e("../utils/ObjectPool"),a=e("../utils/ObjectFactory"),f=e("../fx/camera/Close"),l=e("../fx/camera/Fade"),c=e("../fx/camera/Flash"),h=e("../fx/camera/Scanlines"),p=e("../fx/camera/Shake"),d=e("../utils/inherit"),v=e("../math/math"),m=e("../constants"),g=function(e){this.world=e.world,this.game=e.game,this.state=e,this.bounds=e.world.bounds.clone(),this._deadzone=null,this._target=null,this._targetPos=new o,this.size=new o,this.hSize=new o,this.gui=new r,this.add=new a(e,this.gui),this.fxpools={flash:new u(c,this),fade:new u(l,this),shake:new u(p,this),scanlines:new u(h,this),close:new u(f,this)};var t=this;Object.keys(this.fxpools).forEach(function(e){t[e]=function(){var n=t.fxpools[e].create(),r=Array.prototype.slice.call(arguments),i=r.pop();return i!==undefined&&typeof i!="function"&&r.push(i),r.push(this._fxCallback.bind(this,n,e,i)),n.start.apply(n,r)}}),r.call(this),this.addChild(this.gui)};return d(g,r,{_fxCallback:function(e,t,n){var r;return typeof n=="function"&&(r=n()),this.fxpools[t].free(e),r},follow:function(e,t){if(e instanceof i){this._target=e,this._targetPos.set(null,null);switch(t){case m.CAMERA_FOLLOW.PLATFORMER:var n=this.size.x/8,r=this.size.y/3;this._deadzone=new s((this.size.x-n)/2,(this.size.y-r)/2-r/4,n,r);break;case m.CAMERA_FOLLOW.TOPDOWN:var o=Math.max(this.size.x,this.size.y)/4;this._deadzone=new s((this.size.x-o)/2,(this.size.y-o)/2,o,o);break;case m.CAMERA_FOLLOW.TOPDOWN_TIGHT:var u=Math.max(this.size.x,this.size.y)/8;this._deadzone=new s((this.size.x-u)/2,(this.size.y-u)/2,u,u);break;case m.CAMERA_FOLLOW.LOCKON:default:this._deadzone=null}return this.focusSprite(this._target),this}return this},unfollow:function(){return this._target=null,this._targetPos.set(null,null),this},focusSprite:function(e){var t=e.position.x,n=e.position.y,r=e.parent;while(r&&r!==this.world)t+=r.position.x,n+=r.position.y,r=r.parent;return this.focus(v.floor(t*e.worldTransform[0]),v.floor(n*e.worldTransform[4]))},focus:function(e,t){t=e.y!==undefined?e.y:t||0,e=e.x!==undefined?e.x:e||0;var n=e-this.hSize.x,r=t-this.hSize.y,i=n+this.world.position.x,s=r+this.world.position.y;return this.pan(i,s)},pan:function(e,t){t=e.y!==undefined?e.y:t||0,e=e.x!==undefined?e.x:e||0;if(!e&&!t)return;var n=this.world.position,r=n.x-e,i=n.y-t,s=this.bounds;s&&(this._outsideBounds(-r,-n.y)&&(e=(e<0?s.x:s.right-this.size.x)+n.x),this._outsideBounds(-n.x,-i)&&(t=(t<0?s.y:s.bottom-this.size.y)+n.y));if(e||t)e||(e=0),t||(t=0),this.world.pan(-e,-t);return this},_outsideBounds:function(e,t){return!this.bounds.contains(e,t)||!this.bounds.contains(e,t+this.size.y)||!this.bounds.contains(e+this.size.x,t)||!this.bounds.contains(e+this.size.x,t+this.size.y)},resize:function(e,t){return this.size.set(e,t),this.hSize.set(v.round(this.size.x/2),v.round(this.size.y/2)),this},constrain:function(e){return this.bounds=e,this},unconstrain:function(){return this.bounds=null,this},update:function(e){if(this._target&&!this._target.position.equals(this._targetPos)){this._targetPos.copy(this._target.position);if(!this._deadzone)this.focusSprite(this._target);else{var t,n,r,i,s=this._target.position.x+this.world.position.x,o=this._target.position.y+this.world.position.y;t=n=r=i=0,r=s-this._deadzone.x,i=o-this._deadzone.y,r<0&&(t=r),i<0&&(n=i),r=s-(this._deadzone.x+this._deadzone.width),i=o-(this._deadzone.y+this._deadzone.height),r>0&&(t=r),i>0&&(n=i),this.pan(v.round(t),v.round(n))}}for(var u=0,a=this.children.length;u<a;++u){var f=this.children[u];f.update&&f.update(e)}return this}}),n.exports=g,n.exports}),n("display/BaseTexture",["require","exports","module","../vendor/pixi"],function(e,t,n){var r=e("../vendor/pixi").BaseTexture;return n.exports=r,n.exports}),n("display/RenderTexture",["require","exports","module","../vendor/pixi"],function(e,t,n){var r=e("../vendor/pixi").RenderTexture;return n.exports=r,n.exports}),n("display/TilingSprite",["require","exports","module","../vendor/pixi"],function(e,t,n){var r=e("../vendor/pixi").TilingSprite;return n.exports=r,n.exports}),n("particles/ParticleEmitter",["require","exports","module","../display/Sprite","../display/Texture","../display/Container","../math/Vector","../math/math","../utils/inherit","../constants"],function(e,t,n){var r=e("../display/Sprite"),i=e("../display/Texture"),s=e("../display/Container"),o=e("../math/Vector"),u=e("../math/math"),a=e("../utils/inherit"),f=e("../constants"),l=function(e){s.call(this),this.name=e,this.maxParticles=100,this.width=0,this.height=0,this.lifespan=2e3,this.minSpeed=new o(-100,-100),this.maxSpeed=new o(100,100),this.minScale=1,this.maxScale=1,this.minRotation=-2*Math.PI,this.maxRotation=2*Math.PI,this.delay=100,this.active=!1,this.particles=[],this._rate=0,this._total=0,this._emitted=0,this._timer=0,this._particle=null,this._textures=null,this._pool=[]};return a(l,s,{start:function(e,t,n,r){return this.active=!0,this.lifespan=e||2e3,this.delay=t||250,this._rate=n||1,this._total=r||f.PARTICLES.MAX_EMITTER_PARTICLES,this._timer=0,this},stop:function(){return this.active=!1,this},setup:function(e,t){return t===undefined&&(t=f.DIRECTION.ALL),e instanceof i?(this._particle=new r(e),this._textures=[e]):Array.isArray(e)?(this._particle=new r(e[0]),this._textures=e):(this._particle=e,this._textures=[e.texture]),this},_get:function(){if(this._emitted>=this._total||this._emitted>this.maxParticles)return null;var e=this._pool.pop();return e||(e=this._particle.clone()),e.setTexture(u.randomElement(this._textures)),e.visible=!0,this.addChild(e),this._emitted++,e},_free:function(e){e.visible=!1,this._pool.push(e),this.removeChild(e),this._emitted--},emitParticle:function(){var e=this._get();if(!e)return;return e.setPosition(u.randomInt(0,this.width),u.randomInt(0,this.height)),e.scale.x=e.scale.y=u.randomReal(this.minScale,this.maxScale),e.lifespan=this.lifespan,e.setVelocity(u.randomInt(this.minSpeed.x,this.maxSpeed.x),u.randomInt(this.minSpeed.y,this.maxSpeed.y)),this},update:function(e){var t=e*1e3;for(var n=0;n<this.children.length;++n){var r=this.children[n];r.lifespan-=t,r.lifespan<=0&&this._free(r)}if(!this.active)return;this._timer+=t;if(this._timer>=this._delay){this._timer-=this._delay;for(var i=0;i<this._rate;++i)this.emitParticle()}}}),n.exports=l,n.exports}),n("particles/ParticleSystem",["require","exports","module","./ParticleEmitter","../display/Container","../utils/inherit"],function(e,t,n){var r=e("./ParticleEmitter"),i=e("../display/Container"),s=e("../utils/inherit"),o=function(){i.call(this),this.emitters={},this.nextId=0};return s(o,i,{add:function(e){var t;return typeof e=="string"?t=new r(e):typeof e=="function"?t=new e:t=e,t.name||(t.name="emitter_"+this.nextId++),this.emitters[t.name]=t,this.addChild(t),t},remove:function(e){return typeof e=="string"&&(e=this.emitters[e]),e.parent&&e.parent.removeChild(e),delete this.emitters[e.name],this},update:function(e){for(var t=0,n=this.children.length;t<n;++t){var r=this.children[t];r.update&&r.update(e)}}}),n.exports=o,n.exports}),n("game/World",["require","exports","module","../utils/inherit","../display/Container","../geom/Rectangle","../utils/ObjectFactory","../particles/ParticleSystem","../math/math"],function(e,t,n){var r=e("../utils/inherit"),i=e("../display/Container"),s=e("../geom/Rectangle"),o=e("../utils/ObjectFactory"),u=e("../particles/ParticleSystem"),a=e("../math/math"),f=function(e){i.call(this),this.game=e.game,this.state=e,this.particles=this.addChild(new u),this.bounds=new s(0,0,e.game.width,e.game.height),this.add=new o(e,this)};return r(f,i,{pan:function(e,t){t=a.floor(e.y!==undefined?e.y:t||0),e=a.floor(e.x!==undefined?e.x:e||0),this.position.x+=e*this.scale.x,this.position.y+=t*this.scale.y;for(var n=0,r=this.children.length;n<r;++n){var i=this.children[n];i.pan&&i.pan(e,t)}return this},resize:function(e,t){for(var n=0,r=this.children.length;n<r;++n){var i=this.children[n];i.render&&i.render(-this.position.x,-this.position.y,e,t)}return this},update:function(e){this.particles.update(e)}}),n.exports=f,n.exports}),n("vendor/cp",["require","exports","module"],function(e,t,n){Object.create=Object.create||function(e){function t(){}return t.prototype=e,new t};var r;typeof t=="undefined"?(r={},typeof s=="object"&&(s.cp=r)):r=t;var i=function(e,t){if(!e)throw new Error("Assertion failed: "+t)},o=function(e,t){!e&&console&&console.warn&&(console.warn("ASSERTION FAILED: "+t),console.trace&&console.trace())},u=function(e,t){return e<t?e:t},a=function(e,t){return e>t?e:t},f,l;typeof s=="object"&&s.navigator.userAgent.indexOf("Firefox")>-1?(f=Math.min,l=Math.max):(f=u,l=a);var c=function(e,t){return e<t?e+" "+t:t+" "+e},h=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t){e[n]=e[e.length-1],e.length--;return}},p=function(e,t,n){var r=M(t,n),i=w(N(r,M(e,n))/R(r));return O(n,D(r,i))},d=function(e,t,n,r,i,s){var o=n-i,u=r-s,a=w(C(o,u,e-i,t-s)/U(o,u));return new x(i+o*a,s+u*a)};r.momentForCircle=function(e,t,n,r){return e*(.5*(t*t+n*n)+R(r))},r.areaForCircle=function(e,t){return Math.PI*Math.abs(e*e-t*t)},r.momentForSegment=function(e,t,n){var r=D(O(t,n),.5);return e*(K(n,t)/12+R(r))},r.areaForSegment=function(e,t,n){return n*(Math.PI*n+2*J(e,t))},r.momentForPoly=function(e,t,n){var r=0,i=0,s=t.length;for(var o=0;o<s;o+=2){var u=t[o]+n.x,a=t[o+1]+n.y,f=t[(o+2)%s]+n.x,l=t[(o+3)%s]+n.y,c=H(f,l,u,a),h=C(u,a,u,a)+C(u,a,f,l)+C(f,l,f,l);r+=c*h,i+=c}return e*r/(6*i)},r.areaForPoly=function(e){var t=0;for(var n=0,r=e.length;n<r;n+=2)t+=P(new x(e[n],e[n+1]),new x(e[(n+2)%r],e[(n+3)%r]));return-t/2},r.centroidForPoly=function(e){var t=0,n=new x(0,0);for(var r=0,i=e.length;r<i;r+=2){var s=new x(e[r],e[r+1]),o=new x(e[(r+2)%i],e[(r+3)%i]),u=P(s,o);t+=u,n=O(n,D(O(s,o),u))}return D(n,1/(3*t))},r.recenterPoly=function(e){var t=r.centroidForPoly(e);for(var n=0;n<e.length;n+=2)e[n]-=t.x,e[n+1]-=t.y},r.momentForBox=function(e,t,n){return e*(t*t+n*n)/12},r.momentForBox2=function(e,t){var n=t.r-t.l,i=t.t-t.b,s=D([t.l+t.r,t.b+t.t],.5);return r.momentForBox(e,n,i)+e*R(s)};var v=r.loopIndexes=function(e){var t=0,n=0,r,i,s,o;r=s=e[0],i=o=e[1];var u=e.length>>1;for(var a=1;a<u;a++){var f=e[a*2],l=e[a*2+1];if(f<r||f==r&&l<i)r=f,i=l,t=a;else if(f>s||f==s&&l>o)s=f,o=l,n=a}return[t,n]},m=function(e,t,n){var r=e[t*2];e[t*2]=e[n*2],e[n*2]=r,r=e[t*2+1],e[t*2+1]=e[n*2+1],e[n*2+1]=r},g=function(e,t,n,r,i,s){if(n===0)return 0;var o=0,u=t,a=M(i,r),f=s*k(a),l=t;for(var c=t+n-1;l<=c;){var h=new x(e[l*2],e[l*2+1]),p=P(a,M(h,r));p>f?(p>o&&(o=p,u=l),l++):(m(e,l,c),c--)}return u!=t&&m(e,t,u),l-t},y=function(e,t,n,r,i,s,o,u){if(r<0)return 0;if(r==0)return t[u*2]=s.x,t[u*2+1]=s.y,1;var a=g(t,n,r,i,s,e),f=new x(t[n*2],t[n*2+1]),l=y(e,t,n+1,a-1,i,f,s,u),c=u+l++;t[c*2]=s.x,t[c*2+1]=s.y;var h=g(t,n+a,r-a,s,o,e),p=new x(t[(n+a)*2],t[(n+a)*2+1]);return l+y(e,t,n+a+1,h-1,s,p,o,u+l)};r.convexHull=function(e,t,n){if(t)for(var r=0;r<e.length;r++)t[r]=e[r];else t=e;var i=v(e),s=i[0],u=i[1];if(s==u)return t.length=2,t;m(t,0,s),m(t,1,u==0?s:u);var a=new x(t[0],t[1]),f=new x(t[2],t[3]),l=e.length>>1,c=y(n,t,2,l-2,a,f,a,1)+1;return t.length=c*2,o(Lt(t),"Internal error: cpConvexHull() and cpPolyValidate() did not agree.Please report this error with as much info as you can."),t};var b=function(e,t,n){return f(l(e,t),n)},w=function(e){return l(0,f(e,1))},E=function(e,t,n){return e*(1-n)+t*n},S=function(e,t,n){return e+b(t-e,-n,n)},x=r.Vect=function(e,t){this.x=e,this.y=t};r.v=function(e,t){return new x(e,t)};var T=r.vzero=new x(0,0),N=r.v.dot=function(e,t){return e.x*t.x+e.y*t.y},C=function(e,t,n,r){return e*n+t*r},k=r.v.len=function(e){return Math.sqrt(N(e,e))},L=r.v.len2=function(e,t){return Math.sqrt(e*e+t*t)},A=r.v.eql=function(e,t){return e.x===t.x&&e.y===t.y},O=r.v.add=function(e,t){return new x(e.x+t.x,e.y+t.y)};x.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this};var M=r.v.sub=function(e,t){return new x(e.x-t.x,e.y-t.y)};x.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this};var _=r.v.neg=function(e){return new x(-e.x,-e.y)};x.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this};var D=r.v.mult=function(e,t){return new x(e.x*t,e.y*t)};x.prototype.mult=function(e){return this.x*=e,this.y*=e,this};var P=r.v.cross=function(e,t){return e.x*t.y-e.y*t.x},H=function(e,t,n,r){return e*r-t*n},B=r.v.perp=function(e){return new x(-e.y,e.x)},j=r.v.pvrperp=function(e){return new x(e.y,-e.x)},F=r.v.project=function(e,t){return D(t,N(e,t)/R(t))};x.prototype.project=function(e){return this.mult(N(this,e)/R(e)),this};var I=r.v.rotate=function(e,t){return new x(e.x*t.x-e.y*t.y,e.x*t.y+e.y*t.x)};x.prototype.rotate=function(e){return this.x=this.x*e.x-this.y*e.y,this.y=this.x*e.y+this.y*e.x,this};var q=r.v.unrotate=function(e,t){return new x(e.x*t.x+e.y*t.y,e.y*t.x-e.x*t.y)},R=r.v.lengthsq=function(e){return N(e,e)},U=r.v.lengthsq2=function(e,t){return e*e+t*t},z=r.v.lerp=function(e,t,n){return O(D(e,1-n),D(t,n))},W=r.v.normalize=function(e){return D(e,1/k(e))},X=r.v.normalize_safe=function(e){return e.x===0&&e.y===0?T:W(e)},V=r.v.clamp=function(e,t){return N(e,e)>t*t?D(W(e),t):e},$=r.v.lerpconst=function(e,t,n){return O(e,V(M(t,e),n))},J=r.v.dist=function(e,t){return k(M(e,t))},K=r.v.distsq=function(e,t){return R(M(e,t))},Q=r.v.near=function(e,t,n){return K(e,t)<n*n},G=r.v.slerp=function(e,t,n){var r=Math.acos(N(e,t));if(r){var i=1/Math.sin(r);return O(D(e,Math.sin((1-n)*r)*i),D(t,Math.sin(n*r)*i))}return e},Y=r.v.slerpconst=function(e,t,n){var r=Math.acos(N(e,t));return G(e,t,f(n,r)/r)},Z=r.v.forangle=function(e){return new x(Math.cos(e),Math.sin(e))},et=r.v.toangle=function(e){return Math.atan2(e.y,e.x)},tt=r.v.str=function(e){return"("+e.x.toFixed(3)+", "+e.y.toFixed(3)+")"},nt=0,rt=r.BB=function(e,t,n,r){this.l=e,this.b=t,this.r=n,this.t=r,nt++};r.bb=function(e,t,n,r){return new rt(e,t,n,r)};var it=function(e,t){return new rt(e.x-t,e.y-t,e.x+t,e.y+t)},st=function(e,t){return e.l<=t.r&&t.l<=e.r&&e.b<=t.t&&t.b<=e.t},ot=function(e,t,n,r,i){return e.l<=r&&t<=e.r&&e.b<=i&&n<=e.t},ut=function(e,t){return e.l<=t.l&&e.r>=t.r&&e.b<=t.b&&e.t>=t.t},at=function(e,t){return e.l<=t.x&&e.r>=t.x&&e.b<=t.y&&e.t>=t.y},ft=function(e,t,n,r,i){return e<=i.x&&n>=i.x&&t<=i.y&&r>=i.y},lt=function(e,t){return new rt(f(e.l,t.l),f(e.b,t.b),l(e.r,t.r),l(e.t,t.t))},ct=function(e,t){return new rt(f(e.l,t.x),f(e.b,t.y),l(e.r,t.x),l(e.t,t.y))},ht=function(e){return(e.r-e.l)*(e.t-e.b)},pt=function(e,t){return(l(e.r,t.r)-f(e.l,t.l))*(l(e.t,t.t)-f(e.b,t.b))},dt=function(e,t,n,r,i){return(l(e.r,r)-f(e.l,t))*(l(e.t,i)-f(e.b,n))},vt=function(e,t,n){return bbSegmentQuery(e,t,n)!=Infinity},mt=function(e,t){var n=f(l(e.l,t.x),e.r),r=f(l(e.b,t.y),e.t);return new x(n,r)},gt=function(e,t){var n=Math.abs(e.r-e.l),r=(t.x-e.l)%n,i=r>0?r:r+n,s=Math.abs(e.t-e.b),o=(t.y-e.b)%s,u=o>0?o:o+s;return new x(i+e.l,u+e.b)},yt=0,bt=r.NO_GROUP=0,wt=r.ALL_LAYERS=-1;r.resetShapeIdCounter=function(){yt=0};var Et=r.Shape=function(e){this.body=e,this.bb_l=this.bb_b=this.bb_r=this.bb_t=0,this.hashid=yt++,this.sensor=!1,this.e=0,this.u=0,this.surface_v=T,this.collision_type=0,this.group=0,this.layers=wt,this.space=null,this.collisionCode=this.collisionCode};Et.prototype.setElasticity=function(e){this.e=e},Et.prototype.setFriction=function(e){this.body.activate(),this.u=e},Et.prototype.setLayers=function(e){this.body.activate(),this.layers=e},Et.prototype.setSensor=function(e){this.body.activate(),this.sensor=e},Et.prototype.setCollisionType=function(e){this.body.activate(),this.collision_type=e},Et.prototype.getBody=function(){return this.body},Et.prototype.active=function(){return this.body&&this.body.shapeList.indexOf(this)!==-1},Et.prototype.setBody=function(e){i(!this.active(),"You cannot change the body on an active shape. You must remove the shape from the space before changing the body."),this.body=e},Et.prototype.cacheBB=function(){return this.update(this.body.p,this.body.rot)},Et.prototype.update=function(e,t){i(!isNaN(t.x),"Rotation is NaN"),i(!isNaN(e.x),"Position is NaN"),this.cacheData(e,t)},Et.prototype.pointQuery=function(e){var t=this.nearestPointQuery(e);if(t.d<0)return t},Et.prototype.getBB=function(){return new rt(this.bb_l,this.bb_b,this.bb_r,this.bb_t)};var St=function(e){this.shape=e,this.d=Infinity,this.n=T},xt=function(e,t,n){this.shape=e,this.p=t,this.d=n},Tt=function(e,t,n){this.shape=e,this.t=t,this.n=n};Tt.prototype.hitPoint=function(e,t){return z(e,t,this.t)},Tt.prototype.hitDist=function(e,t){return J(e,t)*this.t};var Nt=r.CircleShape=function(e,t,n){this.c=this.tc=n,this.r=t,this.type="circle",Et.call(this,e)};Nt.prototype=Object.create(Et.prototype),Nt.prototype.cacheData=function(e,t){var n=this.tc=I(this.c,t).add(e),r=this.r;this.bb_l=n.x-r,this.bb_b=n.y-r,this.bb_r=n.x+r,this.bb_t=n.y+r},Nt.prototype.nearestPointQuery=function(e){var t=e.x-this.tc.x,n=e.y-this.tc.y,r=L(t,n),i=this.r,s=new x(this.tc.x+t*i/r,this.tc.y+n*i/r);return new xt(this,s,r-i)};var Ct=function(e,t,n,r,i,s){r=M(r,t),i=M(i,t);var o=N(r,r)-2*N(r,i)+N(i,i),u=-2*N(r,r)+2*N(r,i),a=N(r,r)-n*n,f=u*u-4*o*a;if(f>=0){var l=(-u-Math.sqrt(f))/(2*o);if(0<=l&&l<=1)return new Tt(e,l,W(z(r,i,l)))}};Nt.prototype.segmentQuery=function(e,t){return Ct(this,this.tc,this.r,e,t)};var kt=r.SegmentShape=function(e,t,n,r){this.a=t,this.b=n,this.n=B(W(M(n,t))),this.ta=this.tb=this.tn=null,this.r=r,this.a_tangent=T,this.b_tangent=T,this.type="segment",Et.call(this,e)};kt.prototype=Object.create(Et.prototype),kt.prototype.cacheData=function(e,t){this.ta=O(e,I(this.a,t)),this.tb=O(e,I(this.b,t)),this.tn=I(this.n,t);var n,r,i,s;this.ta.x<this.tb.x?(n=this.ta.x,r=this.tb.x):(n=this.tb.x,r=this.ta.x),this.ta.y<this.tb.y?(i=this.ta.y,s=this.tb.y):(i=this.tb.y,s=this.ta.y);var o=this.r;this.bb_l=n-o,this.bb_b=i-o,this.bb_r=r+o,this.bb_t=s+o},kt.prototype.nearestPointQuery=function(e){var t=p(e,this.ta,this.tb),n=e.x-t.x,r=e.y-t.y,i=L(n,r),s=this.r,o=i?O(t,D(new x(n,r),s/i)):t;return new xt(this,o,i-s)},kt.prototype.segmentQuery=function(e,t){var n=this.tn,r=N(M(this.ta,e),n),i=this.r,s=r>0?_(n):n,o=M(D(s,i),e),u=O(this.ta,o),a=O(this.tb,o),f=M(t,e);if(P(f,u)*P(f,a)<=0){var l=r+(r>0?-i:i),c=-l,h=N(f,n)-l;if(c*h<0)return new Tt(this,c/(c-h),s)}else if(i!==0){var p=Ct(this,this.ta,this.r,e,t),d=Ct(this,this.tb,this.r,e,t);return p?d&&d.t<p.t?d:p:d}},kt.prototype.setNeighbors=function(e,t){this.a_tangent=M(e,this.a),this.b_tangent=M(t,this.b)},kt.prototype.setEndpoints=function(e,t){this.a=e,this.b=t,this.n=B(W(M(t,e)))};var Lt=function(e){var t=e.length;for(var n=0;n<t;n+=2){var r=e[n],i=e[n+1],s=e[(n+2)%t],o=e[(n+3)%t],u=e[(n+4)%t],a=e[(n+5)%t];if(H(s-r,o-i,u-s,a-o)>0)return!1}return!0},At=r.PolyShape=function(e,t,n){this.setVerts(t,n),this.type="poly",Et.call(this,e)};At.prototype=Object.create(Et.prototype);var Ot=function(e,t){this.n=e,this.d=t};Ot.prototype.compare=function(e){return N(this.n,e)-this.d},At.prototype.setVerts=function(e,t){i(e.length>=4,"Polygons require some verts"),i(typeof e[0]=="number","Polygon verticies should be specified in a flattened list (eg [x1,y1,x2,y2,x3,y3,...])"),i(Lt(e),"Polygon is concave or has a reversed winding. Consider using cpConvexHull()");var n=e.length,r=n>>1;this.verts=new Array(n),this.tVerts=new Array(n),this.planes=new Array(r),this.tPlanes=new Array(r);for(var s=0;s<n;s+=2){var o=e[s]+t.x,u=e[s+1]+t.y,a=e[(s+2)%n]+t.x,f=e[(s+3)%n]+t.y,l=W(B(new x(a-o,f-u)));this.verts[s]=o,this.verts[s+1]=u,this.planes[s>>1]=new Ot(l,C(l.x,l.y,o,u)),this.tPlanes[s>>1]=new Ot(new x(0,0),0)}};var Mt=r.BoxShape=function(e,t,n){var r=t/2,i=n/2;return _t(e,new rt(-r,-i,r,i))},_t=r.BoxShape2=function(e,t){var n=[t.l,t.b,t.l,t.t,t.r,t.t,t.r,t.b];return new At(e,n,T)};At.prototype.transformVerts=function(e,t){var n=this.verts,r=this.tVerts,i=Infinity,s=-Infinity,o=Infinity,u=-Infinity;for(var a=0;a<n.length;a+=2){var c=n[a],h=n[a+1],p=e.x+c*t.x-h*t.y,d=e.y+c*t.y+h*t.x;r[a]=p,r[a+1]=d,i=f(i,p),s=l(s,p),o=f(o,d),u=l(u,d)}this.bb_l=i,this.bb_b=o,this.bb_r=s,this.bb_t=u},At.prototype.transformAxes=function(e,t){var n=this.planes,r=this.tPlanes;for(var i=0;i<n.length;i++){var s=I(n[i].n,t);r[i].n=s,r[i].d=N(e,s)+n[i].d}},At.prototype.cacheData=function(e,t){this.transformAxes(e,t),this.transformVerts(e,t)},At.prototype.nearestPointQuery=function(e){var t=this.tPlanes,n=this.tVerts,r=n[n.length-2],i=n[n.length-1],s=Infinity,o=T,u=!1;for(var a=0;a<t.length;a++){t[a].compare(e)>0&&(u=!0);var f=n[a*2],l=n[a*2+1],c=d(e.x,e.y,r,i,f,l),h=J(e,c);h<s&&(s=h,o=c),r=f,i=l}return new xt(this,o,u?s:-s)},At.prototype.segmentQuery=function(e,t){var n=this.tPlanes,r=this.tVerts,i=n.length,s=i*2;for(var o=0;o<i;o++){var u=n[o].n,a=N(e,u);if(n[o].d>a)continue;var f=N(t,u),l=(n[o].d-a)/(f-a);if(l<0||1<l)continue;var c=z(e,t,l),h=-P(u,c),p=-H(u.x,u.y,r[o*2],r[o*2+1]),d=-H(u.x,u.y,r[(o*2+2)%s],r[(o*2+3)%s]);if(p<=h&&h<=d)return new Tt(this,l,u)}},At.prototype.valueOnAxis=function(e,t){var n=this.tVerts,r=C(e.x,e.y,n[0],n[1]);for(var i=2;i<n.length;i+=2)r=f(r,C(e.x,e.y,n[i],n[i+1]));return r-t},At.prototype.containsVert=function(e,t){var n=this.tPlanes;for(var r=0;r<n.length;r++){var i=n[r].n,s=C(i.x,i.y,e,t)-n[r].d;if(s>0)return!1}return!0},At.prototype.containsVertPartial=function(e,t,n){var r=this.tPlanes;for(var i=0;i<r.length;i++){var s=r[i].n;if(N(s,n)<0)continue;var o=C(s.x,s.y,e,t)-r[i].d;if(o>0)return!1}return!0},At.prototype.getNumVerts=function(){return this.verts.length/2},At.prototype.getVert=function(e){return new x(this.verts[e*2],this.verts[e*2+1])};var Dt=r.Body=function(e,t){this.p=new x(0,0),this.vx=this.vy=0,this.f=new x(0,0),this.w=0,this.t=0,this.v_limit=Infinity,this.w_limit=Infinity,this.v_biasx=this.v_biasy=0,this.w_bias=0,this.space=null,this.shapeList=[],this.arbiterList=null,this.constraintList=null,this.nodeRoot=null,this.nodeNext=null,this.nodeIdleTime=0,this.setMass(e),this.setMoment(t),this.rot=new x(0,0),this.setAngle(0)},Pt=function(){var e=new Dt(Infinity,Infinity);return e.nodeIdleTime=Infinity,e};if(typeof DEBUG!="undefined"&&DEBUG){var Ht=function(e,t){i(e.x==e.x&&e.y==e.y,t)},Bt=function(e,t){i(Math.abs(e.x)!==Infinity&&Math.abs(e.y)!==Infinity,t)},jt=function(e,t){Ht(e,t),Bt(e,t)};Dt.prototype.sanityCheck=function(){i(this.m===this.m&&this.m_inv===this.m_inv,"Body's mass is invalid."),i(this.i===this.i&&this.i_inv===this.i_inv,"Body's moment is invalid."),jt(this.p,"Body's position is invalid."),jt(this.f,"Body's force is invalid."),i(this.vx===this.vx&&Math.abs(this.vx)!==Infinity,"Body's velocity is invalid."),i(this.vy===this.vy&&Math.abs(this.vy)!==Infinity,"Body's velocity is invalid."),i(this.a===this.a&&Math.abs(this.a)!==Infinity,"Body's angle is invalid."),i(this.w===this.w&&Math.abs(this.w)!==Infinity,"Body's angular velocity is invalid."),i(this.t===this.t&&Math.abs(this.t)!==Infinity,"Body's torque is invalid."),jt(this.rot,"Body's rotation vector is invalid."),i(this.v_limit===this.v_limit,"Body's velocity limit is invalid."),i(this.w_limit===this.w_limit,"Body's angular velocity limit is invalid.")}}else Dt.prototype.sanityCheck=function(){};Dt.prototype.getPos=function(){return this.p},Dt.prototype.getVel=function(){return new x(this.vx,this.vy)},Dt.prototype.getAngVel=function(){return this.w},Dt.prototype.isSleeping=function(){return this.nodeRoot!==null},Dt.prototype.isStatic=function(){return this.nodeIdleTime===Infinity},Dt.prototype.isRogue=function(){return this.space===null},Dt.prototype.setMass=function(e){i(e>0,"Mass must be positive and non-zero."),this.activate(),this.m=e,this.m_inv=1/e},Dt.prototype.setMoment=function(e){i(e>0,"Moment of Inertia must be positive and non-zero."),this.activate(),this.i=e,this.i_inv=1/e},Dt.prototype.addShape=function(e){this.shapeList.push(e)},Dt.prototype.removeShape=function(e){h(this.shapeList,e)};var Ft=function(e,t,n){return e===n?e.next(t):(e.a===t?e.next_a=Ft(e.next_a,t,n):e.next_b=Ft(e.next_b,t,n),e)};Dt.prototype.removeConstraint=function(e){this.constraintList=Ft(this.constraintList,this,e)},Dt.prototype.setPos=function(e){this.activate(),this.sanityCheck(),e===T&&(e=r.v(0,0)),this.p=e},Dt.prototype.setVel=function(e){this.activate(),this.vx=e.x,this.vy=e.y},Dt.prototype.setAngVel=function(e){this.activate(),this.w=e},Dt.prototype.setAngleInternal=function(e){i(!isNaN(e),"Internal Error: Attempting to set body's angle to NaN"),this.a=e,this.rot.x=Math.cos(e),this.rot.y=Math.sin(e)},Dt.prototype.setAngle=function(e){this.activate(),this.sanityCheck(),this.setAngleInternal(e)},Dt.prototype.velocity_func=function(e,t,n){var r=this.vx*t+(e.x+this.f.x*this.m_inv)*n,i=this.vy*t+(e.y+this.f.y*this.m_inv)*n,s=this.v_limit,o=r*r+i*i,u=o>s*s?s/Math.sqrt(o):1;this.vx=r*u,this.vy=i*u;var a=this.w_limit;this.w=b(this.w*t+this.t*this.i_inv*n,-a,a),this.sanityCheck()},Dt.prototype.position_func=function(e){this.p.x+=(this.vx+this.v_biasx)*e,this.p.y+=(this.vy+this.v_biasy)*e,this.setAngleInternal(this.a+(this.w+this.w_bias)*e),this.v_biasx=this.v_biasy=0,this.w_bias=0,this.sanityCheck()},Dt.prototype.resetForces=function(){this.activate(),this.f=new x(0,0),this.t=0},Dt.prototype.applyForce=function(e,t){this.activate(),this.f=O(this.f,e),this.t+=P(t,e)},Dt.prototype.applyImpulse=function(e,t){this.activate(),Un(this,e.x,e.y,t)},Dt.prototype.getVelAtPoint=function(e){return O(new x(this.vx,this.vy),D(B(e),this.w))},Dt.prototype.getVelAtWorldPoint=function(e){return this.getVelAtPoint(M(e,this.p))},Dt.prototype.getVelAtLocalPoint=function(e){return this.getVelAtPoint(I(e,this.rot))},Dt.prototype.eachShape=function(e){for(var t=0,n=this.shapeList.length;t<n;t++)e(this.shapeList[t])},Dt.prototype.eachConstraint=function(e){var t=this.constraintList;while(t){var n=t.next(this);e(t),t=n}},Dt.prototype.eachArbiter=function(e){var t=this.arbiterList;while(t){var n=t.next(this);t.swappedColl=this===t.body_b,e(t),t=n}},Dt.prototype.local2World=function(e){return O(this.p,I(e,this.rot))},Dt.prototype.world2Local=function(e){return q(M(e,this.p),this.rot)},Dt.prototype.kineticEnergy=function(){var e=this.vx*this.vx+this.vy*this.vy,t=this.w*this.w;return(e?e*this.m:0)+(t?t*this.i:0)};var It=r.SpatialIndex=function(e){this.staticIndex=e;if(e){if(e.dynamicIndex)throw new Error("This static index is already associated with a dynamic index.");e.dynamicIndex=this}};It.prototype.collideStatic=function(e,t){if(e.count>0){var n=e.query;this.each(function(e){n(e,new rt(e.bb_l,e.bb_b,e.bb_r,e.bb_t),t)})}};var qt=r.BBTree=function(e){It.call(this,e),this.velocityFunc=null,this.leaves={},this.count=0,this.root=null,this.pooledNodes=null,this.pooledPairs=null,this.stamp=0};qt.prototype=Object.create(It.prototype);var Rt=0,Ut=function(e,t,n){this.obj=null,this.bb_l=f(t.bb_l,n.bb_l),this.bb_b=f(t.bb_b,n.bb_b),this.bb_r=l(t.bb_r,n.bb_r),this.bb_t=l(t.bb_t,n.bb_t),this.parent=null,this.setA(t),this.setB(n)};qt.prototype.makeNode=function(e,t){var n=this.pooledNodes;return n?(this.pooledNodes=n.parent,n.constructor(this,e,t),n):(Rt++,new Ut(this,e,t))};var zt=0,Wt=function(e,t){this.obj=t,e.getBB(t,this),this.parent=null,this.stamp=1,this.pairs=null,zt++};qt.prototype.getBB=function(e,t){var n=this.velocityFunc;if(n){var r=.1,i=(e.bb_r-e.bb_l)*r,s=(e.bb_t-e.bb_b)*r,o=D(n(e),.1);t.bb_l=e.bb_l+f(-i,o.x),t.bb_b=e.bb_b+f(-s,o.y),t.bb_r=e.bb_r+l(i,o.x),t.bb_t=e.bb_t+l(s,o.y)}else t.bb_l=e.bb_l,t.bb_b=e.bb_b,t.bb_r=e.bb_r,t.bb_t=e.bb_t},qt.prototype.getStamp=function(){var e=this.dynamicIndex;return e&&e.stamp?e.stamp:this.stamp},qt.prototype.incrementStamp=function(){this.dynamicIndex&&this.dynamicIndex.stamp?this.dynamicIndex.stamp++:this.stamp++};var Xt=0,Vt=function(e,t,n,r){this.prevA=null,this.leafA=e,this.nextA=t,this.prevB=null,this.leafB=n,this.nextB=r};qt.prototype.makePair=function(e,t,n,r){var i=this.pooledPairs;return i?(this.pooledPairs=i.prevA,i.prevA=null,i.leafA=e,i.nextA=t,i.prevB=null,i.leafB=n,i.nextB=r,i):(Xt++,new Vt(e,t,n,r))},Vt.prototype.recycle=function(e){this.prevA=e.pooledPairs,e.pooledPairs=this};var $t=function(e,t,n){n&&(n.leafA===t?n.prevA=e:n.prevB=e),e?e.leafA===t?e.nextA=n:e.nextB=n:t.pairs=n};Wt.prototype.clearPairs=function(e){var t=this.pairs,n;this.pairs=null;while(t)t.leafA===this?(n=t.nextA,$t(t.prevB,t.leafB,t.nextB)):(n=t.nextB,$t(t.prevA,t.leafA,t.nextA)),t.recycle(e),t=n};var Jt=function(e,t,n){var r=e.pairs,i=t.pairs,s=n.makePair(e,r,t,i);e.pairs=t.pairs=s,r&&(r.leafA===e?r.prevA=s:r.prevB=s),i&&(i.leafA===t?i.prevA=s:i.prevB=s)};Ut.prototype.recycle=function(e){this.parent=e.pooledNodes,e.pooledNodes=this},Wt.prototype.recycle=function(e){},Ut.prototype.setA=function(e){this.A=e,e.parent=this},Ut.prototype.setB=function(e){this.B=e,e.parent=this},Wt.prototype.isLeaf=!0,Ut.prototype.isLeaf=!1,Ut.prototype.otherChild=function(e){return this.A==e?this.B:this.A},Ut.prototype.replaceChild=function(e,t,n){o(e==this.A||e==this.B,"Node is not a child of parent."),this.A==e?(this.A.recycle(n),this.setA(t)):(this.B.recycle(n),this.setB(t));for(var r=this;r;r=r.parent){var i=r.A,s=r.B;r.bb_l=f(i.bb_l,s.bb_l),r.bb_b=f(i.bb_b,s.bb_b),r.bb_r=l(i.bb_r,s.bb_r),r.bb_t=l(i.bb_t,s.bb_t)}},Ut.prototype.bbArea=Wt.prototype.bbArea=function(){return(this.bb_r-this.bb_l)*(this.bb_t-this.bb_b)};var Kt=function(e,t){return(l(e.bb_r,t.bb_r)-f(e.bb_l,t.bb_l))*(l(e.bb_t,t.bb_t)-f(e.bb_b,t.bb_b))},Qt=function(e,t){return Math.abs(e.bb_l+e.bb_r-t.bb_l-t.bb_r)+Math.abs(e.bb_b+e.bb_t-t.bb_b-t.bb_t)},Gt=function(e,t,n){if(e==null)return t;if(e.isLeaf)return n.makeNode(t,e);var r=e.B.bbArea()+Kt(e.A,t),i=e.A.bbArea()+Kt(e.B,t);return r===i&&(r=Qt(e.A,t),i=Qt(e.B,t)),i<r?e.setB(Gt(e.B,t,n)):e.setA(Gt(e.A,t,n)),e.bb_l=f(e.bb_l,t.bb_l),e.bb_b=f(e.bb_b,t.bb_b),e.bb_r=l(e.bb_r,t.bb_r),e.bb_t=l(e.bb_t,t.bb_t),e};Ut.prototype.intersectsBB=Wt.prototype.intersectsBB=function(e){return this.bb_l<=e.r&&e.l<=this.bb_r&&this.bb_b<=e.t&&e.b<=this.bb_t};var Yt=function(e,t,n){e.intersectsBB(t)&&(e.isLeaf?n(e.obj):(Yt(e.A,t,n),Yt(e.B,t,n)))},Zt=function(e,t,n){var r=1/(n.x-t.x),i=e.bb_l==t.x?-Infinity:(e.bb_l-t.x)*r,s=e.bb_r==t.x?Infinity:(e.bb_r-t.x)*r,o=f(i,s),u=l(i,s),a=1/(n.y-t.y),c=e.bb_b==t.y?-Infinity:(e.bb_b-t.y)*a,h=e.bb_t==t.y?Infinity:(e.bb_t-t.y)*a,p=f(c,h),d=l(c,h);if(p<=u&&o<=d){var v=l(o,p),m=f(u,d);if(0<=m&&v<=1)return l(v,0)}return Infinity},en=function(e,t,n,r,i){if(e.isLeaf)return i(e.obj);var s=Zt(e.A,t,n),o=Zt(e.B,t,n);return s<o?(s<r&&(r=f(r,en(e.A,t,n,r,i))),o<r&&(r=f(r,en(e.B,t,n,r,i)))):(o<r&&(r=f(r,en(e.B,t,n,r,i))),s<r&&(r=f(r,en(e.A,t,n,r,i)))),r};qt.prototype.subtreeRecycle=function(e){e.isLeaf&&(this.subtreeRecycle(e.A),this.subtreeRecycle(e.B),e.recycle(this))};var tn=function(e,t,n){if(t==e)return null;var r=t.parent;if(r==e){var i=e.otherChild(t);return i.parent=e.parent,e.recycle(n),i}return r.parent.replaceChild(r,r.otherChild(t),n),e},nn=function(e,t){return e.bb_l<=t.bb_r&&t.bb_l<=e.bb_r&&e.bb_b<=t.bb_t&&t.bb_b<=e.bb_t};Wt.prototype.markLeafQuery=function(e,t,n,r){nn(e,this)&&(t?Jt(e,this,n):(this.stamp<e.stamp&&Jt(this,e,n),r&&r(e.obj,this.obj)))},Ut.prototype.markLeafQuery=function(e,t,n,r){nn(e,this)&&(this.A.markLeafQuery(e,t,n,r),this.B.markLeafQuery(e,t,n,r))},Wt.prototype.markSubtree=function(e,t,n){if(this.stamp==e.getStamp()){t&&t.markLeafQuery(this,!1,e,n);for(var r=this;r.parent;r=r.parent)r==r.parent.A?r.parent.B.markLeafQuery(this,!0,e,n):r.parent.A.markLeafQuery(this,!1,e,n)}else{var i=this.pairs;while(i)this===i.leafB?(n&&n(i.leafA.obj,this.obj),i=i.nextB):i=i.nextA}},Ut.prototype.markSubtree=function(e,t,n){this.A.markSubtree(e,t,n),this.B.markSubtree(e,t,n)},Wt.prototype.containsObj=function(e){return this.bb_l<=e.bb_l&&this.bb_r>=e.bb_r&&this.bb_b<=e.bb_b&&this.bb_t>=e.bb_t},Wt.prototype.update=function(e){var t=e.root,n=this.obj;return this.containsObj(n)?!1:(e.getBB(this.obj,this),t=tn(t,this,e),e.root=Gt(t,this,e),this.clearPairs(e),this.stamp=e.getStamp(),!0)},Wt.prototype.addPairs=function(e){var t=e.dynamicIndex;if(t){var n=t.root;n&&n.markLeafQuery(this,!0,t,null)}else{var r=e.staticIndex.root;this.markSubtree(e,r,null)}},qt.prototype.insert=function(e,t){var n=new Wt(this,e);this.leaves[t]=n,this.root=Gt(this.root,n,this),this.count++,n.stamp=this.getStamp(),n.addPairs(this),this.incrementStamp()},qt.prototype.remove=function(e,t){var n=this.leaves[t];delete this.leaves[t],this.root=tn(this.root,n,this),this.count--,n.clearPairs(this),n.recycle(this)},qt.prototype.contains=function(e,t){return this.leaves[t]!=null};var rn=function(e,t){};qt.prototype.reindexQuery=function(e){if(!this.root)return;var t,n=this.leaves;for(t in n)n[t].update(this);var r=this.staticIndex,i=r&&r.root;this.root.markSubtree(this,i,e),r&&!i&&this.collideStatic(this,r,e),this.incrementStamp()},qt.prototype.reindex=function(){this.reindexQuery(rn)},qt.prototype.reindexObject=function(e,t){var n=this.leaves[t];n&&(n.update(this)&&n.addPairs(this),this.incrementStamp())},qt.prototype.pointQuery=function(e,t){this.query(new rt(e.x,e.y,e.x,e.y),t)},qt.prototype.segmentQuery=function(e,t,n,r){this.root&&en(this.root,e,t,n,r)},qt.prototype.query=function(e,t){this.root&&Yt(this.root,e,t)},qt.prototype.count=function(){return this.count},qt.prototype.each=function(e){var t;for(t in this.leaves)e(this.leaves[t].obj)};var sn=function(e,t,n,r,i){return(l(e.bb_r,r)-f(e.bb_l,t))*(l(e.bb_t,i)-f(e.bb_b,n))},on=function(e,t,n,r){if(r==1)return t[n];if(r==2)return e.makeNode(t[n],t[n+1]);var i=t[n],s=i.bb_l,o=i.bb_b,u=i.bb_r,a=i.bb_t,c=n+r;for(var h=n+1;h<c;h++)i=t[h],s=f(s,i.bb_l),o=f(o,i.bb_b),u=l(u,i.bb_r),a=l(a,i.bb_t);var p=u-s>a-o,d=new Array(r*2);if(p)for(var h=n;h<c;h++)d[2*h+0]=t[h].bb_l,d[2*h+1]=t[h].bb_r;else for(var h=n;h<c;h++)d[2*h+0]=t[h].bb_b,d[2*h+1]=t[h].bb_t;d.sort(function(e,t){return e-t});var v=(d[r-1]+d[r])*.5,m=s,g=o,y=u,b=a,w=s,E=o,S=u,x=a;p?y=w=v:b=E=v;var T=c;for(var N=n;N<T;){var i=t[N];sn(i,w,E,S,x)<sn(i,m,g,y,b)?(T--,t[N]=t[T],t[T]=i):N++}if(T==r){var i=null;for(var h=n;h<c;h++)i=Gt(i,t[h],e);return i}return NodeNew(e,on(e,t,n,T-n),on(e,t,T,c-T))};qt.prototype.optimize=function(){var e=new Array(this.count),t=0;for(var n in this.leaves)e[t++]=this.nodes[n];tree.subtreeRecycle(root),this.root=on(tree,e,e.length)};var un=function(e,t){!e.isLeaf&&t<=10&&(un(e.A,t+1),un(e.B,t+1));var n="";for(var r=0;r<t;r++)n+=" ";console.log(n+e.bb_b+" "+e.bb_t)};qt.prototype.log=function(){this.root&&un(this.root,0)};var an=r.CollisionHandler=function(){this.a=this.b=0};an.prototype.begin=function(e,t){return!0},an.prototype.preSolve=function(e,t){return!0},an.prototype.postSolve=function(e,t){},an.prototype.separate=function(e,t){};var fn=4,ln=function(e,t){this.e=0,this.u=0,this.surface_vr=T,this.a=e,this.body_a=e.body,this.b=t,this.body_b=t.body,this.thread_a_next=this.thread_a_prev=null,this.thread_b_next=this.thread_b_prev=null,this.contacts=null,this.stamp=0,this.handler=null,this.swappedColl=!1,this.state="first coll"};ln.prototype.getShapes=function(){return this.swappedColl?[this.b,this.a]:[this.a,this.b]},ln.prototype.totalImpulse=function(){var e=this.contacts,t=new x(0,0);for(var n=0,r=e.length;n<r;n++){var i=e[n];t.add(D(i.n,i.jnAcc))}return this.swappedColl?t:t.neg()},ln.prototype.totalImpulseWithFriction=function(){var e=this.contacts,t=new x(0,0);for(var n=0,r=e.length;n<r;n++){var i=e[n];t.add((new x(i.jnAcc,i.jtAcc)).rotate(i.n))}return this.swappedColl?t:t.neg()},ln.prototype.totalKE=function(){var e=(1-this.e)/(1+this.e),t=0,n=this.contacts;for(var r=0,i=n.length;r<i;r++){var s=n[r],o=s.jnAcc,u=s.jtAcc;t+=e*o*o/s.nMass+u*u/s.tMass}return t},ln.prototype.ignore=function(){this.state="ignore"},ln.prototype.getA=function(){return this.swappedColl?this.b:this.a},ln.prototype.getB=function(){return this.swappedColl?this.a:this.b},ln.prototype.isFirstContact=function(){return this.state==="first coll"};var cn=function(e,t,n){this.point=e,this.normal=t,this.dist=n};ln.prototype.getContactPointSet=function(){var e=new Array(this.contacts.length),t;for(t=0;t<e.length;t++)e[t]=new cn(this.contacts[t].p,this.contacts[t].n,this.contacts[t].dist);return e},ln.prototype.getNormal=function(e){var t=this.contacts[e].n;return this.swappedColl?_(t):t},ln.prototype.getPoint=function(e){return this.contacts[e].p},ln.prototype.getDepth=function(e){return this.contacts[e].dist};var hn=function(e,t,n,r){n?n.body_a===t?n.thread_a_next=r:n.thread_b_next=r:t.arbiterList=r,r&&(r.body_a===t?r.thread_a_prev=n:r.thread_b_prev=n)};ln.prototype.unthread=function(){hn(this,this.body_a,this.thread_a_prev,this.thread_a_next),hn(this,this.body_b,this.thread_b_prev,this.thread_b_next),this.thread_a_prev=this.thread_a_next=null,this.thread_b_prev=this.thread_b_next=null},ln.prototype.update=function(e,t,n,r){if(this.contacts)for(var i=0;i<this.contacts.length;i++){var s=this.contacts[i];for(var o=0;o<e.length;o++){var u=e[o];u.hash===s.hash&&(u.jnAcc=s.jnAcc,u.jtAcc=s.jtAcc)}}this.contacts=e,this.handler=t,this.swappedColl=n.collision_type!==t.a,this.e=n.e*r.e,this.u=n.u*r.u,this.surface_vr=M(n.surface_v,r.surface_v),this.a=n,this.body_a=n.body,this.b=r,this.body_b=r.body,this.state=="cached"&&(this.state="first coll")},ln.prototype.preStep=function(e,t,n){var r=this.body_a,i=this.body_b;for(var s=0;s<this.contacts.length;s++){var o=this.contacts[s];o.r1=M(o.p,r.p),o.r2=M(o.p,i.p),o.nMass=1/Vn(r,i,o.r1,o.r2,o.n),o.tMass=1/Vn(r,i,o.r1,o.r2,B(o.n)),o.bias=-n*f(0,o.dist+t)/e,o.jBias=0,o.bounce=Rn(r,i,o.r1,o.r2,o.n)*this.e}},ln.prototype.applyCachedImpulse=function(e){if(this.isFirstContact())return;var t=this.body_a,n=this.body_b;for(var r=0;r<this.contacts.length;r++){var i=this.contacts[r],s=i.n.x,o=i.n.y,u=s*i.jnAcc-o*i.jtAcc,a=s*i.jtAcc+o*i.jnAcc;zn(t,n,i.r1,i.r2,u*e,a*e)}};var pn=0,dn=0;ln.prototype.applyImpulse=function(){pn++;var e=this.body_a,t=this.body_b,n=this.surface_vr,r=this.u;for(var i=0;i<this.contacts.length;i++){dn++;var s=this.contacts[i],o=s.nMass,u=s.n,a=s.r1,f=s.r2,c=t.vx-f.y*t.w-(e.vx-a.y*e.w),h=t.vy+f.x*t.w-(e.vy+a.x*e.w),p=u.x*(t.v_biasx-f.y*t.w_bias-e.v_biasx+a.y*e.w_bias)+u.y*(f.x*t.w_bias+t.v_biasy-a.x*e.w_bias-e.v_biasy),d=C(c,h,u.x,u.y),v=C(c+n.x,h+n.y,-u.y,u.x),m=(s.bias-p)*o,g=s.jBias;s.jBias=l(g+m,0);var y=-(s.bounce+d)*o,w=s.jnAcc;s.jnAcc=l(w+y,0);var E=r*s.jnAcc,S=-v*s.tMass,x=s.jtAcc;s.jtAcc=b(x+S,-E,E);var T=u.x*(s.jBias-g),N=u.y*(s.jBias-g);Wn(e,-T,-N,a),Wn(t,T,N,f);var k=s.jnAcc-w,L=s.jtAcc-x;zn(e,t,a,f,u.x*k-u.y*L,u.x*L+u.y*k)}},ln.prototype.callSeparate=function(e){var t=e.lookupHandler(this.a.collision_type,this.b.collision_type);t.separate(this,e)},ln.prototype.next=function(e){return this.body_a==e?this.thread_a_next:this.thread_b_next};var vn=0,mn=function(e,t,n,r){this.p=e,this.n=t,this.dist=n,this.r1=this.r2=T,this.nMass=this.tMass=this.bounce=this.bias=0,this.jnAcc=this.jtAcc=this.jBias=0,this.hash=r,vn++},gn=[],yn=function(e,t,n,r){var i=n+r,s=M(t,e),o=R(s);if(o>=i*i)return;var u=Math.sqrt(o);return new mn(O(e,D(s,.5+(n-.5*i)/(u?u:Infinity))),u?D(s,1/u):new x(1,0),u-i,0)},bn=function(e,t){var n=yn(e.tc,t.tc,e.r,t.r);return n?[n]:gn},wn=function(e,t){var n=t.ta,r=t.tb,i=e.tc,s=M(r,n),o=w(N(s,M(i,n))/R(s)),u=O(n,D(s,o)),a=yn(i,u,e.r,t.r);if(a){var f=a.n;return o===0&&N(f,t.a_tangent)<0||o===1&&N(f,t.b_tangent)<0?gn:[a]}return gn},En=0,Sn=function(e,t){var n=0,r=e.valueOnAxis(t[0].n,t[0].d);if(r>0)return-1;for(var i=1;i<t.length;i++){var s=e.valueOnAxis(t[i].n,t[i].d);if(s>0)return-1;s>r&&(r=s,n=i)}return En=r,n},xn=function(e,t,n,r){var i=[],s=e.tVerts;for(var o=0;o<s.length;o+=2){var u=s[o],a=s[o+1];t.containsVertPartial(u,a,_(n))&&i.push(new mn(new x(u,a),n,r,c(e.hashid,o)))}var f=t.tVerts;for(var o=0;o<f.length;o+=2){var u=f[o],a=f[o+1];e.containsVertPartial(u,a,n)&&i.push(new mn(new x(u,a),n,r,c(t.hashid,o)))}return i},Tn=function(e,t,n,r){var i=[],s=e.tVerts;for(var o=0;o<s.length;o+=2){var u=s[o],a=s[o+1];t.containsVert(u,a)&&i.push(new mn(new x(u,a),n,r,c(e.hashid,o>>1)))}var f=t.tVerts;for(var o=0;o<f.length;o+=2){var u=f[o],a=f[o+1];e.containsVert(u,a)&&i.push(new mn(new x(u,a),n,r,c(t.hashid,o>>1)))}return i.length?i:xn(e,t,n,r)},Nn=function(e,t){var n=Sn(t,e.tPlanes);if(n==-1)return gn;var r=En,i=Sn(e,t.tPlanes);if(i==-1)return gn;var s=En;return r>s?Tn(e,t,e.tPlanes[n].n,r):Tn(e,t,_(t.tPlanes[i].n),s)},Cn=function(e,t,n){var r=N(t,e.ta)-e.r,i=N(t,e.tb)-e.r;return f(r,i)-n},kn=function(e,t,n,r,i){var s=P(t.tn,t.ta),o=P(t.tn,t.tb),u=D(t.tn,i),a=n.tVerts;for(var f=0;f<a.length;f+=2){var l=a[f],h=a[f+1];if(C(l,h,u.x,u.y)<N(t.tn,t.ta)*i+t.r){var p=H(t.tn.x,t.tn.y,l,h);s>=p&&p>=o&&e.push(new mn(new x(l,h),u,r,c(n.hashid,f)))}}},Ln=function(e,t){var n=[],r=t.tPlanes,i=r.length,s=N(e.tn,e.ta),o=t.valueOnAxis(e.tn,s)-e.r,u=t.valueOnAxis(_(e.tn),-s)-e.r;if(u>0||o>0)return gn;var a=0,f=Cn(e,r[0].n,r[0].d);if(f>0)return gn;for(var l=0;l<i;l++){var h=Cn(e,r[l].n,r[l].d);if(h>0)return gn;h>f&&(f=h,a=l)}var p=_(r[a].n),d=O(e.ta,D(p,e.r)),v=O(e.tb,D(p,e.r));t.containsVert(d.x,d.y)&&n.push(new mn(d,p,f,c(e.hashid,0))),t.containsVert(v.x,v.y)&&n.push(new mn(v,p,f,c(e.hashid,1)));if(o>=f||u>=f)o>u?kn(n,e,t,o,1):kn(n,e,t,u,-1);if(n.length===0){var m=a*2,g=t.tVerts,y=new x(g[m],g[m+1]),b;if(b=yn(e.ta,y,e.r,0,n))return[b];if(b=yn(e.tb,y,e.r,0,n))return[b];var w=i*2,E=new x(g[(m+2)%w],g[(m+3)%w]);if(b=yn(e.ta,E,e.r,0,n))return[b];if(b=yn(e.tb,E,e.r,0,n))return[b]}return n},An=function(e,t){var n=t.tPlanes,r=0,i=N(n[0].n,e.tc)-n[0].d-e.r;for(var s=0;s<n.length;s++){var o=N(n[s].n,e.tc)-n[s].d-e.r;if(o>0)return gn;o>i&&(i=o,r=s)}var u=n[r].n,a=t.tVerts,f=a.length,l=r<<1,c=a[l],h=a[l+1],p=a[(l+2)%f],d=a[(l+3)%f],v=H(u.x,u.y,c,h),m=H(u.x,u.y,p,d),g=P(u,e.tc);if(g<m){var y=yn(e.tc,new x(p,d),e.r,0,y);return y?[y]:gn}if(g<v)return[new mn(M(e.tc,D(u,e.r+i/2)),_(u),i,0)];var y=yn(e.tc,new x(c,h),e.r,0,y);return y?[y]:gn};Nt.prototype.collisionCode=0,kt.prototype.collisionCode=1,At.prototype.collisionCode=2,Nt.prototype.collisionTable=[bn,wn,An],kt.prototype.collisionTable=[null,function(e,t){return gn},Ln],At.prototype.collisionTable=[null,null,Nn];var On=r.collideShapes=function(e,t){return i(e.collisionCode<=t.collisionCode,"Collided shapes must be sorted by type"),e.collisionTable[t.collisionCode](e,t)},Mn=new an,_n=r.Space=function(){this.stamp=0,this.curr_dt=0,this.bodies=[],this.rousedBodies=[],this.sleepingComponents=[],this.staticShapes=new qt(null),this.activeShapes=new qt(this.staticShapes),this.arbiters=[],this.contactBuffersHead=null,this.cachedArbiters={},this.constraints=[],this.locked=0,this.collisionHandlers={},this.defaultHandler=Mn,this.postStepCallbacks=[],this.iterations=10,this.gravity=T,this.damping=1,this.idleSpeedThreshold=0,this.sleepTimeThreshold=Infinity,this.collisionSlop=.1,this.collisionBias=Math.pow(.9,60),this.collisionPersistence=3,this.enableContactGraph=!1,this.staticBody=new Dt(Infinity,Infinity),this.staticBody.nodeIdleTime=Infinity,this.collideShapes=this.makeCollideShapes()};_n.prototype.getCurrentTimeStep=function(){return this.curr_dt},_n.prototype.setIterations=function(e){this.iterations=e},_n.prototype.isLocked=function(){return this.locked};var Dn=function(e){i(!e.locked,"This addition/removal cannot be done safely during a call to cpSpaceStep()  or during a query. Put these calls into a post-step callback.")};_n.prototype.addCollisionHandler=function(e,t,n,r,i,s){Dn(this),this.removeCollisionHandler(e,t);var o=new an;o.a=e,o.b=t,n&&(o.begin=n),r&&(o.preSolve=r),i&&(o.postSolve=i),s&&(o.separate=s),this.collisionHandlers[c(e,t)]=o},_n.prototype.removeCollisionHandler=function(e,t){Dn(this),delete this.collisionHandlers[c(e,t)]},_n.prototype.setDefaultCollisionHandler=function(e,t,n,r){Dn(this);var i=new an;e&&(i.begin=e),t&&(i.preSolve=t),n&&(i.postSolve=n),r&&(i.separate=r),this.defaultHandler=i},_n.prototype.lookupHandler=function(e,t){return this.collisionHandlers[c(e,t)]||this.defaultHandler},_n.prototype.addShape=function(e){var t=e.body;return t.isStatic()?this.addStaticShape(e):(i(!e.space,"This shape is already added to a space and cannot be added to another."),Dn(this),t.activate(),t.addShape(e),e.update(t.p,t.rot),this.activeShapes.insert(e,e.hashid),e.space=this,e)},_n.prototype.addStaticShape=function(e){i(!e.space,"This shape is already added to a space and cannot be added to another."),Dn(this);var t=e.body;return t.addShape(e),e.update(t.p,t.rot),this.staticShapes.insert(e,e.hashid),e.space=this,e},_n.prototype.addBody=function(e){return i(!e.isStatic(),"Static bodies cannot be added to a space as they are not meant to be simulated."),i(!e.space,"This body is already added to a space and cannot be added to another."),Dn(this),this.bodies.push(e),e.space=this,e},_n.prototype.addConstraint=function(e){i(!e.space,"This shape is already added to a space and cannot be added to another."),Dn(this);var t=e.a,n=e.b;return t.activate(),n.activate(),this.constraints.push(e),e.next_a=t.constraintList,t.constraintList=e,e.next_b=n.constraintList,n.constraintList=e,e.space=this,e},_n.prototype.filterArbiters=function(e,t){for(var n in this.cachedArbiters){var r=this.cachedArbiters[n];if(e===r.body_a&&(t===r.a||t===null)||e===r.body_b&&(t===r.b||t===null))t&&r.state!=="cached"&&r.callSeparate(this),r.unthread(),h(this.arbiters,r),delete this.cachedArbiters[n]}},_n.prototype.removeShape=function(e){var t=e.body;t.isStatic()?this.removeStaticShape(e):(i(this.containsShape(e),"Cannot remove a shape that was not added to the space. (Removed twice maybe?)"),Dn(this),t.activate(),t.removeShape(e),this.filterArbiters(t,e),this.activeShapes.remove(e,e.hashid),e.space=null)},_n.prototype.removeStaticShape=function(e){i(this.containsShape(e),"Cannot remove a static or sleeping shape that was not added to the space. (Removed twice maybe?)"),Dn(this);var t=e.body;t.isStatic()&&t.activateStatic(e),t.removeShape(e),this.filterArbiters(t,e),this.staticShapes.remove(e,e.hashid),e.space=null},_n.prototype.removeBody=function(e){i(this.containsBody(e),"Cannot remove a body that was not added to the space. (Removed twice maybe?)"),Dn(this),e.activate(),h(this.bodies,e),e.space=null},_n.prototype.removeConstraint=function(e){i(this.containsConstraint(e),"Cannot remove a constraint that was not added to the space. (Removed twice maybe?)"),Dn(this),e.a.activate(),e.b.activate(),h(this.constraints,e),e.a.removeConstraint(e),e.b.removeConstraint(e),e.space=null},_n.prototype.containsShape=function(e){return e.space===this},_n.prototype.containsBody=function(e){return e.space==this},_n.prototype.containsConstraint=function(e){return e.space==this},_n.prototype.uncacheArbiter=function(e){delete this.cachedArbiters[c(e.a.hashid,e.b.hashid)],h(this.arbiters,e)},_n.prototype.eachBody=function(e){this.lock();var t=this.bodies;for(var n=0;n<t.length;n++)e(t[n]);var r=this.sleepingComponents;for(var n=0;n<r.length;n++){var i=r[n],s=i;while(s){var o=s.nodeNext;e(s),s=o}}this.unlock(!0)},_n.prototype.eachShape=function(e){this.lock(),this.activeShapes.each(e),this.staticShapes.each(e),this.unlock(!0)},_n.prototype.eachConstraint=function(e){this.lock();var t=this.constraints;for(var n=0;n<t.length;n++)e(t[n]);this.unlock(!0)},_n.prototype.reindexStatic=function(){i(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete."),this.staticShapes.each(function(e){var t=e.body;e.update(t.p,t.rot)}),this.staticShapes.reindex()},_n.prototype.reindexShape=function(e){i(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete.");var t=e.body;e.update(t.p,t.rot),this.activeShapes.reindexObject(e,e.hashid),this.staticShapes.reindexObject(e,e.hashid)},_n.prototype.reindexShapesForBody=function(e){for(var t=e.shapeList;t;t=t.next)this.reindexShape(t)},_n.prototype.useSpatialHash=function(e,t){throw new Error("Spatial Hash not implemented.");var n,r},_n.prototype.activateBody=function(e){i(!e.isRogue(),"Internal error: Attempting to activate a rogue body.");if(this.locked)this.rousedBodies.indexOf(e)===-1&&this.rousedBodies.push(e);else{this.bodies.push(e);for(var t=0;t<e.shapeList.length;t++){var n=e.shapeList[t];this.staticShapes.remove(n,n.hashid),this.activeShapes.insert(n,n.hashid)}for(var r=e.arbiterList;r;r=r.next(e)){var s=r.body_a;if(e===s||s.isStatic()){var o=r.a,u=r.b;this.cachedArbiters[c(o.hashid,u.hashid)]=r,r.stamp=this.stamp,r.handler=this.lookupHandler(o.collision_type,u.collision_type),this.arbiters.push(r)}}for(var a=e.constraintList;a;a=a.nodeNext){var s=a.a;(e===s||s.isStatic())&&this.constraints.push(a)}}},_n.prototype.deactivateBody=function(e){i(!e.isRogue(),"Internal error: Attempting to deactivate a rogue body."),h(this.bodies,e);for(var t=0;t<e.shapeList.length;t++){var n=e.shapeList[t];this.activeShapes.remove(n,n.hashid),this.staticShapes.insert(n,n.hashid)}for(var r=e.arbiterList;r;r=r.next(e)){var s=r.body_a;(e===s||s.isStatic())&&this.uncacheArbiter(r)}for(var o=e.constraintList;o;o=o.nodeNext){var s=o.a;(e===s||s.isStatic())&&h(this.constraints,o)}};var Pn=function(e){return e?e.nodeRoot:null},Hn=function(e){if(!e||!e.isSleeping(e))return;i(!e.isRogue(),"Internal Error: componentActivate() called on a rogue body.");var t=e.space,n=e;while(n){var r=n.nodeNext;n.nodeIdleTime=0,n.nodeRoot=null,n.nodeNext=null,t.activateBody(n),n=r}h(t.sleepingComponents,e)};Dt.prototype.activate=function(){this.isRogue()||(this.nodeIdleTime=0,Hn(Pn(this)))},Dt.prototype.activateStatic=function(e){i(this.isStatic(),"Body.activateStatic() called on a non-static body.");for(var t=this.arbiterList;t;t=t.next(this))(!e||e==t.a||e==t.b)&&(t.body_a==this?t.body_b:t.body_a).activate()},Dt.prototype.pushArbiter=function(e){o((e.body_a===this?e.thread_a_next:e.thread_b_next)===null,"Internal Error: Dangling contact graph pointers detected. (A)"),o((e.body_a===this?e.thread_a_prev:e.thread_b_prev)===null,"Internal Error: Dangling contact graph pointers detected. (B)");var t=this.arbiterList;o(t===null||(t.body_a===this?t.thread_a_prev:t.thread_b_prev)===null,"Internal Error: Dangling contact graph pointers detected. (C)"),e.body_a===this?e.thread_a_next=t:e.thread_b_next=t,t&&(t.body_a===this?t.thread_a_prev=e:t.thread_b_prev=e),this.arbiterList=e};var Bn=function(e,t){t.nodeRoot=e,t!==e&&(t.nodeNext=e.nodeNext,e.nodeNext=t)},jn=function(e,t){if(!t.isRogue()){var n=Pn(t);if(n==null){Bn(e,t);for(var r=t.arbiterList;r;r=r.next(t))jn(e,t==r.body_a?r.body_b:r.body_a);for(var i=t.constraintList;i;i=i.next(t))jn(e,t==i.a?i.b:i.a)}else o(n===e,"Internal Error: Inconsistency detected in the contact graph.")}},Fn=function(e,t){for(var n=e;n;n=n.nodeNext)if(n.nodeIdleTime<t)return!0;return!1};_n.prototype.processComponents=function(e){var t=this.sleepTimeThreshold!==Infinity,n=this.bodies;for(var r=0;r<n.length;r++){var i=n[r];o(i.nodeNext===null,"Internal Error: Dangling next pointer detected in contact graph."),o(i.nodeRoot===null,"Internal Error: Dangling root pointer detected in contact graph.")}if(t){var s=this.idleSpeedThreshold,u=s?s*s:R(this.gravity)*e*e;for(var r=0;r<n.length;r++){var i=n[r],a=u?i.m*u:0;i.nodeIdleTime=i.kineticEnergy()>a?0:i.nodeIdleTime+e}}var f=this.arbiters;for(var r=0,l=f.length;r<l;r++){var c=f[r],h=c.body_a,p=c.body_b;t&&((p.isRogue()&&!p.isStatic()||h.isSleeping())&&h.activate(),(h.isRogue()&&!h.isStatic()||p.isSleeping())&&p.activate()),h.pushArbiter(c),p.pushArbiter(c)}if(t){var d=this.constraints;for(var r=0;r<d.length;r++){var v=d[r],h=v.a,p=v.b;p.isRogue()&&!p.isStatic()&&h.activate(),h.isRogue()&&!h.isStatic()&&p.activate()}for(var r=0;r<n.length;){var i=n[r];if(Pn(i)===null){jn(i,i);if(!Fn(i,this.sleepTimeThreshold)){this.sleepingComponents.push(i);for(var m=i;m;m=m.nodeNext)this.deactivateBody(m);continue}}r++,i.nodeRoot=null,i.nodeNext=null}}},Dt.prototype.sleep=function(){this.sleepWithGroup(null)},Dt.prototype.sleepWithGroup=function(e){i(!this.isStatic()&&!this.isRogue(),"Rogue and static bodies cannot be put to sleep.");var t=this.space;i(t,"Cannot put a rogue body to sleep."),i(!t.locked,"Bodies cannot be put to sleep during a query or a call to cpSpaceStep(). Put these calls into a post-step callback."),i(e===null||e.isSleeping(),"Cannot use a non-sleeping body as a group identifier.");if(this.isSleeping()){i(Pn(this)===Pn(e),"The body is already sleeping and it's group cannot be reassigned.");return}for(var n=0;n<this.shapeList.length;n++)this.shapeList[n].update(this.p,this.rot);t.deactivateBody(this);if(e){var r=Pn(e);this.nodeRoot=r,this.nodeNext=r.nodeNext,this.nodeIdleTime=0,r.nodeNext=this}else this.nodeRoot=this,this.nodeNext=null,this.nodeIdleTime=0,t.sleepingComponents.push(this);h(t.bodies,this)},_n.prototype.activateShapesTouchingShape=function(e){this.sleepTimeThreshold!==Infinity&&this.shapeQuery(e,function(e,t){e.body.activate()})},_n.prototype.pointQuery=function(e,t,n,r){var i=function(i){(!i.group||n!==i.group)&&t&i.layers&&i.pointQuery(e)&&r(i)},s=new rt(e.x,e.y,e.x,e.y);this.lock(),this.activeShapes.query(s,i),this.staticShapes.query(s,i),this.unlock(!0)},_n.prototype.pointQueryFirst=function(e,t,n){var r=null;return this.pointQuery(e,t,n,function(e){e.sensor||(r=e)}),r},_n.prototype.nearestPointQuery=function(e,t,n,r,i){var s=function(s){if((!s.group||r!==s.group)&&n&s.layers){var o=s.nearestPointQuery(e);o.d<t&&i(s,o.d,o.p)}},o=it(e,t);this.lock(),this.activeShapes.query(o,s),this.staticShapes.query(o,s),this.unlock(!0)},_n.prototype.nearestPointQueryNearest=function(e,t,n,r){var i,s=function(s){if((!s.group||r!==s.group)&&n&s.layers&&!s.sensor){var o=s.nearestPointQuery(e);o.d<t&&(!i||o.d<i.d)&&(i=o)}},o=it(e,t);return this.activeShapes.query(o,s),this.staticShapes.query(o,s),i},_n.prototype.segmentQuery=function(e,t,n,r,i){var s=function(s){var o;return(!s.group||r!==s.group)&&n&s.layers&&(o=s.segmentQuery(e,t))&&i(s,o.t,o.n),1};this.lock(),this.staticShapes.segmentQuery(e,t,1,s),this.activeShapes.segmentQuery(e,t,1,s),this.unlock(!0)},_n.prototype.segmentQueryFirst=function(e,t,n,r){var i=null,s=function(s){var o;return(!s.group||r!==s.group)&&n&s.layers&&!s.sensor&&(o=s.segmentQuery(e,t))&&(i===null||o.t<i.t)&&(i=o),i?i.t:1};return this.staticShapes.segmentQuery(e,t,1,s),this.activeShapes.segmentQuery(e,t,i?i.t:1,s),i},_n.prototype.bbQuery=function(e,t,n,r){var i=function(i){(!i.group||n!==i.group)&&t&i.layers&&ot(e,i.bb_l,i.bb_b,i.bb_r,i.bb_t)&&r(i)};this.lock(),this.activeShapes.query(e,i),this.staticShapes.query(e,i),this.unlock(!0)},_n.prototype.shapeQuery=function(e,t){var n=e.body;n&&e.update(n.p,n.rot);var r=new rt(e.bb_l,e.bb_b,e.bb_r,e.bb_t),i=!1,s=function(n){var r=e;if(r.group&&r.group===n.group||!(r.layers&n.layers)||r===n)return;var s;if(r.collisionCode<=n.collisionCode)s=On(r,n);else{s=On(n,r);for(var o=0;o<s.length;o++)s[o].n=_(s[o].n)}if(s.length){i=!r.sensor&&!n.sensor;if(t){var u=new Array(s.length);for(var o=0;o<s.length;o++)u[o]=new cn(s[o].p,s[o].n,s[o].dist);t(n,u)}}};return this.lock(),this.activeShapes.query(r,s),this.staticShapes.query(r,s),this.unlock(!0),i},_n.prototype.addPostStepCallback=function(e){o(this.locked,"Adding a post-step callback when the space is not locked is unnecessary. Post-step callbacks will not called until the end of the next call to cpSpaceStep() or the next query."),this.postStepCallbacks.push(e)},_n.prototype.runPostStepCallbacks=function(){for(var e=0;e<this.postStepCallbacks.length;e++)this.postStepCallbacks[e]();this.postStepCallbacks=[]},_n.prototype.lock=function(){this.locked++},_n.prototype.unlock=function(e){this.locked--,i(this.locked>=0,"Internal Error: Space lock underflow.");if(this.locked===0&&e){var t=this.rousedBodies;for(var n=0;n<t.length;n++)this.activateBody(t[n]);t.length=0,this.runPostStepCallbacks()}},_n.prototype.makeCollideShapes=function(){var e=this;return function(t,n){var r=e;if(!(t.bb_l<=n.bb_r&&n.bb_l<=t.bb_r&&t.bb_b<=n.bb_t&&n.bb_b<=t.bb_t)||t.body===n.body||t.group&&t.group===n.group||!(t.layers&n.layers))return;var i=r.lookupHandler(t.collision_type,n.collision_type),s=t.sensor||n.sensor;if(s&&i===Mn)return;if(t.collisionCode>n.collisionCode){var o=t;t=n,n=o}var u=On(t,n);if(u.length===0)return;var a=c(t.hashid,n.hashid),f=r.cachedArbiters[a];f||(f=r.cachedArbiters[a]=new ln(t,n)),f.update(u,i,t,n),f.state=="first coll"&&!i.begin(f,r)&&f.ignore(),f.state!=="ignore"&&i.preSolve(f,r)&&!s?r.arbiters.push(f):(f.contacts=null,f.state!=="ignore"&&(f.state="normal")),f.stamp=r.stamp}},_n.prototype.arbiterSetFilter=function(e){var t=this.stamp-e.stamp,n=e.body_a,r=e.body_b;return(n.isStatic()||n.isSleeping())&&(r.isStatic()||r.isSleeping())?!0:(t>=1&&e.state!="cached"&&(e.callSeparate(this),e.state="cached"),t>=this.collisionPersistence?(e.contacts=null,!1):!0)};var In=function(e){var t=e.body;e.update(t.p,t.rot)};_n.prototype.step=function(e){if(e===0)return;i(T.x===0&&T.y===0,"vzero is invalid"),this.stamp++;var t=this.curr_dt;this.curr_dt=e;var n,r,s,o=this.bodies,u=this.constraints,a=this.arbiters;for(n=0;n<a.length;n++){var f=a[n];f.state="normal",!f.body_a.isSleeping()&&!f.body_b.isSleeping()&&f.unthread()}a.length=0,this.lock();for(n=0;n<o.length;n++)o[n].position_func(e);this.activeShapes.each(In),this.activeShapes.reindexQuery(this.collideShapes),this.unlock(!1),this.processComponents(e),this.lock();for(s in this.cachedArbiters)this.arbiterSetFilter(this.cachedArbiters[s])||delete this.cachedArbiters[s];var l=this.collisionSlop,c=1-Math.pow(this.collisionBias,e);for(n=0;n<a.length;n++)a[n].preStep(e,l,c);for(n=0;n<u.length;n++){var h=u[n];h.preSolve(this),h.preStep(e)}var p=Math.pow(this.damping,e),d=this.gravity;for(n=0;n<o.length;n++)o[n].velocity_func(d,p,e);var v=t===0?0:e/t;for(n=0;n<a.length;n++)a[n].applyCachedImpulse(v);for(n=0;n<u.length;n++)u[n].applyCachedImpulse(v);for(n=0;n<this.iterations;n++){for(r=0;r<a.length;r++)a[r].applyImpulse();for(r=0;r<u.length;r++)u[r].applyImpulse()}for(n=0;n<u.length;n++)u[n].postSolve(this);for(n=0;n<a.length;n++)a[n].handler.postSolve(a[n],this);this.unlock(!0)};var qn=function(e,t,n,r){var i=e.vx+ -n.y*e.w,s=e.vy+n.x*e.w,o=t.vx+ -r.y*t.w,u=t.vy+r.x*t.w;return new x(o-i,u-s)},Rn=function(e,t,n,r,i){var s=e.vx+ -n.y*e.w,o=e.vy+n.x*e.w,u=t.vx+ -r.y*t.w,a=t.vy+r.x*t.w;return C(u-s,a-o,i.x,i.y)},Un=function(e,t,n,r){e.vx+=t*e.m_inv,e.vy+=n*e.m_inv,e.w+=e.i_inv*(r.x*n-r.y*t)},zn=function(e,t,n,r,i,s){Un(e,-i,-s,n),Un(t,i,s,r)},Wn=function(e,t,n,r){e.v_biasx+=t*e.m_inv,e.v_biasy+=n*e.m_inv,e.w_bias+=e.i_inv*H(r.x,r.y,t,n)},Xn=function(e,t,n){var r=P(t,n);return e.m_inv+e.i_inv*r*r},Vn=function(e,t,n,r,i){var s=Xn(e,n,i)+Xn(t,r,i);return o(s!==0,"Unsolvable collision or constraint."),s},$n=function(e,t,n,r,i,s){var u,a,f,l,c=e.m_inv+t.m_inv;u=c,a=0,f=0,l=c;var h=e.i_inv,p=n.x*n.x*h,d=n.y*n.y*h,v=-n.x*n.y*h;u+=d,a+=v,f+=v,l+=p;var m=t.i_inv,g=r.x*r.x*m,y=r.y*r.y*m,b=-r.x*r.y*m;u+=y,a+=b,f+=b,l+=g;var w=u*l-a*f;o(w!==0,"Unsolvable constraint.");var E=1/w;i.x=l*E,i.y=-a*E,s.x=-f*E,s.y=u*E},Jn=function(e,t,n){return new x(N(e,t),N(e,n))},Kn=function(e,t){return 1-Math.pow(e,t)},Qn=r.Constraint=function(e,t){this.a=e,this.b=t,this.space=null,this.next_a=null,this.next_b=null,this.maxForce=Infinity,this.errorBias=Math.pow(.9,60),this.maxBias=Infinity};Qn.prototype.activateBodies=function(){this.a&&this.a.activate(),this.b&&this.b.activate()},Qn.prototype.preStep=function(e){},Qn.prototype.applyCachedImpulse=function(e){},Qn.prototype.applyImpulse=function(){},Qn.prototype.getImpulse=function(){return 0},Qn.prototype.preSolve=function(e){},Qn.prototype.postSolve=function(e){},Qn.prototype.next=function(e){return this.a===e?this.next_a:this.next_b};var Gn=r.PinJoint=function(e,t,n,r){Qn.call(this,e,t),this.anchr1=n,this.anchr2=r;var i=e?O(e.p,I(n,e.rot)):n,s=t?O(t.p,I(r,t.rot)):r;this.dist=k(M(s,i)),o(this.dist>0,"You created a 0 length pin joint. A pivot joint will be much more stable."),this.r1=this.r2=null,this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0};Gn.prototype=Object.create(Qn.prototype),Gn.prototype.preStep=function(e){var t=this.a,n=this.b;this.r1=I(this.anchr1,t.rot),this.r2=I(this.anchr2,n.rot);var r=M(O(n.p,this.r2),O(t.p,this.r1)),i=k(r);this.n=D(r,1/(i?i:Infinity)),this.nMass=1/Vn(t,n,this.r1,this.r2,this.n);var s=this.maxBias;this.bias=b(-Kn(this.errorBias,e)*(i-this.dist)/e,-s,s),this.jnMax=this.maxForce*e},Gn.prototype.applyCachedImpulse=function(e){var t=D(this.n,this.jnAcc*e);zn(this.a,this.b,this.r1,this.r2,t.x,t.y)},Gn.prototype.applyImpulse=function(){var e=this.a,t=this.b,n=this.n,r=Rn(e,t,this.r1,this.r2,n),i=(this.bias-r)*this.nMass,s=this.jnAcc;this.jnAcc=b(s+i,-this.jnMax,this.jnMax),i=this.jnAcc-s,zn(e,t,this.r1,this.r2,n.x*i,n.y*i)},Gn.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var Yn=r.SlideJoint=function(e,t,n,r,i,s){Qn.call(this,e,t),this.anchr1=n,this.anchr2=r,this.min=i,this.max=s,this.r1=this.r2=this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0};Yn.prototype=Object.create(Qn.prototype),Yn.prototype.preStep=function(e){var t=this.a,n=this.b;this.r1=I(this.anchr1,t.rot),this.r2=I(this.anchr2,n.rot);var r=M(O(n.p,this.r2),O(t.p,this.r1)),i=k(r),s=0;i>this.max?(s=i-this.max,this.n=X(r)):i<this.min?(s=this.min-i,this.n=_(X(r))):(this.n=T,this.jnAcc=0),this.nMass=1/Vn(t,n,this.r1,this.r2,this.n);var o=this.maxBias;this.bias=b(-Kn(this.errorBias,e)*s/e,-o,o),this.jnMax=this.maxForce*e},Yn.prototype.applyCachedImpulse=function(e){var t=this.jnAcc*e;zn(this.a,this.b,this.r1,this.r2,this.n.x*t,this.n.y*t)},Yn.prototype.applyImpulse=function(){if(this.n.x===0&&this.n.y===0)return;var e=this.a,t=this.b,n=this.n,r=this.r1,i=this.r2,s=qn(e,t,r,i),o=N(s,n),u=(this.bias-o)*this.nMass,a=this.jnAcc;this.jnAcc=b(a+u,-this.jnMax,0),u=this.jnAcc-a,zn(e,t,this.r1,this.r2,n.x*u,n.y*u)},Yn.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var Zn=r.PivotJoint=function(e,t,n,r){Qn.call(this,e,t);if(typeof r=="undefined"){var i=n;n=e?e.world2Local(i):i,r=t?t.world2Local(i):i}this.anchr1=n,this.anchr2=r,this.r1=this.r2=T,this.k1=new x(0,0),this.k2=new x(0,0),this.jAcc=T,this.jMaxLen=0,this.bias=T};Zn.prototype=Object.create(Qn.prototype),Zn.prototype.preStep=function(e){var t=this.a,n=this.b;this.r1=I(this.anchr1,t.rot),this.r2=I(this.anchr2,n.rot),$n(t,n,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*e;var r=M(O(n.p,this.r2),O(t.p,this.r1));this.bias=V(D(r,-Kn(this.errorBias,e)/e),this.maxBias)},Zn.prototype.applyCachedImpulse=function(e){zn(this.a,this.b,this.r1,this.r2,this.jAcc.x*e,this.jAcc.y*e)},Zn.prototype.applyImpulse=function(){var e=this.a,t=this.b,n=this.r1,r=this.r2,i=qn(e,t,n,r),s=Jn(M(this.bias,i),this.k1,this.k2),o=this.jAcc;this.jAcc=V(O(this.jAcc,s),this.jMaxLen),zn(e,t,this.r1,this.r2,this.jAcc.x-o.x,this.jAcc.y-o.y)},Zn.prototype.getImpulse=function(){return k(this.jAcc)};var er=r.GrooveJoint=function(e,t,n,r,i){Qn.call(this,e,t),this.grv_a=n,this.grv_b=r,this.grv_n=B(W(M(r,n))),this.anchr2=i,this.grv_tn=null,this.clamp=0,this.r1=this.r2=null,this.k1=new x(0,0),this.k2=new x(0,0),this.jAcc=T,this.jMaxLen=0,this.bias=null};er.prototype=Object.create(Qn.prototype),er.prototype.preStep=function(e){var t=this.a,n=this.b,r=t.local2World(this.grv_a),i=t.local2World(this.grv_b),s=I(this.grv_n,t.rot),o=N(r,s);this.grv_tn=s,this.r2=I(this.anchr2,n.rot);var u=P(O(n.p,this.r2),s);u<=P(r,s)?(this.clamp=1,this.r1=M(r,t.p)):u>=P(i,s)?(this.clamp=-1,this.r1=M(i,t.p)):(this.clamp=0,this.r1=M(O(D(B(s),-u),D(s,o)),t.p)),$n(t,n,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*e;var a=M(O(n.p,this.r2),O(t.p,this.r1));this.bias=V(D(a,-Kn(this.errorBias,e)/e),this.maxBias)},er.prototype.applyCachedImpulse=function(e){zn(this.a,this.b,this.r1,this.r2,this.jAcc.x*e,this.jAcc.y*e)},er.prototype.grooveConstrain=function(e){var t=this.grv_tn,n=this.clamp*P(e,t)>0?e:F(e,t);return V(n,this.jMaxLen)},er.prototype.applyImpulse=function(){var e=this.a,t=this.b,n=this.r1,r=this.r2,i=qn(e,t,n,r),s=Jn(M(this.bias,i),this.k1,this.k2),o=this.jAcc;this.jAcc=this.grooveConstrain(O(o,s)),zn(e,t,this.r1,this.r2,this.jAcc.x-o.x,this.jAcc.y-o.y)},er.prototype.getImpulse=function(){return k(this.jAcc)},er.prototype.setGrooveA=function(e){this.grv_a=e,this.grv_n=B(W(M(this.grv_b,e))),this.activateBodies()},er.prototype.setGrooveB=function(e){this.grv_b=e,this.grv_n=B(W(M(e,this.grv_a))),this.activateBodies()};var tr=function(e,t){return(e.restLength-t)*e.stiffness},nr=r.DampedSpring=function(e,t,n,r,i,s,o){Qn.call(this,e,t),this.anchr1=n,this.anchr2=r,this.restLength=i,this.stiffness=s,this.damping=o,this.springForceFunc=tr,this.target_vrn=this.v_coef=0,this.r1=this.r2=null,this.nMass=0,this.n=null};nr.prototype=Object.create(Qn.prototype),nr.prototype.preStep=function(e){var t=this.a,n=this.b;this.r1=I(this.anchr1,t.rot),this.r2=I(this.anchr2,n.rot);var r=M(O(n.p,this.r2),O(t.p,this.r1)),i=k(r);this.n=D(r,1/(i?i:Infinity));var s=Vn(t,n,this.r1,this.r2,this.n);o(s!==0,"Unsolvable this."),this.nMass=1/s,this.target_vrn=0,this.v_coef=1-Math.exp(-this.damping*e*s);var u=this.springForceFunc(this,i);zn(t,n,this.r1,this.r2,this.n.x*u*e,this.n.y*u*e)},nr.prototype.applyCachedImpulse=function(e){},nr.prototype.applyImpulse=function(){var e=this.a,t=this.b,n=this.n,r=this.r1,i=this.r2,s=Rn(e,t,r,i,n),o=(this.target_vrn-s)*this.v_coef;this.target_vrn=s+o,o*=this.nMass,zn(e,t,this.r1,this.r2,this.n.x*o,this.n.y*o)},nr.prototype.getImpulse=function(){return 0};var rr=function(e,t){return(t-e.restAngle)*e.stiffness},ir=r.DampedRotarySpring=function(e,t,n,r,i){Qn.call(this,e,t),this.restAngle=n,this.stiffness=r,this.damping=i,this.springTorqueFunc=rr,this.target_wrn=0,this.w_coef=0,this.iSum=0};ir.prototype=Object.create(Qn.prototype),ir.prototype.preStep=function(e){var t=this.a,n=this.b,r=t.i_inv+n.i_inv;o(r!==0,"Unsolvable spring."),this.iSum=1/r,this.w_coef=1-Math.exp(-this.damping*e*r),this.target_wrn=0;var i=this.springTorqueFunc(this,t.a-n.a)*e;t.w-=i*t.i_inv,n.w+=i*n.i_inv},ir.prototype.applyImpulse=function(){var e=this.a,t=this.b,n=e.w-t.w,r=(this.target_wrn-n)*this.w_coef;this.target_wrn=n+r;var i=r*this.iSum;e.w+=i*e.i_inv,t.w-=i*t.i_inv};var sr=r.RotaryLimitJoint=function(e,t,n,r){Qn.call(this,e,t),this.min=n,this.max=r,this.jAcc=0,this.iSum=this.bias=this.jMax=0};sr.prototype=Object.create(Qn.prototype),sr.prototype.preStep=function(e){var t=this.a,n=this.b,r=n.a-t.a,i=0;r>this.max?i=this.max-r:r<this.min&&(i=this.min-r),this.iSum=1/(1/t.i+1/n.i);var s=this.maxBias;this.bias=b(-Kn(this.errorBias,e)*i/e,-s,s),this.jMax=this.maxForce*e,this.bias||(this.jAcc=0)},sr.prototype.applyCachedImpulse=function(e){var t=this.a,n=this.b,r=this.jAcc*e;t.w-=r*t.i_inv,n.w+=r*n.i_inv},sr.prototype.applyImpulse=function(){if(!this.bias)return;var e=this.a,t=this.b,n=t.w-e.w,r=-(this.bias+n)*this.iSum,i=this.jAcc;this.bias<0?this.jAcc=b(i+r,0,this.jMax):this.jAcc=b(i+r,-this.jMax,0),r=this.jAcc-i,e.w-=r*e.i_inv,t.w+=r*t.i_inv},sr.prototype.getImpulse=function(){return Math.abs(joint.jAcc)};var or=r.RatchetJoint=function(e,t,n,r){Qn.call(this,e,t),this.angle=0,this.phase=n,this.ratchet=r,this.angle=(t?t.a:0)-(e?e.a:0),this.iSum=this.bias=this.jAcc=this.jMax=0};or.prototype=Object.create(Qn.prototype),or.prototype.preStep=function(e){var t=this.a,n=this.b,r=this.angle,i=this.phase,s=this.ratchet,o=n.a-t.a,u=r-o,a=0;u*s>0?a=u:this.angle=Math.floor((o-i)/s)*s+i,this.iSum=1/(t.i_inv+n.i_inv);var f=this.maxBias;this.bias=b(-Kn(this.errorBias,e)*a/e,-f,f),this.jMax=this.maxForce*e,this.bias||(this.jAcc=0)},or.prototype.applyCachedImpulse=function(e){var t=this.a,n=this.b,r=this.jAcc*e;t.w-=r*t.i_inv,n.w+=r*n.i_inv},or.prototype.applyImpulse=function(){if(!this.bias)return;var e=this.a,t=this.b,n=t.w-e.w,r=this.ratchet,i=-(this.bias+n)*this.iSum,s=this.jAcc;this.jAcc=b((s+i)*r,0,this.jMax*Math.abs(r))/r,i=this.jAcc-s,e.w-=i*e.i_inv,t.w+=i*t.i_inv},or.prototype.getImpulse=function(e){return Math.abs(e.jAcc)};var ur=r.GearJoint=function(e,t,n,r){Qn.call(this,e,t),this.phase=n,this.ratio=r,this.ratio_inv=1/r,this.jAcc=0,this.iSum=this.bias=this.jMax=0};ur.prototype=Object.create(Qn.prototype),ur.prototype.preStep=function(e){var t=this.a,n=this.b;this.iSum=1/(t.i_inv*this.ratio_inv+this.ratio*n.i_inv);var r=this.maxBias;this.bias=b(-Kn(this.errorBias,e)*(n.a*this.ratio-t.a-this.phase)/e,-r,r),this.jMax=this.maxForce*e},ur.prototype.applyCachedImpulse=function(e){var t=this.a,n=this.b,r=this.jAcc*e;t.w-=r*t.i_inv*this.ratio_inv,n.w+=r*n.i_inv},ur.prototype.applyImpulse=function(){var e=this.a,t=this.b,n=t.w*this.ratio-e.w,r=(this.bias-n)*this.iSum,i=this.jAcc;this.jAcc=b(i+r,-this.jMax,this.jMax),r=this.jAcc-i,e.w-=r*e.i_inv*this.ratio_inv,t.w+=r*t.i_inv},ur.prototype.getImpulse=function(){return Math.abs(this.jAcc)},ur.prototype.setRatio=function(e){this.ratio=e,this.ratio_inv=1/e,this.activateBodies()};var ar=r.SimpleMotor=function(e,t,n){Qn.call(this,e,t),this.rate=n,this.jAcc=0,this.iSum=this.jMax=0};return ar.prototype=Object.create(Qn.prototype),ar.prototype.preStep=function(e){this.iSum=1/(this.a.i_inv+this.b.i_inv),this.jMax=this.maxForce*e},ar.prototype.applyCachedImpulse=function(e){var t=this.a,n=this.b,r=this.jAcc*e;t.w-=r*t.i_inv,n.w+=r*n.i_inv},ar.prototype.applyImpulse=function(){var e=this.a,t=this.b,n=t.w-e.w+this.rate,r=-n*this.iSum,i=this.jAcc;this.jAcc=b(i+r,-this.jMax,this.jMax),r=this.jAcc-i,e.w-=r*e.i_inv,t.w+=r*t.i_inv},ar.prototype.getImpulse=function(){return Math.abs(this.jAcc)},n.exports}),n("physics/PhysicsSystem",["require","exports","module","../geom/Rectangle","../geom/Circle","../geom/Polygon","../math/Vector","../tilemap/Tile","../utils/inherit","../vendor/cp"],function(e,t,n){var r=e("../geom/Rectangle"),i=e("../geom/Circle"),s=e("../geom/Polygon"),o=e("../math/Vector"),u=e("../tilemap/Tile"),a=e("../utils/inherit"),f=e("../vendor/cp"),l=function(e,t){t=t||{},t.gravity=t.gravity instanceof o?t.gravity:new o(0,9.87),t.sleepTimeThreshold=t.sleepTimeThreshold!==undefined?t.sleepTimeThreshold:.2,t.collisionSlop=t.collisionSlop!==undefined?t.collisionSlop:.1,this.state=e,this.space=new f.Space,this.gravity=this.space.gravity=t.gravity,this.space.sleepTimeThreshold=t.sleepTimeThreshold,this.space.collisionSlop=t.collisionSlop,this.space.addCollisionHandler(l.COLLISION_TYPE.SPRITE,l.COLLISION_TYPE.SPRITE,this.onCollisionBegin.bind(this),null,this.onCollisionPostSolve.bind(this),this.onCollisionEnd.bind(this)),this.space.addCollisionHandler(l.COLLISION_TYPE.SPRITE,l.COLLISION_TYPE.TILE,this.onCollisionBegin.bind(this),null,this.onCollisionPostSolve.bind(this),this.onCollisionEnd.bind(this)),this.actionQueue=[],this.tickCallbacks=[],this._skip=0};return a(l,Object,{pause:function(){return this._paused=!0,this},resume:function(){return this._paused=!1,this},skip:function(e){return this._skip+=e,this},skipNext:function(){return this.skip(1)},nextTick:function(e){return this.tickCallbacks.push(e),this},getCollisionType:function(e){return e instanceof u?l.COLLISION_TYPE.TILE:l.COLLISION_TYPE.SPRITE},add:function(e,t){if(e._phys.active)return;var n=this._createBody(e),r=this._createShape(e,n),i;if(!n.isStatic()){var s=new f.Body(Infinity,Infinity),o=new f.PivotJoint(s,n,f.vzero,f.vzero),u=new f.GearJoint(s,n,0,1);o.maxBias=0,o.maxForce=1e4,u.errorBias=0,u.maxBias=1.2,u.maxForce=5e4,i={},i.body=s,i.pivot=o,i.gear=u}return e._phys.active=!0,this.actionQueue.push(["add",{spr:e,body:n,shape:r,control:i},t]),this.act(),e},remove:function(e,t){if(!e||!e._phys.active)return;return e._phys.active=!1,this.actionQueue.push(["remove",e._phys,t]),this.act(),e},reindex:function(e,t){if(!e||!e._phys.active)return;return e._phys._cb=t,this.actionQueue.push(["reindex",e._phys.shape,t]),this.act(),this},reindexStatic:function(e){return this.actionQueue.push(["reindexStatic",null,e]),this.act(),this},addCustomShape:function(e,t,n,r){if(!e||!e._phys.body)return;var i=this._createShape(e,e._phys.body,t);return i.setSensor(n),i.width=e.width,i.height=e.height,i.sprite=e,i.setElasticity(0),i.setSensor(n!==undefined?n:e.sensor),i.setCollisionType(this.getCollisionType(e)),i.setFriction(e.friction||0),this.actionQueue.push(["addCustomShape",{spr:e,shape:i},r]),this.act(),i},setMass:function(e,t){if(!e||!e._phys.body)return;return e._phys.body.setMass(t),this},setVelocity:function(e,t){if(!e)return;return e._phys.control?e._phys.control.body.setVel(t):e._phys.body.setVel(t),this},setPosition:function(e,t){if(!e)return;return e._phys.body&&e._phys.body.setPos(t),e._phys.control&&e._phys.control.body.setPos(t),this},setRotation:function(e,t){if(!e)return;return e._phys.control?e._phys.control.body.setAngle(t):e._phys.body&&e._phys.body.setAngle(t),this},update:function(e){if(this._paused)return;while(this.tickCallbacks.length)this.tickCallbacks.shift().call(this);if(this._skip)return this._skip--;this.space.step(e),this.space.activeShapes.each(function(e){var t=e.sprite;t.position.x=e.body.p.x,t.position.y=e.body.p.y,t.rotation=e.body.a,t.emit("physUpdate")})},onCollisionBegin:function(e){var t=e.getShapes(),n=t[0].sprite,r=t[1].sprite;if(t[0].sensor||t[1].sensor)n.onCollision(r,e.getNormal(0),t[1],t[0]),r.onCollision(n,e.getNormal(0),t[0],t[1]);return!0},onCollisionPostSolve:function(e){var t=e.getShapes(),n=t[0].sprite,r=t[1].sprite;return e.isFirstContact()&&(n.onCollision(r,e.totalImpulse(),t[1],t[0]),r.onCollision(n,e.totalImpulse(),t[0],t[1])),!0},onCollisionEnd:function(e){var t=e.getShapes(),n=t[0].sprite,r=t[1].sprite;return n.onSeparate(r,t[1],t[0]),r.onSeparate(n,t[0],t[1]),!0},act:function(){if(this.space.locked)this.space.addPostStepCallback(this.onPostStep.bind(this));else{var e=this;setTimeout(function(){e.onPostStep()},1)}},onPostStep:function(){while(this.actionQueue.length){var e=this.actionQueue.shift(),t=e[0],n=e[1],r=e[2];switch(t){case"add":n.body.setPos(n.spr.position),n.body.isStatic()||this.space.addBody(n.body),this.space.addShape(n.shape),n.control&&(n.control.body.setPos(n.spr.position),this.space.addConstraint(n.control.pivot),this.space.addConstraint(n.control.gear)),n.spr._phys.body=n.body,n.spr._phys.shape=n.shape,n.spr._phys.control=n.control;break;case"remove":n.body.space&&this.space.removeBody(n.body),n.shape.space&&this.space.removeShape(n.shape);if(n.customShapes)for(var i=n.customShapes.length-1;i>-1;--i)this.space.removeShape(n.customShapes[i]);n.body=null,n.shape.sprite=null,n.shape=null,n.customShapes=null;break;case"reindex":this.space.reindexShape(n);break;case"reindexStatic":this.space.reindexStatic();break;case"addCustomShape":n.spr._phys.customShapes||(n.spr._phys.customShapes=[]),n.spr._phys.customShapes.push(n.shape),this.space.addShape(n.shape)}r&&r.call(this)}},_createBody:function(e){var t=new f.Body(e.mass||1,e.inertia||f.momentForBox(e.mass||1,e.width,e.height)||Infinity);return e.mass===Infinity&&(t.nodeIdleTime=Infinity),t},_createShape:function(e,t,n){var u,a=n||e.hitArea,l=e.anchor?e.anchor.x:0,c=e.anchor?e.anchor.y:0,h=e.width*l,p=e.height*c;if(a)if(a instanceof r){var d=a.x,v=a.x+a.width,m=a.y-e.height,g=m+a.height;d-=h,v-=h,m+=e.height-p,g+=e.height-p,u=new f.BoxShape2(t,new f.BB(d,m,v,g))}else if(a instanceof i){var y=new o(e.width/2-h+a.x,e.height/2-p+a.y);u=new f.CircleShape(t,a.radius,y)}else if(a instanceof s){var b=[],w=a.points;for(var E=0;E<w.length;++E){var S=w[E];b.push(S.x-h),b.push(S.y-p)}u=new f.PolyShape(t,f.convexHull(b,null,0),f.vzero)}return u||(u=new f.BoxShape2(t,new f.BB(0,-e.height,e.width,0))),u.width=e.width,u.height=e.height,u.sprite=e,u.setElasticity(0),u.setSensor(e.sensor),u.setCollisionType(this.getCollisionType(e)),u.setFriction(e.friction||0),u}}),l.COLLISION_TYPE={SPRITE:0,TILE:1},n.exports=l,n.exports}),n("game/State",["require","exports","module","../audio/AudioManager","../display/Container","./World","../camera/Camera","../physics/PhysicsSystem","../math/math","../utils/inherit"],function(e,t,n){var r=e("../audio/AudioManager"),i=e("../display/Container"),s=e("./World"),o=e("../camera/Camera"),u=e("../physics/PhysicsSystem"),a=e("../math/math"),f=e("../utils/inherit"),l=function(e,t,n){t||(t=a.randomString()),this.name=t,this.game=e,this.audio=new r(e,e.audio),this.world=new s(this),this.physics=new u(this,n),this.camera=new o(this),i.call(this),this.visible=!1,this.addChild(this.world),this.addChild(this.camera),this.camera.resize(e.width,e.height)};return f(l,i,{enable:function(){return this.game.state.enable(this),this},resize:function(e,t){return this.camera.resize(e,t),this.world.resize(e,t),this},update:function(e){return this.game.timings.cameraStart=this.game.clock.now(),this.camera.update(e),this.game.timings.cameraEnd=this.game.clock.now(),this.game.timings.worldStart=this.game.clock.now(),this.world.update(e),this.game.timings.worldEnd=this.game.clock.now(),this.game.timings.physicsStart=this.game.clock.now(),this.physics.update(e),this.game.timings.physicsEnd=this.game.clock.now(),this}}),n.exports=l,n.exports}),n("game/StateManager",["require","exports","module","../utils/inherit","./State"],function(e,t,n){var r=e("../utils/inherit"),i=e("./State"),s=function(e){this.game=e,this.states={},this.active=null,this.count=0,this._createDefault()};return r(s,Object,{_createDefault:function(){return this.add("__default",!0)},add:function(e,t){var n;return typeof e=="string"?n=new i(this.game,e):typeof e=="function"?n=new e(this.game):(n=e,n.game=this.game),this.states[n.name]=n,this.game.stage.addChild(n),t&&this.enable(n),this.count++,n},remove:function(e){return typeof e=="string"&&(e=this.states[e]),e.parent&&e.parent.removeChild(e),delete this.states[e.name],this.count--,this},enable:function(e){return typeof e!="string"&&(e=e.name),this.states[e]&&(this.active&&(this.active.visible=!1),this.active=this.states[e],this.active.visible=!0),this},destroy:function(){this.game=null,this.states=null}}),n.exports=s,n.exports}),n("utils/Cache",["require","exports","module","./inherit","../constants","../display/Texture","../display/BaseTexture","../text/BitmapText","../vendor/pixi"],function(e,t,n){var r=e("./inherit"),i=e("../constants"),s=e("../display/Texture"),o=e("../display/BaseTexture"),u=e("../text/BitmapText"),a=e("../vendor/pixi"),f=function(e){this.game=e,this._canvases={},this._images={},this._sounds={},this._text={},this._tilemaps={},this.addDefaultImage()};return r(f,Object,{addCanvas:function(e){this._canvases[e.key]=e},addSpriteSheet:function(e){var t=e.key;a.BaseTextureCache[t]=new o(e.image),a.TextureCache[t]=new s(a.BaseTextureCache[t]),e.texture=a.TextureCache[t],e.textures=s.fromSpritesheet(e),this._images[t]=e},addTilemap:function(e){var t=e.key,n=e.format,r,u;n===i.FILE_FORMAT.XML?r=e.data.getElementsByTagName("tilesets"):n===i.FILE_FORMAT.JSON&&(r=e.data.tilesets),e.textures={};for(var f=0,l=e.images.length;f<l;++f){n===i.FILE_FORMAT.JSON?u=r[f].name:n===i.FILE_FORMAT.XML&&(u=r[f].attributes.getNamedItem("name").nodeValue);var c=t+"_"+u;a.BaseTextureCache[c]=new o(e.images[f]),a.TextureCache[c]=new s(a.BaseTextureCache[c]),e.textures[u]=a.TextureCache[c]}this._tilemaps[t]=e},addTextureAtlas:function(e){var t=e.key;a.BaseTextureCache[t]=new o(e.image),a.TextureCache[t]=new s(a.BaseTextureCache[t]),e.texture=a.TextureCache[t],e.format===i.ATLAS_FORMAT.JSON_ARRAY||e.format===i.ATLAS_FORMAT.JSON_HASH?e.textures=s.fromJSON(t,e.data,e.texture.baseTexture):e.format===i.ATLAS_FORMAT.STARLING_XML&&(e.textures=s.fromXML(t,e.data,e.texture.baseTexture)),this._images[t]=e},addBitmapFont:function(e){var t=e.key;a.BaseTextureCache[t]=new o(e.image),a.TextureCache[t]=new s(a.BaseTextureCache[t]),e.texture=a.TextureCache[t],e.font=u.parseXML(t,e.data,e.texture),this._images[t]=e},addImage:function(e){var t=e.key;a.BaseTextureCache[t]=new o(e.image),a.TextureCache[t]=new s(a.BaseTextureCache[t]),e.texture=a.TextureCache[t],this._images[t]=e},addAudio:function(e){var t=e.key;e.webAudio||(e.decoded=!0),e.isDecoding=!1,this._sounds[t]=e},updateSound:function(e,t,n){this._sounds[e]&&(this._sounds[e][t]=n)},addText:function(e){this._text[e.key]=e},addDefaultImage:function(){var e="__default",t=new o;t.width=0,t.height=0,t.hasLoaded=!0,a.BaseTextureCache[e]=t,a.TextureCache[e]=new s(t),s.__default=a.TextureCache[e],this._images[e]={texture:a.TextureCache[e]}},getCanvas:function(e){if(this._canvases[e])return this._canvases[e].canvas},getImage:function(e){if(this._images[e])return this._images[e].image},getTexture:function(e){if(this._images[e])return this._images[e].texture},getTextures:function(e){if(this._images[e])return this._images[e].textures},getBitmapFont:function(e){if(this._images[e])return this._images[e].font},getTilemap:function(e){return this._tilemaps[e]},getAudio:function(e){return this._sounds[e]},getAudioData:function(e){if(this._sounds[e])return this._sounds[e].data},getText:function(e){if(this._text[e])return this._text[e].data},removeCanvas:function(e){delete this._canvases[e]},removeImage:function(e){delete this._images[e]},removeSound:function(e){delete this._sounds[e]},removeText:function(e){delete this._text[e]},destroy:function(){this.game=null,this._canvases=null,this._images=null,this._sounds=null,this._text=null,this._tilemaps=null}}),n.exports=f,n.exports}),n("utils/Clock",["require","exports","module","./inherit"],function(e,t,n){var r=e("./inherit"),i=function(){this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1,this.timer=s.performance&&s.performance.now?s.performance:Date};return r(i,Object,{now:function(){return this.timer.now()},start:function(){return this.startTime=this.oldTime=this.now(),this.running=!0,this},stop:function(){return this.getElapsedTime(),this.running=!1,this},reset:function(){return this.elapsedTime=0,this.startTime=this.oldTime=this.now(),this},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.running){var t=this.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}}),n.exports=i,n.exports}),n("utils/SpritePool",["require","exports","module","./inherit","../display/Sprite"],function(e,t,n){var r=e("./inherit"),i=e("../display/Sprite"),s=function(e){this.types={},this.game=e,this.add("_default",i)};return r(s,Object,{add:function(e,t){return this.types[e]=t},has:function(e){return!!this.types[e]},create:function(e,t,n){if(!e||!this.types[e])e="_default";return new this.types[e](t,n)},free:function(){return}}),n.exports=s,n.exports}),n("loader/Loader",["require","exports","module","../utils/utils","../utils/inherit","../utils/support","../utils/EventEmitter","../constants"],function(e,t,n){var r=e("../utils/utils"),i=e("../utils/inherit"),s=e("../utils/support"),o=e("../utils/EventEmitter"),u=e("../constants"),a=function(e){o.call(this),this.game=e,this.keys=[],this.assets={},this.total=0,this.done=0,this.isLoading=!1,this.hasLoaded=!1,this.progress=0,this.crossOrigin="",this.baseUrl=""};return i(a,Object,{hasKey:function(e){return!!this.assets[e]},reset:function(){return this.progress=0,this.total=0,this.done=0,this.hasLoaded=!1,this.isLoading=!1,this.assets={},this.keys.length=0,this},add:function(e,t,n,r){var i={type:e,key:t,url:n,image:null,data:null,error:!1,loaded:!1};if(r!==undefined)for(var s in r)i[s]=r[s];return this.assets[t]=i,this.keys.push(t),this.total++,this},image:function(e,t,n){return(n||!this.hasKey(e))&&this.add("image",e,t),this},text:function(e,t,n){return(n||!this.hasKey(e))&&this.add("text",e,t),this},spritesheet:function(e,t,n,r,i,s){return(s||!this.hasKey(e))&&this.add("spritesheet",e,t,{frameWidth:n,frameHeight:r,numFrames:i}),this},audio:function(e,t,n){return(n||!this.hasKey(e))&&this.add("audio",e,t),this},tilemap:function(e,t,n,r,i){if(i||!this.hasKey(e)){r||(r=u.FILE_FORMAT.JSON);if(typeof n=="string")switch(r){case u.FILE_FORMAT.JSON:n=JSON.parse(n);break;case u.FILE_FORMAT.XML:n=u.utils.parseXML(n);break;case u.FILE_FORMAT.CSV:}this.add("tilemap",e,t,{data:n,format:r})}return this},bitmapFont:function(e,t,n,i,s,o){if(o||!this.hasKey(e)){s||(s=u.FILE_FORMAT.XML);if(typeof i=="string")switch(s){case u.FILE_FORMAT.XML:i=r.parseXML(i);break;case u.FILE_FORMAT.JSON:i=JSON.parse(i)}this.add("bitmapfont",e,t,{dataUrl:n,data:i,format:s})}return this},atlasJSONArray:function(e,t,n,r){return this.atlas(e,t,n,r,u.ATLAS_FORMAT.JSON_ARRAY)},atlasJSONHash:function(e,t,n,r){return this.atlas(e,t,n,r,u.ATLAS_FORMAT.JSON_HASH)},atlasXML:function(e,t,n,r){return this.atlas(e,t,n,r,u.ATLAS_FORMAT.XML_STARLING)},atlas:function(e,t,n,i,s,o){if(o||!this.hasKey(e)){s||(s=u.ATLAS_FORMAT.JSON_ARRAY);if(typeof i=="string")switch(s){case u.ATLAS_FORMAT.XML_STARLING:i=r.parseXML(i);break;case u.ATLAS_FORMAT.JSON_ARRAY:case u.ATLAS_FORMAT.JSON_HASH:i=JSON.parse(i)}this.add("textureatlas",e,t,{dataUrl:n,data:i,format:s})}return this},start:function(){if(this.isLoading)return;this.progress=0,this.hasLoaded=!1,this.isLoading=!0,this.emit("start",this.keys.length);if(this.keys.length>0)while(this.keys.length>0)this.loadFile();else this.progress=100,this.hasLoaded=!0,this.emit("complete");return this},loadFile:function(){var e=this.assets[this.keys.shift()],t=this;switch(e.type){case"image":case"spritesheet":case"textureatlas":case"bitmapfont":e.image=new Image,e.image.name=e.key,e.image.addEventListener("load",this.fileComplete.bind(this,e.key),!1),e.image.addEventListener("error",this.fileError.bind(this,e.key),!1),e.image.crossOrigin=e.crossOrigin!==undefined?e.crossOrigin:this.crossOrigin,e.image.src=this.baseUrl+e.url;break;case"tilemap":r.ajax({url:this.baseUrl+e.url,dataType:this._getFormatAjaxType(e.format),load:function(n){e.data=n,t.fileComplete(e.key)},error:function(n){t.fileError(e.key,n)}});break;case"audio":e.url=this.getAudioUrl(e.url),e.url?s.webAudio?r.ajax({url:this.baseUrl+e.url,dataType:"arraybuffer",load:function(n){e.data=n,t.fileComplete(e.key)},error:function(n){t.fileError(e.key,n)}}):s.htmlAudio&&(e.data=new Audio,e.data.name=e.key,e.data.preload="auto",e.data.src=this.baseUrl+e.url,e.data.addEventListener("error",e._bndError=this.fileError.bind(this,e.key),!1),e.data.addEventListener("canplaythrough",e._bndComplete=this.fileComplete.bind(this,e.key),!1),e.data.load()):this.fileError(e.key,"No supported audio URL could be determined!");break;case"text":r.ajax({url:this.baseUrl+e.url,dataType:"text",load:function(n){e.data=n,t.fileComplete(e.key)},error:function(n){t.fileError(e.key,n)}})}return this},getAudioUrl:function(e){for(var t=0,n=e.length;t<n;++t){var r=e[t],i=r.match(/.+\.([^?]+)(\?|$)/);i=i&&i.length>=2?i[1]:r.match(/data\:audio\/([^?]+);/)[1];if(s.codec[i])return r}},fileError:function(e,t){this.assets[e].loaded=!0,this.assets[e].error=t,this.fileDone(e,t)},fileComplete:function(e){if(!this.assets[e])return r.warn("fileComplete key is invalid!",e);this.assets[e].loaded=!0;var t=this.assets[e],n=!0,i=this;switch(t.type){case"image":this.game.cache.addImage(t);break;case"spritesheet":this.game.cache.addSpriteSheet(t);break;case"tilemap":t.baseUrl=t.url.replace(/[^\/]*$/,""),t.numImages=t.numLoaded=0,t.images=[],t.format===u.FILE_FORMAT.JSON?(n=!1,this._loadJsonTilesets(t)):t.format===u.FILE_FORMAT.XML&&(n=!1,this._loadXmlTilesets(t));break;case"textureatlas":n=!1,this._dataget(t,function(){i.game.cache.addTextureAtlas(t)});break;case"bitmapfont":n=!1,this._dataget(t,function(){i.game.cache.addBitmapFont(t)});break;case"audio":s.webAudio?(t.webAudio=!0,t.decoded=!1):(t.data.removeEventListener("error",t._bndError),t.data.removeEventListener("canplaythrough",t._bndComplete)),this.game.cache.addAudio(t);break;case"text":this.game.cache.addText(t)}n&&this.fileDone(t.key)},fileDone:function(e,t){this.done++,this.progress=Math.round(this.done/this.total*100),this.emit("progress",this.progress),t&&(r.warn('Error loading file "'+e+'", error received:',t),this.emit("error",t,e)),this.progress>=100&&(this.progress=100,this.hasLoaded=!0,this.isLoading=!1,this.emit("complete"))},_getFormatAjaxType:function(e){switch(e){case u.ATLAS_FORMAT.JSON_ARRAY:case u.ATLAS_FORMAT.JSON_HASH:case u.FILE_FORMAT.JSON:return"json";case u.ATLAS_FORMAT.XML_STARLING:case u.FILE_FORMAT.XML:return"xml";case u.FILE_FORMAT.CSV:return"text"}},_dataget:function(e,t){var n=this;e.dataUrl?r.ajax({url:this.baseUrl+e.dataUrl,dataType:this._getFormatAjaxType(e.format),load:function(r){e.data=r,t&&t(),n.fileDone(e.key)},error:function(t){n.fileError(e.key,t)}}):setTimeout(t,1)},_loadJsonTilesets:function(e){var t=e.data,n=e.baseUrl;for(var r=0,i=t.tilesets.length;r<i;++r){var s=t.tilesets[r],o;if(!s.image)continue;e.numImages++,o=new Image,o.addEventListener("load",this._onTilesetLoaded.bind(this,e),!1),o.addEventListener("error",this._onTilesetError.bind(this,e),!1),o.crossOrigin=e.crossOrigin!==undefined?e.crossOrigin:this.crossOrigin,o.src=this.baseUrl+n+s.image,e.images.push(o)}},_loadXmlTilesets:function(e){var t=e.data,n=e.baseUrl,r=t.getElementsByTagName("tileset");for(var i=0,s=r.length;i<s;++i){var o=r[i],u=o.getElementsByTagName("image")[0],a;if(!u)continue;e.numImages++,a=new Image,a.addEventListener("load",this._onTilesetLoaded.bind(this,e),!1),a.addEventListener("error",this._onTilesetError.bind(this,e),!1),a.crossOrigin=e.crossOrigin!==undefined?e.crossOrigin:this.crossOrigin,a.src=this.baseUrl+n+u.attributes.getNamedItem("source").nodeValue,e.images.push(a)}},_onTilesetLoaded:function(e){e.numLoaded++,e.numImages===e.numLoaded&&(this.game.cache.addTilemap(e),this.fileDone(e.key))},_onTilesetError:function(e,t){e.error=t,e.numLoaded++,e.numImages===e.numLoaded&&this.fileDone(e.key,t)}}),n.exports=a,n.exports}),n("input/Input",["require","exports","module","../utils/inherit","../utils/EventEmitter"],function(e,t,n){var r=e("../utils/inherit"),i=e("../utils/EventEmitter"),s=function(e){i.call(this),this.game=e};return r(s,Object,{}),n.exports=s,n.exports}),n("input/Keyboard",["require","exports","module","../utils/inherit","./Input"],function(e,t,n){var r=e("../utils/inherit"),i=e("./Input"),s=function(e){i.call(this,e),this.sequence=[],this.sequenceTimeout=500,this._clearSq=null,e.canvas.addEventListener("keydown",this.onKeyDown.bind(this),!1),e.canvas.addEventListener("keyup",this.onKeyUp.bind(this),!1)};return r(s,i,{onKeyDown:function(e,t){return this.modifyKey(e,t||e.keyCode||e.which,!0)},onKeyUp:function(e,t){return this.modifyKey(e,t||e.keyCode||e.which,!1)},modifyKey:function(e,t,n){this.emit(t,this._getEventData(e,n));if(n){this.sequence.push(t);var r=this.sequence.toString();r!==t.toString()&&this.emit(r,this._getEventData(e,n)),clearTimeout(this._clearSq),this._clearSq=setTimeout(this._clearSequence.bind(this),this.sequenceTimeout)}},_getEventData:function(e,t){return{input:this,originalEvent:e,down:t}},_clearSequence:function(){this.sequence.length=0}}),s.KEY={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,PLUS:61,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,NUMPAD_STAR:106,NUMPAD_PLUS:107,NUMPAD_MINUS:109,NUMPAD_DOT:110,NUMPAD_SLASH:111,F1:112,F2:113,F3:114,F4:115,MINUS:173,TILDE:192},n.exports=s,n.exports}),n("input/gamepad/GamepadButtons",["require","exports","module","../../utils/inherit","../Input"],function(e,t,n){var r=e("../../utils/inherit"),i=e("../Input"),s=function(){i.call(this),this.threshold=.4,this.buttons={};for(var e in s.BUTTON)this.buttons[s.BUTTON[e]]={code:s.BUTTON[e],name:e,down:!1,value:0}};return r(s,i,{pollStatus:function(e){for(var t=0,n=e.buttons.length;t<n;++t){var r=e.buttons[t]>this.threshold,i=this.buttons[t];i.value=e.buttons[t],i.down!==r&&(i.down=r,this.emit(t,i))}}}),s.BUTTON={FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SELECT:8,START:9,LEFT_ANALOGUE_STICK:10,RIGHT_ANALOGUE_STICK:11,PAD_TOP:12,PAD_BOTTOM:13,PAD_LEFT:14,PAD_RIGHT:15,SYSTEM_MENU:16},s.getGpButtonName=function(e){for(var t in s.BUTTON)if(s.BUTTON[t]===e)return t;return""},n.exports=s,n.exports}),n("input/gamepad/GamepadSticks",["require","exports","module","../../utils/inherit","../Input"],function(e,t,n){var r=e("../../utils/inherit"),i=e("../Input"),s=function(){i.call(this),this.threshold=.5,this.axes={};for(var e in s.AXIS)this.axes[s.AXIS[e]]={code:s.AXIS[e],name:e,value:0}};return r(s,i,{pollStatus:function(e){for(var t=0,n=e.axes.length;t<n;++t){var r=e.axes[t],i=this.axes[t];Math.abs(r)>=this.threshold?i.value=r:i.value=0,this.emit(t,i)}}}),s.AXIS={LEFT_ANALOGUE_HOR:0,LEFT_ANALOGUE_VERT:1,RIGHT_ANALOGUE_HOR:2,RIGHT_ANALOGUE_VERT:3},s.getGpAxisName=function(e){for(var t in s.AXIS)if(s.AXIS[t]===e)return t;return""},n.exports=s,n.exports}),n("input/Gamepad",["require","exports","module","../utils/inherit","./Input","./gamepad/GamepadButtons","./gamepad/GamepadSticks"],function(e,t,n){var r=e("../utils/inherit"),i=e("./Input"),o=e("./gamepad/GamepadButtons"),u=e("./gamepad/GamepadSticks"),a=function(){i.call(this),this.ticking=!1,this.pads=[],this.prevTimestamps=[],this.buttons=new o,this.sticks=new u,s.addEventListener("MozGamepadConnected",this.onGamepadConnect.bind(this),!1),s.addEventListener("MozGamepadDisconnected",this.onGamepadDisconnect.bind(this),!1),(!!navigator.webkitGamepads||!!navigator.webkitGetGamepads)&&this.startPolling()};return r(a,i,{onGamepadConnect:function(e){this.pads.push(e.gamepad),this.startPolling()},onGamepadDisconnect:function(e){for(var t=0,n=this.pads.length;t<n;++t)if(this.pads[t].index===e.gamepad.index){this.pads.splice(t,1);break}this.pads.length===0&&this.stopPolling()},startPolling:function(){if(this.ticking)return;this.ticking=!0,this.update()},stopPolling:function(){this.ticking=!1},pollGamepads:function(){var e=navigator.webkitGetGamepads&&navigator.webkitGetGamepads()||navigator.webkitGamepads;if(e){this.pads.length=0;for(var t=0,n=e.length;t<n;++t)e[t]&&this.pads.push(e[t])}},pollStatus:function(){for(var e=0,t=this.pads.length;e<t;++e){var n=this.pads[e];if(n.timestamp&&n.timestamp===this.prevTimestamps[e])continue;this.prevTimestamps[e]=n.timestamp,this.buttons.pollStatus(n),this.sticks.pollStatus(n)}},update:function(){if(!this.ticking)return;this.pollGamepads(),this.pollStatus()}}),n.exports=a,n.exports}),n("input/pointer/Pointer",["require","exports","module","../Input","../../math/Vector","../../utils/Clock","../../utils/inherit"],function(e,t,n){var r=e("../Input"),i=e("../../math/Vector"),s=e("../../utils/Clock"),o=e("../../utils/inherit"),u=function(e,t){r.call(this),this.id=e,this.manager=t,this.game=t.game,this.active=!1,this.mouse=e===1,this.clock=new s,this.button=null,this.type=null,this._holdSent=!1,this.position=new i,this.positionDown=new i};return o(u,r,{down:function(e){this.originalEvent=e,this.timeDown=this.clock.now(),this.timeHold=0,this._holdSent=!1,this.move(e),this.positionDown.copy(this.position),this.button=e.button,this.type=e.pointerType,this.active||(this.active=!0,this.manager.activePointers++)},up:function(e){var t;this.originalEvent=e,this.timeUp=this.clock.now(),this.timeHold=this.timeUp-this.timeDown,this.timeHold>=0&&this.timeHold<=this.manager.clickDelay&&(this.timeUp-this.previousClickTime<=this.manager.doubleClickDelay?t="doubleclick":t="click",this.previousClickTime=this.timeUp),this.mouse||(this.active=!1,this.manager.activePointers--),t&&this.manager.emit(t,this)},move:function(e){this.originalEvent=e,this.button=e.button,this.type=e.pointerType,this.position.set(e.pageX-this.game.offset.x,e.pageY-this.game.offset.y)},leave:function(e){this.move(e)},update:function(){if(!this.active||this._holdSent)return;this.timeHold+=this.clock.now()-this.timeDown,this.timeHold>=this.manager.holdDelay&&(this._holdSent=!0,this.manager.emit("hold",this))},positionWorld:{}}),Object.defineProperty(u.prototype.positionWorld,"x",{get:function(){return this.position.x-this.game.world.position.x}}),Object.defineProperty(u.prototype.positionWorld,"y",{get:function(){return this.position.y-this.game.world.position.y}}),u.TYPE={TOUCH:"touch",PEN:"pen",MOUSE:"mouse"},n.exports=u,n.exports}),n("input/Pointers",["require","exports","module","../utils/inherit","./Input","./pointer/Pointer"],function(e,t,n){var r=e("../utils/inherit"),i=e("./Input"),s=e("./pointer/Pointer"),o=function(e){i.call(this,e),this.pointers={},this.maxPointers=10,this.clickDelay=200,this.doubleClickDelay=300,this.holdDelay=2e3,this.mouse=this.pointers[1]=new s(1,this),this.activePointers=0,e.canvas.addEventListener("pointerdown",this.onPointer.bind(this,"down"),!1),e.canvas.addEventListener("pointerup",this.onPointer.bind(this,"up"),!1),e.canvas.addEventListener("pointermove",this.onPointer.bind(this,"move"),!1),e.canvas.addEventListener("pointerover",this.onPointer.bind(this,"over"),!1),e.canvas.addEventListener("pointerout",this.onPointer.bind(this,"out"),!1),e.canvas.addEventListener("pointercancel",this.onPointer.bind(this,"cancel"),!1),e.canvas.addEventListener("pointerenter",this.onPointer.bind(this,"enter"),!1),e.canvas.addEventListener("pointerleave",this.onPointer.bind(this,"leave"),!1)};return r(o,i,{onPointer:function(e,t){var n=t.pointerId,r=this.pointers[n];if(!r){if(!(this._numPointers<this.maxPointers))return;this.pointers[n]=new s(n,this)}r[e]&&r[e](t),this.emit(e,r)},update:function(e){var t=this.pointers;for(var n=0;n<t.length;++n)t[n]&&t[n].update(e);return this}}),n.exports=o,n.exports}),n("input/InputManager",["require","exports","module","../utils/inherit","./Keyboard","./Gamepad","./Pointers"],function(e,t,n){var r=e("../utils/inherit"),i=e("./Keyboard"),s=e("./Gamepad"),o=e("./Pointers"),u=function(e){this.game=e,this.canvas=e.canvas,this.keyboard=new i(e),this.pointers=new o(e),this.gamepad=new s};return r(u,Object,{update:function(e){this.pointers.update(e),this.gamepad.update(e)}}),n.exports=u,n.exports}),n("game/Game",["require","exports","module","./StateManager","../utils/EventEmitter","../utils/Cache","../utils/Clock","../utils/SpritePool","../loader/Loader","../input/InputManager","../audio/AudioManager","../math/Vector","../utils/utils","../utils/support","../utils/inherit","../vendor/pixi","../constants"],function(e,t,n){var r=e("./StateManager"),i=e("../utils/EventEmitter"),o=e("../utils/Cache"),u=e("../utils/Clock"),a=e("../utils/SpritePool"),f=e("../loader/Loader"),l=e("../input/InputManager"),c=e("../audio/AudioManager"),h=e("../math/Vector"),p=e("../utils/utils"),d=e("../utils/support"),v=e("../utils/inherit"),m=e("../vendor/pixi"),g=e("../constants"),y=function(e,t){i.call(this),t=t||{},t.width=t.width||800,t.height=t.height||600,t.renderer=t.renderer||g.RENDERER.AUTO,t.transparent=t.transparent||!1,t.background=t.background||"#FFF",t.antialias=t.antialias!==undefined?t.antialias:!0,t.canvas=t.canvas||null,this.container=typeof e=="string"?document.getElementById(e):e,this.container||(this.container=document.body),this.width=t.width,this.height=t.height,this.renderMethod=t.renderer,this.transparent=t.transparent,this.background=t.background,this.antialias=t.antialias,this.canvas=t.canvas,this.renderer=this._createRenderer(),this.stage=new m.Stage(this.background),this.clock=new u,this.audio=new c(this),this.load=new f(this),this.cache=new o(this),this.input=new l(this),this.spritepool=new a(this),this.state=new r(this),this.offset=new h,this.timings={};var n=this.canvas;n.getAttribute("tabindex")||n.setAttribute("tabindex","1"),n.focus(),n.addEventListener("click",function(){n.focus()},!1)};return v(y,Object,{_createRenderer:function(){var e=this.renderMethod,t=null;if(!d.webgl&&!d.canvas)throw new Error("Neither WebGL nor Canvas is supported by this browser!");if(e!==g.RENDERER.WEBGL&&e!==g.RENDERER.AUTO||!d.webgl){if(e!==g.RENDERER.CANVAS&&e!==g.RENDERER.AUTO||!d.canvas)throw new Error('Your render method ("'+e+'") is not supported by this browser!');e=g.RENDERER.CANVAS,t=new m.CanvasRenderer(this.width,this.height,this.canvas,this.transparent)}else e=g.RENDERER.WEBGL,t=new m.WebGLRenderer(this.width,this.height,this.canvas,this.transparent,this.antialias);return this.canvas||(this.container.appendChild(t.view),this.canvas=t.view),this.offset=p.getOffset(this.canvas),this.renderMethod=e,t},resize:function(e,t){this.renderer.resize(e,t),this.width=e,this.height=t;for(var n=0,r=this.stage.children.length;n<r;++n){var i=this.stage.children[n];i.resize&&i.resize(e,t)}return this},requestFullscreen:function(){var e=this.renderer.view;return e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),this},render:function(){return this.clock.start(),this._tick(),this},_tick:function(){this.timings.tickStart=this.clock.now(),s.requestAnimFrame(this._tick.bind(this));var e=this.clock.getDelta();this.timings.lastDelta=e,this.timings.inputStart=this.clock.now(),this.input.update(e),this.timings.inputEnd=this.clock.now(),this.timings.stateStart=this.clock.now(),this.state.active.update(e),this.timings.stateEnd=this.clock.now(),this.timings.userFuncsStart=this.clock.now(),this.emit("tick",e),this.timings.userFuncsEnd=this.clock.now(),this.timings.renderStart=this.clock.now(),this.renderer.render(this.stage),this.timings.renderEnd=this.clock.now(),this.timings.tickEnd=this.clock.now()}}),Object.defineProperty(y.prototype,"physics",{get:function(){return this.state.active.physics}}),Object.defineProperty(y.prototype,"camera",{get:function(){return this.state.active.camera}}),Object.defineProperty(y.prototype,"world",{get:function(){return this.state.active.world}}),n.exports=y,n.exports}),n("text/Text",["require","exports","module","../vendor/pixi"],function(e,t,n){var r=e("../vendor/pixi").Text;return n.exports=r,n.exports}),n("plugin",["require","exports","module"],function(e,t,n){var r={patch:function(e,t,n){e.prototype!==undefined&&(e=e.prototype);if(typeof e[t]!="function")throw new TypeError(t+" is not a function in the passed object.");if(typeof n!="function")throw new TypeError("The passed patch function is not a function.");var r=e[t];e[t]=function(e,t){return function(){var e=this._super;this._super=r;var n=t.apply(this,arguments);return this._super=e,n}}(t,n)},register:function(e,t){if(s.gf[t])throw new RangeError('Unable to register plugin: "'+t+'" already exists in the gf namespace, please choose something else!');s.gf[t]=e}};return n.exports=r,n.exports}),n("core.js",["require","exports","module","./constants","./vendor/hand-1.1.2.js","./audio/AudioManager","./audio/AudioPlayer","./camera/Camera","./display/BaseTexture","./display/Container","./display/Graphics","./display/RenderTexture","./display/Sprite","./display/Texture","./display/TilingSprite","./fx/camera/Effect","./fx/camera/Close","./fx/camera/Fade","./fx/camera/Flash","./fx/camera/Scanlines","./fx/camera/Shake","./game/Game","./game/State","./game/StateManager","./game/World","./geom/Circle","./geom/Ellipse","./geom/Polygon","./geom/Rectangle","./gui/GuiItem","./input/Input","./input/InputManager","./input/Keyboard","./input/Gamepad","./input/gamepad/GamepadButtons","./input/gamepad/GamepadSticks","./input/Pointers","./input/pointer/Pointer","./loader/Loader","./math/math","./math/Vector","./particles/ParticleEmitter","./particles/ParticleSystem","./physics/PhysicsSystem","./physics/PhysicsTarget","./text/BitmapText","./text/Text","./tilemap/Tile","./tilemap/Tilelayer","./tilemap/Tilemap","./tilemap/Tileset","./tilemap/ObjectGroup","./utils/utils","./utils/support","./utils/inherit","./utils/Cache","./utils/Clock","./utils/EventEmitter","./utils/ObjectPool","./utils/SpritePool","./utils/ObjectFactory","./plugin","./vendor/pixi"],function(e,t,n){var r=function(e,t,n){e("./vendor/hand-1.1.2.js");var r={AudioManager:e("./audio/AudioManager"),AudioPlayer:e("./audio/AudioPlayer"),Camera:e("./camera/Camera"),BaseTexture:e("./display/BaseTexture"),Container:e("./display/Container"),Graphics:e("./display/Graphics"),RenderTexture:e("./display/RenderTexture"),Sprite:e("./display/Sprite"),Texture:e("./display/Texture"),TilingSprite:e("./display/TilingSprite"),fx:{camera:{Effect:e("./fx/camera/Effect"),Close:e("./fx/camera/Close"),Fade:e("./fx/camera/Fade"),Flash:e("./fx/camera/Flash"),Scanlines:e("./fx/camera/Scanlines"),Shake:e("./fx/camera/Shake")}},Game:e("./game/Game"),State:e("./game/State"),StateManager:e("./game/StateManager"),World:e("./game/World"),Circle:e("./geom/Circle"),Ellipse:e("./geom/Ellipse"),Polygon:e("./geom/Polygon"),Rectangle:e("./geom/Rectangle"),GuiItem:e("./gui/GuiItem"),Input:e("./input/Input"),InputManager:e("./input/InputManager"),Keyboard:e("./input/Keyboard"),Gamepad:e("./input/Gamepad"),GamepadButtons:e("./input/gamepad/GamepadButtons"),GamepadSticks:e("./input/gamepad/GamepadSticks"),Pointers:e("./input/Pointers"),Pointer:e("./input/pointer/Pointer"),Loader:e("./loader/Loader"),math:e("./math/math"),Vector:e("./math/Vector"),ParticleEmitter:e("./particles/ParticleEmitter"),ParticleSystem:e("./particles/ParticleSystem"),PhysicsSystem:e("./physics/PhysicsSystem"),PhysicsTarget:e("./physics/PhysicsTarget"),BitmapText:e("./text/BitmapText"),Text:e("./text/Text"),Tile:e("./tilemap/Tile"),Tilelayer:e("./tilemap/Tilelayer"),Tilemap:e("./tilemap/Tilemap"),Tileset:e("./tilemap/Tileset"),ObjectGroup:e("./tilemap/ObjectGroup"),utils:e("./utils/utils"),support:e("./utils/support"),inherit:e("./utils/inherit"),Cache:e("./utils/Cache"),Clock:e("./utils/Clock"),EventEmitter:e("./utils/EventEmitter"),ObjectPool:e("./utils/ObjectPool"),SpritePool:e("./utils/SpritePool"),ObjectFactory:e("./utils/ObjectFactory"),plugin:e("./plugin"),PIXI:e("./vendor/pixi")};r.PIXI.Point=r.Vector;var i=e("./constants");for(var s in i)r[s]=i[s];return n.exports=r,n.exports}.call(this,e,t,n),i=s.gf;return s.gf=r,r.noConflict=function(){return s.gf=i,r},r}),t("core.js")};t?define("vendor/gf",u):n?module.exports=u():u()})(typeof exports=="object"?global:window),define("game/data/constants",{ENTITY:{PLAYER:"player",ENEMY:"enemy",FRIENDLY:"friendly",NEUTRAL:"neutral",TILE:"tile",COLLECTABLE:"collectable"},WIDTH:256,HEIGHT:224,SCALE:3,TEXT_SCALE:1.5,ATTACK_CONE:.5,USE_CONE:.4,ATTACK_SENSOR_RADIUS:18,THROW_DISTANCE_X:75,THROW_DISTANCE_Y:50,EFFECT_VOLUME:.8,MUSIC_VOLUME:.2,BLOCKED_WAIT_TIME:500,JUMP_TIME:.5,JUMP_DISTANCE:50,INVENTORY_DROP_TIME:.5}),define("game/data/resources",["vendor/gf"],function(e){return{preload:function(t){t.load.atlas("sprite_rog_font","assets/sprites/fonts/retofganon.png","assets/sprites/fonts/retofganon.json",null,e.ATLAS_FORMAT.JSON_HASH)},startup:function(t){t.load.image("image_life","assets/ui/life.png",null,e.ATLAS_FORMAT.JSON_HASH),t.load.atlas("sprite_intro","assets/sprites/misc/intro.png","assets/sprites/misc/intro.json",null,e.ATLAS_FORMAT.JSON_HASH),t.load.atlas("sprite_select","assets/sprites/misc/selectscreen.png","assets/sprites/misc/selectscreen.json",null,e.ATLAS_FORMAT.JSON_HASH),t.load.atlas("sprite_particles","assets/sprites/misc/particles.png","assets/sprites/misc/particles.json",null,e.ATLAS_FORMAT.JSON_HASH),t.load.audio("music_title",["assets/audio/music/title.lite.ogg"]),t.load.audio("music_select",["assets/audio/music/select_screen.lite.ogg"])},common:function(t){t.load.atlas("sprite_link","assets/sprites/entities/link.png","assets/sprites/entities/link.json",null,e.ATLAS_FORMAT.JSON_HASH),t.load.atlas("sprite_misc","assets/sprites/entities/misc.png","assets/sprites/entities/misc.json",null,e.ATLAS_FORMAT.JSON_HASH),t.load.atlas("sprite_enemies","assets/sprites/entities/enemies.png","assets/sprites/entities/enemies.json",null,e.ATLAS_FORMAT.JSON_HASH),t.load.atlas("sprite_smash","assets/sprites/misc/smash.png","assets/sprites/misc/smash.json",null,e.ATLAS_FORMAT.JSON_HASH),t.load.atlas("sprite_worlditems","assets/sprites/misc/overworlditems.png","assets/sprites/misc/overworlditems.json",null,e.ATLAS_FORMAT.JSON_HASH),t.load.atlas("sprite_gui","assets/sprites/ui/gui.png","assets/sprites/ui/gui.json",null,e.ATLAS_FORMAT.JSON_HASH),t.load.atlas("sprite_hud_font","assets/sprites/fonts/hud.png","assets/sprites/fonts/hud.json",null,e.ATLAS_FORMAT.JSON_HASH),t.load.audio("effect_grass_cut",["assets/audio/effects/LTTP_Grass_Cut.lite.ogg"]),t.load.audio("effect_lift",["assets/audio/effects/LTTP_Link_Pickup.lite.ogg"]),t.load.audio("effect_throw",["assets/audio/effects/LTTP_Link_Throw.lite.ogg"]),t.load.audio("effect_smash",["assets/audio/effects/LTTP_Shatter.lite.ogg"]),t.load.audio("effect_sword1",["assets/audio/effects/LTTP_Sword1.lite.ogg"]),t.load.audio("effect_sword2",["assets/audio/effects/LTTP_Sword1.lite.ogg"]),t.load.audio("effect_menu_select",["assets/audio/effects/LTTP_Menu_Select.lite.ogg"]),t.load.audio("effect_menu_select_cursor",["assets/audio/effects/LTTP_Menu_Cursor.lite.ogg"]),t.load.audio("effect_menu_select_erase",["assets/audio/effects/LTTP_Menu_Erase.lite.ogg"]),t.load.audio("effect_error",["assets/audio/effects/LTTP_Error.lite.ogg"]),t.load.audio("effect_lowhp",["assets/audio/effects/LTTP_LowHealth.lite.ogg"]),t.load.audio("effect_pause_close",["assets/audio/effects/LTTP_Pause_Close.lite.ogg"]),t.load.audio("effect_fall",["assets/audio/effects/LTTP_Link_Jump.lite.ogg"]),t.load.audio("effect_chest",["assets/audio/effects/LTTP_Chest.lite.ogg"]),t.load.audio("effect_chest_appear",["assets/audio/effects/LTTP_Chest_Appears.lite.ogg"]),t.load.audio("effect_item",["assets/audio/effects/LTTP_Item.lite.ogg"]),t.load.audio("effect_item_fanfaire",["assets/audio/effects/LTTP_ItemFanfare_Stereo.lite.ogg"]),t.load.audio("effect_rupee1",["assets/audio/effects/LTTP_Rupee1.lite.ogg"]),t.load.audio("effect_rupee2",["assets/audio/effects/LTTP_Rupee2.lite.ogg"])},world_lightworld:function(t){t.load.tilemap("world_lightworld","assets/worlds/lightworld/lightworld.json",null,e.FILE_FORMAT.JSON),t.load.audio("music_lightworld",["assets/audio/music/overworld.lite.ogg"]),t.load.audio("music_village",["assets/audio/music/kakariko_village.lite.ogg"])},world_darkworld:function(t){t.load.tilemap("world_lightworld","assets/worlds/lightworld/lightworld.json",null,e.FILE_FORMAT.JSON),t.load.audio("music_darkworld",["assets/audio/music/dark_world.lite.ogg"])},world_linkshouse:function(t){t.load.tilemap("world_linkshouse","assets/worlds/linkshouse/linkshouse.json",null,e.FILE_FORMAT.JSON),t.load.audio("music_village",["assets/audio/music/kakariko_village.lite.ogg"])},cave_034:function(t){t.load.tilemap("cave_034","assets/worlds/cave_034/cave_034.json",null,e.FILE_FORMAT.JSON)}}}),define("game/states/State",["vendor/gf"],function(e){var t=function(t,n){e.State.call(this,t,n),this.physics.gravity.set(0,0),t.state.add(this)};return e.inherit(t,e.State,{start:function(){return this.game.state.enable(this),this},stop:function(){this.music&&this.music.stop()},destroy:function(){this.game.state.remove(this),this.music&&this.music.stop(),this.camera&&this.camera.destroy(),this.world&&this.world.destroy()}}),t}),define("game/states/Intro",["vendor/gf","game/data/constants","game/states/State"],function(e,t,n){var r=function(r){n.call(this,r,"title");var i={volume:t.EFFECT_VOLUME};this.sounds={intro:this.audio.add("music_title",{volume:t.MUSIC_VOLUME}),sword:this.audio.add("effect_sword1",i),ding:this.audio.add("effect_menu_select",i)};var s=r.cache.getTextures("sprite_intro"),o=r.cache.getTextures("sprite_particles");this.sprites={intro:new e.Sprite,background:new e.Sprite(s["background.png"]),title:new e.Sprite(s["logo.png"]),sword:new e.Sprite(s["sword.png"]),zpart:new e.Sprite(s["zpart.png"]),shine:new e.Sprite(o["swordshine/shine.png"]),sparkle:new e.Sprite([o["sparkle/0.png"],o["sparkle/1.png"],o["sparkle/2.png"],o["sparkle/3.png"],o["sparkle/4.png"],o["sparkle/5.png"]],.25)},this.camera.add.obj(this.sprites.background),this.camera.add.obj(this.sprites.intro),this.camera.add.obj(this.sprites.title),this.camera.add.obj(this.sprites.sparkle),this.camera.add.obj(this.sprites.sword),this.camera.add.obj(this.sprites.shine),this.camera.add.obj(this.sprites.zpart),this.sprites.sparkle.visible=!1,this.sprites.sparkle.anchor.x=this.sprites.sparkle.anchor.y=.5,this.sprites.shine.visible=!1,this._setupIntroSprite(),this._setupTitleSprites(),this.scale.x=this.scale.y=t.SCALE,this.doPlay=!0};return e.inherit(r,n,{start:function(){n.prototype.start.call(this),this.sprites.intro.goto(0,"intro").play();var e=this;setTimeout(function(){e.doPlay&&(e.music=e.sounds.intro.play())},3100),this.sprites.intro.once("complete",function(){setTimeout(function(){e.sparkle()},500),TweenLite.to(e.sprites.title,2.5,{alpha:1,ease:Linear.easeNone,onComplete:function(){e.sprites.zpart.visible=!0,e.sounds.sword.play(function(){e.sounds.ding.play()}),TweenLite.to(e.sprites.sword.position,.2,{y:38,ease:Linear.easeNone,onComplete:function(){e.blink(8,function(){TweenLite.to(e.sprites.intro,1,{alpha:0,ease:Linear.easeNone,onComplete:function(){e.shine(),e.sprites.intro.goto(0).stop().visible=!1}})})}})}})})},stop:function(){this.doPlay=!1,this.sprites.sparkle.stop(),this.sprites.sparkle.visible=!1,n.prototype.stop.call(this)},shine:function(){var e=this.sprites.shine;e.position.x=68,e.position.y=85,e.visible=!0,TweenLite.to(e.position,.25,{y:150,ease:Linear.easeNone,onComplete:function(){e.visible=!1}})},sparkle:function(e){if(!this.doPlay){this.sprites.sparkle.stop(),this.sprites.sparkle.visible=!1;return}e=(e||0)%4;var t=this.sprites.sparkle,n=this;t.visible=!0;switch(e){case 0:t.position.x=55,t.position.y=93;break;case 1:t.position.x=197,t.position.y=128;break;case 2:t.position.x=154,t.position.y=88;break;case 3:t.position.x=113,t.position.y=128}t.goto(0,"_default").play(),t.once("complete",function(){t.visible=!1,setTimeout(function(){n.sparkle(++e)},500)})},blink:function(e,t){if(e===0)return t();e--;var n=this,r=20,i=.9;n.camera.flash(16711680,r,i,function(){n.camera.flash(65280,r,i,function(){n.camera.flash(255,r,i,function(){n.blink(e,t)})})})},_setupIntroSprite:function(){var e=[],t=0,n=this.game.cache.getTextures("sprite_intro");for(t=3;t<278;++t){var r=t.toString();while(r.length<5)r="0"+r;e.push(n["Zelda - A Link to the Past_"+r+".png"])}this.sprites.intro.addAnimation("intro",e,.5)},_setupTitleSprites:function(){this.sprites.title.position.x=49,this.sprites.title.position.y=60,this.sprites.title.alpha=0,this.sprites.sword.position.x=56,this.sprites.sword.position.y=-130,this.sprites.zpart.position.x=53,this.sprites.zpart.position.y=86,this.sprites.zpart.visible=!1}}),r}),define("game/fonts/ReturnOfGanon",["vendor/gf"],function(e){function l(){a=lttp.game.cache.getTextures("sprite_rog_font"),u={":":"colon",";":"semicolon","'":"comma",",":"comma","-":"dash","!":"exclamation",".":"period","?":"question","<":"arrow-left",">":"arrow-right","(":"open-parenthesis",")":"close-parenthesis"},"abcdefghijklmnopqrstuvwxyz".split("").forEach(function(e){u[e]="_"+e}),"gjpqy,<>".split("").forEach(function(e){u[e]={yOffset:6,name:u[e]}}),"acemnorsuvwxz".split("").forEach(function(e){u[e]={yOffset:6,name:u[e]}}),u["'"]={yOffset:-16,name:u["'"]},u[" "]={xAdvance:7,name:" "},u["."]={yOffset:18,name:"period"};for(r=0;r<n.length;++r){s=n.charAt(r),i=s.charCodeAt(0),o=u[s]||s,f=a[(o.name||o)+".png"],i===32&&(f=lttp.game.cache.getTexture("__default"));if(!f)continue;t.chars[i]={kerning:{},texture:f,xAdvance:o.xAdvance||f.frame.width,xOffset:o.xOffset||0,yOffset:o.yOffset||0}}e.PIXI.BitmapText.fonts[t.name]=t}var t={name:"ReturnOfGanon",size:32,lineHeight:32,chars:{}},n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ:;',-!.?<>() ",r,i,s,o,u,a,f,c=function(n,r){a||l(),e.BitmapText.call(this,n||"",t,r)};return e.inherit(c,e.BitmapText),c}),define("game/utility/storage",{save:function(e,t){localStorage.setItem(e,JSON.stringify(t))},load:function(e){var t=localStorage.getItem(e);try{t=JSON.parse(t)}catch(n){}return t},remove:function(e){localStorage.removeItem(e)}}),define("game/utility/saves/Save",["vendor/gf","game/utility/storage"],function(e,t){var n=function(e){this.key=e,this.data={}};return e.inherit(n,Object,{save:function(){t.save(this.key,this.data)},load:function(){return this.data=t.load(this.key)},remove:function(){t.remove(this.key)}}),n}),define("game/utility/saves/LinkSave",["vendor/gf","game/utility/saves/Save"],function(e,t){var n=function(e,n){t.call(this,"link_"+e);var r=lttp.play&&lttp.play.link;r=r||{},this.data.name=n,this.data.slot=e};return e.inherit(n,t,{save:function(e,n,r){e=e||{},this.data.inventory=e.inventory||{},this.data.health=e.health||3,this.data.maxHealth=e.maxHealth||3,this.data.magic=e.magic!==undefined?e.magic:0,this.data.maxMagic=e.maxMagic||10,this.data.equipted=e.equipted||null,this.data.map=n||"world_linkshouse",this.data.position=r||[128,128],t.prototype.save.call(this)},load:function(){return t.prototype.load.call(this)}}),n}),define("game/states/Select",["vendor/gf","game/data/constants","game/states/State","game/fonts/ReturnOfGanon","game/utility/saves/LinkSave"],function(e,t,n,r,i){var s=function(i){n.call(this,i,"mainmenu"),this.music=this.audio.add("music_select"),this.music.loop=!0,this.music.volume=t.MUSIC_VOLUME,this.audio.attach(this.music);var s={volume:t.EFFECT_VOLUME};this.sounds={select:this.audio.add("effect_menu_select",s),cursor:this.audio.add("effect_menu_select_cursor",s),erase:this.audio.add("effect_menu_select_erase",s),error:this.audio.add("effect_error",s),lowhp:this.audio.add("effect_lowhp",s)};var o=i.cache.getTextures("sprite_select");this.sprites={select:new e.Sprite(o["select.png"]),register:new e.Sprite(o["register.png"]),pointer:new e.Sprite(o["pointer.png"]),fairy:new e.Sprite({flap:{frames:[o["fairy1.png"],o["fairy2.png"]],speed:.1,loop:!0}}),link1:new e.Sprite([o["link1.png"],o["link2.png"]]),link2:new e.Sprite([o["link1.png"],o["link2.png"]]),link3:new e.Sprite([o["link1.png"],o["link2.png"]])};for(var u in this.sprites)this.sprites[u].scale.x=this.sprites[u].scale.y=t.SCALE;this.fontpool=new e.ObjectPool(r),this.heartpool=new e.ObjectPool(e.Sprite),this._setupSelect(),this._setupRegister(),this._lastHorzGpValue=0,this._lastVertGpValue=0,this.activate("select"),this.selected=0,this.pnameI=0};return e.inherit(s,n,{start:function(){n.prototype.start.call(this),this.music.play(),this.game.input.keyboard.on(e.Keyboard.KEY.DOWN,this._boundMoveDown=this.onMove.bind(this,"down")),this.game.input.keyboard.on(e.Keyboard.KEY.UP,this._boundMoveUp=this.onMove.bind(this,"up")),this.game.input.keyboard.on(e.Keyboard.KEY.LEFT,this._boundMoveLeft=this.onMove.bind(this,"left")),this.game.input.keyboard.on(e.Keyboard.KEY.RIGHT,this._boundMoveRight=this.onMove.bind(this,"right")),this.game.input.keyboard.on(e.Keyboard.KEY.S,this._boundMoveDownS=this.onMove.bind(this,"down")),this.game.input.keyboard.on(e.Keyboard.KEY.W,this._boundMoveUpW=this.onMove.bind(this,"up")),this.game.input.keyboard.on(e.Keyboard.KEY.A,this._boundMoveLeftA=this.onMove.bind(this,"left")),this.game.input.keyboard.on(e.Keyboard.KEY.D,this._boundMoveRightD=this.onMove.bind(this,"right")),this.game.input.keyboard.on(e.Keyboard.KEY.ENTER,this._boundSelect1=this.onSelect.bind(this)),this.game.input.keyboard.on(e.Keyboard.KEY.SPACE,this._boundSelect2=this.onSelect.bind(this)),this.game.input.gamepad.buttons.on(e.GamepadButtons.BUTTON.PAD_TOP,this._boundGpMoveUp=this.onMove.bind(this,"up")),this.game.input.gamepad.buttons.on(e.GamepadButtons.BUTTON.PAD_BOTTOM,this._boundGpMoveDown=this.onMove.bind(this,"down")),this.game.input.gamepad.buttons.on(e.GamepadButtons.BUTTON.PAD_LEFT,this._boundGpMoveLeft=this.onMove.bind(this,"left")),this.game.input.gamepad.buttons.on(e.GamepadButtons.BUTTON.PAD_RIGHT,this._boundGpMoveRight=this.onMove.bind(this,"right")),this.game.input.gamepad.buttons.on(e.GamepadButtons.BUTTON.FACE_1,this._boundGpSelect1=this.onSelect.bind(this)),this.game.input.gamepad.buttons.on(e.GamepadButtons.BUTTON.FACE_2,this._boundGpSelect2=this.onSelect.bind(this)),this.game.input.gamepad.buttons.on(e.GamepadButtons.BUTTON.START,this._boundGpSelect3=this.onSelect.bind(this)),this.game.input.gamepad.sticks.on(e.GamepadSticks.AXIS.LEFT_ANALOGUE_HOR,this._boundGpMove1=this.onGpMove.bind(this)),this.game.input.gamepad.sticks.on(e.GamepadSticks.AXIS.LEFT_ANALOGUE_VERT,this._boundGpMove2=this.onGpMove.bind(this)),this.game.input.gamepad.sticks.threshold=.35},stop:function(){n.prototype.stop.call(this),this.game.input.keyboard.off(e.Keyboard.KEY.DOWN,this._boundMoveDown),this.game.input.keyboard.off(e.Keyboard.KEY.UP,this._boundMoveUp),this.game.input.keyboard.off(e.Keyboard.KEY.LEFT,this._boundMoveLeft),this.game.input.keyboard.off(e.Keyboard.KEY.RIGHT,this._boundMoveRight),this.game.input.keyboard.off(e.Keyboard.KEY.S,this._boundMoveDownS),this.game.input.keyboard.off(e.Keyboard.KEY.W,this._boundMoveUpW),this.game.input.keyboard.off(e.Keyboard.KEY.A,this._boundMoveLeftA),this.game.input.keyboard.off(e.Keyboard.KEY.D,this._boundMoveRightD),this.game.input.keyboard.off(e.Keyboard.KEY.ENTER,this._boundSelect1),this.game.input.keyboard.off(e.Keyboard.KEY.SPACE,this._boundSelect2),this.game.input.gamepad.buttons.off(e.GamepadButtons.BUTTON.PAD_TOP,this._boundGpMoveDown),this.game.input.gamepad.buttons.off(e.GamepadButtons.BUTTON.PAD_BOTTOM,this._boundGpMoveUp),this.game.input.gamepad.buttons.off(e.GamepadButtons.BUTTON.PAD_LEFT,this._boundGpMoveLeft),this.game.input.gamepad.buttons.off(e.GamepadButtons.BUTTON.PAD_RIGHT,this._boundGpMoveRight),this.game.input.gamepad.buttons.off(e.GamepadButtons.BUTTON.FACE_1,this._boundGpSelect1),this.game.input.gamepad.buttons.off(e.GamepadButtons.BUTTON.FACE_2,this._boundGpSelect2),this.game.input.gamepad.buttons.off(e.GamepadButtons.BUTTON.START,this._boundGpSelect3),this.game.input.gamepad.sticks.off(e.GamepadSticks.AXIS.LEFT_ANALOGUE_HOR,this._boundGpMove1),this.game.input.gamepad.sticks.off(e.GamepadSticks.AXIS.LEFT_ANALOGUE_VERT,this._boundGpMove2)},onMove:function(n,r){if(!r.down)return;if(this.active==="select"){n==="down"?(this.selected++,this.selected%=5):n==="up"&&(this.selected--,this.selected===-1&&(this.selected=4));switch(this.selected){case 0:this.sprites.fairy.position.y=72*t.SCALE;break;case 1:this.sprites.fairy.position.y=103*t.SCALE;break;case 2:this.sprites.fairy.position.y=132*t.SCALE;break;case 3:this.sprites.fairy.position.y=177*t.SCALE;break;case 4:this.sprites.fairy.position.y=192*t.SCALE}this.sounds.cursor.play()}else if(this.active==="register"){switch(n){case"down":this.char.y++;break;case"up":this.char.y--;break;case"left":this.char.x--;break;case"right":this.char.x++}this.char.y=e.math.clamp(this.char.y,0,3),this.char.x=e.math.clamp(this.char.x,0,28),this.line.position.y=261*t.TEXT_SCALE+this.char.y*this.delta.y*t.TEXT_SCALE,this.characters.position.x=-((this.char.x-6)*this.delta.x)}else this.active!=="erase"&&this.active==="copy"},onGpMove:function(t){if(t.code===e.GamepadSticks.AXIS.LEFT_ANALOGUE_HOR){if(t.value>0){if(this._lastHorzGpValue>0)return;this.onMove("right",{down:!0})}else if(t.value<0){if(this._lastHorzGpValue<0)return;this.onMove("left",{down:!0})}this._lastHorzGpValue=t.value}else{if(t.value>0){if(this._lastVertGpValue>0)return;this.onMove("down",{down:!0})}else if(t.value<0){if(this._lastVertGpValue<0)return;this.onMove("up",{down:!0})}this._lastVertGpValue=t.value}},onSelect:function(e){if(!e.down)return;if(this.active==="select"){if(this.selected<=2)this.saves[this.selected].data?this.emit("select",this.saves[this.selected]):this.activate("register");else{if(this.selected===3){this.sounds.error.play();return}if(this.selected===4){this.sounds.error.play();return}}this.sounds.select.play()}else if(this.active==="register"){var n=this.pname.text,r=this.chars[this.char.y][this.char.x];if(r.name==="end"){if(!n.trim())return this.activate("select");var s=new i(this.selected,n.split("").filter(function(e,t){return t%2===0}).join(""));return s.save(),this.sounds.select.play(),this.activate("select")}if(r.name==="left"){this.pnameI=Math.max(0,this.pnameI-1),this.sprites.pointer.position.x=60*t.TEXT_SCALE+this.pnameI*2*this.pname.monospace*t.TEXT_SCALE;return}if(r.name==="right"){this.pnameI=Math.min(n.length/2,this.pnameI+1),this.sprites.pointer.position.x=60*t.TEXT_SCALE+this.pnameI*2*this.pname.monospace*t.TEXT_SCALE;return}if(this.pname.text.length===11){var o=this.pnameI*2;n=n.substr(0,o)+r.text+n.substr(o+1)}else if(this.pnameI<n.length/2){var o=this.pnameI*2;n=n.substr(0,o)+r.text+n.substr(o+1)}else n.length&&(n+=" "),n+=r.text;this.pnameI=(this.pnameI+1)%6,this.pname.text=n,this.sprites.pointer.position.x=60*t.TEXT_SCALE+this.pnameI*2*this.pname.monospace*t.TEXT_SCALE,this.sounds.lowhp.play()}else this.active!=="erase"&&this.active==="copy"},activate:function(e){this.select.visible=!1,this.register.visible=!1,this.line.visible=!1,this[e].visible=!0,e==="register"&&(this.pname.text="",this.pnameI=0,this.sprites.pointer.position.x=60*t.TEXT_SCALE,this.line.visible=!0);if(e==="select"){var n=this.saves=[new i(0),new i(1),new i(2)];for(var r=0;r<n.length;++r){var s=r+1,o=n[r].load(),u=o?o.inventory:null,a=this.sprites["link"+s];this["slot"+s].text=s+"."+(o?o.name:""),u&&(a.visible=!0,u.sword===1&&u.shield===1?a.goto(3):u.shield===1?a.goto(2):u.sword===1?a.goto(1):a.goto(0),this._renderHearts(this["hearts"+s],o.health,o.maxHealth))}}this.active=e},_renderHearts:function(e,t,n){var r=0,i=20,s=16,o=10,u=0,a=0,f=this.game.cache.getTextures("sprite_select");for(a=t;a>0;--a){u++;var l=0,c,h;a<1?(h=f["heart-half.png"],l=2):h=f["heart-full.png"],c=this.heartpool.create(h),c.setTexture(h),c.position.x=r,c.position.y=i+l,c.visible=!0,r/s>=o-1?(r=0,i+=s):r+=s,e.addChild(c)}for(u;u<n;++u){var h=f["heart-empty.png"],c=this.heartpool.create(h);c.setTexture(h),c.position.x=r,c.position.y=i,c.visible=!0,r/s>=o-1?(r=0,i+=s):r+=s,e.addChild(c)}},_setupSelect:function(){this.select=new e.Container,this.select.addChild(this.sprites.select),this.sprites.fairy.position.x=27*t.SCALE,this.sprites.fairy.position.y=72*t.SCALE,this.sprites.fairy.goto(0,"flap").play(),this.select.addChild(this.sprites.fairy),this.sprites.link1.position.x=52*t.SCALE,this.sprites.link1.position.y=68*t.SCALE,this.sprites.link1.visible=!1,this.select.addChild(this.sprites.link1),this.sprites.link2.position.x=52*t.SCALE,this.sprites.link2.position.y=100*t.SCALE,this.sprites.link2.visible=!1,this.select.addChild(this.sprites.link2),this.sprites.link3.position.x=52*t.SCALE,this.sprites.link3.position.y=128*t.SCALE,this.sprites.link3.visible=!1,this.select.addChild(this.sprites.link3),this.hearts1=new e.Container,this.hearts1.position.x=142*t.SCALE,this.hearts1.position.y=63*t.SCALE,this.hearts1.scale.x=this.hearts1.scale.y=t.TEXT_SCALE,this.select.addChild(this.hearts1),this.hearts2=new e.Container,this.hearts2.position.x=142*t.SCALE,this.hearts2.position.y=93*t.SCALE,this.hearts2.scale.x=this.hearts2.scale.y=t.TEXT_SCALE,this.select.addChild(this.hearts2),this.hearts3=new e.Container,this.hearts3.position.x=142*t.SCALE,this.hearts3.position.y=142*t.SCALE,this.hearts3.scale.x=this.hearts3.scale.y=t.TEXT_SCALE,this.select.addChild(this.hearts3);var n=new e.Container,r=this.fontpool.create(),i=this.fontpool.create(),s=this.fontpool.create();n.scale.x=n.scale.y=t.TEXT_SCALE,r.text="PLAYER  SELECT",r.monospace=15,r.position.x=80,r.position.y=49,n.addChild(r),this.slot1=this.fontpool.create(),this.slot1.monospace=15,this.slot1.text="1.",this.slot1.position.x=145,this.slot1.position.y=145,n.addChild(this.slot1),this.slot2=this.fontpool.create(),this.slot2.monospace=15,this.slot2.text="2.",this.slot2.position.x=145,this.slot2.position.y=205,n.addChild(this.slot2),this.slot3=this.fontpool.create(),this.slot3.monospace=15,this.slot3.text="3.",this.slot3.position.x=145,this.slot3.position.y=265,n.addChild(this.slot3),i.text="COPY  PLAYER",i.monospace=15,i.position.x=100,i.position.y=355,n.addChild(i),s.text="ERASE PLAYER",s.monospace=15,s.position.x=100,s.position.y=385,n.addChild(s),this.select.addChild(n),this.camera.add.obj(this.select)},_setupRegister:function(){this.register=new e.Container,this.sprites.pointer.position.x=60*t.TEXT_SCALE,this.sprites.pointer.position.y=176*t.TEXT_SCALE,this.register.addChild(this.sprites.pointer);var n=new e.Container,r=this.fontpool.create(),i=this,s=["ABCDEFGHIJ  abcdefghij  01234","KLMNOPQRST  klmnopqrst  56789","UVWXYZDPC   uvwxyzDPC   EQPP ","     <> =+       <> =+  <> =+"];n.scale.x=n.scale.y=t.TEXT_SCALE,r.text="REGISTER  YOUR  NAME",r.position.x=80,r.position.y=80,n.addChild(r),this.pname=this.fontpool.create(),this.pname.text="",this.pname.monospace=15,this.pname.position.x=62,this.pname.position.y=192,n.addChild(this.pname),this.characters=new e.Container,this.chars=[],this.delta=new e.Vector(32,35),this.char=new e.Vector(6,0);var o=65,u=250,a=o,f=u;for(var l=0;l<s.length;++l){this.chars[l]=[];var c=s[l].split("");for(var h=0;h<c.length;++h){var p=this.fontpool.create();c[h]==="="?(p.text="END",p.name="end"):c[h]==="+"?(p.text=" ",p.name="end"):c[h]==="<"?(p.text="<",p.name="left"):c[h]===">"?(p.text=">",p.name="right"):p.text=c[h],p.position.x=a,p.position.y=f,this.chars[l][h]=p,this.characters.addChild(p),a+=this.delta.x}f+=this.delta.y,a=o}n.addChild(this.characters),this.register.addChild(n);var c=this.line=new e.Graphics;c.lineStyle(2,16777215,1),c.moveTo(0,0),c.lineTo(624,0),c.position.x=72,c.position.y=392,c.visible=!1,this.register.addChild(c),this.register.addChild(this.sprites.register),this.camera.addChild(this.register),this.register.visible=!1}}),s}),define("game/data/items",["vendor/gf"],function(e){return[{name:"sword",icon:"items/sword%d.png",position:[180,160]},{name:"shield",icon:"items/shield%d.png",position:[200,160]},{name:"armor",icon:"items/armor%d.png",position:[220,160]},{name:"boot",icon:"items/boot.png",position:[32,190]},{name:"gloves",icon:"items/gloves%d.png",position:[64,190]},{name:"flippers",icon:"items/flippers.png",position:[96,190]},{name:"pearl",icon:"items/pearl.png",position:[128,190]},{name:"heart",icon:"items/heart%d.png",position:[200,190]},{name:"txtLiftNum",icon:"text/%d.png",position:[67,161]},{name:"txtRun",icon:"text/run.png",position:[81,176]},{name:"txtSwim",icon:"text/swim.png",position:[121,176]},{name:"bow",icon:function(e){return e.inventory.silver_arrows&&e.inventory.arrows?"items/bow_and_silver_arrow.png":e.inventory.arrows?"items/bow_and_arrow.png":"items/bow.png"},_icon:"items/bow.png",position:[32,32],grid:[0,0]},{name:"boomerang",icon:"items/boomerang%d.png",position:[56,32],grid:[1,0]},{name:"hookshot",icon:"items/hookshot.png",position:[80,32],grid:[2,0]},{name:"bombs",icon:"items/bomb.png",position:[104,32],grid:[3,0]},{name:"mushroom",icon:"items/mushroom.png",position:[128,32],grid:[4,0]},{name:"powder",icon:"items/magic_powder.png",position:[128,32],grid:[4,0]},{name:"firerod",icon:"items/firerod.png",position:[32,56],grid:[0,1]},{name:"icerod",icon:"items/icerod.png",position:[56,56],grid:[1,1]},{name:"bombos",icon:"items/bombos.png",position:[80,56],grid:[2,1]},{name:"ether",icon:"items/ether.png",position:[104,56],grid:[3,1]},{name:"quake",icon:"items/quake.png",position:[128,56],grid:[4,1]},{name:"lantern",icon:"items/lantern.png",cost:.5,particle:{path:"fire/fire",ext:".png",type:"fire",num:3,speed:.15,loop:!1,spacing:2,hitArea:new e.Rectangle(0,8,8,8)},position:[32,80],grid:[0,2]},{name:"hammer",icon:"items/hammer.png",position:[56,80],grid:[1,2]},{name:"shovel",icon:"items/shovel.png",position:[80,80],grid:[2,2]},{name:"flute",icon:"items/flute.png",position:[80,80],grid:[2,2]},{name:"net",icon:"items/net.png",position:[104,80],grid:[3,2]},{name:"book",icon:"items/book_of_mudora.png",position:[128,80],grid:[4,2]},{name:"bottle",icon:"items/bottle_empty.png",position:[32,104],grid:[0,3]},{name:"somaria",icon:"items/cane_of_somaria.png",position:[56,104],grid:[1,3]},{name:"byrna",icon:"items/cane_of_byrna.png",position:[80,104],grid:[2,3]},{name:"cape",icon:"items/magic_cape.png",position:[104,104],grid:[3,3]},{name:"mirror",icon:"items/magic_mirror.png",position:[128,104],grid:[4,3]}]}),define("game/entities/Entity",["vendor/gf"],function(e){var t=function(t,n,r){this.locked=!1,this.maxHealth=3,this.health=3,this.moveSpeed=75,this.spritesheet=t,e.Sprite.call(this,t,n,r),this.on("collision",this._collide.bind(this)),this.on("separate",this._separate.bind(this))};return e.inherit(t,e.Sprite,{damage:function(e){this.health-=e,this.health<0&&(this.health=0),this.health||this.emit("die")},heal:function(e){this.health+=e,this.health>this.maxHealth&&(this.health=this.maxHealth)},_addDirectionalFrames:function(e,t,n,r){e.indexOf("%s")===-1&&(e+="_%s"),this._addFrames([e.replace(/%s/g,"left"),e.replace(/%s/g,"right"),e.replace(/%s/g,"down"),e.replace(/%s/g,"up")],t,n,r)},_addFrames:function(e,t,n,r){e instanceof Array||(e=[e]);for(var i=0,s=e.length;i<s;++i){var o=[],u=e[i],a=u.replace(/.+\/|\.png|_%./g,"");u.indexOf("%d")===-1&&(u+="_%d");for(var f=1;f<=t;++f)o.push(this.spritesheet[u.replace(/%d/g,f)+".png"].frames[0]);this.addAnimation(a,o,n,r)}},_collide:function(e,t,n,r){},_separate:function(e,t,n,r){}}),t}),define("game/entities/misc/Smash",["vendor/gf","game/data/constants","game/entities/Entity"],function(e,t,n){var r=function(){n.call(this,lttp.game.cache.getTextures("sprite_smash"),.2),this._addAnimations();var e={volume:t.EFFECT_VOLUME};this.sounds={grass:lttp.play.audio.add("effect_grass_cut",e),smash:lttp.play.audio.add("effect_smash",e)},this.on("complete",this._done.bind(this))};return e.inherit(r,n,{_addAnimations:function(){this._addSlices("pot",0,0,0,7),this._addSlices("grass",0,8,1,5),this._addSlices("grass_pink",1,6,2,3),this._addSlices("rock",2,4,3,1),this._addSlices("grass_white",3,2,3,9),this._addSlices("grass_brown",4,0,4,7),this._addSlices("grass_dark",4,8,5,6)},_addSlices:function(e,t,n,r,i){var s=[];while(t!==r||n!==i)s.push(this.spritesheet["slice_"+t+"_"+n+".png"].frames[0]),n++,n>9&&(t++,n=0);this.addAnimation(e,s)},"goto":function(e,t){return this.sounds&&(typeof t=="string"&&(t.indexOf("grass")!==-1?this.sounds.grass.play():this.sounds.smash.play()),this.animations[t]||(t="pot")),n.prototype.goto.apply(this,arguments)},_done:function(){this.visible=!1}}),r}),define("game/entities/misc/Particle",["vendor/gf","game/data/constants","game/entities/Entity"],function(e,t,n){var r=function(){this.sensor=!0,n.call(this,lttp.game.cache.getTextures("sprite_particles"),.1),this.anchor.x=0,this.anchor.y=1,this.on("complete",this.expire.bind(this))};return e.inherit(r,n,{run:function(e,t){var n=this.cfg=e.particle;this.visible=!0,this.hitArea=n.hitArea||new Rectangle(0,8,8,8);if(!this.animations[e.name]){var r=[];for(var i=0;i<n.num;++i)r.push(this.spritesheet[n.path+(i+1)+n.ext].frames[0]);this.addAnimation(e.name,r,n.speed,n.loop)}this.name=e.name,this.type=n.type,this.goto(0,e.name).play(),this.enablePhysics(t);var s=lttp.play.link,o=s.position,u=n.spacing;switch(lttp.play.link.lastDir){case"up":this.setPosition(o.x+s.width/2-this.width/2,o.y-u-s.height);break;case"down":this.setPosition(o.x+s.width/2-this.width/2,o.y+u+this.height);break;case"left":this.setPosition(o.x-u-this.width,o.y-3);break;case"right":this.setPosition(o.x+u+s.width,o.y-3)}if(n.velocity){this.velocity=n.velocity.clone(),this.setVelocity(this.velocity);if(n.velocityTimer){var a;n.velocityReverse?a=this.reverse:a=this.expire,this.velto=setTimeout(a.bind(this),n.velocityTimer)}}},expire:function(){clearTimeout(this.velto),this.stop(),this.visible=!1,this.disablePhysics()},reverse:function(){clearTimeout(this.velto),this.velocity.x=-this.velocity.x,this.velocity.y=-this.velocity.y,this.setVelocity(this.velocity)},_collide:function(e,n,r,i){this.type==="fire"&&e.lite&&e.lite();if(this.name==="firerod")e.type===t.ENTITY.TILE&&this.expire();else if(this.name==="boomerang")switch(e.type){case t.ENTITY.TILE:this.reverse();break;case t.ENTITY.PLAYER:this.expire()}}}),r}),define("game/entities/items/WorldItem",["vendor/gf","game/data/constants","game/entities/Entity"],function(e,t,n){var r=function(){this.sensor=!0,this.loot=!0;var e={volume:t.EFFECT_VOLUME};this.sounds={item:lttp.play.audio.add("effect_item",e),rupees1:lttp.play.audio.add("effect_rupee1",e),rupees2:lttp.play.audio.add("effect_rupee2",e)},this.textureKeys={heart:"hearts/heart.png",bombs:"inventory/bombs_%d.png",arrows:"inventory/arrows_%d.png",magic:"magic/magic_%d.png",rupees:"rupees_%d"};var r=lttp.game.cache.getTextures("sprite_worlditems");n.call(this,[r["hearts/heart.png"]]);var i=this;[1,5,20].forEach(function(e){i.addAnimation("rupees_"+e,[r["inventory/rupees_"+e+"_1.png"],r["inventory/rupees_"+e+"_2.png"],r["inventory/rupees_"+e+"_3.png"]],.1,!0)})};return e.inherit(r,n,{setup:function(t,n,r){var i=r||t.properties.loot,s=i.split("_")[0],o=parseInt(i.split("_")[1],10)||1,u=this.textureKeys[s]||"items/"+i+".png";o&&(u=u.replace("%d",o)),this.type=s,this.value=o,s==="rupees"?this.goto(0,u).play(u):(this.stop(),this.setTexture(lttp.game.cache.getTextures("sprite_worlditems")[u])),this.anchor.x=0,this.anchor.y=1,this.position.x=t.position.x,this.position.y=t.position.y,this.hitArea=new e.Rectangle(4,4,8,8),this.visible=!0,n&&this.enablePhysics(n)},pickup:function(){this.visible=!1,this.disablePhysics();if(this.type==="rupees"){this.sounds.rupees1.play();var e=this;setTimeout(function(){e.sounds.rupees2.play()},100)}else this.sounds.item.play()}}),r}),define("game/entities/Link",["vendor/gf","game/data/constants","game/data/items","game/entities/Entity","game/entities/misc/Smash","game/entities/misc/Particle","game/entities/items/WorldItem"],function(e,t,n,r,i,s,o){var u=function(n){r.call(this,n),this.type=t.ENTITY.PLAYER,this.name="link",this.maxMagic=10,this.magic=0,this.inventory={armor:0,arrows:0,keys:0,big_key:0,bombs:0,bombos:0,mudora:0,boomerang:0,boot:0,bow:0,byrna:0,somaria:0,crystals:0,ether:0,firerod:0,flippers:0,flute:0,gloves:0,hammer:0,heart_pieces:0,hookshot:0,icerod:0,lantern:0,cape:0,mirror:0,powder:0,mushroom:0,net:0,pearl:0,pendants:0,quake:0,rupees:0,shield:0,shovel:0,sword:0},this.inAttackRange=[],this.colliding=[],this.smashpool=new e.ObjectPool(i),this.itempool=new e.ObjectPool(o),this.particlepool=new e.ObjectPool(s),this.moveSpeed=87,this.movement=new e.Vector,this.actions={move:{},attack:!1,holdAttack:!1};var u={volume:t.EFFECT_VOLUME};this.sounds={lift:lttp.play.audio.add("effect_lift",u),"throw":lttp.play.audio.add("effect_throw",u),openChest:lttp.play.audio.add("effect_chest",u),itemFanfaire:lttp.play.audio.add("effect_item_fanfaire",u),error:lttp.play.audio.add("effect_error",u),fall:lttp.play.audio.add("effect_fall",u)},this.addAnimations(),this.anchor.x=this.anchor.y=.5,this.on("physUpdate",this._physUpdate.bind(this)),this.equipted=null};return e.inherit(u,r,{updateTransform:function(){r.prototype.updateTransform.call(this)},_addDirectionalPrefixedFrames:function(e,t,n,r){this._addDirectionalFrames(e+"_%s/"+e+"_%s",t,n,r)},addAnimations:function(){this._addDirectionalPrefixedFrames("walk",8,.4,!0),this.addAnimation("idle_shield_left",[this.spritesheet["walk_shield_left/walk_shield_left_1.png"].frames[0]]),this.addAnimation("idle_shield_right",[this.spritesheet["walk_shield_right/walk_shield_right_1.png"].frames[0]]),this.addAnimation("idle_shield_down",[this.spritesheet["walk_shield_down/walk_shield_down_1.png"].frames[0]]),this.addAnimation("idle_shield_up",[this.spritesheet["walk_shield_up/walk_shield_up_1.png"].frames[0]]),this.addAnimation("idle_left",[this.spritesheet["walk_left/walk_left_1.png"].frames[0]]),this.addAnimation("idle_right",[this.spritesheet["walk_right/walk_right_1.png"].frames[0]]),this.addAnimation("idle_down",[this.spritesheet["walk_down/walk_down_1.png"].frames[0]]),this.addAnimation("idle_up",[this.spritesheet["walk_up/walk_up_1.png"].frames[0]]),this.addAnimation("lift_idle_left",[this.spritesheet["lift_walk_left/lift_walk_left_1.png"].frames[0]]),this.addAnimation("lift_idle_right",[this.spritesheet["lift_walk_right/lift_walk_right_1.png"].frames[0]]),this.addAnimation("lift_idle_down",[this.spritesheet["lift_walk_down/lift_walk_down_1.png"].frames[0]]),this.addAnimation("lift_idle_up",[this.spritesheet["lift_walk_up/lift_walk_up_1.png"].frames[0]]),this._addDirectionalPrefixedFrames("attack",9,.6),this._addDirectionalPrefixedFrames("attack_bow",3,.4),this._addDirectionalPrefixedFrames("attack_spin",12,.4),this._addDirectionalPrefixedFrames("attack_tap",3,.4),this._addFrames("fall_in_hole/fall_in_hole",4,.05),this._addDirectionalPrefixedFrames("lift",4,.2),this.addAnimation("lift_walk_left",[this.spritesheet["lift_walk_left/lift_walk_left_1.png"].frames[0],this.spritesheet["lift_walk_left/lift_walk_left_2.png"].frames[0],this.spritesheet["lift_walk_left/lift_walk_left_3.png"].frames[0],this.spritesheet["lift_walk_left/lift_walk_left_2.png"].frames[0]],.2,!0),this.addAnimation("lift_walk_right",[this.spritesheet["lift_walk_right/lift_walk_right_1.png"].frames[0],this.spritesheet["lift_walk_right/lift_walk_right_2.png"].frames[0],this.spritesheet["lift_walk_right/lift_walk_right_3.png"].frames[0],this.spritesheet["lift_walk_right/lift_walk_right_2.png"].frames[0]],.2,!0),this._addFrames(["lift_walk_down/lift_walk_down","lift_walk_up/lift_walk_up"],6,.25,!0),this._addDirectionalPrefixedFrames("push",5,.1,!0),this._addFrames(["walk_attack_left/walk_attack_left","walk_attack_right/walk_attack_right"],3,.4,!0),this._addFrames(["walk_attack_down/walk_attack_down","walk_attack_up/walk_attack_up"],6,.4,!0),this._addDirectionalPrefixedFrames("walk_shield",8,.4,!0),this.lastDir="down",this._setMoveAnimation()},onWalk:function(e,t){t.originalEvent&&t.originalEvent.preventDefault();if(t.down){if(this.actions.move[e])return;this.actions.move[e]=!0}else this.actions.move[e]=!1;this._checkMovement()},onGpWalk:function(t){if(t.code===e.GamepadSticks.AXIS.LEFT_ANALOGUE_HOR){if(t.value===0){if(!this._lastHorzGpValue)return;this.actions.move.left=!1,this.actions.move.right=!1}else if(t.value>0){if(this.actions.move.right)return;this.actions.move.right=!0}else{if(this.actions.move.left)return;this.actions.move.left=!0}this._lastHorzGpValue=t.value}else{if(t.value===0){if(!this._lastVertGpValue)return;this.actions.move.down=!1,this.actions.move.up=!1}else if(t.value>0){if(this.actions.move.down)return;this.actions.move.down=!0}else{if(this.actions.move.up)return;this.actions.move.up=!0}this._lastVertGpValue=t.value}this._checkMovement()},onAttack:function(e){if(!this.inventory.sword||this.carrying)return;e.originalEvent&&e.originalEvent.preventDefault();if(e.down){if(this.locked||this.actions.holdAttack)return;this.lock(),this.actions.attack=!0,this.actions.holdAttack=!0,this._setAttackAnimation(),this._checkAttack()}else this.actions.holdAttack=!1},lock:function(){this.setVelocity(new e.Vector),this.locked=!0},unlock:function(){this._setMoveAnimation(),this.setVelocity(this.movement),this.locked=!1},addAttackSensor:function(n){if(this.atkSensor)return;this.atkSensor=n.addCustomShape(this,new e.Circle(0,0,t.ATTACK_SENSOR_RADIUS),!0)},onUse:function(e){if(!e.down||this.locked)return;if(this.carrying)return this.throwItem();for(var n=0;n<this.colliding.length;++n){var r=this.colliding[n],i;if(!r.properties)continue;i=r.properties.type;if(!i)continue;if(this._inCone(r,t.USE_CONE)){switch(i){case"chest":this.lastDir==="up"&&this.openChest(r);break;case"sign":this.lastDir==="up"?this.readSign(r):this.liftItem(r);break;case"rock":this.inventory.gloves&&this.liftItem(r);break;case"grass":case"grass_brown":case"pot":this.liftItem(r)}break}}},onUseItem:function(e){if(e.down)return;var t=this._findItem(this.equipted),n;if(!t||this.magic<t.cost){this.sounds.error.play();return}this.magic-=t.cost,n=this.particlepool.create(),this.parent.addChild(n),n.run(t,this._phys.system),this.emit("updateHud")},_findItem:function(e){for(var t=0;t<n.length;++t)if(n[t].name===e)return n[t]},dropLoot:function(e){if(!e.properties.loot)return;var t=this.itempool.create();t.setup(e,this._phys.system),this.parent.addChild(t),this._markEmpty(e)},collectLoot:function(e){switch(e.type){case"heart":this.heal(1);break;case"magic":this.magic+=e.value,this.magic>this.maxMagic&&(this.magic=this.maxMagic);break;case"arrows":case"bombs":case"rupees":this.inventory[e.type]+=e.value}e.pickup(),this.itempool.free(e),this.emit("updateHud")},openChest:function(e){if(!e.properties.loot)return;var t=e.properties.loot.split(","),n=0;while(n<t.length-1&&this.inventory[t[n]])++n;t=t[n],this.lock(),this.goto(0,"lift_walk_down").stop(),e.setTexture(lttp.game.cache.getTextures("sprite_worlditems")["dungeon/chest_open.png"]),this.sounds.openChest.play();var r=this.itempool.create();this.parent.addChild(r),r.setup(e,null,t),r.position.y-=5;var i=this;setTimeout(function(){i.sounds.itemFanfaire.play()},100),TweenLite.to(r.position,1.5,{y:"-=5",ease:Linear.easenone,onComplete:function(){i.unlock(),i.itempool.free(r),r.pickup(),i.inventory[r.type]+=r.value,i.emit("updateHud")}}),this._markEmpty(e)},readSign:function(e){this.emit("readSign",e)},liftItem:function(e){this.lock(),e.disablePhysics(),e.sensor=!0,e.enablePhysics();var t=this.colliding.indexOf(e);t!==-1&&this.colliding.splice(t,1),e.properties.loot&&this.dropLoot(e),e.parent.removeChild(e),this.parent.addChild(e);var n="dungeon/"+e.properties.type+(e.properties.heavy?"_heavy":"")+".png";e.setTexture(lttp.game.cache.getTextures("sprite_worlditems")[n]),this.goto(0,"lift_"+this.lastDir).play(),this.sounds.lift.play();var r=this;TweenLite.to(e.position,.15,{x:r.position.x,y:r.position.y-r.height+5,ease:Linear.easeNone,onComplete:function(){r.carrying=e,r.unlock()}})},throwItem:function(){var e=this.carrying,n=this._getDirVector(),r=n.y===-1?0:1,i=this;this.carrying=null,this.sounds.throw.play(),TweenLite.to(e.position,.25,{x:"+="+t.THROW_DISTANCE_X*n.x,y:"+="+(t.THROW_DISTANCE_Y*n.y+r*this.height),ease:Linear.easeNone,onCompleteParams:[e],onComplete:function(e){i._destroyObject(e)}}),this._setMoveAnimation()},_markEmpty:function(e){e.parent&&(e.parent.objects[e._objIndex].properties.loot=null),e.properties.loot=null},_destroyObject:function(e){var t=e.properties.type,n=this.smashpool.create();n.goto(0,t).play(),n.visible=!0,n.anchor.x=e.anchor.x,n.anchor.y=e.anchor.y,n.setPosition(e.position.x,e.position.y),e.parent.addChild(n),e.destroy()},_physUpdate:function(){this.carrying&&this.carrying.setPosition(this.position.x,this.position.y-this.height+5)},_checkAttack:function(){for(var e=this.inAttackRange.length-1;e>-1;--e){var n=this.inAttackRange[e],r=n.type;if(r.match(/grass|grass_brown/)===null)continue;this._inCone(n,t.ATTACK_CONE)&&(n.takeDamage?n.takeDamage(this.damage):r.match(/grass|grass_brown/)===null&&this._destroyObject(n))}},_inCone:function(t,n){var r=new e.Vector(t.position.x-this.position.x,t.position.y-this.position.y);r.normalize();switch(this.lastDir){case"left":return r.x<0&&r.y>-n&&r.y<n;case"right":return r.x>0&&r.y>-n&&r.y<n;case"up":return r.y<0&&r.x>-n&&r.x<n;case"down":return r.y>0&&r.x>-n&&r.x<n}},_getDirVector:function(){switch(this.lastDir){case"left":return new e.Vector(-1,0);case"right":return new e.Vector(1,0);case"up":return new e.Vector(0,-1);case"down":return new e.Vector(0,1)}},_checkMovement:function(){this.actions.move.left&&this.actions.move.right?this.movement.x=0:this.actions.move.left?this.movement.x=-this.moveSpeed:this.actions.move.right?this.movement.x=this.moveSpeed:this.movement.x=0,this.actions.move.up&&this.actions.move.down?this.movement.y=0:this.actions.move.up?this.movement.y=-this.moveSpeed:this.actions.move.down?this.movement.y=this.moveSpeed:this.movement.y=0;if(this.locked)return;this._setMoveAnimation(),this.setVelocity(this.movement)},_setMoveAnimation:function(e){var t=e||(this.movement.x||this.movement.y?"walk":"idle");this.carrying?this._setMoveDirAnimation("lift_"+t):this.inventory.shield?this._setMoveDirAnimation(t+"_shield"):this._setMoveDirAnimation(t)},_setMoveDirAnimation:function(e){this.movement.x?this.movement.x>0?(this.lastDir="right",this.goto(0,e+"_right").play()):(this.lastDir="left",this.goto(0,e+"_left").play()):this.movement.y?this.movement.y>0?(this.lastDir="down",this.goto(0,e+"_down").play()):(this.lastDir="up",this.goto(0,e+"_up").play()):this.goto(0,e+"_"+this.lastDir).stop()},_setAttackAnimation:function(){this._attackAnchorMap||(this._attackAnchorMap={up:{0:[0,1],1:[-0.05,1],2:[.05,1],3:[0,1],6:[.2,1],7:[.3,1],8:[.4,1]},down:{0:[.2,1],2:[.2,.95],3:[.2,.79],4:[.1,.75],5:[.1,.75],6:[.1,.75],7:[.1,.75],8:[.1,.8],9:[.1,.75]},right:{0:[0,1],7:[0,.75],8:[0,.7]},left:{0:[.5,1],7:[.5,.8]}});var e=this.anchor.x,t=this.anchor.y,n=this.lastDir,r=this._attackAnchorMap[n],i=this,s=function(e,t){r&&r[t]&&(i.anchor.x=r[t][0],i.anchor.y=r[t][1])};this.on("frame",s),this.once("complete",function(){i.anchor.x=e,i.anchor.y=t,i.actions.attack=!1,i.off("frame",s),i.unlock()}),this.goto(0,"attack_"+n).play()},jumpDown:function(e){this.lock(),this.stop(),this._phys.system.pause(),e.normalize();var n=2,r=e.x?"x":"y",i=(t.JUMP_DISTANCE+n)*-e[r],s=this;setTimeout(function(){s.sounds.fall.play()},t.JUMP_TIME/4);if(e.y<0){var o={ease:Linear.easeNone,onUpdate:function(){s.setPosition(s.position.x,s.position.y)},onComplete:this._doJumpDown.bind(this,r,i)};o[r]=this.position[r]-n,TweenLite.to(this.position,t.JUMP_TIME/4,o)}else this._doJumpDown(r,i)},_doJumpDown:function(e,n){var r=this,i={ease:Linear.easeNone,onUpdate:function(){r.setPosition(r.position.x,r.position.y)},onComplete:function(){r.unlock(),r._phys.system.resume()}};i[e]=n,TweenLite.to(this.position,t.JUMP_TIME/4*3,i)},_collide:function(t,n,r,i){i===this.atkSensor?t.type&&(this.inAttackRange.push(t),this.actions.attack&&this._checkAttack()):t.type==="zone"?this.emit("zone",t,n):t.type==="exit"?this.emit("exit",t,n):t.sensor?t.loot&&this.collectLoot(t):(t.__colVec=new e.Vector(n.x,n.y),this.colliding.push(t))},_separate:function(e,t,n){if(n===this.atkSensor){var r=this.inAttackRange.indexOf(e);r>=0&&this.inAttackRange.splice(r,1)}else if(!e.sensor){var r=this.colliding.indexOf(e);r>=0&&this.colliding.splice(r,1)}}}),u}),define("game/fonts/Hud",["vendor/gf"],function(e){function a(){o=lttp.game.cache.getTextures("sprite_hud_font");for(r=0;r<n.length;++r){s=n.charAt(r),i=s.charCodeAt(0),u=o[s+".png"];if(!u)continue;t.chars[i]={kerning:{},texture:u,xAdvance:u.frame.width,xOffset:0,yOffset:0}}e.PIXI.BitmapText.fonts[t.name]=t}var t={name:"HudFont",size:16,lineHeight:16,chars:{}},n="0123456789",r,i,s,o,u,f=function(n){o||a(),e.BitmapText.call(this,n||"",t)};return e.inherit(f,e.BitmapText),f}),define("game/gui/huditems",["vendor/gf","game/data/constants","game/fonts/ReturnOfGanon","game/fonts/Hud"],function(e,t,n,r){var i=function(t,n,r){this.name=n,this.value=0,e.Container.call(this),this.position.x=t[0],this.position.y=t[1],this.sprites=new e.ObjectPool(e.Sprite,this)};e.inherit(i,e.Container,{set:function(e){return this.value=e,this}});var s=function(e,t){this.textures=lttp.game.cache.getTextures("sprite_gui"),i.call(this,e,"magic",t),this.sprites.create(this.textures["hud/magic_meter.png"]),this.sprValue=this.sprites.create(this.textures["hud/magic_meter_value.png"]),this.maxHeight=this.sprValue.height,this.sprValue.position.x=6,this.set(t)};e.inherit(s,i,{set:function(e){return i.prototype.set.call(this,e),this.sprValue.height=this.maxHeight*e,this.sprValue.position.y=this.maxHeight-this.sprValue.height+8*this.sprValue.scale.y,this}});var o=function(e,t){this.textures=lttp.game.cache.getTextures("sprite_gui"),i.call(this,e,"life",t),this.max=3,this.dash1=this.sprites.create(this.textures["hud/life-dash.png"]),this.dash1.position.x=this.dash1X=35,this.dash1.position.y=this.dashY=0,this.life=this.sprites.create(lttp.game.cache.getTexture("image_life")),this.life.position.x=this.lifeX=65,this.life.position.y=this.lifeY=-7,this.dash2=this.sprites.create(this.textures["hud/life-dash.png"]),this.dash2.position.x=this.dash2X=100,this.dash1.position.y=this.dashY=0,this.set(t)};e.inherit(o,i,{set:function(t){i.prototype.set.call(this,t);for(var n=0,r=this.children.length;n<r;++n){var s=this.children[n];s instanceof e.Sprite&&(s.visible=!1,this.sprites.free(s))}this.dash1=this.sprites.create(this.textures["hud/life-dash.png"]),this.dash1.setTexture(this.textures["hud/life-dash.png"]),this.dash1.position.x=this.dash1X,this.dash1.position.y=this.dashY,this.dash1.visible=!0,this.dash2=this.sprites.create(this.textures["hud/life-dash.png"]),this.dash2.setTexture(this.textures["hud/life-dash.png"]),this.dash2.position.x=this.dash2X,this.dash2.position.y=this.dashY,this.dash2.visible=!0,this.life=this.sprites.create(lttp.game.cache.getTexture("image_life")),this.life.setTexture(lttp.game.cache.getTexture("image_life")),this.life.position.x=this.lifeX,this.life.position.y=this.lifeY,this.life.visible=!0;var o=0,u=20,a=16,f=10,l=0;for(var c=t;c>0;--c){l++;var h=0,p,d;c<1?(d=this.textures["hud/heart-half.png"],h=2):d=this.textures["hud/heart-full.png"],p=this.sprites.create(d),p.setTexture(d),p.position.x=o,p.position.y=u+h,p.visible=!0,o/a>=f-1?(o=0,u+=a):o+=a}for(l;l<this.max;++l){var d=this.textures["hud/heart-empty.png"],p=this.sprites.create(d);p.setTexture(d),p.position.x=o,p.position.y=u,p.visible=!0,o/a>=f-1?(o=0,u+=a):o+=a}return this.dirty=!1,this}});var u=function(e,t){this.textures=lttp.game.cache.getTextures("sprite_gui"),i.call(this,e,"equipted",t),this.sprites.create(this.textures["hud/item-frame.png"]),this.sprites.create(this.textures["items/lantern.png"]),this.children[1].visible=!1,this.children[1].position.x=this.children[1].position.y=6,this.children[1].scale.x=this.children[1].scale.y=2};e.inherit(u,i,{set:function(e){i.prototype.set.call(this,e);var t=this.textures["items/"+e+".png"];return t?(this.children[1].setTexture(t),this.children[1].visible=!0):this.children[1].visible=!1,this}});var a=function(e,t,n){this.textures=lttp.game.cache.getTextures("sprite_gui"),i.call(this,e,t,n),this.icon=this.sprites.create(this.textures["hud/indicator-"+this.name+".png"]),t==="rupees"?this.icon.position.x+=13:t==="bombs"&&(this.icon.position.x+=5),this.font=new r,this.addChild(this.font),this.font.position.y=30,this.set(n)};return e.inherit(a,i,{set:function(e){var t=this.name==="rupees"?3:2;e=e.toString();while(e.length<t)e="0"+e;return i.prototype.set.call(this,e),this.font&&(this.font.text=e),this}}),{MagicMeter:s,LifeMeter:o,EquiptedItem:u,InventoryCounter:a}}),define("game/gui/Hud",["vendor/gf","game/data/constants","game/gui/huditems"],function(e,t,n){var r=function(){e.Container.call(this),this.scale.x=this.scale.y=t.SCALE/2,this.items={},this.addChild(this.items.magicMeter=new n.MagicMeter([40,36],1)),this.addChild(this.items.equipted=new n.EquiptedItem([75,42],"")),this.addChild(this.items.rupees=new n.InventoryCounter([135,30],"rupees",0)),this.addChild(this.items.bombs=new n.InventoryCounter([195,30],"bombs",0)),this.addChild(this.items.arrows=new n.InventoryCounter([245,30],"arrows",0)),this.addChild(this.items.life=new n.LifeMeter([320,35],3))};return e.inherit(r,e.Container,{updateValues:function(e){this.items.equipted.set(e.equipted),this.items.rupees.set(e.inventory.rupees),this.items.bombs.set(e.inventory.bombs),this.items.arrows.set(e.inventory.arrows),this.items.magicMeter.set(e.magic/e.maxMagic),this.items.life.max=e.maxHealth,this.items.life.set(e.health)}}),r}),define("game/gui/Inventory",["vendor/gf","game/data/constants","game/fonts/ReturnOfGanon","game/data/items"],function(e,t,n,r){var i=function(){e.Container.call(this);var n={volume:t.MUSIC_VOLUME};this.sounds={open:lttp.play.audio.add("effect_pause_close")},this.grid=[],this._setup(),this.scale.x=this.scale.y=t.SCALE,this.position.y=-t.HEIGHT*t.SCALE,this.visible=!1,this.move={},this.empty=!0};return e.inherit(i,e.Container,{updateValues:function(e){var t=this.empty,n=lttp.game.cache.getTextures("sprite_gui");for(var r=0;r<this.children.length;++r){var i=this.children[r],s=i.item,o=s?s.name:null,u,a;if(!o)continue;u=e.inventory[o],u||u===0&&(o==="armor"||o==="crystal")?(o==="flippers"?this.txtSwim.visible=!0:o==="boot"&&(this.txtRun.visible=!0),s.icon.call?a=s.icon(e):a=s.icon.replace("%d",u),i.visible=!0,i.setTexture(n[a]),s.grid&&(this.empty=!1)):i.visible=!1}this.txtLiftNum.visible=!0,this.txtLiftNum.setTexture(n[this.txtLiftNum.item.icon.replace("%d",e.inventory.gloves+1)]),t&&!this.empty&&(this.selected.x=-1,this.selected.y=0,this.onMove("right",{down:!0}),this.onMove("right",{down:!1}),e.equipted=this.grid[this.selected.x][this.selected.y].item.name,lttp.play.hud.updateValues(e)),this._moveSelector()},show:function(e){if(this.moving)return;this.moving=!0,this.visible=!0,this.sounds.open.play();var n=this;TweenLite.to(this.parent.position,t.INVENTORY_DROP_TIME,{y:t.HEIGHT*t.SCALE,ease:Linear.easeNone,onComplete:function(){n.moving=!1,e&&e()}})},hide:function(e){if(this.moving)return;this.moving=!0;var n=this;TweenLite.to(this.parent.position,t.INVENTORY_DROP_TIME,{y:0,ease:Linear.easeNone,onComplete:function(){n.visible=!1,n.moving=!1,e&&e()}})},_selectItem:function(e){var t,n;for(t=0;t<this.grid.length;++t)for(n=0;n<this.grid[t].length;++n)if(this.grid[t][n].item.name===e){this.selected.x=t,this.selected.y=n;break}this._moveSelector()},_setup:function(){var t=lttp.game.cache.getTextures("sprite_gui");this.addChild(new e.Sprite(t["inventory.png"]));for(var i=0;i<r.length;++i){var s=r[i],o;s._icon?o=new e.Sprite(t[s._icon]):o=new e.Sprite(t[s.icon.replace("%d",1)]),o.item=s,o.position.x=s.position[0],o.position.y=s.position[1],s.grid&&this._addToGrid(o,s.grid);if(s.name==="txtSwim"||s.name==="txtRun"||s.name==="txtLiftNum")this[s.name]=o;this.addChild(o)}this.selected=new e.Vector(0,0),this.selector=new e.Sprite(t["selector.png"]),this.selector.visible=!1,this.addChild(this.selector),this.activeItem=new e.Sprite(t["items/lantern.png"]),this.activeItem.position.x=200,this.activeItem.position.y=25,this.activeItem.visible=!1,this.addChild(this.activeItem),this.activeText=new n,this.activeText.position.x=175,this.activeText.position.y=55,this.activeText.scale.x=this.activeText.scale.y=.3,this.activeText.visible=!1,this.addChild(this.activeText)},_addToGrid:function(e,t){this.grid[t[0]]||(this.grid[t[0]]=[]);if(!this.grid[t[0]][t[1]])this.grid[t[0]][t[1]]=e;else{var n=this.grid[t[0]][t[1]];n instanceof Array?this.grid[t[0]][t[1]].push(e):this.grid[t[0]][t[1]]=[n,e]}},_moveSelector:function(){var e=this.grid[this.selected.x][this.selected.y];if(e.length)for(var t=e.length-1;t>-1;--t)if(e[t].visible){e=e[t];break}this.selector.position.x=e.position.x-5,this.selector.position.y=e.position.y-5,this.activeItem.setTexture(e.texture),this.activeText.text=e.item.name,e.visible&&(this.selector.visible=!0,this.activeItem.visible=!0,this.activeText.visible=!0)},onMove:function(e,t){if(this.empty)return;t.originalEvent&&t.originalEvent.preventDefault();if(!t.down){this.move[e]=!1;return}if(this.move[e])return;this.move[e]=!0;var n;e==="up"?n=this._findNext(0,-1):e==="down"?n=this._findNext(0,1):e==="left"?n=this._findNext(-1,0):e==="right"&&(n=this._findNext(1,0)),n&&(this.selected.x=n.x,this.selected.y=n.y,this._moveSelector())},_findNext:function(e,t){var n=this.selected.clone(),r=!1,i=this.grid.length-1,s=this.grid[0].length-1,o;while(!r){n.x+=e,n.y+=t,this._wrapGrid(n,i,s),o=this.grid[n.x][n.y];if(o.length)for(var u=o.length-1;u>-1;--u)r=r||o[u].visible;else r=r||o.visible}return n},_wrapGrid:function(e,t,n){e.x<0?(e.y--,e.x=t,e.y<0&&(e.y=n)):e.x>t&&(e.y++,e.x=0,e.y>n&&(e.y=0)),e.y<0?(e.x--,e.y=n,e.x<0&&(e.x=t)):e.y>n&&(e.x++,e.y=0,e.x>t&&(e.x=0))},onGpMove:function(t){var n;if(t.code===e.GamepadSticks.AXIS.LEFT_ANALOGUE_HOR)if(t.value>0){if(this.move.right)return;n="right"}else{if(this.move.left)return;n="left"}else if(t.value>0){if(this.move.down)return;n="down"}else{if(this.move.up)return;n="up"}n&&this.onMove(n,{down:!0})}}),i}),define("game/gui/Dialog",["vendor/gf","game/data/constants","game/fonts/ReturnOfGanon"],function(e,t,n){var r=function(){e.Container.call(this);var n={volume:t.MUSIC_VOLUME};this.sounds={open:lttp.play.audio.add("effect_pause_close",n)},this.scale.x=this.scale.y=t.SCALE,this.position.x=102,this.position.y=438,this.visible=!1,this.text="",this.range=[0,1],this.fastSpeed=15,this.typeSpeed=60,this.speed=this.typeSpeed,this.speedCooldown=250,this.firstOpen=!0,this.padding=5,this._setup()};return e.inherit(r,e.Container,{setText:function(e){this.text=e;var t=30;while(this.text[t]){var n=this._getPreviousSpace(this.text,t);this.text=[this.text.slice(0,n),"\n",this.text.slice(n+1)].join(""),t+=30}this.font.text=""},_getPreviousSpace:function(e,t){var n=!1,r=0;do{if(e[t-r]===" ")return t-r;r++}while(t+r<e.length||t-r>0)},show:function(e){this.firstOpen=!0,this.visible=!0,this.sounds.open.play(),this.range[0]=0,this.range[1]=1;var t=this;this._type(function(){setTimeout(function(){t.doneCb=e},t.speedCooldown)})},hide:function(){this.visible=!1},onAdvance:function(e){if(this.firstOpen){this.firstOpen=!1;return}if(this.doneCb)this.doneCb(),this.doneCb=null;else{this.speed=this.fastSpeed;var t=this;setTimeout(function(){t.speed=t.typeSpeed},this.speedCooldown)}},_type:function(e){this.font.text=this.text.substr(this.range[0],this.range[1]),this.range[1]++,this.range[1]>this.text.length?e&&e():setTimeout(this._type.bind(this,e),this.speed)},_setup:function(){this.addChild(new e.Sprite(lttp.game.cache.getTextures("sprite_gui")["dialog.png"])),this.font=new n,this.font.scale.x=this.font.scale.y=.5,this.font.position.x=8,this.font.position.y=8,this.addChild(this.font)}}),r}),define("game/utility/saves/ZoneSave",["vendor/gf","game/utility/saves/Save"],function(e,t){var n=function(e,n,r){t.call(this,"zone_"+e+"_"+r+"_"+n.name);var i=this.data.objects=[];for(var s=0,o=n.objects.length;s<o;++s)i.push({properties:{loot:n.objects[s].properties.loot}});this.zone=n};return e.inherit(n,t,{save:function(){t.prototype.save.call(this)},load:function(){var e=t.prototype.load.call(this),n=this.zone;if(e)for(var r=0;r<e.objects.length;++r){var i=n.objects[r],s=e.objects[r],o=i.properties.type||i.properties.tileprops.type,u=n.objects.length-1-r,a=n.children[u];i?(i.properties.loot=s.properties.loot,a.properties.loot=s.properties.loot,!i.properties.loot&&o==="chest"&&a.setTexture(lttp.game.cache.getTextures("sprite_worlditems")["dungeon/chest_open.png"])):console.warn("Mismatch on objects array length! Delete key: "+this.key)}return e}}),n}),define("game/states/Play",["vendor/gf","game/data/constants","game/data/resources","game/states/State","game/entities/Link","game/gui/Hud","game/gui/Inventory","game/gui/Dialog","game/utility/saves/LinkSave","game/utility/saves/ZoneSave","game/fonts/ReturnOfGanon"],function(e,t,n,r,i,s,o,u,a,f,l){var c=function(n){r.call(this,n,"play"),this.maps={},this.map=null,this.game.input.keyboard.on(e.Keyboard.KEY.B,this._boundToggleSaveMenu=this.onToggleSaveMenu.bind(this)),this.game.input.keyboard.on(e.Keyboard.KEY.M,this._boundToggleMap=this.onToggleMap.bind(this)),this.game.input.keyboard.on(e.Keyboard.KEY.I,this._boundToggleInventory=this.onToggleInventory.bind(this)),this.game.input.gamepad.buttons.on(e.GamepadButtons.BUTTON.SELECT,this._boundGpToggleSaveMenu=this.onToggleSaveMenu.bind(this)),this.game.input.gamepad.buttons.on(e.GamepadButtons.BUTTON.FACE_3,this._boundGpToggleMap=this.onToggleMap.bind(this)),this.game.input.gamepad.buttons.on(e.GamepadButtons.BUTTON.START,this._boundGpToggleInventory=this.onToggleInventory.bind(this)),this._bgtx=new e.RenderTexture(this.camera.size.x,this.camera.size.y),this._bgspr=new e.Sprite(this._bgtx),this._bgspr.visible=!1,this.loading=new l("Loading..."),this.loading.setPosition(75*t.SCALE,100*t.SCALE),this.loading.scale.set(t.SCALE,t.SCALE),this.loading.hide(),this.addChild(this.loading),this.camera.add.obj(this._bgspr)};return e.inherit(c,r,{start:function(e){r.prototype.start.call(this),this.linkSave=e;var t=this.lastLoad=e.data;this.link=this.createLink(),this.bindInput();for(var n in t.inventory)this.link.inventory[n]=t.inventory[n];this.link.health=t.health,this.link.maxHealth=t.maxHealth,this.link.magic=t.magic,this.link.maxMagic=t.maxMagic,this.link.equipted=t.equipted,this.camera.add.obj(this.hud=new s),this.camera.add.obj(this.inventory=new o),this.camera.add.obj(this.dialog=new u),this.hud.updateValues(this.link),this.inventory.updateValues(this.link),this.gotoMap({name:t.map,properties:{loc:t.position,transition:"fade"}})},stop:function(){this.game.input.keyboard.off(e.input.KEY.W,this._boundMoveUp),this.game.input.keyboard.off(e.input.KEY.S,this._boundMoveDown),this.game.input.keyboard.off(e.input.KEY.A,this._boundMoveLeft),this.game.input.keyboard.off(e.input.KEY.D,this._boundMoveRight),this.game.input.keyboard.off(e.input.KEY.E,this._boundUse),this.game.input.keyboard.on(e.input.KEY.V,this._boundUseItem),this.game.input.keyboard.off(e.input.KEY.M,this._boundToggleMap),this.game.input.keyboard.off(e.input.KEY.SPACE,this._boundAttack),this.game.input.keyboard.off(e.input.KEY.B,this._boundToggleSaveMenu),this.game.input.keyboard.off(e.input.KEY.I,this._boundToggleInventory),this.game.input.gamepad.sticks.off(e.GamepadSticks.AXIS.LEFT_ANALOGUE_HOR,this._boundGpMoveHor),this.game.input.gamepad.sticks.off(e.GamepadSticks.AXIS.LEFT_ANALOGUE_VERT,this._boundGpMoveVert),this.game.input.gamepad.buttons.off(e.GamepadButtons.BUTTON.PAD_TOP,this._boundGpMoveUp),this.game.input.gamepad.buttons.off(e.GamepadButtons.BUTTON.PAD_BOTTOM,this._boundGpMoveDown),this.game.input.gamepad.buttons.off(e.GamepadButtons.BUTTON.PAD_LEFT,this._boundGpMoveLeft),this.game.input.gamepad.buttons.off(e.GamepadButtons.BUTTON.PAD_RIGHT,this._boundGpMoveRight),this.game.input.gamepad.buttons.off(e.GamepadButtons.BUTTON.FACE_1,this._boundGpUse),this.game.input.gamepad.buttons.off(e.GamepadButtons.BUTTON.FACE_2,this._boundGpAttack),this.game.input.gamepad.buttons.off(e.GamepadButtons.BUTTON.FACE_3,this._boundGpToggleMap),this.game.input.gamepad.buttons.off(e.GamepadButtons.BUTTON.FACE_4,this._boundGpUseItem),this.game.input.gamepad.buttons.off(e.GamepadButtons.BUTTON.SELECT,this._boundGpToggleSaveMenu),this.game.input.gamepad.buttons.off(e.GamepadButtons.BUTTON.START,this._boundGpToggleInventory),this.game.input.keyboard.off(e.Keyboard.KEY.SHIFT,this._boundROCKET),this.game.input.gamepad.buttons.off(e.GamepadButtons.BUTTON.LEFT_TRIGGER,this._boundGpROCKET)},onToggleSaveMenu:function(){},onToggleMap:function(){},onToggleInventory:function(e){if(e.down)return;if(this.inventory.visible){var t=this,n=this.inventory.grid[this.inventory.selected.x][this.inventory.selected.y];this.inventory.empty||(this.link.equipted=n.item.name,this.hud.updateValues(this.link)),this.inventory.hide(function(){t.resume()})}else this.pause(),this.inventory.show()},onToggleAudio:function(){this.audio._muted?this.audio.unmute():this.audio.mute()},showDialog:function(e){this.pause(),this.dialog.setText(e);var t=this;this.dialog.show(function(){t.dialog.hide(),t.resume()})},pause:function(){this.hud.visible=!1,this._bgtx.render(this),this._bgspr.visible=!0,this.hud.visible=!0,this.world.visible=!1,this.physics.pause()},resume:function(){this._bgspr.visible=!1,this.world.visible=!0,this.physics.resume()},_saveZoneState:function(e){var t=new f(this.lastLoad.slot,e,this.lastExit.name);t.save(),this.linkSave.save(this.link,this.lastExit.name,this.lastExit.properties.loc)},gotoMap:function(e,t){typeof e=="string"&&(e={name:e});var n=this;if(this.map&&e.properties.animation){this.link.once("complete",function(){n._doMapTransition(e,t),n.link.unlock()}),this.link.lock(),this.link.goto(0,e.properties.animation).play();return}this._doMapTransition(e,t)},_doMapTransition:function(e,t){var n=250,r=this,i;if(!this.map){i=this.camera.fade(0,1,1,function(){return r._dogotoMap(e,t,function(){r.camera.flash(0,n*3),i.stop()}),!1});return}switch(e.properties.transition){case"none":this._dogotoMap(e,t);break;case"close":this.camera.close("ellipse",n,this.link.position,function(){r._dogotoMap(e,t)});case"fade":default:i=this.camera.fade(0,n,1,function(){return r._dogotoMap(e,t,function(){r.camera.flash(0,n),i.stop()}),!1})}},_dogotoMap:function(e,r,i){var s=this;this.link.parent&&this.link.parent.removeChild(this.link),this.map&&(this._saveZoneState(this.activeLayer),this.map.despawnObjects(),this.map.clearTiles(),this.map.parent&&this.map.parent.removeChild(this.map)),s.maps[e.name]?this._dogotoMapLoaded(e,r,i):(n[e.name](this.game),this.loading.show(),this.game.load.once("complete",function(){s.game.cache.getTilemap(e.name).data.properties.scale=t.SCALE,s.maps[e.name]=s.world.add.tilemap(e.name,!0),s._dogotoMapLoaded(e,r,i),s.loading.hide()}),this.game.load.start())},_dogotoMapLoaded:function(e,t,n){var r=this;this.firstZone=!0,this.physics.nextTick(function(){r.physics.skip(2),r.map=r.maps[e.name],r.world.add.obj(r.map);var t=r.map.findLayer("player");t?t.addChild(r.link):r.map.addChild(r.link),r.lastExit=e,r.map.findLayer("exits").spawn(),r.map.findLayer("zones").spawn(),r.link.setPosition(e.properties.loc[0],e.properties.loc[1]),r.game.once("tick",function(){r.game.once("tick",function(){r.game.once("tick",function(){r.map.render(),n&&n()})})})})},showMapOverlay:function(){var e=this.map.properties.overlay},gotoZone:function(e,t){if(e===this.activeZone)return;this.oldZone=this.activeZone,this.oldLayer=this.activeLayer,this.oldLayerOverlay=this.activeLayerOverlay,this.activeZone=e,this.activeLayer=this.map.findLayer(e.name),this.activeLayerOverlay=this.map.findLayer(e.name+"_overlay"),this.activeLayer.spawn(),this.activeLayerOverlay?(this.overlay.stop().hide(),this.activeLayerOverlay.spawn()):this.showMapOverlay();var n=new f(this.lastLoad.slot,this.activeLayer,this.lastExit.name);n.load(),this.camera.unfollow(),this.camera.unconstrain(),this.firstZone?this._zoneReady():this._zoneTransition(e,t)},_zoneTransition:function(e,t){var n=t.x?"x":"y",r=0,i={v:0},s=20,o=500,e=this.activeZone,u=this;this.link.lock();switch(e.properties.transition||this.oldZone.properties.transition){case"fade":this.camera.fade(0,o,1,function(){u.camera.pan(u.camera.size.x*t.x,u.camera.size.y*t.y),u.link.position[n]+=s*t[n],u.link.setPosition(u.link.position.x,u.link.position.y),u._zoneReady()});break;case"none":u.camera.pan(u.camera.size.x*t.x,u.camera.size.y*t.y),u.link.position[n]+=s*t[n],u.link.setPosition(u.link.position.x,u.link.position.y),u._zoneReady();break;case"slide":default:TweenLite.to(i,o/1e3,{v:this.camera.size[n],ease:Linear.easeNone,onUpdate:function(){var e=i.v-r;u.camera.pan(e*t.x,e*t.y),u.link.position[n]+=e/u.camera.size[n]*s*t[n],u.link.setPosition(u.link.position.x,u.link.position.y),r=i.v},onComplete:this._zoneReady.bind(this)})}},_zoneReady:function(){this.oldLayer&&(this._saveZoneState(this.oldLayer),this.oldLayer.despawn(),this.oldLayerOverlay&&this.oldLayerOverlay.despawn());var n=this.activeZone,r=t.SCALE;this.firstZone=!1,n.bounds||(n.bounds=n.hitArea.clone(),n.bounds.x+=n.position.x,n.bounds.y+=n.position.y,(n.bounds._shapetype=e.SHAPE.RECTANGLE)?(n.bounds.x*=r,n.bounds.y*=r,n.bounds.width*=r,n.bounds.height*=r):(n.bounds.scale.set(r,r),n.bounds.recalc())),this.camera.constrain(n.bounds.clone()),this.camera.follow(this.link,e.CAMERA_FOLLOW.LOCKON),this.camera.pan(1,1),this.setMusic(n.properties.music||this.map.properties.music),this.link.unlock()},setMusic:function(n){if(!n||this.music&&this.music.key===n)return;this.music&&this.music.stop(),this.music=this.audio.add(n,{volume:t.MUSIC_VOLUME,loop:!0}),this.music?this.music.play():e.utils.warn('Music not loaded! "'+zone.properties.music+'"')},createLink:function(t){if(this.link)return this.link;var n=new i(this.game.cache.getTextures("sprite_link")),r=this;return n.hitArea=new e.Polygon(0,0,[7,8,9,8,16,14,16,16,9,22,7,22,0,16,0,14]),n.mass=1,n.inertia=Infinity,n.friction=0,n.anchor.x=0,n.anchor.y=1,n.enablePhysics(this.physics,function(){n.addAttackSensor(this)}),n.on("updateHud",function(){r.hud.updateValues(n),r.inventory.updateValues(n)}),n.on("zone",function(e,t){r.gotoZone(e,t)}),n.on("exit",function(e,t){r.gotoMap(e,t)}),n.on("readSign",function(e){r.showDialog(e.properties.text)}),n},bindInput:function(){this.game.input.keyboard.on(e.Keyboard.KEY.W,this._boundMoveUp=this.onMove.bind(this,"up")),this.game.input.keyboard.on(e.Keyboard.KEY.S,this._boundMoveDown=this.onMove.bind(this,"down")),this.game.input.keyboard.on(e.Keyboard.KEY.A,this._boundMoveLeft=this.onMove.bind(this,"left")),this.game.input.keyboard.on(e.Keyboard.KEY.D,this._boundMoveRight=this.onMove.bind(this,"right")),this.game.input.keyboard.on(e.Keyboard.KEY.E,this._boundUse=this.onUse.bind(this)),this.game.input.keyboard.on(e.Keyboard.KEY.V,this._boundUseItem=this.onUseItem.bind(this)),this.game.input.keyboard.on(e.Keyboard.KEY.SPACE,this._boundAttack=this.onAttack.bind(this)),this.game.input.gamepad.sticks.on(e.GamepadSticks.AXIS.LEFT_ANALOGUE_HOR,this._boundGpMoveHor=this.onGpMove.bind(this)),this.game.input.gamepad.sticks.on(e.GamepadSticks.AXIS.LEFT_ANALOGUE_VERT,this._boundGpMoveVert=this.onGpMove.bind(this)),this.game.input.gamepad.sticks.threshold=.35,this.game.input.gamepad.buttons.on(e.GamepadButtons.BUTTON.PAD_TOP,this._boundGpMoveUp=this.onMove.bind(this,"up")),this.game.input.gamepad.buttons.on(e.GamepadButtons.BUTTON.PAD_BOTTOM,this._boundGpMoveDown=this.onMove.bind(this,"down")),this.game.input.gamepad.buttons.on(e.GamepadButtons.BUTTON.PAD_LEFT,this._boundGpMoveLeft=this.onMove.bind(this,"left")),this.game.input.gamepad.buttons.on(e.GamepadButtons.BUTTON.PAD_RIGHT,this._boundGpMoveRight=this.onMove.bind(this,"right")),this.game.input.gamepad.buttons.on(e.GamepadButtons.BUTTON.FACE_1,this._boundGpUse=this.onUse.bind(this)),this.game.input.gamepad.buttons.on(e.GamepadButtons.BUTTON.FACE_2,this._boundGpAttack=this.onAttack.bind(this)),this.game.input.gamepad.buttons.on(e.GamepadButtons.BUTTON.FACE_4,this._boundGpUseItem=this.onUseItem.bind(this)),this.game.input.keyboard.on(e.Keyboard.KEY.SHIFT,this._boundROCKET=this.onROCKET.bind(this)),this.game.input.gamepad.buttons.on(e.GamepadButtons.BUTTON.LEFT_TRIGGER,this._boundGpROCKET=this.onROCKET.bind(this))},onMove:function(e,t){this.inventory.visible?this.inventory.onMove(e,t):this.link.onWalk(e,t)},onGpMove:function(e){this.inventory.visible?this.inventory.onGpMove(e):this.link.onGpWalk(e)},onUse:function(e){this.dialog.visible?this.dialog.onAdvance(e):this.link.onUse(e)},onUseItem:function(e){this.dialog.visible?this.dialog.onAdvance(e):this.link.onUseItem(e)},onAttack:function(e){this.dialog.visible?this.dialog.onAdvance(e):this.link.onAttack(e)},onROCKET:function(e){e.down?this.link.moveSpeed=400:this.link.moveSpeed=87,this.link._checkMovement()}}),c}),define("game/entities/misc/Torch",["vendor/gf","game/data/constants","game/entities/Entity"],function(e,t,n){var r=function(){n.call(this,lttp.game.cache.getTextures("sprite_misc"),.2),this.addAnimation("torch",[this.spritesheet["torch/torch0.png"].frames[0]]),this.addAnimation("torch_lit",[this.spritesheet["torch/torch1.png"].frames[0],this.spritesheet["torch/torch2.png"].frames[0],this.spritesheet["torch/torch3.png"].frames[0]],.09,!0),this.addAnimation("wall_torch",[this.spritesheet["torch/wall_torch1.png"].frames[0],this.spritesheet["torch/wall_torch2.png"].frames[0],this.spritesheet["torch/wall_torch3.png"].frames[0]],.09,!0),this.light=.25};return e.inherit(r,n,{lite:function(){if(this.type!=="torch")return;this.goto(0,"torch_lit").play(),setTimeout(this.extinguish.bind(this),5e3),lttp.play.world.findLayer("darkness").alpha-=this.light},extinguish:function(){if(this.type!=="torch")return;this.gotoAndStop("torch"),lttp.play.world.findLayer("darkness").alpha+=this.light}}),r}),define("game/entities/misc/Flower",["vendor/gf","game/data/constants","game/entities/Entity"],function(e,t,n){var r=function(){n.call(this,lttp.game.cache.getTextures("sprite_misc"),.2),this.addAnimation("flower_1",[this.spritesheet["flower/flower_1_3.png"].frames[0],this.spritesheet["flower/flower_1_1.png"].frames[0],this.spritesheet["flower/flower_1_2.png"].frames[0]],.095,!0),this.addAnimation("flower_2",[this.spritesheet["flower/flower_2_3.png"].frames[0],this.spritesheet["flower/flower_2_1.png"].frames[0],this.spritesheet["flower/flower_2_2.png"].frames[0]],.095,!0)};return e.inherit(r,n,{}),r}),require(["vendor/gf","game/data/constants","game/data/resources","game/states/Intro","game/states/Select","game/states/Play","game/entities/misc/Torch","game/entities/misc/Flower","game/fonts/ReturnOfGanon"],function(e,t,n,r,i,s,o,u,a){function h(){lttp.intro.stop(),l.input.keyboard.off(e.Keyboard.KEY.ENTER,h),l.input.keyboard.off(e.Keyboard.KEY.SPACE,h),l.input.gamepad.buttons.off(e.GamepadButtons.BUTTON.FACE_1,h),l.input.gamepad.buttons.off(e.GamepadButtons.BUTTON.START,h),lttp.select.start()}function p(e){lttp.select.stop(),lttp.play.start(e)}function d(){gfdebug.show(l)}function v(e){if(e.down)return;c?(lttp.intro.audio.unmute(),lttp.select.audio.unmute(),lttp.play.audio.unmute(),c=!1):(lttp.intro.audio.mute(),lttp.select.audio.mute(),lttp.play.audio.mute(),c=!0)}function m(e){lttp.loading.text="Loading: "+e+"%"}var f,l,c;t.SCALE=window.LTTP_SCALE||t.SCALE,t.TEXT_SCALE=window.LTTP_TEXT_SCALE||t.TEXT_SCALE,window.lttp={game:null,loading:null,intro:null,select:null,play:null},$(function(){f=$("#game"),e.Texture.SCALE_MODE.DEFAULT=e.Texture.SCALE_MODE.NEAREST,lttp.game=l=new e.Game("game",{width:f.width(),height:f.height(),transparent:!0,renderer:e.RENDERER.AUTO}),l.load.baseUrl=window.LTTP_BASE_URL||"",n.preload(l),l.load.once("complete",function(){lttp.loading=new a("Loading: 0%"),lttp.loading.setPosition(75*t.SCALE,100*t.SCALE),lttp.loading.scale.set(t.SCALE,t.SCALE),l.camera.add.obj(lttp.loading),l.spritepool.add("torch",o),l.spritepool.add("flower",u),n.startup(l),n.common(l),l.load.on("progress",m),l.load.once("complete",function(){lttp.intro=new r(l),lttp.intro.start(),lttp.select=new i(l),lttp.select.on("select",p),lttp.play=new s(l),l.input.keyboard.on(e.Keyboard.KEY.ENTER,h),l.input.keyboard.on(e.Keyboard.KEY.SPACE,h),l.input.gamepad.buttons.on(e.GamepadButtons.BUTTON.FACE_1,h),l.input.gamepad.buttons.on(e.GamepadButtons.BUTTON.START,h),l.input.keyboard.once(e.Keyboard.KEY.TILDE,d),l.input.keyboard.on(e.Keyboard.KEY.P,v),l.input.gamepad.buttons.on(e.GamepadButtons.BUTTON.RIGHT_SHOULDER,v),lttp.loading.hide(),l.load.off("progress",m)}),l.load.start()}),l.load.start(),l.render()})}),define("main",function(){})})();